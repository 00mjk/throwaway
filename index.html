<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <style>html, body {
  margin: 0;
  padding: 0;
}

.app {
  margin: 10px;
  padding: 0;
}

.files-list {
  margin: 10px 0 0;
  width: 100%;
  border-collapse: collapse;
}
.files-list__head {
  border: 1px solid #999;
}
.files-list__head > tr > th {
  padding: 10px;
  border: 1px solid #999;
  text-align: left;
  font-weight: normal;
  background: #ddd;
}
.files-list__body {
}
.files-list__file {
  cursor: pointer;
}
.files-list__file:hover {
  background: #ccf;
}
.files-list__file > td {
  padding: 10px;
  border: 1px solid #999;
}
.files-list__file > td:first-child::before {
  content: '\01F4C4';
  margin-right: 1em;
}
.files-list__file_low {
  background: #fcc;
}
.files-list__file_medium {
  background: #ffc;
}
.files-list__file_high {
  background: #cfc;
}
.files-list__file_folder > td:first-child::before {
  content: '\01F4C1';
  margin-right: 1em;
}

.file-header {
  border: 1px solid #999;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.file-header__back {
  margin: 10px;
  cursor: pointer;
  flex-shrink: 0;
  flex-grow: 0;
  text-decoration: underline;
  color: #338;
}

.file-header__name {
  margin: 10px;
  flex-shrink: 2;
  flex-grow: 2;
}

.file-header__stat {
  margin: 10px;
  flex-shrink: 0;
  flex-grow: 0;
}

.file-content {
  margin: 10px 0 0;
  border: 1px solid #999;
  padding: 10px;
}

.code-line {
  margin: 0;
  padding: 0.3em;
  height: 1em;
}
.code-line_covered {
  background: #cfc;
}
.code-line_uncovered {
  background: #fcc;
}
</style>
</head>
<body>
    <div id="root"></div>
    <script>
        var data = {"files":[{"path":["/","home","runner","work","throwaway","throwaway","src","attributes","core.rs"],"content":"use serde::{Deserialize, Serialize};\n\nuse crate::attributes::profile::ProfileAttributes;\n\n#[derive(Default, Clone, Debug, Serialize, Deserialize)]\npub struct Attributes {\n    profile: Option\u003cProfileAttributes\u003e,\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","attributes","mod.rs"],"content":"pub mod core;\npub mod profile;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","attributes","profile.rs"],"content":"use serde::{Deserialize, Serialize};\n\nuse crate::helpers::serialization::is_none_or_false;\n\n#[derive(Default, Clone, Debug, Serialize, Deserialize)]\npub struct ProfileAttributes {\n    #[serde(skip_serializing_if = \"is_none_or_false\")]\n    pub create: Option\u003cbool\u003e,\n\n    #[serde(skip_serializing_if = \"is_none_or_false\")]\n    pub read: Option\u003cbool\u003e,\n\n    #[serde(skip_serializing_if = \"is_none_or_false\")]\n    pub update: Option\u003cbool\u003e,\n\n    #[serde(skip_serializing_if = \"is_none_or_false\")]\n    pub delete: Option\u003cbool\u003e,\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","core","cache.rs"],"content":"use std::fmt::Debug;\n\nuse deadpool_redis::{Config as RedisConfig, Runtime};\nuse deadpool_redis::{Connection, Pool};\nuse redis::{AsyncCommands, FromRedisValue, RedisResult, ToRedisArgs};\nuse tracing::info;\n\nuse crate::config::Config;\nuse crate::errors::core::ServerError;\nuse crate::models::secrets::cache::CacheSecrets;\n\npub type CachePool = Pool;\n\npub fn connect(config: \u0026Config, cache_secrets: \u0026CacheSecrets) -\u003e Result\u003cCachePool, ServerError\u003e {\n    let dsn = if config.use_local {\n        cache_secrets.local_dsn()\n    } else {\n        cache_secrets.dsn()\n    };\n\n    info!(\"Redis DSN: {dsn}\");\n\n    let redis_config = RedisConfig {\n        url: Some(dsn),\n        connection: None,\n        pool: None,\n    };\n\n    redis_config\n        .create_pool(Some(Runtime::Tokio1))\n        .map_err(ServerError::CacheError)\n}\n\n#[derive(Clone)]\npub struct Cache {\n    pool: CachePool,\n}\n\nimpl Cache {\n    #[must_use]\n    pub const fn new(pool: CachePool) -\u003e Self {\n        Self {\n            pool,\n        }\n    }\n\n    async fn connection(\u0026self) -\u003e Connection {\n        self.pool.get().await.unwrap()\n    }\n\n    pub async fn get\u003cT\u003e(\u0026self, key: \u0026str) -\u003e Option\u003cT\u003e\n    where\n        T: FromRedisValue + Debug + Send + Sync,\n    {\n        let mut cache = self.connection().await;\n\n        if self.exists(key).await {\n            let result = cache.get(\u0026key).await;\n            if let Ok(inner) = result {\n                info!(\"HIT | {key} | {inner:#?}\");\n                return Some(inner);\n            }\n        }\n\n        info!(\"MISS | {key}\");\n        None\n    }\n\n    pub async fn set\u003cT\u003e(\u0026self, key: \u0026str, value: T, expiry: usize)\n    where\n        T: ToRedisArgs + Debug + Send + Sync,\n    {\n        let mut cache = self.connection().await;\n\n        info!(\"SET | {key} | {value:#?}\");\n        let result = cache\n            .set_ex::\u003c_, _, ()\u003e(\u0026key, value, expiry)\n            .await;\n\n        if result.is_err() {\n            info!(\"Failed to set\");\n        }\n    }\n\n    pub async fn delete(\u0026self, key: \u0026str) {\n        let mut cache = self.connection().await;\n\n        info!(\"DELETE | {key}\");\n        let result = cache.del::\u003c_, ()\u003e(\u0026key).await;\n\n        if result.is_err() {\n            info!(\"Failed to delete\");\n        }\n    }\n\n    pub async fn exists(\u0026self, key: \u0026str) -\u003e bool {\n        let mut cache = self.connection().await;\n\n        let cache_exists: RedisResult\u003cbool\u003e = cache.exists(\u0026key).await;\n        if let Ok(exists) = cache_exists {\n            info!(\"EXISTS | {key} | {exists}\");\n            return exists;\n        }\n\n        info!(\"EXISTS | {key} | false\");\n        false\n    }\n}\n","traces":[{"line":14,"address":[3884320,3887641,3887606],"length":1,"stats":{"Line":5},"fn_name":"connect"},{"line":15,"address":[3884367],"length":1,"stats":{"Line":5},"fn_name":null},{"line":16,"address":[3884423],"length":1,"stats":{"Line":5},"fn_name":null},{"line":18,"address":[3884392],"length":1,"stats":{"Line":0},"fn_name":null},{"line":21,"address":[3885483,3884604,3886392,3886291,3886938,3885130,3886236,3885399,3887010,3884966],"length":1,"stats":{"Line":25},"fn_name":null},{"line":24,"address":[3885883],"length":1,"stats":{"Line":5},"fn_name":null},{"line":29,"address":[3886191,3887580],"length":1,"stats":{"Line":10},"fn_name":null},{"line":30,"address":[3886183],"length":1,"stats":{"Line":5},"fn_name":null},{"line":41,"address":[3887680],"length":1,"stats":{"Line":5},"fn_name":"new"},{"line":47,"address":[3888317,3887712,3887861,3887743,3887959,3888036,3887792],"length":1,"stats":{"Line":12},"fn_name":"connection"},{"line":48,"address":[4677100],"length":1,"stats":{"Line":9},"fn_name":null},{"line":51,"address":[3888806,3888560],"length":1,"stats":{"Line":6},"fn_name":"get\u003cthrowaway::models::database::profile::Profile\u003e"},{"line":55,"address":[4641352],"length":1,"stats":{"Line":12},"fn_name":null},{"line":57,"address":[4641270],"length":1,"stats":{"Line":12},"fn_name":null},{"line":58,"address":[3888920,3889942],"length":1,"stats":{"Line":4},"fn_name":null},{"line":59,"address":[3890338],"length":1,"stats":{"Line":2},"fn_name":null},{"line":60,"address":[3891201,3892560,3890675,3893149,3891037,3892180,3892341,3891492,3893952,3891576,3893233],"length":1,"stats":{"Line":10},"fn_name":null},{"line":61,"address":[3892108],"length":1,"stats":{"Line":2},"fn_name":null},{"line":65,"address":[3894056,3896364,3895395,3894418,3895556,3894582,3894957,3894873,3895775,3896448],"length":1,"stats":{"Line":15},"fn_name":null},{"line":66,"address":[3895369],"length":1,"stats":{"Line":3},"fn_name":null},{"line":69,"address":[3897270,3897008],"length":1,"stats":{"Line":6},"fn_name":"set\u003c\u0026throwaway::models::database::profile::Profile\u003e"},{"line":73,"address":[3897335,3897375,3897627,3897808,3897460],"length":1,"stats":{"Line":12},"fn_name":null},{"line":75,"address":[3900600,3899631,3898657,3900684,3898131,3898948,3898493,3899032,3900011,3899792],"length":1,"stats":{"Line":15},"fn_name":null},{"line":76,"address":[3899576,3899605,3901596,3901516],"length":1,"stats":{"Line":12},"fn_name":null},{"line":77,"address":[4643087],"length":1,"stats":{"Line":15},"fn_name":null},{"line":78,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":80,"address":[3901851,3901786,3903213],"length":1,"stats":{"Line":6},"fn_name":null},{"line":81,"address":[3902341,3903379,3902880,3903218,3903598,3904178,3902505,3904250,3901979,3902796],"length":1,"stats":{"Line":0},"fn_name":null},{"line":85,"address":[3904848,3904895],"length":1,"stats":{"Line":0},"fn_name":"delete"},{"line":96,"address":[3905235,3905691,3905393,3904960,3905007,3905125,3905072],"length":1,"stats":{"Line":12},"fn_name":"exists"},{"line":97,"address":[3905702,3905350,3905265,3905225,3905521],"length":1,"stats":{"Line":12},"fn_name":null},{"line":99,"address":[3905959,3905861,3905283],"length":1,"stats":{"Line":9},"fn_name":null},{"line":100,"address":[3906337],"length":1,"stats":{"Line":3},"fn_name":null},{"line":101,"address":[3911110,3910200,3912163,3911490,3910491,3909674,3912079,3910575,3911271,3910036],"length":1,"stats":{"Line":15},"fn_name":null},{"line":102,"address":[3911078],"length":1,"stats":{"Line":3},"fn_name":null},{"line":105,"address":[3907175,3906649,3908362,3909035,3907011,3908143,3908951,3907466,3907550,3907982],"length":1,"stats":{"Line":0},"fn_name":null},{"line":106,"address":[3907956],"length":1,"stats":{"Line":0},"fn_name":null}],"covered":31,"coverable":37},{"path":["/","home","runner","work","throwaway","throwaway","src","core","config.rs"],"content":"use dotenv::dotenv;\nuse envconfig::Envconfig;\nuse serde::Serialize;\nuse tracing::error;\n\nuse crate::errors::core::ServerError;\n\n#[derive(Envconfig, Clone, Debug, Serialize)]\npub struct Config {\n    #[envconfig(from = \"USE_LOCAL\", default = \"false\")]\n    pub use_local: bool,\n\n    #[envconfig(from = \"VAULT_URL\")]\n    pub vault_url: String,\n    #[envconfig(from = \"VAULT_TOKEN\")]\n    pub vault_token: String,\n\n    #[envconfig(from = \"VAULT_KV_MOUNT\")]\n    pub vault_kv_mount: String,\n    #[envconfig(from = \"VAULT_KV_PATH_REDIS\")]\n    pub vault_kv_path_redis: String,\n    #[envconfig(from = \"VAULT_KV_PATH_JWT\")]\n    pub vault_kv_path_jwt: String,\n\n    #[envconfig(from = \"VAULT_DATABASE_MOUNT\")]\n    pub vault_database_mount: String,\n    #[envconfig(from = \"VAULT_DATABASE_DEPLOYMENT_ROLE\")]\n    pub vault_database_deployment_role: String,\n    #[envconfig(from = \"VAULT_DATABASE_ROLE\")]\n    pub vault_database_role: String,\n\n    #[envconfig(from = \"DATABASE_HOST\")]\n    pub database_host: String,\n    #[envconfig(from = \"DATABASE_PORT\")]\n    pub database_port: String,\n    #[envconfig(from = \"DATABASE_DB\")]\n    pub database_db: String,\n    #[envconfig(from = \"DATABASE_CONNECTIONS\", default = \"50\")]\n    pub database_connections: u32,\n    #[envconfig(from = \"DATABASE_LIFETIME\", default = \"3600\")]\n    pub database_lifetime: u64,\n}\n\npub fn read() -\u003e Result\u003cConfig, ServerError\u003e {\n    dotenv().ok();\n    Config::init_from_env().map_err(|error| {\n        error!(\"Failed to load config: {error:#?}\");\n        ServerError::EnvConfigError(error)\n    })\n}\n","traces":[{"line":44,"address":[4393728],"length":1,"stats":{"Line":5},"fn_name":"read"},{"line":45,"address":[4393744],"length":1,"stats":{"Line":5},"fn_name":null},{"line":46,"address":[8256848,8256806],"length":1,"stats":{"Line":5},"fn_name":"{closure#0}"},{"line":47,"address":[4393956,4394730,4394413,4394265,4395322,4395274,4395389,4395905,4395967,4394656],"length":1,"stats":{"Line":0},"fn_name":null},{"line":48,"address":[4395185],"length":1,"stats":{"Line":0},"fn_name":null}],"covered":3,"coverable":5},{"path":["/","home","runner","work","throwaway","throwaway","src","core","database.rs"],"content":"use std::time::Duration;\n\nuse sqlx::{postgres::PgPoolOptions, Pool, Postgres};\nuse tracing::{error, info};\n\nuse crate::config::Config;\nuse crate::errors::core::ServerError;\nuse crate::models::secrets::database::DatabaseSecrets;\n\npub type DatabasePool = Pool\u003cPostgres\u003e;\n\npub async fn connect(config: \u0026Config, database_secrets: \u0026DatabaseSecrets) -\u003e Result\u003cDatabasePool, ServerError\u003e {\n    let dsn = if config.use_local {\n        database_secrets.local_dsn()\n    } else {\n        database_secrets.dsn()\n    };\n\n    info!(\"Database DSN: {dsn}\");\n\n    PgPoolOptions::new()\n        .max_connections(config.database_connections)\n        .max_lifetime(Duration::from_secs(config.database_lifetime))\n        .connect(\u0026dsn)\n        .await\n        .map_err(|error| {\n            error!(\"Failed to connect to Postgres: {error:#?}\");\n            ServerError::SqlxError(error)\n        })\n}\n","traces":[{"line":12,"address":[8142103,8142064],"length":1,"stats":{"Line":20},"fn_name":"connect"},{"line":13,"address":[5899636],"length":1,"stats":{"Line":5},"fn_name":null},{"line":14,"address":[4765812,4765882],"length":1,"stats":{"Line":10},"fn_name":null},{"line":16,"address":[4776540,4776319],"length":1,"stats":{"Line":0},"fn_name":null},{"line":19,"address":[5900088,5900909,5901802,5902395,5902483,5901583,5900450,5901422,5903043,5900614,5900997],"length":1,"stats":{"Line":25},"fn_name":null},{"line":21,"address":[4769350,4769568,4769205,4769674,4767380,4769893,4769113],"length":1,"stats":{"Line":35},"fn_name":null},{"line":22,"address":[5903155,5903192],"length":1,"stats":{"Line":10},"fn_name":null},{"line":23,"address":[5903168,5903316,5903056,5903276],"length":1,"stats":{"Line":10},"fn_name":null},{"line":24,"address":[4776190,4780208,4780346,4779925,4779804,4779966,4780145,4779850,4780044,4779576],"length":1,"stats":{"Line":30},"fn_name":null},{"line":26,"address":[5904912,5907846],"length":1,"stats":{"Line":0},"fn_name":"{closure#0}"},{"line":27,"address":[5905632,5906669,5905905,5905468,5907228,5907304,5906568,5905106,5906516,5905993],"length":1,"stats":{"Line":0},"fn_name":null},{"line":28,"address":[5906434],"length":1,"stats":{"Line":0},"fn_name":null}],"covered":8,"coverable":12},{"path":["/","home","runner","work","throwaway","throwaway","src","core","logging.rs"],"content":"use tracing::subscriber::set_global_default;\nuse tracing_error::ErrorLayer;\nuse tracing_log::LogTracer;\nuse tracing_subscriber::filter::FromEnvError;\nuse tracing_subscriber::layer::SubscriberExt;\nuse tracing_subscriber::{EnvFilter, Registry};\n\nuse crate::errors::core::ServerError;\n\n#[allow(clippy::cognitive_complexity)]\npub fn init() -\u003e Result\u003c(), ServerError\u003e {\n    LogTracer::init().map_err(ServerError::LogTracerError)?;\n\n    let env_filter = EnvFilter::try_from_default_env()\n        .or_else(|_| EnvFilter::try_new(\"debug\"))\n        .map_err(|err| ServerError::LogEnvError(FromEnvError::from(err)))?;\n\n    let stdout_subscriber = tracing_subscriber::fmt::layer();\n\n    let subscriber = Registry::default()\n        .with(env_filter)\n        .with(ErrorLayer::default())\n        .with(stdout_subscriber);\n\n    set_global_default(subscriber).map_err(ServerError::LogSubscriberError)?;\n\n    Ok(())\n}\n","traces":[{"line":11,"address":[8115099,8113872,8114712],"length":1,"stats":{"Line":5},"fn_name":"init"},{"line":12,"address":[4260311,4260414],"length":1,"stats":{"Line":5},"fn_name":null},{"line":14,"address":[8134851,8134499,8134605],"length":1,"stats":{"Line":10},"fn_name":null},{"line":15,"address":[4261520,4261504],"length":1,"stats":{"Line":10},"fn_name":"{closure#0}"},{"line":16,"address":[8135776,8135790,8134790],"length":1,"stats":{"Line":0},"fn_name":"{closure#1}"},{"line":18,"address":[8114256],"length":1,"stats":{"Line":5},"fn_name":null},{"line":20,"address":[4260974,4261069,4260818,4260901],"length":1,"stats":{"Line":20},"fn_name":null},{"line":21,"address":[8114435,8114510],"length":1,"stats":{"Line":10},"fn_name":null},{"line":22,"address":[8135202,8135030,8135127],"length":1,"stats":{"Line":10},"fn_name":null},{"line":23,"address":[4261013],"length":1,"stats":{"Line":5},"fn_name":null},{"line":25,"address":[4261251,4261137],"length":1,"stats":{"Line":5},"fn_name":null},{"line":27,"address":[4261230],"length":1,"stats":{"Line":5},"fn_name":null}],"covered":11,"coverable":12},{"path":["/","home","runner","work","throwaway","throwaway","src","core","migrations.rs"],"content":"use sqlx::migrate;\nuse sqlx::migrate::Migrator;\n\nuse crate::{DatabasePool, ServerError};\n\n// Migrations embedded within the binary\nstatic MIGRATOR: Migrator = migrate!(\"./sql/migrations\");\n\npub async fn migrate(database_deployment: \u0026DatabasePool) -\u003e Result\u003c(), ServerError\u003e {\n    MIGRATOR\n        .run(database_deployment)\n        .await\n        .map_err(ServerError::SqlxMigrationError)?;\n\n    Ok(())\n}\n","traces":[{"line":9,"address":[8018038,8018016],"length":1,"stats":{"Line":25},"fn_name":"migrate"},{"line":10,"address":[5230814,5231296,5231084,5230896,5230507],"length":1,"stats":{"Line":20},"fn_name":null},{"line":11,"address":[5283249],"length":1,"stats":{"Line":20},"fn_name":null},{"line":13,"address":[5098898,5098716],"length":1,"stats":{"Line":0},"fn_name":null},{"line":15,"address":[5098703],"length":1,"stats":{"Line":5},"fn_name":null}],"covered":4,"coverable":5},{"path":["/","home","runner","work","throwaway","throwaway","src","core","mod.rs"],"content":"pub mod cache;\npub mod config;\npub mod database;\npub mod logging;\npub mod migrations;\npub mod secrets;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","core","secrets.rs"],"content":"use serde::{Deserialize, Serialize};\nuse vaultrs::client::{VaultClient, VaultClientSettingsBuilder};\nuse vaultrs::database::role::creds;\nuse vaultrs::kv2;\n\nuse crate::config::Config;\nuse crate::models::secrets::cache::CacheSecrets;\nuse crate::models::secrets::database::DatabaseSecrets;\nuse crate::models::secrets::jwt::JwtSecrets;\nuse crate::ServerError;\n\n#[derive(Clone, Debug, Deserialize, Serialize)]\npub struct Secrets {\n    pub cache: CacheSecrets,\n    pub database: DatabaseSecrets,\n    pub database_deployment: DatabaseSecrets,\n    pub jwt: JwtSecrets,\n}\n\n// FIXME: Support reading Vault token from filepath (K8s injection method)\npub async fn read(config: \u0026Config) -\u003e Result\u003cSecrets, ServerError\u003e {\n    let settings = VaultClientSettingsBuilder::default()\n        .address(\u0026config.vault_url)\n        .token(\u0026config.vault_token)\n        .build()\n        .map_err(ServerError::VaultClientConfigError)?;\n\n    let client = VaultClient::new(settings).map_err(ServerError::VaultClientError)?;\n\n    let cache_secrets: CacheSecrets = kv2::read(\u0026client, \u0026config.vault_kv_mount, \u0026config.vault_kv_path_redis).await?;\n\n    let database_deployment_credentials = creds(\n        \u0026client,\n        \u0026config.vault_database_mount,\n        \u0026config.vault_database_deployment_role,\n    )\n    .await?;\n    let database_deployment_secrets = DatabaseSecrets {\n        host: config.database_host.clone(),\n        port: config.database_port.clone(),\n        db: config.database_db.clone(),\n        user: database_deployment_credentials.username,\n        password: database_deployment_credentials.password,\n    };\n\n    let database_credentials = creds(\u0026client, \u0026config.vault_database_mount, \u0026config.vault_database_role).await?;\n    let database_secrets = DatabaseSecrets {\n        host: config.database_host.clone(),\n        port: config.database_port.clone(),\n        db: config.database_db.clone(),\n        user: database_credentials.username,\n        password: database_credentials.password,\n    };\n\n    let jwt_secrets: JwtSecrets = kv2::read(\u0026client, \u0026config.vault_kv_mount, \u0026config.vault_kv_path_jwt).await?;\n\n    Ok(Secrets {\n        cache: cache_secrets,\n        database: database_secrets,\n        database_deployment: database_deployment_secrets,\n        jwt: jwt_secrets,\n    })\n}\n","traces":[{"line":21,"address":[5891818,5892580,5891312,5891373,5891516,5891893,5899445,5892606],"length":1,"stats":{"Line":25},"fn_name":"{async_fn#0}"},{"line":22,"address":[5927957,5928504,5928037,5927494],"length":1,"stats":{"Line":15},"fn_name":null},{"line":23,"address":[5927945],"length":1,"stats":{"Line":5},"fn_name":null},{"line":24,"address":[5892029],"length":1,"stats":{"Line":5},"fn_name":null},{"line":26,"address":[5927972,5928534,5928322],"length":1,"stats":{"Line":5},"fn_name":null},{"line":28,"address":[5928667,5928991],"length":1,"stats":{"Line":5},"fn_name":null},{"line":30,"address":[5927775,5928957,5930077,5929308,5927546],"length":1,"stats":{"Line":20},"fn_name":null},{"line":33,"address":[5930028],"length":1,"stats":{"Line":5},"fn_name":null},{"line":34,"address":[5894043],"length":1,"stats":{"Line":5},"fn_name":null},{"line":35,"address":[5930431],"length":1,"stats":{"Line":5},"fn_name":null},{"line":37,"address":[5931322,5931132],"length":1,"stats":{"Line":0},"fn_name":null},{"line":39,"address":[5931099],"length":1,"stats":{"Line":5},"fn_name":null},{"line":40,"address":[5931457],"length":1,"stats":{"Line":5},"fn_name":null},{"line":41,"address":[5931536],"length":1,"stats":{"Line":5},"fn_name":null},{"line":42,"address":[5931615],"length":1,"stats":{"Line":5},"fn_name":null},{"line":43,"address":[5931652],"length":1,"stats":{"Line":5},"fn_name":null},{"line":46,"address":[5927588,5932647,5927673,5931846,5931973],"length":1,"stats":{"Line":20},"fn_name":null},{"line":48,"address":[5896614],"length":1,"stats":{"Line":5},"fn_name":null},{"line":49,"address":[5896965],"length":1,"stats":{"Line":5},"fn_name":null},{"line":50,"address":[5897044],"length":1,"stats":{"Line":5},"fn_name":null},{"line":51,"address":[5897123],"length":1,"stats":{"Line":5},"fn_name":null},{"line":52,"address":[5897160],"length":1,"stats":{"Line":5},"fn_name":null},{"line":55,"address":[5891606,5897347,5751442,5897463,5898895],"length":1,"stats":{"Line":15},"fn_name":null},{"line":57,"address":[5898417],"length":1,"stats":{"Line":5},"fn_name":null},{"line":58,"address":[5898056],"length":1,"stats":{"Line":5},"fn_name":null},{"line":59,"address":[5898138],"length":1,"stats":{"Line":5},"fn_name":null},{"line":60,"address":[5898258],"length":1,"stats":{"Line":5},"fn_name":null},{"line":61,"address":[5898385],"length":1,"stats":{"Line":5},"fn_name":null}],"covered":27,"coverable":28},{"path":["/","home","runner","work","throwaway","throwaway","src","errors","core.rs"],"content":"use axum::{\n    http::StatusCode,\n    response::{IntoResponse, Response},\n    Json,\n};\nuse serde_json::json;\nuse thiserror::Error;\nuse tracing::error;\n\n#[derive(Error, Debug)]\npub enum ServerError {\n    // Can we include status code here? `#[error(\"[Validation]: {0}\", StatusCode::BAD_REQUEST)]`\n    #[error(\"[Validation]: {0}\")]\n    ValidationError(#[from] validator::ValidationErrors),\n\n    #[error(\"[Serde]: {0}\")]\n    SerdeJsonError(#[from] serde_json::Error),\n\n    #[error(\"[SQL]: {0}\")]\n    SqlxError(#[from] sqlx::Error),\n\n    #[error(\"[SQL Migration]: {0}\")]\n    SqlxMigrationError(#[from] sqlx::migrate::MigrateError),\n\n    #[error(\"[Cache]: {0}\")]\n    CacheError(#[from] deadpool_redis::CreatePoolError),\n\n    #[error(\"[Env Config]: {0}\")]\n    EnvConfigError(#[from] envconfig::Error),\n\n    #[error(\"[Log Env]: {0}\")]\n    LogEnvError(#[from] tracing_subscriber::filter::FromEnvError),\n\n    #[error(\"[Log Tracer]: {0}\")]\n    LogTracerError(#[from] tracing::log::SetLoggerError),\n\n    #[error(\"[Log Subscriber]: {0}\")]\n    LogSubscriberError(#[from] tracing::subscriber::SetGlobalDefaultError),\n\n    #[error(\"[Argon]: {0}\")]\n    ArgonPasswordError(#[from] argon2::password_hash::Error),\n\n    #[error(\"[JWT]: {0}\")]\n    JwtError(#[from] jsonwebtoken::errors::Error),\n\n    #[error(\"[Vault Client Config]: {0}\")]\n    VaultClientConfigError(#[from] vaultrs::client::VaultClientSettingsBuilderError),\n\n    #[error(\"[Vault Client]: {0}\")]\n    VaultClientError(#[from] vaultrs::error::ClientError),\n\n    #[error(\"[Hyper]: {0}\")]\n    HyperError(#[from] hyper::Error),\n\n    #[error(\"[Axum Header]: {0}\")]\n    AxumTypedHeaderError(#[from] axum::extract::rejection::TypedHeaderRejection),\n\n    #[error(\"[Axum Extension]: {0}\")]\n    AxumExtensionError(#[from] axum::extract::rejection::ExtensionRejection),\n\n    #[error(\"[Axum Form]: {0}\")]\n    AxumFormRejection(#[from] axum::extract::rejection::FormRejection),\n\n    #[error(\"[Axum Json]: {0}\")]\n    AxumJsonRejection(#[from] axum::extract::rejection::JsonRejection),\n\n    #[error(\"[Credentials]: {0}\")]\n    CredentialsError(#[from] crate::errors::credentials::CredentialsError),\n\n    #[error(\"[Profile]: {0}\")]\n    ProfileError(#[from] crate::errors::profile::ProfileError),\n\n    #[error(\"Token: {0}\")]\n    TokenError(#[from] crate::errors::token::TokenError),\n\n    /// FIXME: This should only be used short term, and replaced with proper error handling in time\n    #[error(\"WIP Error\")]\n    WIPError,\n}\n\nimpl IntoResponse for ServerError {\n    fn into_response(self) -\u003e Response {\n        let (status, message) = match self {\n            ServerError::ValidationError(err) =\u003e (StatusCode::BAD_REQUEST, err.to_string()),\n            ServerError::CredentialsError(error) =\u003e {\n                return error.into_response();\n            }\n            ServerError::ProfileError(error) =\u003e {\n                return error.into_response();\n            }\n            ServerError::TokenError(error) =\u003e {\n                return error.into_response();\n            }\n            _ =\u003e {\n                error!(\"Internal server error: {self:#?}\");\n                (StatusCode::INTERNAL_SERVER_ERROR, self.to_string())\n            }\n        };\n\n        let body = Json(json!({\n            \"status\": status.as_str(),\n            \"message\": message,\n        }));\n\n        (status, body).into_response()\n    }\n}\n","traces":[{"line":82,"address":[8638332,8633936,8637411],"length":1,"stats":{"Line":0},"fn_name":"into_response"},{"line":83,"address":[4778143,4781309],"length":1,"stats":{"Line":0},"fn_name":null},{"line":84,"address":[8654675,8657815],"length":1,"stats":{"Line":0},"fn_name":null},{"line":86,"address":[4778417,4781419],"length":1,"stats":{"Line":0},"fn_name":null},{"line":88,"address":[8654791],"length":1,"stats":{"Line":0},"fn_name":null},{"line":89,"address":[8634289,8634275,8637269],"length":1,"stats":{"Line":0},"fn_name":null},{"line":92,"address":[4778475,4781375],"length":1,"stats":{"Line":0},"fn_name":null},{"line":95,"address":[8635206,8635910,8636558,8635760,8635812,8634937,8634411,8634773,8635290,8636486],"length":1,"stats":{"Line":0},"fn_name":null},{"line":96,"address":[8656243,8657615],"length":1,"stats":{"Line":0},"fn_name":null},{"line":100,"address":[4781718,4781798,4781613,4781365],"length":1,"stats":{"Line":0},"fn_name":null},{"line":101,"address":[4781701,4781766],"length":1,"stats":{"Line":0},"fn_name":null},{"line":105,"address":[4782284],"length":1,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":12},{"path":["/","home","runner","work","throwaway","throwaway","src","errors","credentials.rs"],"content":"use axum::{\n    http::StatusCode,\n    response::{IntoResponse, Response},\n    Json,\n};\nuse serde_json::json;\nuse thiserror::Error;\n\n#[derive(Error, Debug)]\npub enum CredentialsError {\n    #[error(\"Credentials is invalid\")]\n    InvalidCredentials,\n}\n\nimpl IntoResponse for CredentialsError {\n    fn into_response(self) -\u003e Response {\n        let status = match self {\n            CredentialsError::InvalidCredentials =\u003e (StatusCode::NOT_FOUND),\n        };\n\n        let body = Json(json!({\n            \"status\": status.as_str(),\n            \"message\": format!(\"{self}\"),\n        }));\n\n        (status, body).into_response()\n    }\n}\n","traces":[{"line":16,"address":[7685232,7685611,7686395],"length":1,"stats":{"Line":0},"fn_name":"into_response"},{"line":17,"address":[7664737],"length":1,"stats":{"Line":0},"fn_name":null},{"line":18,"address":[7693041],"length":1,"stats":{"Line":0},"fn_name":null},{"line":21,"address":[7665175,7664942,7664878,7665343,7665110,7664760],"length":1,"stats":{"Line":0},"fn_name":null},{"line":22,"address":[7689837,7689902],"length":1,"stats":{"Line":0},"fn_name":null},{"line":23,"address":[7664765,7664845],"length":1,"stats":{"Line":0},"fn_name":null},{"line":26,"address":[3797746],"length":1,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":7},{"path":["/","home","runner","work","throwaway","throwaway","src","errors","mod.rs"],"content":"pub mod core;\npub mod credentials;\npub mod profile;\npub mod token;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","errors","profile.rs"],"content":"use axum::{\n    http::StatusCode,\n    response::{IntoResponse, Response},\n    Json,\n};\nuse serde_json::json;\nuse thiserror::Error;\n\n#[derive(Error, Debug)]\npub enum ProfileError {\n    #[error(\"Profile not found\")]\n    NotFound,\n\n    #[error(\"Profile already exists\")]\n    Exists,\n\n    #[error(\"Profile could not be updated\")]\n    UpdateFailure,\n\n    #[error(\"Profile name already set\")]\n    NameSet,\n\n    #[error(\"Profile email already set\")]\n    EmailSet,\n}\n\nimpl IntoResponse for ProfileError {\n    fn into_response(self) -\u003e Response {\n        let status = match self {\n            ProfileError::NotFound =\u003e (StatusCode::NOT_FOUND),\n            _ =\u003e (StatusCode::BAD_REQUEST),\n        };\n\n        let body = Json(json!({\n            \"status\": status.as_str(),\n            \"message\": format!(\"{self}\"),\n        }));\n\n        (status, body).into_response()\n    }\n}\n","traces":[{"line":28,"address":[8288192,8289382,8288598],"length":1,"stats":{"Line":0},"fn_name":"into_response"},{"line":29,"address":[4492856],"length":1,"stats":{"Line":0},"fn_name":null},{"line":30,"address":[4492883],"length":1,"stats":{"Line":0},"fn_name":null},{"line":31,"address":[8259964],"length":1,"stats":{"Line":0},"fn_name":null},{"line":34,"address":[4492899,4493097,4493245,4493474,4493017,4493306],"length":1,"stats":{"Line":0},"fn_name":null},{"line":35,"address":[8280649,8280584],"length":1,"stats":{"Line":0},"fn_name":null},{"line":36,"address":[4493360,4493289],"length":1,"stats":{"Line":0},"fn_name":null},{"line":39,"address":[4493869],"length":1,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":8},{"path":["/","home","runner","work","throwaway","throwaway","src","errors","token.rs"],"content":"use axum::{\n    http::StatusCode,\n    response::{IntoResponse, Response},\n    Json,\n};\nuse serde_json::json;\nuse thiserror::Error;\n\n#[derive(Error, Debug)]\npub enum TokenError {\n    #[error(\"Token is invalid\")]\n    InvalidToken,\n}\n\nimpl IntoResponse for TokenError {\n    fn into_response(self) -\u003e Response {\n        let status = match self {\n            TokenError::InvalidToken =\u003e (StatusCode::NOT_FOUND),\n        };\n\n        let body = Json(json!({\n            \"status\": status.as_str(),\n            \"message\": format!(\"{self}\"),\n        }));\n\n        (status, body).into_response()\n    }\n}\n","traces":[{"line":16,"address":[7686811,7686432,7687595],"length":1,"stats":{"Line":0},"fn_name":"into_response"},{"line":17,"address":[7665937],"length":1,"stats":{"Line":0},"fn_name":null},{"line":18,"address":[7694241],"length":1,"stats":{"Line":0},"fn_name":null},{"line":21,"address":[7666543,7666078,7666142,7665960,7666310,7666375],"length":1,"stats":{"Line":0},"fn_name":null},{"line":22,"address":[7691037,7691102],"length":1,"stats":{"Line":0},"fn_name":null},{"line":23,"address":[7666045,7665965],"length":1,"stats":{"Line":0},"fn_name":null},{"line":26,"address":[3798930],"length":1,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":7},{"path":["/","home","runner","work","throwaway","throwaway","src","extractors","mod.rs"],"content":"pub mod validated_json;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","extractors","validated_json.rs"],"content":"use axum::{\n    async_trait,\n    extract::{FromRequest, RequestParts},\n    BoxError,\n    Json,\n};\nuse http_body::Body;\nuse serde::de::DeserializeOwned;\nuse validator::Validate;\n\nuse crate::errors::core::ServerError;\n\n#[derive(Debug, Clone, Copy, Default)]\npub struct ValidatedJson\u003cT\u003e(pub T);\n\n#[async_trait]\nimpl\u003cT, B\u003e FromRequest\u003cB\u003e for ValidatedJson\u003cT\u003e\nwhere\n    T: DeserializeOwned + Validate,\n    B: Body + Send,\n    B::Data: Send,\n    B::Error: Into\u003cBoxError\u003e,\n{\n    type Rejection = ServerError;\n\n    async fn from_request(request_parts: \u0026mut RequestParts\u003cB\u003e) -\u003e Result\u003cSelf, Self::Rejection\u003e {\n        let Json(object) = Json::\u003cT\u003e::from_request(request_parts).await?;\n        object.validate()?;\n        Ok(Self(object))\n    }\n}\n","traces":[{"line":26,"address":[3806880,3808839,3809632,3812137,3807081,3807603,3809395,3806688,3810640,3807235,3809264,3807264,3807072,3807472,3810229,3810432,3806889,3809099,3810475,3810771,3811013,3807843,3807307,3807043,3809056,3806851,3806697],"length":1,"stats":{"Line":42},"fn_name":"from_request\u003cthrowaway::models::request::token::TokenRequest, hyper::body::body::Body\u003e"},{"line":27,"address":[8146153,8142127,8143328,8141677,8143540,8141920,8142371,8145506,8145296,8144315,8143085,8145053],"length":1,"stats":{"Line":7},"fn_name":null},{"line":28,"address":[8117365,8117788,8119732,8121393,8121570,8119309,8121147,8119555,8117594],"length":1,"stats":{"Line":14},"fn_name":null},{"line":29,"address":[3808745,3810121,3812043],"length":1,"stats":{"Line":7},"fn_name":null}],"covered":4,"coverable":4},{"path":["/","home","runner","work","throwaway","throwaway","src","handlers","config.rs"],"content":"use axum::extract::Extension;\nuse axum::http::StatusCode;\nuse axum::response::IntoResponse;\nuse axum::routing::get;\nuse axum::{Json, Router};\n\nuse crate::errors::core::ServerError;\nuse crate::models::response::config::ConfigResponse;\nuse crate::Config;\n\n#[must_use]\npub fn routes() -\u003e Router {\n    Router::new().route(\"/config\", get(config_get))\n}\n\npub async fn config_get(Extension(config): Extension\u003cConfig\u003e) -\u003e Result\u003cimpl IntoResponse, ServerError\u003e {\n    let response = ConfigResponse {\n        config,\n    };\n\n    Ok((StatusCode::OK, Json(response)))\n}\n","traces":[{"line":12,"address":[6539728,6539926,6539895],"length":1,"stats":{"Line":5},"fn_name":"routes"},{"line":13,"address":[4552306,4552145],"length":1,"stats":{"Line":5},"fn_name":null},{"line":16,"address":[4552353,4552416,4552458,4552336,4552786],"length":1,"stats":{"Line":4},"fn_name":"config_get"},{"line":21,"address":[4552604],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":4,"coverable":4},{"path":["/","home","runner","work","throwaway","throwaway","src","handlers","mod.rs"],"content":"pub mod config;\npub mod profile;\npub mod register;\npub mod token;\npub mod version;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","handlers","profile.rs"],"content":"use axum::extract::Extension;\nuse axum::http::StatusCode;\nuse axum::response::IntoResponse;\nuse axum::routing::patch;\nuse axum::{Json, Router};\nuse tracing::instrument;\n\nuse crate::errors::core::ServerError;\nuse crate::extractors::validated_json::ValidatedJson;\nuse crate::middleware::token_authentication::TokenAuthenticationLayer;\nuse crate::models::database::profile::Profile;\nuse crate::models::request::profile::ProfilePatchRequest;\nuse crate::models::response::profile::ProfilePatchResponse;\nuse crate::services::profile::ProfileService;\n\n#[must_use]\npub fn routes() -\u003e Router {\n    Router::new()\n        .route(\"/profile\", patch(profile_patch))\n        .route_layer(TokenAuthenticationLayer::default())\n}\n\n// TODO: How does PATCH work with passwords and redacted fields?\n// TODO: How to prevent a PATCH being abused as a PUT? Just check request only 1 field?\n// FIXME: Can we remove the printing of errs but having 'err' in instrument instead?\n#[instrument(skip(profile_service), level = \"info\", err)]\npub async fn profile_patch(\n    ValidatedJson(profile_patch_request): ValidatedJson\u003cProfilePatchRequest\u003e,\n    Extension(profile_service): Extension\u003cProfileService\u003e,\n    Extension(profile): Extension\u003cProfile\u003e,\n) -\u003e Result\u003cimpl IntoResponse, ServerError\u003e {\n    // FIXME: Should this logic be pushed into a service?\n    return match profile_patch_request {\n        ProfilePatchRequest {\n            name: Some(name), ..\n        } =\u003e {\n            let updated_profile = profile_service\n                .update_name(profile.profile_id, name)\n                .await?;\n\n            let response = ProfilePatchResponse {\n                // FIXME: Where do we keep static strings like this? \"constants\"\n                message: \"Updated Profile name\".to_string(),\n                code: 200,\n                profile: Some(updated_profile.to_public()),\n            };\n\n            Ok((StatusCode::OK, Json(response)))\n        }\n        ProfilePatchRequest {\n            email: Some(email), ..\n        } =\u003e {\n            let updated_profile = profile_service\n                .update_email(profile.profile_id, email)\n                .await?;\n\n            let response = ProfilePatchResponse {\n                message: \"Updated Profile email\".to_string(),\n                code: 200,\n                profile: Some(updated_profile.to_public()),\n            };\n\n            Ok((StatusCode::OK, Json(response)))\n        }\n        // ProfilePatchRequest {\n        //     country: Some(country),\n        //     ..\n        // } =\u003e {\n        //     if country == profile.country {\n        //         let response = ProfilePatchResponse {\n        //             message: \"Country already set\".to_string(),\n        //             code: 409,\n        //             profile: None,\n        //         };\n        //\n        //         return Ok((StatusCode::CONFLICT, Json(response)));\n        //     }\n        //\n        //     profile.country = country.clone();\n        //     profile_service\n        //         .update(profile.clone())\n        //         .await?;\n        //\n        //     let response = ProfilePatchResponse {\n        //         message: \"Updated Country password\".to_string(),\n        //         code: 200,\n        //         profile: Some(profile.to_public()),\n        //     };\n        //\n        //     Ok((StatusCode::OK, Json(response)))\n        // }\n        // ProfilePatchRequest {\n        //     timezone: Some(timezone),\n        //     ..\n        // } =\u003e {\n        //     if timezone == profile.timezone {\n        //         let response = ProfilePatchResponse {\n        //             message: \"Timezone already set\".to_string(),\n        //             code: 409,\n        //             profile: None,\n        //         };\n        //\n        //         return Ok((StatusCode::CONFLICT, Json(response)));\n        //     }\n        //\n        //     profile.timezone = timezone.clone();\n        //     profile_service\n        //         .update(profile.clone())\n        //         .await?;\n        //\n        //     let response = ProfilePatchResponse {\n        //         message: \"Updated Timezone password\".to_string(),\n        //         code: 200,\n        //         profile: Some(profile.to_public()),\n        //     };\n        //\n        //     Ok((StatusCode::OK, Json(response)))\n        // }\n        _ =\u003e {\n            // This could be a scenario when a user tries to patch multiple fields (or no fields).\n            // TODO: Can we validate patches at the extractor level? Ensure validated json with only 1 field set e.g.\n            // TODO: Can we just return an Err here?\n            let response = ProfilePatchResponse {\n                message: \"Invalid request\".to_string(),\n                code: 422,\n                profile: None,\n            };\n\n            Ok((StatusCode::UNPROCESSABLE_ENTITY, Json(response)))\n        }\n    };\n}\n","traces":[{"line":17,"address":[4312560,4312733,4312763],"length":1,"stats":{"Line":5},"fn_name":"routes"},{"line":18,"address":[8178429,8178176,8178267],"length":1,"stats":{"Line":15},"fn_name":null},{"line":19,"address":[8178361,8178214,8178319],"length":1,"stats":{"Line":10},"fn_name":null},{"line":20,"address":[8178391,8178335,8178474,8178458],"length":1,"stats":{"Line":10},"fn_name":null},{"line":26,"address":[8203207,8201888,8202709,8198503,8202250,8196049,8198591,8196835,8195257,8195376,8204268,8203368,8195445,8197249,8204180,8204746,8198183,8203587,8202414,8196181,8196999,8196473,8198450,8196224,8199303,8202797],"length":1,"stats":{"Line":10},"fn_name":"{async_fn#0}"},{"line":27,"address":[8195216],"length":1,"stats":{"Line":1},"fn_name":"profile_patch"},{"line":33,"address":[4336102,4336512],"length":1,"stats":{"Line":1},"fn_name":null},{"line":35,"address":[8205234],"length":1,"stats":{"Line":1},"fn_name":null},{"line":37,"address":[4336416,4338763,4338654,4338871,4336494,4339157],"length":1,"stats":{"Line":5},"fn_name":null},{"line":38,"address":[4646216],"length":1,"stats":{"Line":6},"fn_name":null},{"line":39,"address":[8207913,8208107],"length":1,"stats":{"Line":0},"fn_name":null},{"line":41,"address":[8208347],"length":1,"stats":{"Line":1},"fn_name":null},{"line":43,"address":[8207883],"length":1,"stats":{"Line":1},"fn_name":null},{"line":45,"address":[8208183,8208251],"length":1,"stats":{"Line":2},"fn_name":null},{"line":48,"address":[8208487],"length":1,"stats":{"Line":1},"fn_name":null},{"line":51,"address":[8205398],"length":1,"stats":{"Line":0},"fn_name":null},{"line":53,"address":[8206250,8205429,8206145,8205483,8206006,8206562],"length":1,"stats":{"Line":0},"fn_name":null},{"line":54,"address":[4337038,4337219,4336208,4337317,4336580,4337177],"length":1,"stats":{"Line":0},"fn_name":null},{"line":55,"address":[4337522,4337712],"length":1,"stats":{"Line":0},"fn_name":null},{"line":57,"address":[4337944],"length":1,"stats":{"Line":0},"fn_name":null},{"line":58,"address":[4337492],"length":1,"stats":{"Line":0},"fn_name":null},{"line":60,"address":[4337848,4337800],"length":1,"stats":{"Line":0},"fn_name":null},{"line":63,"address":[4338084],"length":1,"stats":{"Line":0},"fn_name":null},{"line":123,"address":[4336760],"length":1,"stats":{"Line":0},"fn_name":null},{"line":124,"address":[4336661],"length":1,"stats":{"Line":0},"fn_name":null},{"line":126,"address":[4336748],"length":1,"stats":{"Line":0},"fn_name":null},{"line":129,"address":[4336850],"length":1,"stats":{"Line":0},"fn_name":null}],"covered":14,"coverable":27},{"path":["/","home","runner","work","throwaway","throwaway","src","handlers","register.rs"],"content":"use axum::extract::Extension;\nuse axum::http::StatusCode;\nuse axum::response::IntoResponse;\nuse axum::routing::post;\nuse axum::{Json, Router};\n\nuse crate::errors::core::ServerError;\nuse crate::extractors::validated_json::ValidatedJson;\nuse crate::models::request::register::RegisterRequest;\nuse crate::models::response::register::RegisterResponse;\nuse crate::services::profile::ProfileService;\n\n#[must_use]\npub fn routes() -\u003e Router {\n    Router::new().route(\"/register\", post(register_post))\n}\n\npub async fn register_post(\n    ValidatedJson(register_request): ValidatedJson\u003cRegisterRequest\u003e,\n    Extension(profile_service): Extension\u003cProfileService\u003e,\n) -\u003e Result\u003cimpl IntoResponse, ServerError\u003e {\n    let profile_id = profile_service\n        .create(register_request)\n        .await?;\n\n    let register_response = RegisterResponse {\n        profile_id,\n    };\n\n    Ok((StatusCode::CREATED, Json(register_response)))\n}\n","traces":[{"line":14,"address":[8562871,8562704,8562902],"length":1,"stats":{"Line":5},"fn_name":"routes"},{"line":15,"address":[4746481,4746642],"length":1,"stats":{"Line":5},"fn_name":null},{"line":18,"address":[4746672],"length":1,"stats":{"Line":3},"fn_name":"register_post"},{"line":22,"address":[8536186,8535528,8535853,8535942,8536587],"length":1,"stats":{"Line":12},"fn_name":null},{"line":23,"address":[8535878,8535932,8536134,8535400,8535746,8535582],"length":1,"stats":{"Line":15},"fn_name":null},{"line":24,"address":[4748427,4748617],"length":1,"stats":{"Line":0},"fn_name":null},{"line":30,"address":[4748310],"length":1,"stats":{"Line":3},"fn_name":null}],"covered":6,"coverable":7},{"path":["/","home","runner","work","throwaway","throwaway","src","handlers","token.rs"],"content":"use axum::extract::Extension;\nuse axum::http::StatusCode;\nuse axum::response::IntoResponse;\nuse axum::routing::{get, post};\nuse axum::{Json, Router};\nuse chrono::{Duration, TimeZone, Utc};\n\nuse crate::errors::core::ServerError;\nuse crate::extractors::validated_json::ValidatedJson;\nuse crate::middleware::basic_authentication::BasicAuthenticationLayer;\nuse crate::middleware::token_authentication::TokenAuthenticationLayer;\nuse crate::models::claims::Claims;\nuse crate::models::database::profile::Profile;\nuse crate::models::request::token::TokenRequest;\nuse crate::models::response::token::TokenResponse;\nuse crate::models::response::token_info::TokenInfoResponse;\nuse crate::TokenService;\n\n#[must_use]\npub fn routes() -\u003e Router {\n    let basic_auth_routes = Router::new()\n        .route(\"/token\", post(token_post))\n        .route_layer(BasicAuthenticationLayer::default());\n\n    let token_auth_routes = Router::new()\n        .route(\"/token/test\", post(token_test_get))\n        .route(\"/token/info\", get(token_info_get))\n        .route_layer(TokenAuthenticationLayer::default());\n\n    Router::new()\n        .merge(basic_auth_routes)\n        .merge(token_auth_routes)\n}\n\npub async fn token_post(\n    ValidatedJson(token_request): ValidatedJson\u003cTokenRequest\u003e,\n    Extension(token_service): Extension\u003cTokenService\u003e,\n    Extension(profile): Extension\u003cProfile\u003e,\n) -\u003e Result\u003cimpl IntoResponse, ServerError\u003e {\n    let lifespan_duration = Duration::seconds(token_request.lifespan as i64);\n    let token = token_service.generate(profile.profile_id, lifespan_duration, token_request.attributes)?;\n\n    let token_response = TokenResponse {\n        token,\n    };\n\n    Ok((StatusCode::CREATED, Json(token_response)))\n}\n\npub async fn token_test_get() -\u003e Result\u003cimpl IntoResponse, ServerError\u003e {\n    Ok(StatusCode::CREATED)\n}\n\npub async fn token_info_get(Extension(claims): Extension\u003cClaims\u003e) -\u003e Result\u003cimpl IntoResponse, ServerError\u003e {\n    let token_info_response = TokenInfoResponse {\n        issued_at: Utc\n            .timestamp(claims.iat, 0)\n            .to_rfc3339(),\n        expires_at: Utc\n            .timestamp(claims.exp, 0)\n            .to_rfc3339(),\n        attributes: claims.attributes,\n    };\n\n    Ok((StatusCode::CREATED, Json(token_info_response)))\n}\n","traces":[{"line":20,"address":[8178496,8178726,8178760],"length":1,"stats":{"Line":5},"fn_name":"routes"},{"line":21,"address":[8178513,8178644,8178805],"length":1,"stats":{"Line":15},"fn_name":null},{"line":22,"address":[8178591,8178741,8178699],"length":1,"stats":{"Line":10},"fn_name":null},{"line":23,"address":[8178715,8178771,8178872,8178837],"length":1,"stats":{"Line":10},"fn_name":null},{"line":25,"address":[8178853,8179145,8179286,8178996],"length":1,"stats":{"Line":20},"fn_name":null},{"line":26,"address":[8179086,8179051,8178935],"length":1,"stats":{"Line":10},"fn_name":null},{"line":27,"address":[8179108,8179200,8179227,8179067],"length":1,"stats":{"Line":10},"fn_name":null},{"line":28,"address":[4397192,4397299,4397260,4397167],"length":1,"stats":{"Line":10},"fn_name":null},{"line":30,"address":[4397284,4397411,4397479],"length":1,"stats":{"Line":15},"fn_name":null},{"line":31,"address":[4397350],"length":1,"stats":{"Line":5},"fn_name":null},{"line":32,"address":[4397418],"length":1,"stats":{"Line":5},"fn_name":null},{"line":35,"address":[4397552],"length":1,"stats":{"Line":3},"fn_name":"token_post"},{"line":40,"address":[8180173,8180024],"length":1,"stats":{"Line":6},"fn_name":null},{"line":41,"address":[4398480,4398073],"length":1,"stats":{"Line":3},"fn_name":null},{"line":47,"address":[4398312],"length":1,"stats":{"Line":3},"fn_name":null},{"line":50,"address":[4398900,4399068,4398896,4398944,4398987],"length":1,"stats":{"Line":0},"fn_name":"token_test_get"},{"line":51,"address":[4399018],"length":1,"stats":{"Line":0},"fn_name":null},{"line":54,"address":[4399211,4399117,4399104,4399168,4399385,4399989],"length":1,"stats":{"Line":5},"fn_name":"token_info_get"},{"line":56,"address":[4399357,4399512],"length":1,"stats":{"Line":2},"fn_name":null},{"line":59,"address":[4399527,4399612],"length":1,"stats":{"Line":2},"fn_name":null},{"line":62,"address":[4399619],"length":1,"stats":{"Line":1},"fn_name":null},{"line":65,"address":[4399711],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":20,"coverable":22},{"path":["/","home","runner","work","throwaway","throwaway","src","handlers","version.rs"],"content":"use axum::http::StatusCode;\nuse axum::response::IntoResponse;\nuse axum::routing::get;\nuse axum::{Json, Router};\n\nuse crate::errors::core::ServerError;\nuse crate::models::response::version::VersionResponse;\nuse crate::VERSION;\n\n#[must_use]\npub fn routes() -\u003e Router {\n    Router::new().route(\"/version\", get(version_get))\n}\n\npub async fn version_get() -\u003e Result\u003cimpl IntoResponse, ServerError\u003e {\n    let response = VersionResponse {\n        version: VERSION.to_string(),\n    };\n\n    Ok((StatusCode::OK, Json(response)))\n}\n","traces":[{"line":11,"address":[4553049,4552864,4553022],"length":1,"stats":{"Line":5},"fn_name":"routes"},{"line":12,"address":[4553042,4552881],"length":1,"stats":{"Line":5},"fn_name":null},{"line":15,"address":[8260980,8261130,8261066,8261024,8260976],"length":1,"stats":{"Line":4},"fn_name":"version_get"},{"line":17,"address":[4553202],"length":1,"stats":{"Line":1},"fn_name":null},{"line":20,"address":[4553380],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":5,"coverable":5},{"path":["/","home","runner","work","throwaway","throwaway","src","helpers","mod.rs"],"content":"pub mod serialization;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","helpers","serialization.rs"],"content":"pub const fn is_none_or_false(value: \u0026Option\u003cbool\u003e) -\u003e bool {\n    if let Some(value) = value {\n        return !(*value);\n    }\n\n    true\n}\n","traces":[{"line":1,"address":[6121440],"length":1,"stats":{"Line":3},"fn_name":"is_none_or_false"},{"line":2,"address":[4261757],"length":1,"stats":{"Line":3},"fn_name":null},{"line":3,"address":[4261791],"length":1,"stats":{"Line":3},"fn_name":null},{"line":6,"address":[4261803],"length":1,"stats":{"Line":3},"fn_name":null}],"covered":4,"coverable":4},{"path":["/","home","runner","work","throwaway","throwaway","src","lib.rs"],"content":"#![deny(clippy::all, clippy::pedantic, clippy::nursery, clippy::cargo)]\n#![allow(\n    clippy::module_name_repetitions,\n    clippy::missing_errors_doc,\n    clippy::multiple_crate_versions,\n    clippy::must_use_candidate,\n    clippy::unused_async,\n    clippy::struct_excessive_bools\n)]\n#![feature(const_mut_refs, once_cell, map_first_last, type_alias_impl_trait, core_intrinsics)]\n\nuse axum::extract::Extension;\nuse axum::http::header;\nuse axum::Router;\nuse axum_extra::middleware::from_fn;\nuse tower::ServiceBuilder;\nuse tower_http::ServiceBuilderExt;\nuse tracing::debug;\n\nuse crate::cache::Cache;\nuse crate::config::Config;\nuse crate::core::cache::CachePool;\nuse crate::core::config;\nuse crate::core::database;\nuse crate::core::database::DatabasePool;\nuse crate::core::logging;\nuse crate::core::migrations::migrate;\nuse crate::core::{cache, secrets};\nuse crate::errors::core::ServerError;\nuse crate::middleware::version_header;\nuse crate::repositories::profile::ProfileRepository;\nuse crate::secrets::Secrets;\nuse crate::services::password::PasswordService;\nuse crate::services::profile::ProfileService;\nuse crate::services::token::TokenService;\n\npub mod attributes;\npub mod core;\npub mod errors;\npub mod extractors;\npub mod handlers;\npub mod helpers;\npub mod middleware;\npub mod models;\npub mod repositories;\npub mod services;\npub mod validation;\n\npub const VERSION: \u0026str = env!(\"CARGO_PKG_VERSION\");\n\npub async fn build_app() -\u003e Result\u003cRouter, ServerError\u003e {\n    logging::init()?;\n\n    let config: Config = config::read()?;\n    debug!(\"Config: {config:#?}\");\n\n    let secrets: Secrets = secrets::read(\u0026config).await?;\n    debug!(\"Secrets: {secrets:#?}\");\n\n    // Connection Pools\n    let database: DatabasePool = database::connect(\u0026config, \u0026secrets.database).await?;\n    let database_deployment: DatabasePool = database::connect(\u0026config, \u0026secrets.database_deployment).await?;\n\n    let cache_pool: CachePool = cache::connect(\u0026config, \u0026secrets.cache)?;\n    let cache: Cache = cache::Cache::new(cache_pool);\n\n    // Database Provision\n    migrate(\u0026database_deployment).await?;\n\n    // Repositories\n    let profile_repository = ProfileRepository::new(database.clone(), cache.clone());\n\n    // Services\n    let token_service = TokenService::new(\u0026secrets.jwt);\n    let password_service = PasswordService::new();\n    let profile_service = ProfileService::new(password_service.clone(), profile_repository);\n\n    // Global Middleware\n    let version_header = from_fn(version_header::version_header_middleware);\n    let sensitive_headers = vec![header::AUTHORIZATION, header::COOKIE];\n\n    let middleware = ServiceBuilder::new()\n        .sensitive_headers(sensitive_headers)\n        .layer(version_header);\n\n    // App\n    let app = Router::new()\n        .layer(middleware)\n        .merge(handlers::config::routes())\n        .merge(handlers::register::routes())\n        .merge(handlers::token::routes())\n        .merge(handlers::profile::routes())\n        .merge(handlers::version::routes())\n        .layer(Extension(token_service))\n        .layer(Extension(password_service))\n        .layer(Extension(profile_service))\n        .layer(Extension(config))\n        .layer(Extension(secrets));\n\n    Ok(app)\n}\n","traces":[{"line":51,"address":[7674701,7674672],"length":1,"stats":{"Line":25},"fn_name":"build_app"},{"line":52,"address":[7148838,7149455,7149383],"length":1,"stats":{"Line":10},"fn_name":null},{"line":54,"address":[7157161,7157514,7157721],"length":1,"stats":{"Line":10},"fn_name":null},{"line":55,"address":[7158377,7160444,7159544,7158836,7159383,7158541,7158015,7159763,7158924,7160356],"length":1,"stats":{"Line":25},"fn_name":null},{"line":57,"address":[5368243],"length":1,"stats":{"Line":20},"fn_name":null},{"line":58,"address":[7161956,7162482,7163502,7163341,7162865,7163721,7164402,7162777,7164314,7162318],"length":1,"stats":{"Line":25},"fn_name":null},{"line":61,"address":[7165550,7163309,7165013,7156748,7156905],"length":1,"stats":{"Line":20},"fn_name":null},{"line":62,"address":[5748225],"length":1,"stats":{"Line":20},"fn_name":null},{"line":64,"address":[7159112,7158642,7158996],"length":1,"stats":{"Line":10},"fn_name":null},{"line":65,"address":[7159439,7159061],"length":1,"stats":{"Line":10},"fn_name":null},{"line":68,"address":[5747977],"length":1,"stats":{"Line":15},"fn_name":null},{"line":71,"address":[7160262,7159987,7160522,7160313],"length":1,"stats":{"Line":10},"fn_name":null},{"line":74,"address":[7160603,7160496],"length":1,"stats":{"Line":10},"fn_name":null},{"line":75,"address":[7160611],"length":1,"stats":{"Line":5},"fn_name":null},{"line":76,"address":[7160684,7160723],"length":1,"stats":{"Line":10},"fn_name":null},{"line":79,"address":[7160782],"length":1,"stats":{"Line":5},"fn_name":null},{"line":80,"address":[7160837,7160892],"length":1,"stats":{"Line":10},"fn_name":null},{"line":82,"address":[7161093,7160985],"length":1,"stats":{"Line":10},"fn_name":null},{"line":83,"address":[7161045],"length":1,"stats":{"Line":5},"fn_name":null},{"line":84,"address":[7161187],"length":1,"stats":{"Line":5},"fn_name":null},{"line":87,"address":[7162709,7161504,7161949,7161195,7161798,7161289,7162843,7161357,7162984,7162096,7161651,7162414],"length":1,"stats":{"Line":60},"fn_name":null},{"line":88,"address":[7161249,7161296],"length":1,"stats":{"Line":10},"fn_name":null},{"line":89,"address":[7161214,7161400,7161304,7161435],"length":1,"stats":{"Line":10},"fn_name":null},{"line":90,"address":[7161457,7161470,7161547,7161416,7161582],"length":1,"stats":{"Line":10},"fn_name":null},{"line":91,"address":[7161694,7161617,7161729,7161604,7161563],"length":1,"stats":{"Line":10},"fn_name":null},{"line":92,"address":[7161841,7161764,7161710,7161751,7161876],"length":1,"stats":{"Line":10},"fn_name":null},{"line":93,"address":[7161857,7161911,7161898,7161992,7162103],"length":1,"stats":{"Line":10},"fn_name":null},{"line":94,"address":[7162000],"length":1,"stats":{"Line":5},"fn_name":null},{"line":95,"address":[7162166],"length":1,"stats":{"Line":5},"fn_name":null},{"line":96,"address":[7162421],"length":1,"stats":{"Line":5},"fn_name":null},{"line":97,"address":[7162724],"length":1,"stats":{"Line":5},"fn_name":null},{"line":98,"address":[7162858],"length":1,"stats":{"Line":5},"fn_name":null},{"line":100,"address":[7163037],"length":1,"stats":{"Line":5},"fn_name":null}],"covered":33,"coverable":33},{"path":["/","home","runner","work","throwaway","throwaway","src","main.rs"],"content":"#![deny(clippy::all, clippy::pedantic, clippy::nursery, clippy::cargo)]\n#![allow(\n    clippy::module_name_repetitions,\n    clippy::missing_errors_doc,\n    clippy::multiple_crate_versions,\n    clippy::must_use_candidate,\n    clippy::unused_async,\n    clippy::struct_excessive_bools\n)]\n#![feature(const_mut_refs, once_cell, map_first_last, type_alias_impl_trait, core_intrinsics)]\n\nuse std::net::SocketAddr;\n\nuse anyhow::Error;\nuse hyper::Server;\nuse throwaway::build_app;\nuse throwaway::errors::core::ServerError;\nuse tracing::info;\n\n#[tokio::main]\npub async fn main() -\u003e Result\u003c(), Error\u003e {\n    let app = build_app().await?;\n\n    let address = SocketAddr::from(([0, 0, 0, 0], 8000));\n    info!(\"Listening on: {address}\");\n\n    Server::bind(\u0026address)\n        .serve(app.into_make_service())\n        .await\n        .map_err(ServerError::HyperError)?;\n\n    Ok(())\n}\n","traces":[{"line":21,"address":[5150917,5151360,5151413,5151508,5151664,5151959,5151736,5151026,5150896],"length":1,"stats":{"Line":0},"fn_name":"main"},{"line":22,"address":[5151792,5152370,5151970,5151538,5151621,5151474],"length":1,"stats":{"Line":0},"fn_name":null},{"line":24,"address":[5152276],"length":1,"stats":{"Line":0},"fn_name":null},{"line":25,"address":[5155090,5153308,5154282,5154121,5152782,5153599,5153683,5153144,5154501,5155174],"length":1,"stats":{"Line":0},"fn_name":null},{"line":27,"address":[5156504,5156169,5156062,5155887,5154095,5155780,5156563,5156258],"length":1,"stats":{"Line":0},"fn_name":null},{"line":28,"address":[5151556,5155737,5155788,5155926,5156093,5156190],"length":1,"stats":{"Line":0},"fn_name":null},{"line":30,"address":[5156344,5156531],"length":1,"stats":{"Line":0},"fn_name":null},{"line":32,"address":[5151002,5151097,5150946,5156323],"length":1,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":8},{"path":["/","home","runner","work","throwaway","throwaway","src","middleware","basic_authentication.rs"],"content":"use std::task::{Context, Poll};\n\nuse axum::extract::{FromRequest, RequestParts, TypedHeader};\nuse axum::response::IntoResponse;\nuse axum::{body::Body, http::Request, response::Response};\nuse futures::future::BoxFuture;\nuse headers::authorization::Basic;\nuse headers::Authorization;\nuse tower::{Layer, Service};\n\nuse crate::errors::token::TokenError;\nuse crate::ProfileService;\n\n#[derive(Debug, Clone)]\npub struct BasicAuthenticationLayer;\n\nimpl Default for BasicAuthenticationLayer {\n    fn default() -\u003e Self {\n        Self\n    }\n}\n\nimpl\u003cS\u003e Layer\u003cS\u003e for BasicAuthenticationLayer {\n    type Service = BasicAuthentication\u003cS\u003e;\n\n    fn layer(\u0026self, inner: S) -\u003e Self::Service {\n        BasicAuthentication {\n            inner,\n        }\n    }\n}\n\n#[derive(Debug, Clone)]\npub struct BasicAuthentication\u003cS\u003e {\n    inner: S,\n}\n\nimpl\u003cS\u003e Service\u003cRequest\u003cBody\u003e\u003e for BasicAuthentication\u003cS\u003e\nwhere\n    S: Service\u003cRequest\u003cBody\u003e, Response = Response\u003e + Clone + Send + 'static,\n    S::Future: Send + 'static,\n{\n    type Error = S::Error;\n    type Future = BoxFuture\u003c'static, Result\u003cSelf::Response, Self::Error\u003e\u003e;\n    type Response = S::Response;\n\n    fn poll_ready(\u0026mut self, cx: \u0026mut Context\u003c'_\u003e) -\u003e Poll\u003cResult\u003c(), Self::Error\u003e\u003e {\n        self.inner.poll_ready(cx)\n    }\n\n    fn call(\u0026mut self, request: Request\u003cBody\u003e) -\u003e Self::Future {\n        let clone = self.inner.clone();\n        let mut inner = std::mem::replace(\u0026mut self.inner, clone);\n\n        // FIXME: Solve error handling within middleware\n        Box::pin(async move {\n            let mut request_parts = RequestParts::new(request);\n\n            let profile_service = request_parts\n                .extensions()\n                .unwrap()\n                .get::\u003cProfileService\u003e()\n                .unwrap()\n                .clone();\n\n            // FIXME: Handle invalid token.\n            let TypedHeader(Authorization(basic)) =\n                TypedHeader::\u003cAuthorization\u003cBasic\u003e\u003e::from_request(\u0026mut request_parts)\n                    .await\n                    .unwrap();\n\n            let email = basic.username();\n            let password = basic.password();\n\n            let result = profile_service\n                .verify_credentials(email, password)\n                .await;\n\n            if let Err(err) = result {\n                return Ok(err.into_response());\n            }\n\n            let (is_valid, profile) = result.unwrap();\n            if !is_valid {\n                // FIXME: Not a token! Invalid basic credentials error\n                return Ok(TokenError::InvalidToken.into_response());\n            }\n\n            // Inject Profile for further actions\n            request_parts\n                .extensions_mut()\n                .unwrap()\n                .insert(profile);\n\n            let request = request_parts\n                .try_into_request()\n                .unwrap();\n\n            let response = inner.call(request).await?;\n\n            Ok(response)\n        })\n    }\n}\n","traces":[{"line":18,"address":[3799104],"length":1,"stats":{"Line":5},"fn_name":"default"},{"line":26,"address":[3799120],"length":1,"stats":{"Line":5},"fn_name":"layer\u003caxum::routing::route::Route\u003chyper::body::body::Body, core::convert::Infallible\u003e\u003e"},{"line":47,"address":[3799168],"length":1,"stats":{"Line":3},"fn_name":"poll_ready\u003caxum::routing::route::Route\u003chyper::body::body::Body, core::convert::Infallible\u003e\u003e"},{"line":48,"address":[3799182],"length":1,"stats":{"Line":3},"fn_name":null},{"line":51,"address":[3799744,3799713,3799216],"length":1,"stats":{"Line":3},"fn_name":"call\u003caxum::routing::route::Route\u003chyper::body::body::Body, core::convert::Infallible\u003e\u003e"},{"line":52,"address":[3799271,3799364],"length":1,"stats":{"Line":6},"fn_name":null},{"line":53,"address":[3799380],"length":1,"stats":{"Line":3},"fn_name":null},{"line":56,"address":[3799255,3799829,3803925,3800208,3799428,3800812,3799760,3799978],"length":1,"stats":{"Line":12},"fn_name":"{async_block#0}\u003caxum::routing::route::Route\u003chyper::body::body::Body, core::convert::Infallible\u003e\u003e"},{"line":57,"address":[3799894,3800330],"length":1,"stats":{"Line":6},"fn_name":null},{"line":59,"address":[3800412,3800337],"length":1,"stats":{"Line":6},"fn_name":null},{"line":60,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":61,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":62,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":63,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":64,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":67,"address":[3801025],"length":1,"stats":{"Line":3},"fn_name":null},{"line":68,"address":[4655821],"length":1,"stats":{"Line":9},"fn_name":null},{"line":69,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":70,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":72,"address":[3801167,3801065],"length":1,"stats":{"Line":6},"fn_name":null},{"line":73,"address":[3801205],"length":1,"stats":{"Line":3},"fn_name":null},{"line":75,"address":[3801472,3801596,3801295],"length":1,"stats":{"Line":9},"fn_name":null},{"line":76,"address":[3800114,3801375,3801511,3800029,3801655],"length":1,"stats":{"Line":15},"fn_name":null},{"line":77,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":79,"address":[3801713],"length":1,"stats":{"Line":3},"fn_name":null},{"line":80,"address":[3804023,3801808],"length":1,"stats":{"Line":0},"fn_name":null},{"line":83,"address":[3801922,3802053],"length":1,"stats":{"Line":6},"fn_name":null},{"line":84,"address":[3802121],"length":1,"stats":{"Line":3},"fn_name":null},{"line":86,"address":[3802165,3802220],"length":1,"stats":{"Line":0},"fn_name":null},{"line":90,"address":[3802379,3802280,3802135],"length":1,"stats":{"Line":9},"fn_name":null},{"line":91,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":92,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":93,"address":[3802310,3802394],"length":1,"stats":{"Line":6},"fn_name":null},{"line":95,"address":[3802409],"length":1,"stats":{"Line":3},"fn_name":null},{"line":96,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":97,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":99,"address":[3802514,3803697,3800047],"length":1,"stats":{"Line":3},"fn_name":null},{"line":101,"address":[3803406],"length":1,"stats":{"Line":3},"fn_name":null}],"covered":24,"coverable":38},{"path":["/","home","runner","work","throwaway","throwaway","src","middleware","mod.rs"],"content":"pub mod basic_authentication;\npub mod token_authentication;\npub mod version_header;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","middleware","token_authentication.rs"],"content":"use std::task::{Context, Poll};\n\nuse axum::extract::{FromRequest, RequestParts, TypedHeader};\nuse axum::{body::Body, http::Request, response::Response};\nuse futures::future::BoxFuture;\nuse headers::authorization::Bearer;\nuse headers::Authorization;\nuse tower::{Layer, Service};\nuse tracing::{debug, info};\n\nuse crate::{ProfileService, TokenService};\n\n#[derive(Debug, Clone)]\npub struct TokenAuthenticationLayer;\n\nimpl Default for TokenAuthenticationLayer {\n    fn default() -\u003e Self {\n        Self\n    }\n}\n\nimpl\u003cS\u003e Layer\u003cS\u003e for TokenAuthenticationLayer {\n    type Service = TokenAuthentication\u003cS\u003e;\n\n    fn layer(\u0026self, inner: S) -\u003e Self::Service {\n        TokenAuthentication {\n            inner,\n        }\n    }\n}\n\n#[derive(Debug, Clone)]\npub struct TokenAuthentication\u003cS\u003e {\n    inner: S,\n}\n\nimpl\u003cS\u003e Service\u003cRequest\u003cBody\u003e\u003e for TokenAuthentication\u003cS\u003e\nwhere\n    S: Service\u003cRequest\u003cBody\u003e, Response = Response\u003e + Clone + Send + 'static,\n    S::Future: Send + 'static,\n{\n    type Error = S::Error;\n    type Future = BoxFuture\u003c'static, Result\u003cSelf::Response, Self::Error\u003e\u003e;\n    type Response = S::Response;\n\n    fn poll_ready(\u0026mut self, cx: \u0026mut Context\u003c'_\u003e) -\u003e Poll\u003cResult\u003c(), Self::Error\u003e\u003e {\n        self.inner.poll_ready(cx)\n    }\n\n    fn call(\u0026mut self, request: Request\u003cBody\u003e) -\u003e Self::Future {\n        let clone = self.inner.clone();\n        let mut inner = std::mem::replace(\u0026mut self.inner, clone);\n\n        // FIXME: Solve error handling within middleware\n        Box::pin(async move {\n            let mut request_parts = RequestParts::new(request);\n\n            // FIXME: Maybe create a helper function to grab services from extensions, this is very verbose.\n            let token_service = request_parts\n                .extensions()\n                .unwrap()\n                .get::\u003cTokenService\u003e()\n                .unwrap()\n                .clone();\n\n            let profile_service = request_parts\n                .extensions()\n                .unwrap()\n                .get::\u003cProfileService\u003e()\n                .unwrap()\n                .clone();\n\n            // FIXME: Handle invalid token.\n            let TypedHeader(Authorization(bearer)) =\n                TypedHeader::\u003cAuthorization\u003cBearer\u003e\u003e::from_request(\u0026mut request_parts)\n                    .await\n                    .unwrap();\n\n            let token = bearer.token();\n            debug!(\"Bearer Token: {token:?}\");\n\n            let claims = token_service.decode(token).unwrap();\n            info!(\"Claims: {claims:?}\");\n\n            let profile_id = claims.sub;\n            let profile = profile_service\n                .read(profile_id)\n                .await\n                .unwrap();\n\n            // Inject Profile and Claims\n            request_parts\n                .extensions_mut()\n                .unwrap()\n                .insert(profile);\n\n            request_parts\n                .extensions_mut()\n                .unwrap()\n                .insert(claims);\n\n            let request = request_parts\n                .try_into_request()\n                .unwrap();\n\n            let response = inner.call(request).await?;\n\n            Ok(response)\n        })\n    }\n}\n","traces":[{"line":17,"address":[4312880],"length":1,"stats":{"Line":5},"fn_name":"default"},{"line":25,"address":[4312896],"length":1,"stats":{"Line":5},"fn_name":"layer\u003caxum::routing::route::Route\u003chyper::body::body::Body, core::convert::Infallible\u003e\u003e"},{"line":46,"address":[4312944],"length":1,"stats":{"Line":2},"fn_name":"poll_ready\u003caxum::routing::route::Route\u003chyper::body::body::Body, core::convert::Infallible\u003e\u003e"},{"line":47,"address":[4312958],"length":1,"stats":{"Line":2},"fn_name":null},{"line":50,"address":[4313489,4313520,4312992],"length":1,"stats":{"Line":2},"fn_name":"call\u003caxum::routing::route::Route\u003chyper::body::body::Body, core::convert::Infallible\u003e\u003e"},{"line":51,"address":[4313047,4313140],"length":1,"stats":{"Line":4},"fn_name":null},{"line":52,"address":[4313156],"length":1,"stats":{"Line":2},"fn_name":null},{"line":55,"address":[4313204,4313031,4313984,4314778,4313754,4313536,4323758,4313605],"length":1,"stats":{"Line":8},"fn_name":"{async_block#0}\u003caxum::routing::route::Route\u003chyper::body::body::Body, core::convert::Infallible\u003e\u003e"},{"line":56,"address":[4314106,4313670],"length":1,"stats":{"Line":4},"fn_name":null},{"line":59,"address":[4314188,4314113],"length":1,"stats":{"Line":4},"fn_name":null},{"line":60,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":61,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":62,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":63,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":64,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":66,"address":[4314301,4314378],"length":1,"stats":{"Line":4},"fn_name":null},{"line":67,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":68,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":69,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":70,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":71,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":74,"address":[4314991],"length":1,"stats":{"Line":2},"fn_name":null},{"line":75,"address":[4656595],"length":1,"stats":{"Line":6},"fn_name":null},{"line":76,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":77,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":79,"address":[4315162,4315046],"length":1,"stats":{"Line":4},"fn_name":null},{"line":80,"address":[4317697,4316103,4317613,4315286,4315648,4315812,4316187,4316644,4316805,4317024],"length":1,"stats":{"Line":10},"fn_name":null},{"line":82,"address":[4316602,4318313],"length":1,"stats":{"Line":4},"fn_name":null},{"line":83,"address":[4318886,4319050,4319425,4320061,4320953,4319900,4318524,4320280,4319341,4320869],"length":1,"stats":{"Line":10},"fn_name":null},{"line":85,"address":[4319836],"length":1,"stats":{"Line":2},"fn_name":null},{"line":86,"address":[4319851,4321670,4319890,4321779,4321872],"length":1,"stats":{"Line":10},"fn_name":null},{"line":87,"address":[4321573,4321703,4313805,4313890,4319858,4321814],"length":1,"stats":{"Line":12},"fn_name":null},{"line":88,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":89,"address":[4321910],"length":1,"stats":{"Line":2},"fn_name":null},{"line":92,"address":[4321989,4322076,4321917],"length":1,"stats":{"Line":6},"fn_name":null},{"line":93,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":94,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":95,"address":[4322091,4322016],"length":1,"stats":{"Line":4},"fn_name":null},{"line":97,"address":[4322106,4322245],"length":1,"stats":{"Line":4},"fn_name":null},{"line":98,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":99,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":100,"address":[4322260,4322162],"length":1,"stats":{"Line":4},"fn_name":null},{"line":102,"address":[4322275],"length":1,"stats":{"Line":2},"fn_name":null},{"line":103,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":104,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":106,"address":[4323545,4322374,4313823],"length":1,"stats":{"Line":3},"fn_name":null},{"line":108,"address":[4323254],"length":1,"stats":{"Line":2},"fn_name":null}],"covered":28,"coverable":47},{"path":["/","home","runner","work","throwaway","throwaway","src","middleware","version_header.rs"],"content":"use axum::body::Body;\nuse axum::http::{HeaderValue, Request};\nuse axum::response::IntoResponse;\nuse axum_extra::middleware::Next;\n\nuse crate::VERSION;\n\npub async fn version_header_middleware(request: Request\u003cBody\u003e, next: Next\u003cBody\u003e) -\u003e impl IntoResponse {\n    let mut response = next.run(request).await;\n\n    response\n        .headers_mut()\n        .insert(\"X-Version\", HeaderValue::from_static(VERSION));\n\n    response\n}\n","traces":[{"line":8,"address":[4118656,4118699],"length":1,"stats":{"Line":0},"fn_name":"version_header_middleware"},{"line":9,"address":[5582635,5582691,5582869,5583035],"length":1,"stats":{"Line":0},"fn_name":null},{"line":11,"address":[5438070,5438168],"length":1,"stats":{"Line":0},"fn_name":null},{"line":13,"address":[5438249,5438315],"length":1,"stats":{"Line":0},"fn_name":null},{"line":15,"address":[5438334],"length":1,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":5},{"path":["/","home","runner","work","throwaway","throwaway","src","models","claims.rs"],"content":"use serde::{Deserialize, Serialize};\nuse uuid::Uuid;\n\nuse crate::attributes::core::Attributes;\n\npub const ISS: \u0026str = \"throwaway\";\n\n/// \u003chttps://www.iana.org/assignments/jwt/jwt.xhtml#claims\u003e\n#[derive(Clone, Debug, Serialize, Deserialize)]\npub struct Claims {\n    // Issuer\n    pub iss: String,\n\n    // Expiration Time\n    pub exp: i64,\n\n    // Issued At\n    pub iat: i64,\n\n    // Subject\n    pub sub: Uuid,\n\n    // Attributes\n    #[serde(skip_serializing_if = \"Option::is_none\")]\n    pub attributes: Option\u003cAttributes\u003e,\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","models","database","mod.rs"],"content":"pub mod profile;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","models","database","profile.rs"],"content":"use chrono::{DateTime, Utc};\nuse redis::{FromRedisValue, RedisResult, RedisWrite, ToRedisArgs, Value};\nuse serde::{Deserialize, Serialize};\nuse serde_json;\nuse sqlx::FromRow;\nuse uuid::Uuid;\n\nuse crate::models::public::profile::ProfilePublic;\n\n#[derive(Clone, Debug, Serialize, Deserialize, FromRow)]\npub struct Profile {\n    pub profile_id: Uuid,\n    pub name: String,\n    pub email: String,\n    pub password: String,\n    pub country: String,\n    pub timezone: String,\n    pub created_at: DateTime\u003cUtc\u003e,\n    pub updated_at: DateTime\u003cUtc\u003e,\n    pub is_deleted: bool,\n}\n\n// FIXME: Perhaps better ot support .into() style access? How do we do that, use From\u003cT\u003e ?\nimpl Profile {\n    pub fn to_public(\u0026self) -\u003e ProfilePublic {\n        ProfilePublic {\n            name: self.name.clone(),\n            email: self.email.clone(),\n            country: self.country.clone(),\n            timezone: self.timezone.clone(),\n        }\n    }\n}\n\nimpl ToRedisArgs for \u0026Profile {\n    fn write_redis_args\u003cW\u003e(\u0026self, output: \u0026mut W)\n    where\n        W: ?Sized + RedisWrite,\n    {\n        output.write_arg_fmt(serde_json::to_string(self).unwrap());\n    }\n}\n\nimpl FromRedisValue for Profile {\n    fn from_redis_value(value: \u0026Value) -\u003e RedisResult\u003cSelf\u003e {\n        match *value {\n            redis::Value::Data(ref value_slice) =\u003e {\n                match serde_json::from_slice(value_slice) {\n                    Err(_) =\u003e Err((redis::ErrorKind::TypeError, \"Can't serialize value\").into()),\n                    Ok(profile) =\u003e Ok(profile),\n                }\n            }\n            _ =\u003e Err((redis::ErrorKind::ResponseError, \"Response type not Profile compatible.\").into()),\n        }\n    }\n}\n","traces":[{"line":25,"address":[4782918,4782560],"length":1,"stats":{"Line":1},"fn_name":"to_public"},{"line":27,"address":[4782590],"length":1,"stats":{"Line":1},"fn_name":null},{"line":28,"address":[8638094],"length":1,"stats":{"Line":1},"fn_name":null},{"line":29,"address":[4782672],"length":1,"stats":{"Line":1},"fn_name":null},{"line":30,"address":[8638607],"length":1,"stats":{"Line":1},"fn_name":null},{"line":36,"address":[4783024,4782944],"length":1,"stats":{"Line":3},"fn_name":"write_redis_args\u003calloc::vec::Vec\u003calloc::vec::Vec\u003cu8, alloc::alloc::Global\u003e, alloc::alloc::Global\u003e\u003e"},{"line":40,"address":[8638457,8638537],"length":1,"stats":{"Line":3},"fn_name":null},{"line":45,"address":[4783572,4783104,4783545],"length":1,"stats":{"Line":2},"fn_name":"from_redis_value"},{"line":46,"address":[4783134],"length":1,"stats":{"Line":2},"fn_name":null},{"line":47,"address":[4783145],"length":1,"stats":{"Line":2},"fn_name":null},{"line":48,"address":[8659676,8659541],"length":1,"stats":{"Line":4},"fn_name":null},{"line":49,"address":[4783509,4783414],"length":1,"stats":{"Line":0},"fn_name":null},{"line":50,"address":[4783317],"length":1,"stats":{"Line":2},"fn_name":null},{"line":53,"address":[4783174],"length":1,"stats":{"Line":0},"fn_name":null}],"covered":12,"coverable":14},{"path":["/","home","runner","work","throwaway","throwaway","src","models","mod.rs"],"content":"pub mod claims;\npub mod database;\npub mod public;\npub mod request;\npub mod response;\npub mod secrets;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","models","public","mod.rs"],"content":"pub mod profile;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","models","public","profile.rs"],"content":"use serde::Serialize;\n\n#[derive(Serialize, Debug)]\npub struct ProfilePublic {\n    pub name: String,\n    pub email: String,\n    pub country: String,\n    pub timezone: String,\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","models","request","mod.rs"],"content":"pub mod profile;\npub mod register;\npub mod token;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","models","request","profile.rs"],"content":"use serde::Deserialize;\nuse validator::Validate;\n\nuse crate::validation::country::validate_country;\nuse crate::validation::email::validate_email;\nuse crate::validation::name::validate_name;\nuse crate::validation::timezone::validate_timezone;\n\n#[derive(Debug, Deserialize, Validate)]\npub struct ProfilePatchRequest {\n    #[validate(custom = \"validate_name\")]\n    pub name: Option\u003cString\u003e,\n\n    #[validate(custom = \"validate_email\")]\n    pub email: Option\u003cString\u003e,\n\n    #[validate(custom = \"validate_country\")]\n    pub country: Option\u003cString\u003e,\n\n    #[validate(custom = \"validate_timezone\")]\n    pub timezone: Option\u003cString\u003e,\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","models","request","register.rs"],"content":"use serde::Deserialize;\nuse validator::Validate;\n\nuse crate::validation::country::validate_country;\nuse crate::validation::email::validate_email;\nuse crate::validation::name::validate_name;\nuse crate::validation::password::validate_password;\nuse crate::validation::timezone::validate_timezone;\n\n#[derive(Debug, Deserialize, Validate)]\npub struct RegisterRequest {\n    #[validate(custom = \"validate_name\")]\n    pub name: String,\n\n    #[validate(custom = \"validate_email\")]\n    pub email: String,\n\n    #[validate(custom = \"validate_password\")]\n    pub password: String,\n\n    #[validate(custom = \"validate_country\")]\n    pub country: String,\n\n    #[validate(custom = \"validate_timezone\")]\n    pub timezone: String,\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","models","request","token.rs"],"content":"use serde::{Deserialize, Serialize};\nuse validator::Validate;\n\nuse crate::attributes::core::Attributes;\n\n#[derive(Debug, Deserialize, Serialize, Validate)]\npub struct TokenRequest {\n    /// FIXME: Limit options here? (10mins, 1hr, 6hrs, 12hrs, 24hrs etc. not the most user friendly...)\n    /// Maybe just 'X seconds' is good enough, but we'll need to limit max here (use validate)\n    pub lifespan: usize,\n\n    /// FIXME: How can we validate this? Will be tricky.\n    #[serde(skip_serializing_if = \"Option::is_none\")]\n    pub attributes: Option\u003cAttributes\u003e,\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","models","response","config.rs"],"content":"use serde::Serialize;\n\nuse crate::Config;\n\n#[derive(Serialize, Debug)]\npub struct ConfigResponse {\n    pub config: Config,\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","models","response","mod.rs"],"content":"pub mod config;\npub mod profile;\npub mod register;\npub mod token;\npub mod token_info;\npub mod version;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","models","response","profile.rs"],"content":"use serde::Serialize;\n\nuse crate::models::public::profile::ProfilePublic;\n\n#[derive(Serialize, Debug)]\npub struct ProfilePatchResponse {\n    pub message: String,\n    pub code: usize,\n    pub profile: Option\u003cProfilePublic\u003e,\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","models","response","register.rs"],"content":"use serde::Serialize;\nuse sqlx::types::Uuid;\n\n#[derive(Serialize, Debug)]\npub struct RegisterResponse {\n    pub profile_id: Uuid,\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","models","response","token.rs"],"content":"use serde::Serialize;\n\n#[derive(Serialize, Debug)]\npub struct TokenResponse {\n    pub token: String,\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","models","response","token_info.rs"],"content":"use serde::Serialize;\n\nuse crate::attributes::core::Attributes;\n\n#[derive(Serialize, Debug)]\npub struct TokenInfoResponse {\n    pub issued_at: String,\n    pub expires_at: String,\n    pub attributes: Option\u003cAttributes\u003e,\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","models","response","version.rs"],"content":"use serde::Serialize;\n\n#[derive(Serialize, Debug)]\npub struct VersionResponse {\n    pub version: String,\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","models","secrets","cache.rs"],"content":"use serde::{Deserialize, Serialize};\n\n#[derive(Clone, Debug, Deserialize, Serialize)]\npub struct CacheSecrets {\n    pub host: String,\n    pub port: String,\n    pub password: String,\n}\n\nimpl CacheSecrets {\n    pub fn dsn(\u0026self) -\u003e String {\n        format!(\"redis://:{}@{}:{}\", self.password, self.host, self.port)\n    }\n\n    pub fn local_dsn(\u0026self) -\u003e String {\n        format!(\"redis://:{}@{}:{}\", self.password, \"localhost\", self.port)\n    }\n}\n","traces":[{"line":11,"address":[6121520],"length":1,"stats":{"Line":0},"fn_name":"dsn"},{"line":12,"address":[4261862],"length":1,"stats":{"Line":0},"fn_name":null},{"line":15,"address":[4262080],"length":1,"stats":{"Line":5},"fn_name":"local_dsn"},{"line":16,"address":[4262118],"length":1,"stats":{"Line":5},"fn_name":null}],"covered":2,"coverable":4},{"path":["/","home","runner","work","throwaway","throwaway","src","models","secrets","database.rs"],"content":"use serde::{Deserialize, Serialize};\n\n#[derive(Clone, Debug, Deserialize, Serialize)]\npub struct DatabaseSecrets {\n    pub host: String,\n    pub port: String,\n    pub user: String,\n    pub password: String,\n    pub db: String,\n}\n\nimpl DatabaseSecrets {\n    pub fn dsn(\u0026self) -\u003e String {\n        format!(\n            \"postgresql://{}:{}@{}:{}/{}\",\n            self.user, self.password, self.host, self.port, self.db,\n        )\n    }\n\n    pub fn local_dsn(\u0026self) -\u003e String {\n        format!(\n            \"postgresql://{}:{}@{}:{}/{}\",\n            self.user, self.password, \"localhost\", self.port, self.db,\n        )\n    }\n}\n","traces":[{"line":13,"address":[5792912],"length":1,"stats":{"Line":0},"fn_name":"dsn"},{"line":14,"address":[3912839],"length":1,"stats":{"Line":0},"fn_name":null},{"line":20,"address":[3913152],"length":1,"stats":{"Line":5},"fn_name":"local_dsn"},{"line":21,"address":[3913191],"length":1,"stats":{"Line":5},"fn_name":null}],"covered":2,"coverable":4},{"path":["/","home","runner","work","throwaway","throwaway","src","models","secrets","jwt.rs"],"content":"use serde::{Deserialize, Serialize};\n\n#[derive(Clone, Debug, Deserialize, Serialize)]\npub struct JwtSecrets {\n    pub password: String,\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","models","secrets","mod.rs"],"content":"pub mod cache;\npub mod database;\npub mod jwt;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","repositories","mod.rs"],"content":"pub mod profile;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","repositories","profile.rs"],"content":"use sqlx::types::Uuid;\nuse tracing::error;\nuse tracing::instrument;\n\nuse crate::database::DatabasePool;\nuse crate::errors::core::ServerError;\nuse crate::errors::profile::ProfileError;\nuse crate::models::database::profile::Profile;\nuse crate::models::request::register::RegisterRequest;\nuse crate::Cache;\n\n#[derive(Clone)]\npub struct ProfileRepository {\n    pub database: DatabasePool,\n    pub cache: Cache,\n}\n\n// FIXME: I wonder if splitting this into SQL v Cache repos (?) would be nicer?\nimpl ProfileRepository {\n    #[must_use]\n    pub const fn new(database: DatabasePool, cache: Cache) -\u003e Self {\n        Self {\n            database,\n            cache,\n        }\n    }\n\n    // FIXME: Probably shouldn't pass in request object directly, pass in parts instead.\n    #[instrument(skip(self), level = \"info\")]\n    pub async fn insert(\u0026self, register_request: RegisterRequest) -\u003e Result\u003cUuid, ServerError\u003e {\n        // language=sql\n        let query = sqlx::query!(\n            r#\"\n            INSERT INTO throwaway.profile (name, email, password, country, timezone)\n            VALUES ($1, $2, $3, $4, $5)\n            RETURNING (profile_id)\n            \"#,\n            register_request.name,\n            register_request.email,\n            register_request.password,\n            register_request.country,\n            register_request.timezone,\n        );\n\n        return match query.fetch_one(\u0026self.database).await {\n            Ok(output) =\u003e Ok(output.profile_id),\n            Err(error) =\u003e {\n                // Tracing instead? Then we don't need to log out parameters every time\n                error!(\"Could not insert Profile: {error:#?}\");\n                Err(ProfileError::NotFound.into())\n            }\n        };\n    }\n\n    #[instrument(skip(self), level = \"info\")]\n    pub async fn exists(\u0026self, email: \u0026str) -\u003e Result\u003cbool, ServerError\u003e {\n        if self.cache_exists_by_email(email).await {\n            return Ok(true);\n        }\n\n        // language=sql\n        let query = sqlx::query!(\n            r#\"\n            SELECT EXISTS(\n                SELECT 1\n                FROM throwaway.profile\n                WHERE email = $1\n            )\n            \"#,\n            email,\n        );\n\n        return match query.fetch_one(\u0026self.database).await {\n            Ok(output) =\u003e {\n                let exists: bool = output.exists.unwrap();\n                Ok(exists)\n            }\n            Err(error) =\u003e {\n                error!(\"Could not find existing Profile by email: {error:#?}\");\n                Err(ProfileError::NotFound.into())\n            }\n        };\n    }\n\n    #[instrument(skip(self), level = \"info\")]\n    pub async fn get_by_email(\u0026self, email: \u0026str) -\u003e Result\u003cProfile, ServerError\u003e {\n        if let Some(profile) = self.cache_get_by_email(email).await {\n            return Ok(profile);\n        }\n\n        // language=sql\n        let query = sqlx::query_as!(\n            Profile,\n            r#\"\n            SELECT profile_id, name, email, password, country, timezone, created_at, updated_at, is_deleted\n            FROM throwaway.profile\n            WHERE email = $1\n            \"#,\n            email,\n        );\n\n        return match query.fetch_one(\u0026self.database).await {\n            Ok(profile) =\u003e {\n                self.cache_set(profile.clone()).await;\n                Ok(profile)\n            }\n            Err(error) =\u003e {\n                error!(\"Could not find Profile by email: {error:#?}\");\n                Err(ProfileError::NotFound.into())\n            }\n        };\n    }\n\n    #[instrument(skip(self), level = \"info\")]\n    pub async fn get_by_profile_id(\u0026self, profile_id: Uuid) -\u003e Result\u003cProfile, ServerError\u003e {\n        if let Some(profile) = self.cache_get_by_id(profile_id).await {\n            return Ok(profile);\n        }\n\n        // language=sql\n        let query = sqlx::query_as!(\n            Profile,\n            r#\"\n            SELECT profile_id, name, email, password, country, timezone, created_at, updated_at, is_deleted\n            FROM throwaway.profile\n            WHERE profile_id = $1\n            \"#,\n            profile_id,\n        );\n\n        return match query.fetch_one(\u0026self.database).await {\n            Ok(profile) =\u003e {\n                self.cache_set(profile.clone()).await;\n                Ok(profile)\n            }\n            Err(error) =\u003e {\n                error!(\"Could not find Profile by ID: {error:#?}\");\n                Err(ProfileError::NotFound.into())\n            }\n        };\n    }\n\n    #[instrument(skip(self), level = \"info\")]\n    pub async fn update(\u0026self, profile: Profile) -\u003e Result\u003c(), ServerError\u003e {\n        // language=sql\n        let query = sqlx::query!(\n            r#\"\n            UPDATE throwaway.profile\n            SET\n                name = $1,\n                email = $2,\n                password = $3,\n                country = $4,\n                timezone = $5\n            WHERE profile_id = $6\n            \"#,\n            profile.name,\n            profile.email,\n            profile.password,\n            profile.country,\n            profile.timezone,\n            profile.profile_id,\n        );\n\n        return match query.execute(\u0026self.database).await {\n            Ok(_) =\u003e Ok(()),\n            Err(error) =\u003e {\n                // FIXME: Do we log out here or at the \"error\" mapping level?\n                error!(\"Failed to update Profile: {error:#?}\");\n                Err(ProfileError::UpdateFailure.into())\n            }\n        };\n    }\n\n    #[instrument(skip(self), level = \"info\")]\n    pub async fn update_name(\u0026self, profile_id: Uuid, name: String) -\u003e Result\u003c(), ServerError\u003e {\n        // language=sql\n        let query = sqlx::query!(\n            r#\"\n            UPDATE throwaway.profile\n            SET name = $1\n            WHERE profile_id = $2\n            \"#,\n            name,\n            profile_id,\n        );\n\n        return match query.execute(\u0026self.database).await {\n            Ok(_) =\u003e Ok(()),\n            Err(error) =\u003e {\n                error!(\"Failed to update Profile name: {error:#?}\");\n                Err(ProfileError::UpdateFailure.into())\n            }\n        };\n    }\n\n    #[instrument(skip(self), level = \"info\")]\n    pub async fn update_email(\u0026self, profile_id: Uuid, email: String) -\u003e Result\u003c(), ServerError\u003e {\n        // language=sql\n        let query = sqlx::query!(\n            r#\"\n            UPDATE throwaway.profile\n            SET email = $1\n            WHERE profile_id = $2\n            \"#,\n            email,\n            profile_id,\n        );\n\n        return match query.execute(\u0026self.database).await {\n            Ok(_) =\u003e Ok(()),\n            Err(error) =\u003e {\n                error!(\"Failed to update Profile email: {error:#?}\");\n                Err(ProfileError::UpdateFailure.into())\n            }\n        };\n    }\n\n    // NOTE: Seems like we shouldn't invalidate caches at all, simply update? Might no scale quite as well...\n    pub async fn cache_set(\u0026self, profile: Profile) {\n        let cache_key_email = Self::cache_key_email(\u0026profile.email);\n        self.cache\n            .set(\u0026cache_key_email, \u0026profile, 600)\n            .await;\n\n        let cache_key_id = Self::cache_key_id(profile.profile_id);\n        self.cache\n            .set(\u0026cache_key_id, \u0026profile, 600)\n            .await;\n    }\n\n    pub async fn cache_get_by_id(\u0026self, profile_id: Uuid) -\u003e Option\u003cProfile\u003e {\n        let cache_key = Self::cache_key_id(profile_id);\n        self.cache.get(\u0026cache_key).await\n    }\n\n    // FIXME: Why do we need email again? For JWT lookups, why not just store Uuid in JWT and call it a day?\n    // FIXME: The \"best practices\" i followed seemed to stick with email as the claim in use for identification.\n    pub async fn cache_get_by_email(\u0026self, email: \u0026str) -\u003e Option\u003cProfile\u003e {\n        let cache_key = Self::cache_key_email(email);\n        self.cache.get(\u0026cache_key).await\n    }\n\n    pub async fn cache_exists_by_email(\u0026self, email: \u0026str) -\u003e bool {\n        let cache_key = Self::cache_key_email(email);\n        self.cache.exists(\u0026cache_key).await\n    }\n\n    pub fn cache_key_id(profile_id: Uuid) -\u003e String {\n        format!(\"profile_id_{profile_id}\")\n    }\n\n    pub fn cache_key_email(email: \u0026str) -\u003e String {\n        format!(\"profile_email_{email}\")\n    }\n}\n","traces":[{"line":21,"address":[3974112],"length":1,"stats":{"Line":5},"fn_name":"new"},{"line":29,"address":[3979421,3979809,3980870,3980098,3980460,3981495,3981744,3980624,3979677,3979300,3981859,3981787,3982318,3979852,3979360],"length":1,"stats":{"Line":30},"fn_name":"{async_fn#0}"},{"line":30,"address":[3984185,3983997,3990747,3983936,3981268,3979264,3984683,3984268,3979486],"length":1,"stats":{"Line":15},"fn_name":"insert"},{"line":32,"address":[3984062,3985647,3985965],"length":1,"stats":{"Line":9},"fn_name":null},{"line":38,"address":[3984418,3984170,3984359],"length":1,"stats":{"Line":3},"fn_name":null},{"line":39,"address":[3984328,3984725],"length":1,"stats":{"Line":3},"fn_name":null},{"line":40,"address":[3984694,3985040],"length":1,"stats":{"Line":3},"fn_name":null},{"line":41,"address":[3985355,3985009],"length":1,"stats":{"Line":3},"fn_name":null},{"line":42,"address":[3985673,3985324],"length":1,"stats":{"Line":3},"fn_name":null},{"line":45,"address":[3984209,3986821,3986901],"length":1,"stats":{"Line":9},"fn_name":null},{"line":46,"address":[3987274],"length":1,"stats":{"Line":3},"fn_name":null},{"line":47,"address":[3987383],"length":1,"stats":{"Line":0},"fn_name":null},{"line":49,"address":[3987576,3988393,3987938,3988102,3989320,3988940,3989879,3989951,3989101,3988477],"length":1,"stats":{"Line":0},"fn_name":null},{"line":50,"address":[3990491,3988906],"length":1,"stats":{"Line":0},"fn_name":null},{"line":55,"address":[3992910,3994739,3993329,3994071,3993691,3993042,3992805,3994782,3993085,3995256,3994854,3994490,3993849,3992671,3992736],"length":1,"stats":{"Line":30},"fn_name":"{async_fn#0}"},{"line":56,"address":[3996812,3994424,3992867,3996496,3992624,3996565,3996656,3997114],"length":1,"stats":{"Line":15},"fn_name":"exists"},{"line":57,"address":[3997125,3996686,3996769,3996627,3996937],"length":1,"stats":{"Line":12},"fn_name":null},{"line":58,"address":[3997252],"length":1,"stats":{"Line":0},"fn_name":null},{"line":62,"address":[3997224,3997644,3997327],"length":1,"stats":{"Line":9},"fn_name":null},{"line":70,"address":[3997244,3997345],"length":1,"stats":{"Line":3},"fn_name":null},{"line":73,"address":[3998032,3998111,3996704],"length":1,"stats":{"Line":9},"fn_name":null},{"line":74,"address":[3998483],"length":1,"stats":{"Line":3},"fn_name":null},{"line":75,"address":[3998493,4001853,3998475],"length":1,"stats":{"Line":9},"fn_name":null},{"line":76,"address":[4001865],"length":1,"stats":{"Line":3},"fn_name":null},{"line":78,"address":[3998521],"length":1,"stats":{"Line":0},"fn_name":null},{"line":79,"address":[3999615,4000458,3998714,4001131,4000078,3999240,3999076,4001047,4000239,3999531],"length":1,"stats":{"Line":0},"fn_name":null},{"line":80,"address":[4001707,4000044],"length":1,"stats":{"Line":0},"fn_name":null},{"line":85,"address":[4005986,4003725,4004495,4003445,4005445,4004331,4005578,4003376,4003550,4004741,4005494,4003317,4005178,4003969,4003682],"length":1,"stats":{"Line":30},"fn_name":"{async_fn#0}"},{"line":86,"address":[4007093,4007417,4003264,4007712,4007187,4005112,4003507,4007024],"length":1,"stats":{"Line":15},"fn_name":"get_by_email"},{"line":87,"address":[4007374,4007723,4007158,4007545,4007217],"length":1,"stats":{"Line":12},"fn_name":null},{"line":88,"address":[4007934],"length":1,"stats":{"Line":0},"fn_name":null},{"line":92,"address":[4008030,4008381,4008064],"length":1,"stats":{"Line":9},"fn_name":null},{"line":99,"address":[4008082,4008050],"length":1,"stats":{"Line":3},"fn_name":null},{"line":102,"address":[4008769,4007323,4008848,4007238],"length":1,"stats":{"Line":12},"fn_name":null},{"line":103,"address":[4009205],"length":1,"stats":{"Line":3},"fn_name":null},{"line":104,"address":[4009257,4012699,4007256],"length":1,"stats":{"Line":9},"fn_name":null},{"line":105,"address":[4012974],"length":1,"stats":{"Line":3},"fn_name":null},{"line":107,"address":[4009294],"length":1,"stats":{"Line":0},"fn_name":null},{"line":108,"address":[4009845,4009483,4010300,4010384,4011008,4011227,4011816,4010009,4011900,4010847],"length":1,"stats":{"Line":0},"fn_name":null},{"line":109,"address":[4012488,4010813],"length":1,"stats":{"Line":0},"fn_name":null},{"line":114,"address":[4018058,4017926,4018101,4018871,4017685,4019581,4020428,4017760,4018345,4018707,4019848,4019897,4019981,4019117,4017829],"length":1,"stats":{"Line":20},"fn_name":"{async_fn#0}"},{"line":115,"address":[4017648,4021456,4022159,4017891,4019527,4021864,4021634,4021525],"length":1,"stats":{"Line":10},"fn_name":"get_by_profile_id"},{"line":116,"address":[4021590,4021821,4021664,4022170,4021992],"length":1,"stats":{"Line":8},"fn_name":null},{"line":117,"address":[4022381],"length":1,"stats":{"Line":2},"fn_name":null},{"line":121,"address":[4022513,4022726,4022477],"length":1,"stats":{"Line":0},"fn_name":null},{"line":128,"address":[4022539,4022499],"length":1,"stats":{"Line":0},"fn_name":null},{"line":131,"address":[4021770,4023114,4021685,4023193],"length":1,"stats":{"Line":0},"fn_name":null},{"line":132,"address":[4023550],"length":1,"stats":{"Line":0},"fn_name":null},{"line":133,"address":[4021703,4023602,4027008],"length":1,"stats":{"Line":0},"fn_name":null},{"line":134,"address":[4027271],"length":1,"stats":{"Line":0},"fn_name":null},{"line":136,"address":[4023639],"length":1,"stats":{"Line":0},"fn_name":null},{"line":137,"address":[4025572,4024729,4024354,4026161,4024645,4024190,4025353,4026245,4023828,4025192],"length":1,"stats":{"Line":0},"fn_name":null},{"line":138,"address":[4026797,4025158],"length":1,"stats":{"Line":0},"fn_name":null},{"line":143,"address":[4031990],"length":1,"stats":{"Line":0},"fn_name":null},{"line":144,"address":[4031952],"length":1,"stats":{"Line":0},"fn_name":"update"},{"line":175,"address":[4032527,4033129,4033539,4032352,4034246,4033293,4032484,4035266,4034538,4034610,4034495,4032176,4032087,4032231,4032767],"length":1,"stats":{"Line":10},"fn_name":"{async_fn#0}"},{"line":176,"address":[4041627,4036769,4032064,4034164,4037184,4036567,4032293,4036688,4036512],"length":1,"stats":{"Line":5},"fn_name":"update_name"},{"line":178,"address":[4036632,4037203,4037417],"length":1,"stats":{"Line":3},"fn_name":null},{"line":184,"address":[4036919,4036673,4036860],"length":1,"stats":{"Line":1},"fn_name":null},{"line":185,"address":[4037229,4036829],"length":1,"stats":{"Line":1},"fn_name":null},{"line":188,"address":[4037979,4036712,4037899],"length":1,"stats":{"Line":3},"fn_name":null},{"line":189,"address":[4038353],"length":1,"stats":{"Line":1},"fn_name":null},{"line":190,"address":[4038366],"length":1,"stats":{"Line":0},"fn_name":null},{"line":191,"address":[4038921,4039923,4040303,4039460,4039376,4038559,4039085,4040862,4040084,4040934],"length":1,"stats":{"Line":0},"fn_name":null},{"line":192,"address":[4041474,4039889],"length":1,"stats":{"Line":0},"fn_name":null},{"line":197,"address":[4043641,4045007,4045050,4045122,4042599,4042864,4042996,4044758,4043279,4042688,4043039,4042743,4043805,4045778,4044051],"length":1,"stats":{"Line":0},"fn_name":"{async_fn#0}"},{"line":198,"address":[4044676,4047281,4047200,4052139,4047696,4047079,4042805,4042576,4047024],"length":1,"stats":{"Line":0},"fn_name":"update_email"},{"line":200,"address":[4047715,4047144,4047929],"length":1,"stats":{"Line":0},"fn_name":null},{"line":206,"address":[4047431,4047372,4047185],"length":1,"stats":{"Line":0},"fn_name":null},{"line":207,"address":[4047741,4047341],"length":1,"stats":{"Line":0},"fn_name":null},{"line":210,"address":[4048411,4048491,4047224],"length":1,"stats":{"Line":0},"fn_name":null},{"line":211,"address":[4048865],"length":1,"stats":{"Line":0},"fn_name":null},{"line":212,"address":[4048878],"length":1,"stats":{"Line":0},"fn_name":null},{"line":213,"address":[4050435,4049433,4050596,4049972,4050815,4051374,4049597,4049071,4051446,4049888],"length":1,"stats":{"Line":0},"fn_name":null},{"line":214,"address":[4051986,4050401],"length":1,"stats":{"Line":0},"fn_name":null},{"line":220,"address":[3974469,3975133,3974627,3974160,3974206,3974325,3975726,3974272],"length":1,"stats":{"Line":15},"fn_name":"cache_set"},{"line":221,"address":[3974436,3974758],"length":1,"stats":{"Line":6},"fn_name":null},{"line":222,"address":[3974933,3974780,3975056],"length":1,"stats":{"Line":9},"fn_name":null},{"line":223,"address":[3974499,3974956,3974912,3974584,3975087,3975144,3974799],"length":1,"stats":{"Line":18},"fn_name":null},{"line":226,"address":[3975216],"length":1,"stats":{"Line":3},"fn_name":null},{"line":227,"address":[3975537,3975261,3975414],"length":1,"stats":{"Line":9},"fn_name":null},{"line":228,"address":[3975562,3975280,3975437,3974517,3975393],"length":1,"stats":{"Line":15},"fn_name":null},{"line":232,"address":[3976149,3975936,3975840,3975871,3976226,3976005,3976540],"length":1,"stats":{"Line":8},"fn_name":"cache_get_by_id"},{"line":233,"address":[3976108],"length":1,"stats":{"Line":2},"fn_name":null},{"line":234,"address":[3976479,3976173,3976559,3976692,3976354],"length":1,"stats":{"Line":6},"fn_name":null},{"line":239,"address":[3976944,3977301,3977233,3977113,3977056,3977579,3976991],"length":1,"stats":{"Line":12},"fn_name":"cache_get_by_email"},{"line":240,"address":[3977216],"length":1,"stats":{"Line":3},"fn_name":null},{"line":241,"address":[3977716,3977254,3977521,3977420,3977595],"length":1,"stats":{"Line":9},"fn_name":null},{"line":244,"address":[3978283,3978095,3978561,3977983,3977936,3978048,3978215],"length":1,"stats":{"Line":12},"fn_name":"cache_exists_by_email"},{"line":245,"address":[3978198],"length":1,"stats":{"Line":3},"fn_name":null},{"line":246,"address":[3978236,3978402,3978577,3978705,3978503],"length":1,"stats":{"Line":9},"fn_name":null},{"line":249,"address":[3978848],"length":1,"stats":{"Line":3},"fn_name":"cache_key_id"},{"line":250,"address":[3978873],"length":1,"stats":{"Line":3},"fn_name":null},{"line":253,"address":[3978976],"length":1,"stats":{"Line":3},"fn_name":"cache_key_email"},{"line":254,"address":[3979000],"length":1,"stats":{"Line":3},"fn_name":null}],"covered":60,"coverable":95},{"path":["/","home","runner","work","throwaway","throwaway","src","services","mod.rs"],"content":"pub mod password;\npub mod profile;\npub mod token;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","services","password.rs"],"content":"use argon2::password_hash::SaltString;\nuse argon2::{Argon2, PasswordHash, PasswordHasher, PasswordVerifier};\nuse rand_core::OsRng;\n\nuse crate::errors::core::ServerError;\n\n#[derive(Clone)]\npub struct PasswordService {\n    argon2: Argon2\u003c'static\u003e,\n}\n\nimpl PasswordService {\n    #[must_use]\n    pub fn new() -\u003e Self {\n        Self {\n            argon2: Argon2::default(),\n        }\n    }\n\n    pub async fn hash(\u0026self, password: \u0026str) -\u003e Result\u003cString, ServerError\u003e {\n        let salt = SaltString::generate(OsRng);\n\n        let password_hash = self\n            .argon2\n            .hash_password(password.as_bytes(), \u0026salt);\n\n        match password_hash {\n            Ok(password) =\u003e Ok(password.to_string()),\n            Err(err) =\u003e Err(ServerError::ArgonPasswordError(err)),\n        }\n    }\n\n    pub async fn verify(\u0026self, password: \u0026str, password_hash: \u0026str) -\u003e Result\u003cbool, ServerError\u003e {\n        let parsed_hash = PasswordHash::new(password_hash)?;\n\n        let verified = self\n            .argon2\n            .verify_password(password.as_bytes(), \u0026parsed_hash)\n            .is_ok();\n\n        Ok(verified)\n    }\n}\n\nimpl Default for PasswordService {\n    fn default() -\u003e Self {\n        Self::new()\n    }\n}\n","traces":[{"line":14,"address":[4323968],"length":1,"stats":{"Line":5},"fn_name":"new"},{"line":16,"address":[4323985],"length":1,"stats":{"Line":5},"fn_name":null},{"line":20,"address":[7672256,7672412,7672176,7672299,7672203],"length":1,"stats":{"Line":12},"fn_name":"hash"},{"line":21,"address":[4324257],"length":1,"stats":{"Line":3},"fn_name":null},{"line":23,"address":[7673009],"length":1,"stats":{"Line":3},"fn_name":null},{"line":27,"address":[4324497],"length":1,"stats":{"Line":3},"fn_name":null},{"line":28,"address":[7672872,7672667],"length":1,"stats":{"Line":6},"fn_name":null},{"line":29,"address":[4324577],"length":1,"stats":{"Line":0},"fn_name":null},{"line":33,"address":[4324821,4324880,4325069,4324784,4324923],"length":1,"stats":{"Line":12},"fn_name":"verify"},{"line":34,"address":[4325387,4325050,4325189],"length":1,"stats":{"Line":6},"fn_name":null},{"line":36,"address":[7694571],"length":1,"stats":{"Line":3},"fn_name":null},{"line":41,"address":[4325595],"length":1,"stats":{"Line":3},"fn_name":null},{"line":46,"address":[4325632],"length":1,"stats":{"Line":0},"fn_name":"default"},{"line":47,"address":[4325640],"length":1,"stats":{"Line":0},"fn_name":null}],"covered":11,"coverable":14},{"path":["/","home","runner","work","throwaway","throwaway","src","services","profile.rs"],"content":"use sqlx::types::Uuid;\n\nuse crate::errors::core::ServerError;\nuse crate::errors::profile::ProfileError;\nuse crate::models::database::profile::Profile;\nuse crate::models::request::register::RegisterRequest;\nuse crate::repositories::profile::ProfileRepository;\nuse crate::services::password::PasswordService;\n\n#[derive(Clone)]\npub struct ProfileService {\n    password_service: PasswordService,\n    profile_repository: ProfileRepository,\n}\n\nimpl ProfileService {\n    #[must_use]\n    pub const fn new(password_service: PasswordService, profile_repository: ProfileRepository) -\u003e Self {\n        Self {\n            password_service,\n            profile_repository,\n        }\n    }\n\n    pub async fn create(\u0026self, mut register_request: RegisterRequest) -\u003e Result\u003cUuid, ServerError\u003e {\n        let profile_exists = self\n            .profile_repository\n            .exists(\u0026register_request.email)\n            .await?;\n\n        if profile_exists {\n            return Err(ProfileError::Exists.into());\n        }\n\n        let password_hash = self\n            .password_service\n            .hash(\u0026register_request.password.clone())\n            .await?;\n\n        register_request.password = password_hash;\n\n        let profile_id = self\n            .profile_repository\n            .insert(register_request)\n            .await?;\n\n        Ok(profile_id)\n    }\n\n    // FIXME: Read vs Get?\n    pub async fn read(\u0026self, profile_id: Uuid) -\u003e Result\u003cProfile, ServerError\u003e {\n        let profile = self\n            .profile_repository\n            .get_by_profile_id(profile_id)\n            .await?;\n\n        Ok(profile)\n    }\n\n    pub async fn update(\u0026self, profile: Profile) -\u003e Result\u003c(), ServerError\u003e {\n        self.profile_repository\n            .update(profile)\n            .await?;\n\n        Ok(())\n    }\n\n    pub async fn update_name(\u0026self, profile_id: Uuid, name: String) -\u003e Result\u003cProfile, ServerError\u003e {\n        let mut profile: Profile = self.read(profile_id).await?;\n        if name == profile.name {\n            return Err(ProfileError::NameSet.into());\n        }\n\n        profile.name = name.clone();\n        self.profile_repository\n            .update_name(profile_id, name)\n            .await?;\n\n        Ok(profile)\n    }\n\n    pub async fn update_email(\u0026self, profile_id: Uuid, email: String) -\u003e Result\u003cProfile, ServerError\u003e {\n        let mut profile: Profile = self.read(profile_id).await?;\n        if email == profile.email {\n            return Err(ProfileError::EmailSet.into());\n        }\n\n        profile.name = email.clone();\n        self.profile_repository\n            .update_email(profile_id, email)\n            .await?;\n\n        Ok(profile)\n    }\n\n    pub async fn verify_credentials(\u0026self, email: \u0026str, password: \u0026str) -\u003e Result\u003c(bool, Profile), ServerError\u003e {\n        let profile = self\n            .profile_repository\n            .get_by_email(email)\n            .await?;\n\n        let valid = self\n            .password_service\n            .verify(password, \u0026profile.password)\n            .await?;\n\n        Ok((valid, profile))\n    }\n}\n","traces":[{"line":18,"address":[3913504],"length":1,"stats":{"Line":5},"fn_name":"new"},{"line":25,"address":[3914063,3914611,3913813,3917601,3913744,3914287,3917330,3913678,3915189,3913632],"length":1,"stats":{"Line":15},"fn_name":"create"},{"line":26,"address":[3914427,3914632,3914893,3914011,3914550,3915122],"length":1,"stats":{"Line":15},"fn_name":null},{"line":28,"address":[3914093,3914247,3914580,3914030,3914622,3914450,3914824],"length":1,"stats":{"Line":18},"fn_name":null},{"line":29,"address":[3914962,3915152],"length":1,"stats":{"Line":0},"fn_name":null},{"line":31,"address":[3914949],"length":1,"stats":{"Line":3},"fn_name":null},{"line":32,"address":[3915255],"length":1,"stats":{"Line":0},"fn_name":null},{"line":35,"address":[3915905,3916184,3915585,3915651,3915474,3915215],"length":1,"stats":{"Line":15},"fn_name":null},{"line":37,"address":[3915615,3914114,3915890,3915227,3915379,3915497,3914199],"length":1,"stats":{"Line":15},"fn_name":null},{"line":38,"address":[3915411,3916003,3916214],"length":1,"stats":{"Line":3},"fn_name":null},{"line":40,"address":[3916495,3916343],"length":1,"stats":{"Line":6},"fn_name":null},{"line":42,"address":[3916532,3916816,3916693,3916890,3917509,3917151],"length":1,"stats":{"Line":15},"fn_name":null},{"line":44,"address":[3916849,3916716,3917082,3914132,3916543],"length":1,"stats":{"Line":15},"fn_name":null},{"line":45,"address":[3917349,3917539],"length":1,"stats":{"Line":0},"fn_name":null},{"line":47,"address":[3917251],"length":1,"stats":{"Line":3},"fn_name":null},{"line":51,"address":[3918560,3918617,3918808,3918448,3918740,3919582,3919360,3919071,3918485],"length":1,"stats":{"Line":10},"fn_name":"read"},{"line":52,"address":[3918697,3919216,3919127,3919525,3918730,3919010],"length":1,"stats":{"Line":10},"fn_name":null},{"line":54,"address":[3918701,3919040,3918761,3919082,3918933,3919159],"length":1,"stats":{"Line":10},"fn_name":null},{"line":55,"address":[3919365,3919555],"length":1,"stats":{"Line":0},"fn_name":null},{"line":57,"address":[3919295],"length":1,"stats":{"Line":2},"fn_name":null},{"line":60,"address":[3919632,3919668],"length":1,"stats":{"Line":0},"fn_name":"update"},{"line":68,"address":[3919872,3921018,3920078,3919938,3920221,3920497,3922184,3919728,3919765,3921945],"length":1,"stats":{"Line":5},"fn_name":"update_name"},{"line":69,"address":[3920342,3920508,3920036,3920791,3920181,3920102],"length":1,"stats":{"Line":4},"fn_name":null},{"line":70,"address":[3921081,3920773],"length":1,"stats":{"Line":2},"fn_name":null},{"line":71,"address":[3921118],"length":1,"stats":{"Line":0},"fn_name":null},{"line":74,"address":[3921095,3921221],"length":1,"stats":{"Line":2},"fn_name":null},{"line":75,"address":[3921411,3921534,3921835,3921339,3921605,3922114],"length":1,"stats":{"Line":5},"fn_name":null},{"line":76,"address":[3921765,3921347,3921564,3921434,3920117],"length":1,"stats":{"Line":5},"fn_name":null},{"line":77,"address":[3922144,3921954],"length":1,"stats":{"Line":0},"fn_name":null},{"line":79,"address":[3921873],"length":1,"stats":{"Line":1},"fn_name":null},{"line":82,"address":[3922562,3924805,3922845,3922496,3924566,3922352,3923121,3922389,3922702,3923639],"length":1,"stats":{"Line":0},"fn_name":"update_email"},{"line":83,"address":[3922660,3922805,3922966,3923132,3923412,3922726],"length":1,"stats":{"Line":0},"fn_name":null},{"line":84,"address":[3923702,3923387],"length":1,"stats":{"Line":0},"fn_name":null},{"line":85,"address":[3923739],"length":1,"stats":{"Line":0},"fn_name":null},{"line":88,"address":[3923842,3923716],"length":1,"stats":{"Line":0},"fn_name":null},{"line":89,"address":[3924226,3924456,3923960,3924032,3924155,3924735],"length":1,"stats":{"Line":0},"fn_name":null},{"line":90,"address":[3924185,3922741,3923968,3924055,3924386],"length":1,"stats":{"Line":0},"fn_name":null},{"line":91,"address":[3924765,3924575],"length":1,"stats":{"Line":0},"fn_name":null},{"line":93,"address":[3924494],"length":1,"stats":{"Line":0},"fn_name":null},{"line":96,"address":[3925324,3925774,3925482,3925189,3924976,3925045,3927078,3925120],"length":1,"stats":{"Line":15},"fn_name":"verify_credentials"},{"line":97,"address":[3926305,3925839,3925704,3925298,3925950],"length":1,"stats":{"Line":12},"fn_name":null},{"line":99,"address":[3925354,3925607,3925439,3925743,3925785,3925883],"length":1,"stats":{"Line":15},"fn_name":null},{"line":100,"address":[3926335,3926145],"length":1,"stats":{"Line":0},"fn_name":null},{"line":102,"address":[3926655,3926079,3926507,3926910,3927243,3926583],"length":1,"stats":{"Line":15},"fn_name":null},{"line":104,"address":[3926622,3926530,3926894,3926091,3925372],"length":1,"stats":{"Line":9},"fn_name":null},{"line":105,"address":[3927083,3927273],"length":1,"stats":{"Line":0},"fn_name":null},{"line":107,"address":[3926971],"length":1,"stats":{"Line":3},"fn_name":null}],"covered":29,"coverable":47},{"path":["/","home","runner","work","throwaway","throwaway","src","services","token.rs"],"content":"use chrono::{DateTime, Duration, Utc};\nuse jsonwebtoken::{decode, encode, Algorithm, DecodingKey, EncodingKey, Header, Validation};\nuse uuid::Uuid;\n\nuse crate::attributes::core::Attributes;\nuse crate::errors::core::ServerError;\nuse crate::models::claims::{Claims, ISS};\nuse crate::models::secrets::jwt::JwtSecrets;\n\n#[derive(Clone)]\npub struct TokenService {\n    jwt_password: String,\n}\n\nimpl TokenService {\n    #[must_use]\n    pub fn new(jwt_secrets: \u0026JwtSecrets) -\u003e Self {\n        Self {\n            jwt_password: jwt_secrets.password.clone(),\n        }\n    }\n\n    pub fn generate(\n        \u0026self,\n        profile_id: Uuid,\n        lifespan: Duration,\n        attributes: Option\u003cAttributes\u003e,\n    ) -\u003e Result\u003cString, ServerError\u003e {\n        let now = Utc::now();\n        let expiration: DateTime\u003cUtc\u003e = now + lifespan;\n\n        let claims = Claims {\n            iss: ISS.to_string(),\n            exp: expiration.timestamp(),\n            iat: now.timestamp(),\n            sub: profile_id,\n            attributes,\n        };\n\n        let encoding_key = EncodingKey::from_secret(self.jwt_password.as_bytes());\n        let token = encode(\u0026Header::new(Algorithm::HS512), \u0026claims, \u0026encoding_key);\n\n        token.map_err(ServerError::JwtError)\n    }\n\n    pub fn decode(\u0026self, token: \u0026str) -\u003e Result\u003cClaims, ServerError\u003e {\n        let mut validation = Validation::new(Algorithm::HS512);\n        validation.set_issuer(\u0026[ISS]);\n\n        let decoding_key = DecodingKey::from_secret(self.jwt_password.as_bytes());\n        let token_data = decode::\u003cClaims\u003e(token, \u0026decoding_key, \u0026validation);\n\n        match token_data {\n            Ok(token) =\u003e Ok(token.claims),\n            Err(error) =\u003e Err(ServerError::JwtError(error)),\n        }\n    }\n}\n","traces":[{"line":17,"address":[8214512],"length":1,"stats":{"Line":5},"fn_name":"new"},{"line":19,"address":[8193635],"length":1,"stats":{"Line":5},"fn_name":null},{"line":23,"address":[8194089,8193696],"length":1,"stats":{"Line":3},"fn_name":"generate"},{"line":29,"address":[4400266],"length":1,"stats":{"Line":3},"fn_name":null},{"line":30,"address":[8214694],"length":1,"stats":{"Line":3},"fn_name":null},{"line":33,"address":[8193841],"length":1,"stats":{"Line":3},"fn_name":null},{"line":34,"address":[8214762],"length":1,"stats":{"Line":3},"fn_name":null},{"line":35,"address":[4400427],"length":1,"stats":{"Line":3},"fn_name":null},{"line":40,"address":[8215062,8214968],"length":1,"stats":{"Line":6},"fn_name":null},{"line":41,"address":[8215157,8215081],"length":1,"stats":{"Line":6},"fn_name":null},{"line":43,"address":[4400893],"length":1,"stats":{"Line":3},"fn_name":null},{"line":46,"address":[4401641,4401617,4401024],"length":1,"stats":{"Line":2},"fn_name":"decode"},{"line":47,"address":[4401080],"length":1,"stats":{"Line":2},"fn_name":null},{"line":48,"address":[4401107],"length":1,"stats":{"Line":2},"fn_name":null},{"line":50,"address":[4401177],"length":1,"stats":{"Line":2},"fn_name":null},{"line":51,"address":[4401254],"length":1,"stats":{"Line":2},"fn_name":null},{"line":53,"address":[4401305],"length":1,"stats":{"Line":2},"fn_name":null},{"line":54,"address":[4401327],"length":1,"stats":{"Line":2},"fn_name":null},{"line":55,"address":[4401505],"length":1,"stats":{"Line":0},"fn_name":null}],"covered":18,"coverable":19},{"path":["/","home","runner","work","throwaway","throwaway","src","validation","country.rs"],"content":"use tracing::error;\nuse validator::ValidationError;\n\npub fn validate_country(country: \u0026str) -\u003e Result\u003c(), ValidationError\u003e {\n    if country == \"xXxShad0wxXx\" {\n        error!(\"Invalid country: {country:#?}\");\n        return Err(ValidationError::new(\"terrible_country\"));\n    }\n\n    Ok(())\n}\n","traces":[{"line":4,"address":[4118784],"length":1,"stats":{"Line":3},"fn_name":"validate_country"},{"line":5,"address":[4118823],"length":1,"stats":{"Line":3},"fn_name":null},{"line":6,"address":[8018866,8019183,8019701,8019109,8020287,8020349,8018718,8018409,8019765,8019653],"length":1,"stats":{"Line":0},"fn_name":null},{"line":7,"address":[4121449,4120191],"length":1,"stats":{"Line":0},"fn_name":null},{"line":10,"address":[4118872],"length":1,"stats":{"Line":3},"fn_name":null}],"covered":3,"coverable":5},{"path":["/","home","runner","work","throwaway","throwaway","src","validation","email.rs"],"content":"use validator::ValidationError;\n\n// FIXME: Don't do this. Should we have static/const errors instead? Or specific ValidationError enum of errors? and use\n// #[from]\nconst MISSING_EMAIL: \u0026str = \"missing_email\";\nconst INVALID_EMAIL: \u0026str = \"invalid_email\";\nconst INVALID_EMAIL_DOMAIN: \u0026str = \"invalid_email_domain\";\n\npub fn validate_email(email: \u0026str) -\u003e Result\u003c(), ValidationError\u003e {\n    if email.is_empty() {\n        return Err(ValidationError::new(MISSING_EMAIL));\n    }\n\n    if !email.contains('@') {\n        return Err(ValidationError::new(INVALID_EMAIL));\n    }\n\n    if email.contains(' ') {\n        return Err(ValidationError::new(INVALID_EMAIL));\n    }\n\n    let email_parts: Vec\u003c\u0026str\u003e = email.split('@').collect();\n    if email_parts.len() != 2 {\n        return Err(ValidationError::new(INVALID_EMAIL));\n    }\n\n    let domain = email_parts[1];\n    if !domain.contains('.') {\n        return Err(ValidationError::new(INVALID_EMAIL_DOMAIN));\n    }\n\n    if domain.contains('_') {\n        return Err(ValidationError::new(INVALID_EMAIL_DOMAIN));\n    }\n\n    Ok(())\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    #[test]\n    fn test_validate_email() {\n        let tests = vec![(\"email@here.com\", true), (\"\", false)];\n\n        for (email, expected_valid) in tests {\n            let valid = validate_email(email);\n\n            if expected_valid {\n                assert!(valid.is_ok());\n            } else {\n                assert!(valid.is_err());\n            }\n        }\n    }\n}\n","traces":[{"line":9,"address":[7673824,7674635],"length":1,"stats":{"Line":4},"fn_name":"validate_email"},{"line":10,"address":[7673883],"length":1,"stats":{"Line":4},"fn_name":null},{"line":11,"address":[7673929],"length":1,"stats":{"Line":1},"fn_name":null},{"line":14,"address":[4325829,4325752],"length":1,"stats":{"Line":8},"fn_name":null},{"line":15,"address":[7694918],"length":1,"stats":{"Line":0},"fn_name":null},{"line":18,"address":[7674005,7674077],"length":1,"stats":{"Line":8},"fn_name":null},{"line":19,"address":[7695010],"length":1,"stats":{"Line":0},"fn_name":null},{"line":22,"address":[7674093,7674168],"length":1,"stats":{"Line":8},"fn_name":null},{"line":23,"address":[4326030,4326103],"length":1,"stats":{"Line":8},"fn_name":null},{"line":24,"address":[7695201],"length":1,"stats":{"Line":0},"fn_name":null},{"line":27,"address":[4326223,4326109],"length":1,"stats":{"Line":8},"fn_name":null},{"line":28,"address":[4326256],"length":1,"stats":{"Line":4},"fn_name":null},{"line":29,"address":[4326316],"length":1,"stats":{"Line":0},"fn_name":null},{"line":32,"address":[4326296,4326379],"length":1,"stats":{"Line":8},"fn_name":null},{"line":33,"address":[4326416],"length":1,"stats":{"Line":0},"fn_name":null},{"line":36,"address":[4326390],"length":1,"stats":{"Line":4},"fn_name":null},{"line":44,"address":[4494784,4494757,4495407,4494752],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":45,"address":[4494791],"length":1,"stats":{"Line":1},"fn_name":null},{"line":47,"address":[4494939],"length":1,"stats":{"Line":1},"fn_name":null},{"line":48,"address":[4495210],"length":1,"stats":{"Line":1},"fn_name":null},{"line":50,"address":[4495221],"length":1,"stats":{"Line":1},"fn_name":null},{"line":51,"address":[4495333,4495309,4495254],"length":1,"stats":{"Line":2},"fn_name":null},{"line":53,"address":[4495235,4495369],"length":1,"stats":{"Line":2},"fn_name":null}],"covered":18,"coverable":23},{"path":["/","home","runner","work","throwaway","throwaway","src","validation","mod.rs"],"content":"pub mod country;\npub mod email;\npub mod name;\npub mod password;\npub mod timezone;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","validation","name.rs"],"content":"use validator::ValidationError;\n\npub fn validate_name(name: \u0026str) -\u003e Result\u003c(), ValidationError\u003e {\n    if name == \"xXxShad0wxXx\" {\n        return Err(ValidationError::new(\"terrible_name\"));\n    }\n\n    Ok(())\n}\n","traces":[{"line":3,"address":[6542848],"length":1,"stats":{"Line":3},"fn_name":"validate_name"},{"line":4,"address":[4553642],"length":1,"stats":{"Line":3},"fn_name":null},{"line":5,"address":[4553687],"length":1,"stats":{"Line":0},"fn_name":null},{"line":8,"address":[4553678],"length":1,"stats":{"Line":3},"fn_name":null}],"covered":3,"coverable":4},{"path":["/","home","runner","work","throwaway","throwaway","src","validation","password.rs"],"content":"use validator::ValidationError;\n\npub fn validate_password(password: \u0026str) -\u003e Result\u003c(), ValidationError\u003e {\n    if password == \"xXxShad0wxXx\" {\n        return Err(ValidationError::new(\"terrible_password\"));\n    }\n\n    Ok(())\n}\n","traces":[{"line":3,"address":[6542976],"length":1,"stats":{"Line":3},"fn_name":"validate_password"},{"line":4,"address":[4748810],"length":1,"stats":{"Line":3},"fn_name":null},{"line":5,"address":[4748855],"length":1,"stats":{"Line":0},"fn_name":null},{"line":8,"address":[4748846],"length":1,"stats":{"Line":3},"fn_name":null}],"covered":3,"coverable":4},{"path":["/","home","runner","work","throwaway","throwaway","src","validation","timezone.rs"],"content":"use validator::ValidationError;\n\npub fn validate_timezone(timezone: \u0026str) -\u003e Result\u003c(), ValidationError\u003e {\n    if timezone == \"xXxShad0wxXx\" {\n        return Err(ValidationError::new(\"terrible_timezone\"));\n    }\n\n    Ok(())\n}\n","traces":[{"line":3,"address":[6543104],"length":1,"stats":{"Line":3},"fn_name":"validate_timezone"},{"line":4,"address":[4553770],"length":1,"stats":{"Line":3},"fn_name":null},{"line":5,"address":[4553815],"length":1,"stats":{"Line":0},"fn_name":null},{"line":8,"address":[4553806],"length":1,"stats":{"Line":3},"fn_name":null}],"covered":3,"coverable":4},{"path":["/","home","runner","work","throwaway","throwaway","tests","common","framework.rs"],"content":"use std::net::SocketAddr;\n\nuse anyhow::Error;\nuse axum::http::Request;\nuse base64::encode;\nuse hyper::client::HttpConnector;\nuse hyper::Client;\nuse hyper::{Body, Method};\nuse serde_json::{to_string, Value};\nuse tracing::log::debug;\n\nuse crate::common::models::response::APIResponse;\nuse crate::common::server::start_test_server;\nuse crate::{CreateProfile, PatchProfile};\n\npub struct Framework {\n    client: Client\u003cHttpConnector\u003e,\n    address: SocketAddr,\n}\n\nimpl Framework {\n    pub async fn new() -\u003e Self {\n        let address = start_test_server().await;\n\n        Self {\n            client: Client::new(),\n            address,\n        }\n    }\n\n    pub fn endpoint(\u0026self, endpoint: \u0026str) -\u003e String {\n        let address = self.address;\n        format!(\"http://{address}{endpoint}\")\n    }\n\n    pub async fn create_profile(\u0026self, profile: \u0026CreateProfile) -\u003e Result\u003cAPIResponse, Error\u003e {\n        let body: String = to_string(\u0026profile)?;\n        debug!(\"Create Profile Request Body: {body:#?}\");\n\n        let request = Request::builder()\n            .uri(self.endpoint(\"/register\"))\n            .method(Method::POST)\n            .header(\"Content-Type\", \"application/json\")\n            .body(Body::from(body))?;\n\n        let response = self.client.request(request).await?;\n        let result = APIResponse::new(response).await;\n        Ok(result)\n    }\n\n    pub async fn patch_profile(\u0026self, token: \u0026str, profile: \u0026PatchProfile) -\u003e Result\u003cAPIResponse, Error\u003e {\n        let body: String = to_string(\u0026profile)?;\n        debug!(\"Patch Profile Request Body: {body:#?}\");\n\n        let request = Request::builder()\n            .uri(self.endpoint(\"/profile\"))\n            .method(Method::PATCH)\n            .header(\"Content-Type\", \"application/json\")\n            .header(\"Authorization\", format!(\"Bearer {token}\"))\n            .body(Body::from(body))?;\n\n        let response = self.client.request(request).await?;\n        let result = APIResponse::new(response).await;\n        Ok(result)\n    }\n\n    pub async fn request_token(\n        \u0026self,\n        email: \u0026str,\n        password: \u0026str,\n        token_request_body: Value,\n    ) -\u003e Result\u003cAPIResponse, Error\u003e {\n        let encoded_authorization = encode(format!(\"{email}:{password}\"));\n        let basic_authorization = format!(\"Basic {encoded_authorization}\");\n        debug!(\"Token Request Headers: {basic_authorization:#?}\");\n\n        let body: String = token_request_body.to_string();\n        debug!(\"Token Request Body: {body:#?}\");\n\n        let request = Request::builder()\n            .uri(self.endpoint(\"/token\"))\n            .method(Method::POST)\n            .header(\"Content-Type\", \"application/json\")\n            .header(\"Authorization\", basic_authorization)\n            .body(Body::from(body))?;\n\n        let response = self.client.request(request).await?;\n        let result = APIResponse::new(response).await;\n        Ok(result)\n    }\n\n    pub async fn token_test(\u0026self, token: \u0026str) -\u003e Result\u003cAPIResponse, Error\u003e {\n        let request = Request::builder()\n            .uri(self.endpoint(\"/token/test\"))\n            .method(Method::GET)\n            .header(\"Content-Type\", \"application/json\")\n            .header(\"Authorization\", format!(\"Bearer {token}\"))\n            .body(Body::empty())?;\n\n        let response = self.client.request(request).await?;\n        let result = APIResponse::new(response).await;\n        Ok(result)\n    }\n\n    pub async fn token_info(\u0026self, token: \u0026str) -\u003e Result\u003cAPIResponse, Error\u003e {\n        let request = Request::builder()\n            .uri(self.endpoint(\"/token/info\"))\n            .method(Method::GET)\n            .header(\"Content-Type\", \"application/json\")\n            .header(\"Authorization\", format!(\"Bearer {token}\"))\n            .body(Body::empty())?;\n\n        let response = self.client.request(request).await?;\n        let result = APIResponse::new(response).await;\n        Ok(result)\n    }\n\n    pub async fn get_version(\u0026self) -\u003e Result\u003cAPIResponse, Error\u003e {\n        let request = Request::builder()\n            .uri(self.endpoint(\"/version\"))\n            .method(Method::GET)\n            .header(\"Content-Type\", \"application/json\")\n            .body(Body::empty())?;\n\n        let response = self.client.request(request).await?;\n        let result = APIResponse::new(response).await;\n        Ok(result)\n    }\n\n    pub async fn get_config(\u0026self) -\u003e Result\u003cAPIResponse, Error\u003e {\n        let request = Request::builder()\n            .uri(self.endpoint(\"/config\"))\n            .method(Method::GET)\n            .header(\"Content-Type\", \"application/json\")\n            .body(Body::empty())?;\n\n        let response = self.client.request(request).await?;\n        let result = APIResponse::new(response).await;\n        Ok(result)\n    }\n}\n","traces":[{"line":22,"address":[7296811,7296653,7297140,7296688,7296745,7296879,7296624],"length":1,"stats":{"Line":20},"fn_name":"new"},{"line":23,"address":[6367296,6367265,6367468,6367615],"length":1,"stats":{"Line":15},"fn_name":null},{"line":26,"address":[6367730],"length":1,"stats":{"Line":5},"fn_name":null},{"line":31,"address":[6367936],"length":1,"stats":{"Line":5},"fn_name":"endpoint"},{"line":32,"address":[6367971],"length":1,"stats":{"Line":5},"fn_name":null},{"line":33,"address":[6368019],"length":1,"stats":{"Line":5},"fn_name":null},{"line":36,"address":[6368685,6368206,6371475,6368176,6368317,6368256,6368959,6368459,6369686,6368613],"length":1,"stats":{"Line":15},"fn_name":"create_profile"},{"line":37,"address":[6368880,6368449,6368742],"length":1,"stats":{"Line":6},"fn_name":null},{"line":38,"address":[6369113,6369016,6368836],"length":1,"stats":{"Line":9},"fn_name":null},{"line":40,"address":[6369397,6370001,6369732,6369592,6369884,6369545,6370226,6370237,6370261,6369947],"length":1,"stats":{"Line":21},"fn_name":null},{"line":41,"address":[6369504,6369657,6369667,6369452,6369404,6369584],"length":1,"stats":{"Line":6},"fn_name":null},{"line":44,"address":[6369697,6369412,6369923,6369796,6370234,6369954,6370245,6370283],"length":1,"stats":{"Line":6},"fn_name":null},{"line":46,"address":[5313455],"length":1,"stats":{"Line":12},"fn_name":null},{"line":47,"address":[5313378],"length":1,"stats":{"Line":6},"fn_name":null},{"line":48,"address":[6371387],"length":1,"stats":{"Line":3},"fn_name":null},{"line":51,"address":[7297792,7297838],"length":1,"stats":{"Line":5},"fn_name":"patch_profile"},{"line":52,"address":[5293577,5293870,5294008],"length":1,"stats":{"Line":2},"fn_name":null},{"line":53,"address":[5294144,5294241,5293964],"length":1,"stats":{"Line":3},"fn_name":null},{"line":55,"address":[5294868,5295392,5294728,5294681,5295134,5295329,5295446,5295682,5294525,5295706,5295671],"length":1,"stats":{"Line":8},"fn_name":null},{"line":56,"address":[5294640,5294793,5294720,5294803,5294588,5294532],"length":1,"stats":{"Line":2},"fn_name":null},{"line":59,"address":[5294833,5294540,5294932,5295260,5295193],"length":1,"stats":{"Line":2},"fn_name":null},{"line":60,"address":[5295399,5295728,5295368,5295282,5295690,5294548,5295679,5295295,5295209],"length":1,"stats":{"Line":2},"fn_name":null},{"line":62,"address":[5320020],"length":1,"stats":{"Line":4},"fn_name":null},{"line":63,"address":[5319940],"length":1,"stats":{"Line":2},"fn_name":null},{"line":64,"address":[5296832],"length":1,"stats":{"Line":1},"fn_name":null},{"line":67,"address":[7297888],"length":1,"stats":{"Line":3},"fn_name":"request_token"},{"line":73,"address":[6372388,6372052],"length":1,"stats":{"Line":6},"fn_name":null},{"line":74,"address":[6372619,6372727],"length":1,"stats":{"Line":6},"fn_name":null},{"line":75,"address":[6372950,6373047,6372854],"length":1,"stats":{"Line":9},"fn_name":null},{"line":77,"address":[6373405,6373334],"length":1,"stats":{"Line":6},"fn_name":null},{"line":78,"address":[6373505,6373602,6373412],"length":1,"stats":{"Line":9},"fn_name":null},{"line":80,"address":[6374227,6374593,6374824,6374539,6374835,6374040,6373889,6374320,6374859,6374476,6374087],"length":1,"stats":{"Line":24},"fn_name":null},{"line":81,"address":[6373999,6374152,6374079,6373896,6374162,6373944],"length":1,"stats":{"Line":6},"fn_name":null},{"line":84,"address":[6374283,6374371],"length":1,"stats":{"Line":6},"fn_name":null},{"line":85,"address":[6374515,6374546,6374379,6374843,6374881,6374192,6373904,6374832],"length":1,"stats":{"Line":6},"fn_name":null},{"line":87,"address":[5312893],"length":1,"stats":{"Line":12},"fn_name":null},{"line":88,"address":[5312746],"length":1,"stats":{"Line":6},"fn_name":null},{"line":89,"address":[6376205],"length":1,"stats":{"Line":3},"fn_name":null},{"line":92,"address":[7298048,7298086],"length":1,"stats":{"Line":0},"fn_name":"token_test"},{"line":105,"address":[7298166,7298128],"length":1,"stats":{"Line":5},"fn_name":"token_info"},{"line":106,"address":[5927328,5926981,5927044,5926830,5926564,5927098,5925990,5927317,5927352,5926377,5926424],"length":1,"stats":{"Line":8},"fn_name":null},{"line":107,"address":[5926270,5926499,5926214,5926416,5926336,5926489],"length":1,"stats":{"Line":2},"fn_name":null},{"line":110,"address":[5926222,5926628,5926912,5926881,5926529],"length":1,"stats":{"Line":2},"fn_name":null},{"line":111,"address":[5927336,5927325,5927020,5926934,5926230,5926905,5927374,5926947,5927051],"length":1,"stats":{"Line":2},"fn_name":null},{"line":113,"address":[5305676],"length":1,"stats":{"Line":4},"fn_name":null},{"line":114,"address":[5305604],"length":1,"stats":{"Line":2},"fn_name":null},{"line":115,"address":[5928476],"length":1,"stats":{"Line":1},"fn_name":null},{"line":118,"address":[7298208,7298230],"length":1,"stats":{"Line":5},"fn_name":"get_version"},{"line":119,"address":[7297560,7296921,7297330,7297549,7297108,7297276,7296968,7296542,7297584,7297213],"length":1,"stats":{"Line":7},"fn_name":null},{"line":120,"address":[7296814,7297043,7296880,7296766,7296960,7297033],"length":1,"stats":{"Line":2},"fn_name":null},{"line":123,"address":[7297252,7297557,7297283,7297172,7297568,7297606,7297073,7296774],"length":1,"stats":{"Line":2},"fn_name":null},{"line":125,"address":[5693159],"length":1,"stats":{"Line":4},"fn_name":null},{"line":126,"address":[5693090],"length":1,"stats":{"Line":2},"fn_name":null},{"line":127,"address":[7298708],"length":1,"stats":{"Line":1},"fn_name":null},{"line":130,"address":[7298674,7298294,7298336,7298520,7299615,7300760,7298272,7298397,7298829,7299030],"length":1,"stats":{"Line":5},"fn_name":"get_config"},{"line":131,"address":[7299244,7299076,7299552,7299181,7299517,7299528,7298510,7298889,7299298,7298936],"length":1,"stats":{"Line":7},"fn_name":null},{"line":132,"address":[7298848,7298734,7298782,7298928,7299001,7299011],"length":1,"stats":{"Line":2},"fn_name":null},{"line":135,"address":[7299140,7299525,7299251,7299220,7299536,7298742,7299041,7299574],"length":1,"stats":{"Line":2},"fn_name":null},{"line":137,"address":[5692855],"length":1,"stats":{"Line":4},"fn_name":null},{"line":138,"address":[5692786],"length":1,"stats":{"Line":2},"fn_name":null},{"line":139,"address":[7300676],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":60,"coverable":61},{"path":["/","home","runner","work","throwaway","throwaway","tests","common","mod.rs"],"content":"#![deny(clippy::all, clippy::pedantic, clippy::nursery, clippy::cargo)]\n#![allow(\n    dead_code,\n    clippy::module_name_repetitions,\n    clippy::missing_errors_doc,\n    clippy::multiple_crate_versions,\n    clippy::must_use_candidate,\n    clippy::unused_async,\n    clippy::struct_excessive_bools\n)]\n\npub mod framework;\npub mod models;\npub mod server;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","tests","common","models","mod.rs"],"content":"pub mod profile;\npub mod response;\npub mod token;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","tests","common","models","profile","mod.rs"],"content":"pub mod profile_create;\npub mod profile_patch;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","tests","common","models","profile","profile_create.rs"],"content":"use rand_core::{OsRng, RngCore};\nuse serde::{Deserialize, Serialize};\n\n#[derive(Serialize, Deserialize)]\npub struct CreateProfile {\n    pub name: String,\n    pub email: String,\n    pub password: String,\n    pub country: String,\n    pub timezone: String,\n}\n\nimpl CreateProfile {\n    pub fn new() -\u003e Self {\n        let id = OsRng.next_u64();\n\n        Self {\n            name: format!(\"Test {id}\"),\n            email: format!(\"test-{id}@domain.test\"),\n            password: \"test-password\".to_string(),\n            country: \"UK\".to_string(),\n            timezone: \"GMT\".to_string(),\n        }\n    }\n}\n","traces":[{"line":14,"address":[7298912,7299648],"length":1,"stats":{"Line":3},"fn_name":"new"},{"line":15,"address":[6100193],"length":1,"stats":{"Line":3},"fn_name":null},{"line":18,"address":[6095729],"length":1,"stats":{"Line":3},"fn_name":null},{"line":19,"address":[7300966,7301041],"length":1,"stats":{"Line":6},"fn_name":null},{"line":20,"address":[7301157],"length":1,"stats":{"Line":3},"fn_name":null},{"line":21,"address":[7301228],"length":1,"stats":{"Line":3},"fn_name":null},{"line":22,"address":[7301296],"length":1,"stats":{"Line":3},"fn_name":null}],"covered":7,"coverable":7},{"path":["/","home","runner","work","throwaway","throwaway","tests","common","models","profile","profile_patch.rs"],"content":"use serde::{Deserialize, Serialize};\n\n#[derive(Serialize, Deserialize)]\npub struct PatchProfile {\n    pub name: Option\u003cString\u003e,\n    pub email: Option\u003cString\u003e,\n    pub country: Option\u003cString\u003e,\n    pub timezone: Option\u003cString\u003e,\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","tests","common","models","response.rs"],"content":"use axum::body::Body;\nuse axum::http::{HeaderMap, StatusCode};\nuse axum::response::Response;\nuse hyper::body::to_bytes;\nuse serde_json::{from_slice, Value};\nuse tracing::debug;\n\npub struct APIResponse {\n    pub status: StatusCode,\n    pub headers: HeaderMap,\n    pub body: Value,\n}\n\nimpl APIResponse {\n    pub async fn new(response: Response\u003cBody\u003e) -\u003e Self {\n        let status = response.status();\n        debug!(\"Response Status: {status:#?}\");\n\n        let headers = response.headers().clone();\n        debug!(\"Response Headers: {headers:#?}\");\n\n        let body_bytes = to_bytes(response.into_body())\n            .await\n            .unwrap();\n\n        let body: Value = from_slice(\u0026body_bytes).unwrap();\n        debug!(\"Response Body: {body:#?}\");\n\n        Self {\n            status,\n            headers,\n            body,\n        }\n    }\n}\n","traces":[{"line":15,"address":[6582912,6582992,6593836,6582928,6593929,6583053,6583306,6590113,6583223],"length":1,"stats":{"Line":25},"fn_name":"new"},{"line":16,"address":[6583430,6583187],"length":1,"stats":{"Line":10},"fn_name":null},{"line":17,"address":[7183617,7182440,7182078,7182895,7183456,7183836,7184425,7182979,7182604,7184509],"length":1,"stats":{"Line":25},"fn_name":null},{"line":19,"address":[6586894,6585155],"length":1,"stats":{"Line":10},"fn_name":null},{"line":20,"address":[7192150,7190292,7190583,7191181,7191342,7190128,7191561,7189766,7192234,7190667],"length":1,"stats":{"Line":25},"fn_name":null},{"line":22,"address":[5319498],"length":1,"stats":{"Line":10},"fn_name":null},{"line":26,"address":[6590329,6590420],"length":1,"stats":{"Line":10},"fn_name":null},{"line":27,"address":[6590624,6591150,6590986,6591525,6592636,6592417,6593270,6593198,6591441,6592256],"length":1,"stats":{"Line":25},"fn_name":null}],"covered":8,"coverable":8},{"path":["/","home","runner","work","throwaway","throwaway","tests","common","models","token","mod.rs"],"content":"pub mod request_token;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","tests","common","models","token","request_token.rs"],"content":"use serde::{Deserialize, Serialize};\n\n#[derive(Serialize, Deserialize)]\npub struct TokenRequest {\n    pub lifespan: usize,\n    pub attributes: String,\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","tests","common","server.rs"],"content":"use std::net::{SocketAddr, TcpListener};\n\nuse throwaway::build_app;\n\npub async fn start_test_server() -\u003e SocketAddr {\n    let app = build_app().await.unwrap();\n\n    let socket_address = SocketAddr::from(([127, 0, 0, 1], 0));\n    let listener = TcpListener::bind(socket_address).unwrap();\n\n    let address = listener.local_addr().unwrap();\n    tokio::spawn(async move {\n        axum::Server::from_tcp(listener)\n            .unwrap()\n            .serve(app.into_make_service())\n            .await\n            .unwrap();\n    });\n\n    address\n}\n","traces":[{"line":5,"address":[7192512,7193058,7192576,7192719,7192860,7192541,7192633,7192787],"length":1,"stats":{"Line":20},"fn_name":"start_test_server"},{"line":6,"address":[7197081,7197320,7197469,7197140],"length":1,"stats":{"Line":15},"fn_name":null},{"line":8,"address":[7184645],"length":1,"stats":{"Line":5},"fn_name":null},{"line":9,"address":[6594916,6594829],"length":1,"stats":{"Line":10},"fn_name":null},{"line":11,"address":[7197954,7197889],"length":1,"stats":{"Line":10},"fn_name":null},{"line":12,"address":[7194813,7193584,7194460,7193969,7194072,7194146,7193936],"length":1,"stats":{"Line":15},"fn_name":"{async_block#0}"},{"line":13,"address":[6595847,6596069,6595713,6595494,6596158,6596232],"length":1,"stats":{"Line":20},"fn_name":null},{"line":14,"address":[7185700],"length":1,"stats":{"Line":5},"fn_name":null},{"line":15,"address":[6596091,6596179,6595565,6595756,6595886,6595993,6595678],"length":1,"stats":{"Line":25},"fn_name":null},{"line":20,"address":[6595218],"length":1,"stats":{"Line":5},"fn_name":null}],"covered":10,"coverable":10},{"path":["/","home","runner","work","throwaway","throwaway","tests","config_get_test.rs"],"content":"use anyhow::Error;\nmod common;\n\nuse common::models::profile::profile_create::CreateProfile;\nuse common::models::profile::profile_patch::PatchProfile;\n\nuse crate::common::framework::Framework;\n\n#[tokio::test]\nasync fn config_get_valid() -\u003e Result\u003c(), Error\u003e {\n    let framework = Framework::new().await;\n\n    // Lookup config\n    let config_response = framework.get_config().await?;\n\n    let use_local_string = config_response.body[\"config\"][\"use_local\"]\n        .as_bool()\n        .unwrap();\n    assert!(use_local_string);\n\n    Ok(())\n}\n","traces":[{"line":10,"address":[7165934,7165701,7165145,7165314,7165184,7165776,7166232,7165136,7165648,7165205],"length":1,"stats":{"Line":6},"fn_name":"{closure#0}"},{"line":11,"address":[7165891,7166243,7165806,7165766,7166062],"length":1,"stats":{"Line":4},"fn_name":null},{"line":14,"address":[5752716],"length":1,"stats":{"Line":3},"fn_name":null},{"line":16,"address":[7166921,7167168],"length":1,"stats":{"Line":2},"fn_name":null},{"line":19,"address":[7167297,7167264],"length":1,"stats":{"Line":1},"fn_name":null},{"line":21,"address":[7165290,7167270,7165234,7165385],"length":1,"stats":{"Line":4},"fn_name":null}],"covered":6,"coverable":6},{"path":["/","home","runner","work","throwaway","throwaway","tests","profile_patch_test.rs"],"content":"use anyhow::Error;\nuse serde_json::json;\n\nmod common;\n\nuse common::models::profile::profile_create::CreateProfile;\nuse common::models::profile::profile_patch::PatchProfile;\n\nuse crate::common::framework::Framework;\n\n#[tokio::test]\nasync fn profile_patch_name_valid() -\u003e Result\u003c(), Error\u003e {\n    let framework = Framework::new().await;\n\n    // Register\n    let profile = CreateProfile::new();\n    framework\n        .create_profile(\u0026profile)\n        .await?;\n\n    // Fetch Token\n    let token_request_body = json!({\n        \"lifespan\": 60,\n        \"attributes\": {\n            \"profile\": {\n                \"update\": true\n            }\n        }\n    });\n\n    let token_response = framework\n        .request_token(\u0026profile.email, \u0026profile.password, token_request_body)\n        .await?;\n\n    let token_authorization = token_response.body[\"token\"]\n        .as_str()\n        .unwrap();\n\n    // Patch Profile\n    let profile_patch = PatchProfile {\n        name: Some(\"Updated\".to_string()),\n        email: None,\n        country: None,\n        timezone: None,\n    };\n\n    let patch_response = framework\n        .patch_profile(token_authorization, \u0026profile_patch)\n        .await?;\n\n    let patch_response_country = patch_response.body[\"profile\"][\"name\"]\n        .as_str()\n        .unwrap();\n\n    assert_eq!(patch_response_country, \"Updated\");\n\n    Ok(())\n}\n","traces":[{"line":12,"address":[4774720,4775653,4774741,4774672,4775184,4774850,4775951,4775351,4775237,4774681],"length":1,"stats":{"Line":6},"fn_name":"{closure#0}"},{"line":13,"address":[4775781,4775610,4775302,4775962,4775381],"length":1,"stats":{"Line":4},"fn_name":null},{"line":16,"address":[4776130],"length":1,"stats":{"Line":1},"fn_name":null},{"line":17,"address":[4776756,4776813,4776357,4776210,4776481,4776603],"length":1,"stats":{"Line":4},"fn_name":null},{"line":18,"address":[4775402,4776260,4775559,4776525,4776192,4776396],"length":1,"stats":{"Line":6},"fn_name":null},{"line":19,"address":[4776778,4776733],"length":1,"stats":{"Line":1},"fn_name":null},{"line":22,"address":[4777439,4777312,4776988,4777202,4776925,4776854],"length":1,"stats":{"Line":5},"fn_name":null},{"line":31,"address":[4778504,4778113,4778359,4778750,4778999,4778628,4778942],"length":1,"stats":{"Line":5},"fn_name":null},{"line":32,"address":[4778543,4778124,4778672,4775508,4775423,4778242,4778404],"length":1,"stats":{"Line":7},"fn_name":null},{"line":33,"address":[4778964,4778926],"length":1,"stats":{"Line":0},"fn_name":null},{"line":35,"address":[4778882,4779082],"length":1,"stats":{"Line":2},"fn_name":null},{"line":41,"address":[4779213],"length":1,"stats":{"Line":1},"fn_name":null},{"line":47,"address":[4779640,4780040,4779764,4780099,4779886,4779470],"length":1,"stats":{"Line":4},"fn_name":null},{"line":48,"address":[4779540,4779808,4775441,4779679],"length":1,"stats":{"Line":4},"fn_name":null},{"line":49,"address":[4780024,4780059],"length":1,"stats":{"Line":0},"fn_name":null},{"line":51,"address":[4780270,4779982],"length":1,"stats":{"Line":2},"fn_name":null},{"line":55,"address":[4780526,4780399],"length":1,"stats":{"Line":1},"fn_name":null},{"line":57,"address":[4774921,4774826,4780489,4774770],"length":1,"stats":{"Line":4},"fn_name":null}],"covered":16,"coverable":18},{"path":["/","home","runner","work","throwaway","throwaway","tests","token_info_get_test.rs"],"content":"use anyhow::Error;\nuse serde_json::json;\n\nmod common;\n\nuse common::models::profile::profile_create::CreateProfile;\nuse common::models::profile::profile_patch::PatchProfile;\n\nuse crate::common::framework::Framework;\n\n#[tokio::test]\nasync fn token_info_get_valid() -\u003e Result\u003c(), Error\u003e {\n    let framework = Framework::new().await;\n\n    // Register\n    let profile = CreateProfile::new();\n    framework\n        .create_profile(\u0026profile)\n        .await?;\n\n    // Fetch Token\n    let token_request_body = json!({\n        \"lifespan\": 60,\n        \"attributes\": {\n            \"profile\": {\n                \"update\": true\n            }\n        }\n    });\n\n    let token_response = framework\n        .request_token(\u0026profile.email, \u0026profile.password, token_request_body)\n        .await?;\n\n    let token_authorization = token_response.body[\"token\"]\n        .as_str()\n        .unwrap();\n\n    // Lookup token info\n    let token_info_response = framework\n        .token_info(token_authorization)\n        .await?;\n\n    let token_info_issued_at = token_info_response.body[\"issued_at\"]\n        .as_str()\n        .unwrap();\n    assert!(!token_info_issued_at.is_empty());\n\n    let token_info_attributes_profile_update = token_info_response.body[\"attributes\"][\"profile\"][\"update\"]\n        .as_bool()\n        .unwrap();\n    assert!(token_info_attributes_profile_update);\n\n    Ok(())\n}\n","traces":[{"line":12,"address":[6301280,6301410,6301911,6301241,6301301,6301232,6301744,6301797,6302213,6302511],"length":1,"stats":{"Line":6},"fn_name":"{closure#0}"},{"line":13,"address":[6302522,6302341,6302170,6301862,6301941],"length":1,"stats":{"Line":4},"fn_name":null},{"line":16,"address":[6302690],"length":1,"stats":{"Line":1},"fn_name":null},{"line":17,"address":[6303041,6303373,6302917,6303163,6303316,6302770],"length":1,"stats":{"Line":4},"fn_name":null},{"line":18,"address":[5368008],"length":1,"stats":{"Line":6},"fn_name":null},{"line":19,"address":[5368062,5368022],"length":1,"stats":{"Line":1},"fn_name":null},{"line":22,"address":[6303872,6303762,6303999,6303485,6303548,6303414],"length":1,"stats":{"Line":5},"fn_name":null},{"line":31,"address":[6305064,6304919,6304673,6305502,6305310,6305188,6305559],"length":1,"stats":{"Line":5},"fn_name":null},{"line":32,"address":[5367925],"length":1,"stats":{"Line":7},"fn_name":null},{"line":33,"address":[6305486,6305524],"length":1,"stats":{"Line":0},"fn_name":null},{"line":35,"address":[6305442,6305642],"length":1,"stats":{"Line":2},"fn_name":null},{"line":40,"address":[6306014,6305767,6305890,6306136,6306358,6306299],"length":1,"stats":{"Line":4},"fn_name":null},{"line":41,"address":[5367785],"length":1,"stats":{"Line":4},"fn_name":null},{"line":42,"address":[6306283,6306318],"length":1,"stats":{"Line":0},"fn_name":null},{"line":44,"address":[6306238,6306510],"length":1,"stats":{"Line":2},"fn_name":null},{"line":47,"address":[6306595,6306657],"length":1,"stats":{"Line":1},"fn_name":null},{"line":49,"address":[6306694,6306618],"length":1,"stats":{"Line":2},"fn_name":null},{"line":52,"address":[6306859,6306826],"length":1,"stats":{"Line":1},"fn_name":null},{"line":54,"address":[6301330,6301386,6301481,6306832],"length":1,"stats":{"Line":4},"fn_name":null}],"covered":17,"coverable":19},{"path":["/","home","runner","work","throwaway","throwaway","tests","token_post_test.rs"],"content":"use anyhow::Error;\nuse serde_json::json;\n\nmod common;\n\nuse common::models::profile::profile_create::CreateProfile;\nuse common::models::profile::profile_patch::PatchProfile;\n\nuse crate::common::framework::Framework;\n\n#[tokio::test]\nasync fn token_post_valid() -\u003e Result\u003c(), Error\u003e {\n    let framework = Framework::new().await;\n\n    // Register\n    let profile = CreateProfile::new();\n    framework\n        .create_profile(\u0026profile)\n        .await?;\n\n    // Fetch Token\n    // FIXME: Maybe use a builder here to create a token request body instead, shouldn't necessarily be testing by\n    // passing in raw JSON bodies, try and make this more approachable?\n    let token_request_body = json!({\n        \"lifespan\": 60,\n        \"attributes\": {\n            \"profile\": {\n                \"update\": true\n            }\n        }\n    });\n\n    let token_response = framework\n        .request_token(\u0026profile.email, \u0026profile.password, token_request_body)\n        .await?;\n\n    let token_authorization = token_response.body[\"token\"]\n        .as_str()\n        .unwrap();\n    assert!(!token_authorization.is_empty());\n\n    Ok(())\n}\n","traces":[{"line":12,"address":[7189511,7189741,7190039,7189344,7189010,7188832,7188880,7188841,7189397,7188901],"length":1,"stats":{"Line":6},"fn_name":"{closure#0}"},{"line":13,"address":[7189462,7190050,7189541,7189698,7189869],"length":1,"stats":{"Line":4},"fn_name":null},{"line":16,"address":[7190218],"length":1,"stats":{"Line":1},"fn_name":null},{"line":17,"address":[7190445,7190298,7190691,7190569,7190844,7190901],"length":1,"stats":{"Line":4},"fn_name":null},{"line":18,"address":[5372684],"length":1,"stats":{"Line":6},"fn_name":null},{"line":19,"address":[5372698,5372738],"length":1,"stats":{"Line":1},"fn_name":null},{"line":24,"address":[7191076,7191013,7191290,7191400,7190942,7191527],"length":1,"stats":{"Line":5},"fn_name":null},{"line":33,"address":[7192838,7192992,7192716,7192201,7192592,7193051,7192447],"length":1,"stats":{"Line":5},"fn_name":null},{"line":34,"address":[5372577],"length":1,"stats":{"Line":6},"fn_name":null},{"line":35,"address":[7192976,7193011],"length":1,"stats":{"Line":0},"fn_name":null},{"line":37,"address":[7192934,7193195],"length":1,"stats":{"Line":2},"fn_name":null},{"line":40,"address":[7193280,7193330],"length":1,"stats":{"Line":1},"fn_name":null},{"line":42,"address":[7188930,7188986,7193303,7189081],"length":1,"stats":{"Line":4},"fn_name":null}],"covered":12,"coverable":13},{"path":["/","home","runner","work","throwaway","throwaway","tests","version_get_test.rs"],"content":"use anyhow::Error;\nmod common;\n\nuse common::models::profile::profile_create::CreateProfile;\nuse common::models::profile::profile_patch::PatchProfile;\n\nuse crate::common::framework::Framework;\n\n#[tokio::test]\nasync fn version_get_valid() -\u003e Result\u003c(), Error\u003e {\n    let framework = Framework::new().await;\n\n    // Lookup version\n    let version_response = framework.get_version().await?;\n\n    let version_string = version_response.body[\"version\"]\n        .as_str()\n        .unwrap();\n    assert!(!version_string.is_empty());\n\n    Ok(())\n}\n","traces":[{"line":10,"address":[7300904,7299856,7299877,7300320,7300606,7299808,7299986,7300373,7299817,7300448],"length":1,"stats":{"Line":6},"fn_name":"{closure#0}"},{"line":11,"address":[7300734,7300438,7300563,7300478,7300915],"length":1,"stats":{"Line":4},"fn_name":null},{"line":14,"address":[5753452],"length":1,"stats":{"Line":3},"fn_name":null},{"line":16,"address":[7301593,7301840],"length":1,"stats":{"Line":2},"fn_name":null},{"line":19,"address":[7301925,7301975],"length":1,"stats":{"Line":1},"fn_name":null},{"line":21,"address":[7299962,7299906,7300057,7301948],"length":1,"stats":{"Line":4},"fn_name":null}],"covered":6,"coverable":6}]};
        var previousData = {"files":[{"path":["/","home","runner","work","throwaway","throwaway","src","attributes","core.rs"],"content":"use serde::{Deserialize, Serialize};\n\nuse crate::attributes::profile::ProfileAttributes;\n\n#[derive(Default, Clone, Debug, Serialize, Deserialize)]\npub struct Attributes {\n    profile: Option\u003cProfileAttributes\u003e,\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","attributes","mod.rs"],"content":"pub mod core;\npub mod profile;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","attributes","profile.rs"],"content":"use serde::{Deserialize, Serialize};\n\nuse crate::helpers::serialization::is_none_or_false;\n\n#[derive(Default, Clone, Debug, Serialize, Deserialize)]\npub struct ProfileAttributes {\n    #[serde(skip_serializing_if = \"is_none_or_false\")]\n    pub create: Option\u003cbool\u003e,\n\n    #[serde(skip_serializing_if = \"is_none_or_false\")]\n    pub read: Option\u003cbool\u003e,\n\n    #[serde(skip_serializing_if = \"is_none_or_false\")]\n    pub update: Option\u003cbool\u003e,\n\n    #[serde(skip_serializing_if = \"is_none_or_false\")]\n    pub delete: Option\u003cbool\u003e,\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","core","cache.rs"],"content":"use std::fmt::Debug;\n\nuse deadpool_redis::{Config as RedisConfig, Runtime};\nuse deadpool_redis::{Connection, Pool};\nuse redis::{AsyncCommands, FromRedisValue, RedisResult, ToRedisArgs};\nuse tracing::info;\n\nuse crate::config::Config;\nuse crate::errors::core::ServerError;\nuse crate::models::secrets::cache::CacheSecrets;\n\npub type CachePool = Pool;\n\npub fn connect(config: \u0026Config, cache_secrets: \u0026CacheSecrets) -\u003e Result\u003cCachePool, ServerError\u003e {\n    let dsn = if config.use_local {\n        cache_secrets.local_dsn()\n    } else {\n        cache_secrets.dsn()\n    };\n\n    info!(\"Redis DSN: {dsn}\");\n\n    let redis_config = RedisConfig {\n        url: Some(dsn),\n        connection: None,\n        pool: None,\n    };\n\n    redis_config\n        .create_pool(Some(Runtime::Tokio1))\n        .map_err(ServerError::CacheError)\n}\n\n#[derive(Clone)]\npub struct Cache {\n    pool: CachePool,\n}\n\nimpl Cache {\n    #[must_use]\n    pub const fn new(pool: CachePool) -\u003e Self {\n        Self {\n            pool,\n        }\n    }\n\n    async fn connection(\u0026self) -\u003e Connection {\n        self.pool.get().await.unwrap()\n    }\n\n    pub async fn get\u003cT\u003e(\u0026self, key: \u0026str) -\u003e Option\u003cT\u003e\n    where\n        T: FromRedisValue + Debug + Send + Sync,\n    {\n        let mut cache = self.connection().await;\n\n        if self.exists(key).await {\n            let result = cache.get(\u0026key).await;\n            if let Ok(inner) = result {\n                info!(\"HIT | {key} | {inner:#?}\");\n                return Some(inner);\n            }\n        }\n\n        info!(\"MISS | {key}\");\n        None\n    }\n\n    pub async fn set\u003cT\u003e(\u0026self, key: \u0026str, value: T, expiry: usize)\n    where\n        T: ToRedisArgs + Debug + Send + Sync,\n    {\n        let mut cache = self.connection().await;\n\n        info!(\"SET | {key} | {value:#?}\");\n        let result = cache\n            .set_ex::\u003c_, _, ()\u003e(\u0026key, value, expiry)\n            .await;\n\n        if result.is_err() {\n            info!(\"Failed to set\");\n        }\n    }\n\n    pub async fn delete(\u0026self, key: \u0026str) {\n        let mut cache = self.connection().await;\n\n        info!(\"DELETE | {key}\");\n        let result = cache.del::\u003c_, ()\u003e(\u0026key).await;\n\n        if result.is_err() {\n            info!(\"Failed to delete\");\n        }\n    }\n\n    pub async fn exists(\u0026self, key: \u0026str) -\u003e bool {\n        let mut cache = self.connection().await;\n\n        let cache_exists: RedisResult\u003cbool\u003e = cache.exists(\u0026key).await;\n        if let Ok(exists) = cache_exists {\n            info!(\"EXISTS | {key} | {exists}\");\n            return exists;\n        }\n\n        info!(\"EXISTS | {key} | false\");\n        false\n    }\n}\n","traces":[{"line":14,"address":[4082009,4081974,4078688],"length":1,"stats":{"Line":5},"fn_name":"connect"},{"line":15,"address":[4078735],"length":1,"stats":{"Line":5},"fn_name":null},{"line":16,"address":[4078791],"length":1,"stats":{"Line":5},"fn_name":null},{"line":18,"address":[4078760],"length":1,"stats":{"Line":0},"fn_name":null},{"line":21,"address":[4080604,4079767,4079334,4081378,4078972,4081306,4080760,4080659,4079498,4079851],"length":1,"stats":{"Line":25},"fn_name":null},{"line":24,"address":[4080251],"length":1,"stats":{"Line":5},"fn_name":null},{"line":29,"address":[4080559,4081948],"length":1,"stats":{"Line":10},"fn_name":null},{"line":30,"address":[4080551],"length":1,"stats":{"Line":5},"fn_name":null},{"line":41,"address":[4082048],"length":1,"stats":{"Line":5},"fn_name":"new"},{"line":47,"address":[4082160,4082404,4082080,4082685,4082229,4082111,4082327],"length":1,"stats":{"Line":12},"fn_name":"connection"},{"line":48,"address":[4776364],"length":1,"stats":{"Line":9},"fn_name":null},{"line":51,"address":[4083174,4082928],"length":1,"stats":{"Line":6},"fn_name":"get\u003cthrowaway::models::database::profile::Profile\u003e"},{"line":55,"address":[4740616],"length":1,"stats":{"Line":12},"fn_name":null},{"line":57,"address":[4740534],"length":1,"stats":{"Line":12},"fn_name":null},{"line":58,"address":[4084310,4083288],"length":1,"stats":{"Line":4},"fn_name":null},{"line":59,"address":[4084706],"length":1,"stats":{"Line":2},"fn_name":null},{"line":60,"address":[4085405,4085043,4085944,4085860,4088320,4086928,4085569,4087517,4086709,4086548,4087601],"length":1,"stats":{"Line":10},"fn_name":null},{"line":61,"address":[4086476],"length":1,"stats":{"Line":2},"fn_name":null},{"line":65,"address":[4090732,4088786,4088424,4089325,4089924,4090816,4089241,4090143,4088950,4089763],"length":1,"stats":{"Line":15},"fn_name":null},{"line":66,"address":[4089737],"length":1,"stats":{"Line":3},"fn_name":null},{"line":69,"address":[4091638,4091376],"length":1,"stats":{"Line":6},"fn_name":"set\u003c\u0026throwaway::models::database::profile::Profile\u003e"},{"line":73,"address":[4091703,4091995,4091743,4092176,4091828],"length":1,"stats":{"Line":12},"fn_name":null},{"line":75,"address":[4092499,4094379,4094968,4093400,4094160,4095052,4093316,4093999,4093025,4092861],"length":1,"stats":{"Line":15},"fn_name":null},{"line":76,"address":[4095964,4093973,4095884,4093944],"length":1,"stats":{"Line":12},"fn_name":null},{"line":77,"address":[4742351],"length":1,"stats":{"Line":15},"fn_name":null},{"line":78,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":80,"address":[4097581,4096154,4096219],"length":1,"stats":{"Line":6},"fn_name":null},{"line":81,"address":[4098546,4097966,4098618,4097164,4096347,4097586,4096709,4097248,4097747,4096873],"length":1,"stats":{"Line":0},"fn_name":null},{"line":85,"address":[4099216,4099263],"length":1,"stats":{"Line":0},"fn_name":"delete"},{"line":96,"address":[4099440,4099375,4099761,4099493,4100059,4099603,4099328],"length":1,"stats":{"Line":12},"fn_name":"exists"},{"line":97,"address":[4099593,4099633,4099889,4100070,4099718],"length":1,"stats":{"Line":12},"fn_name":null},{"line":99,"address":[4100327,4099651,4100229],"length":1,"stats":{"Line":9},"fn_name":null},{"line":100,"address":[4100705],"length":1,"stats":{"Line":3},"fn_name":null},{"line":101,"address":[4106447,4105858,4104568,4104943,4104042,4106531,4104859,4105478,4104404,4105639],"length":1,"stats":{"Line":15},"fn_name":null},{"line":102,"address":[4105446],"length":1,"stats":{"Line":3},"fn_name":null},{"line":105,"address":[4102730,4101379,4102511,4102350,4101543,4101017,4101918,4103403,4103319,4101834],"length":1,"stats":{"Line":0},"fn_name":null},{"line":106,"address":[4102324],"length":1,"stats":{"Line":0},"fn_name":null}],"covered":31,"coverable":37},{"path":["/","home","runner","work","throwaway","throwaway","src","core","config.rs"],"content":"use dotenv::dotenv;\nuse envconfig::Envconfig;\nuse serde::Serialize;\nuse tracing::error;\n\nuse crate::errors::core::ServerError;\n\n#[derive(Envconfig, Clone, Debug, Serialize)]\npub struct Config {\n    #[envconfig(from = \"USE_LOCAL\", default = \"false\")]\n    pub use_local: bool,\n\n    #[envconfig(from = \"VAULT_URL\")]\n    pub vault_url: String,\n    #[envconfig(from = \"VAULT_TOKEN\")]\n    pub vault_token: String,\n\n    #[envconfig(from = \"VAULT_KV_MOUNT\")]\n    pub vault_kv_mount: String,\n    #[envconfig(from = \"VAULT_KV_PATH_REDIS\")]\n    pub vault_kv_path_redis: String,\n    #[envconfig(from = \"VAULT_KV_PATH_JWT\")]\n    pub vault_kv_path_jwt: String,\n\n    #[envconfig(from = \"VAULT_DATABASE_MOUNT\")]\n    pub vault_database_mount: String,\n    #[envconfig(from = \"VAULT_DATABASE_DEPLOYMENT_ROLE\")]\n    pub vault_database_deployment_role: String,\n    #[envconfig(from = \"VAULT_DATABASE_ROLE\")]\n    pub vault_database_role: String,\n\n    #[envconfig(from = \"DATABASE_HOST\")]\n    pub database_host: String,\n    #[envconfig(from = \"DATABASE_PORT\")]\n    pub database_port: String,\n    #[envconfig(from = \"DATABASE_DB\")]\n    pub database_db: String,\n    #[envconfig(from = \"DATABASE_CONNECTIONS\", default = \"50\")]\n    pub database_connections: u32,\n    #[envconfig(from = \"DATABASE_LIFETIME\", default = \"3600\")]\n    pub database_lifetime: u64,\n}\n\npub fn read() -\u003e Result\u003cConfig, ServerError\u003e {\n    dotenv().ok();\n    Config::init_from_env().map_err(|error| {\n        error!(\"Failed to load config: {error:#?}\");\n        ServerError::EnvConfigError(error)\n    })\n}\n","traces":[{"line":44,"address":[4569024],"length":1,"stats":{"Line":5},"fn_name":"read"},{"line":45,"address":[4569040],"length":1,"stats":{"Line":5},"fn_name":null},{"line":46,"address":[8445830,8445872],"length":1,"stats":{"Line":5},"fn_name":"{closure#0}"},{"line":47,"address":[4569561,4570618,4570685,4569709,4569252,4571263,4571201,4570026,4569952,4570570],"length":1,"stats":{"Line":0},"fn_name":null},{"line":48,"address":[4570481],"length":1,"stats":{"Line":0},"fn_name":null}],"covered":3,"coverable":5},{"path":["/","home","runner","work","throwaway","throwaway","src","core","database.rs"],"content":"use std::time::Duration;\n\nuse sqlx::{postgres::PgPoolOptions, Pool, Postgres};\nuse tracing::{error, info};\n\nuse crate::config::Config;\nuse crate::errors::core::ServerError;\nuse crate::models::secrets::database::DatabaseSecrets;\n\npub type DatabasePool = Pool\u003cPostgres\u003e;\n\npub async fn connect(config: \u0026Config, database_secrets: \u0026DatabaseSecrets) -\u003e Result\u003cDatabasePool, ServerError\u003e {\n    let dsn = if config.use_local {\n        database_secrets.local_dsn()\n    } else {\n        database_secrets.dsn()\n    };\n\n    info!(\"Database DSN: {dsn}\");\n\n    PgPoolOptions::new()\n        .max_connections(config.database_connections)\n        .max_lifetime(Duration::from_secs(config.database_lifetime))\n        .connect(\u0026dsn)\n        .await\n        .map_err(|error| {\n            error!(\"Failed to connect to Postgres: {error:#?}\");\n            ServerError::SqlxError(error)\n        })\n}\n","traces":[{"line":12,"address":[8356112,8356151],"length":1,"stats":{"Line":20},"fn_name":"connect"},{"line":13,"address":[4976260],"length":1,"stats":{"Line":5},"fn_name":null},{"line":14,"address":[4937460,4937530],"length":1,"stats":{"Line":10},"fn_name":null},{"line":16,"address":[4946828,4946607],"length":1,"stats":{"Line":0},"fn_name":null},{"line":19,"address":[4938066,4938230,4940099,4940659,4940011,4939418,4938613,4938525,4937704,4939038,4939199],"length":1,"stats":{"Line":25},"fn_name":null},{"line":21,"address":[4980549,4979861,4980006,4980224,4980330,4978036,4979769],"length":1,"stats":{"Line":35},"fn_name":null},{"line":22,"address":[4940739,4940776],"length":1,"stats":{"Line":10},"fn_name":null},{"line":23,"address":[4940784,4940892,4940932,4940672],"length":1,"stats":{"Line":10},"fn_name":null},{"line":24,"address":[5487519],"length":1,"stats":{"Line":30},"fn_name":null},{"line":26,"address":[4941632,4944566],"length":1,"stats":{"Line":0},"fn_name":"{closure#0}"},{"line":27,"address":[4943288,4942352,4943236,4942188,4943389,4942713,4942625,4944024,4943948,4941826],"length":1,"stats":{"Line":0},"fn_name":null},{"line":28,"address":[4943154],"length":1,"stats":{"Line":0},"fn_name":null}],"covered":8,"coverable":12},{"path":["/","home","runner","work","throwaway","throwaway","src","core","logging.rs"],"content":"use tracing::subscriber::set_global_default;\nuse tracing_error::ErrorLayer;\nuse tracing_log::LogTracer;\nuse tracing_subscriber::filter::FromEnvError;\nuse tracing_subscriber::layer::SubscriberExt;\nuse tracing_subscriber::{EnvFilter, Registry};\n\nuse crate::errors::core::ServerError;\n\n#[allow(clippy::cognitive_complexity)]\npub fn init() -\u003e Result\u003c(), ServerError\u003e {\n    LogTracer::init().map_err(ServerError::LogTracerError)?;\n\n    let env_filter = EnvFilter::try_from_default_env()\n        .or_else(|_| EnvFilter::try_new(\"debug\"))\n        .map_err(|err| ServerError::LogEnvError(FromEnvError::from(err)))?;\n\n    let stdout_subscriber = tracing_subscriber::fmt::layer();\n\n    let subscriber = Registry::default()\n        .with(env_filter)\n        .with(ErrorLayer::default())\n        .with(stdout_subscriber);\n\n    set_global_default(subscriber).map_err(ServerError::LogSubscriberError)?;\n\n    Ok(())\n}\n","traces":[{"line":11,"address":[8274928,8275768,8276155],"length":1,"stats":{"Line":5},"fn_name":"init"},{"line":12,"address":[4427534,4427431],"length":1,"stats":{"Line":5},"fn_name":null},{"line":14,"address":[8283139,8282893,8282787],"length":1,"stats":{"Line":10},"fn_name":null},{"line":15,"address":[4428640,4428624],"length":1,"stats":{"Line":10},"fn_name":"{closure#0}"},{"line":16,"address":[8283078,8284064,8284078],"length":1,"stats":{"Line":0},"fn_name":"{closure#1}"},{"line":18,"address":[8275312],"length":1,"stats":{"Line":5},"fn_name":null},{"line":20,"address":[4428189,4428094,4427938,4428021],"length":1,"stats":{"Line":20},"fn_name":null},{"line":21,"address":[8275566,8275491],"length":1,"stats":{"Line":10},"fn_name":null},{"line":22,"address":[8283318,8283415,8283490],"length":1,"stats":{"Line":10},"fn_name":null},{"line":23,"address":[4428133],"length":1,"stats":{"Line":5},"fn_name":null},{"line":25,"address":[4428257,4428371],"length":1,"stats":{"Line":5},"fn_name":null},{"line":27,"address":[4428350],"length":1,"stats":{"Line":5},"fn_name":null}],"covered":11,"coverable":12},{"path":["/","home","runner","work","throwaway","throwaway","src","core","migrations.rs"],"content":"use sqlx::migrate;\nuse sqlx::migrate::Migrator;\n\nuse crate::{DatabasePool, ServerError};\n\n// Migrations embedded within the binary\nstatic MIGRATOR: Migrator = migrate!(\"./sql/migrations\");\n\npub async fn migrate(database_deployment: \u0026DatabasePool) -\u003e Result\u003c(), ServerError\u003e {\n    MIGRATOR\n        .run(database_deployment)\n        .await\n        .map_err(ServerError::SqlxMigrationError)?;\n\n    Ok(())\n}\n","traces":[{"line":9,"address":[5255840,5255972,5256044,5256583,5256797,5256318,5255883],"length":1,"stats":{"Line":25},"fn_name":"{async_fn#0}"},{"line":10,"address":[5538128,5538316,5538046,5538528,5537739],"length":1,"stats":{"Line":20},"fn_name":null},{"line":11,"address":[5256201,5256025,5256496,5256316,5256361],"length":1,"stats":{"Line":20},"fn_name":null},{"line":13,"address":[5256770,5256588],"length":1,"stats":{"Line":0},"fn_name":null},{"line":15,"address":[5256575],"length":1,"stats":{"Line":5},"fn_name":null}],"covered":4,"coverable":5},{"path":["/","home","runner","work","throwaway","throwaway","src","core","mod.rs"],"content":"pub mod cache;\npub mod config;\npub mod database;\npub mod logging;\npub mod migrations;\npub mod secrets;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","core","secrets.rs"],"content":"use serde::{Deserialize, Serialize};\nuse vaultrs::client::{VaultClient, VaultClientSettingsBuilder};\nuse vaultrs::database::role::creds;\nuse vaultrs::kv2;\n\nuse crate::config::Config;\nuse crate::models::secrets::cache::CacheSecrets;\nuse crate::models::secrets::database::DatabaseSecrets;\nuse crate::models::secrets::jwt::JwtSecrets;\nuse crate::ServerError;\n\n#[derive(Clone, Debug, Deserialize, Serialize)]\npub struct Secrets {\n    pub cache: CacheSecrets,\n    pub database: DatabaseSecrets,\n    pub database_deployment: DatabaseSecrets,\n    pub jwt: JwtSecrets,\n}\n\n// FIXME: Support reading Vault token from filepath (K8s injection method)\npub async fn read(config: \u0026Config) -\u003e Result\u003cSecrets, ServerError\u003e {\n    let settings = VaultClientSettingsBuilder::default()\n        .address(\u0026config.vault_url)\n        .token(\u0026config.vault_token)\n        .build()\n        .map_err(ServerError::VaultClientConfigError)?;\n\n    let client = VaultClient::new(settings).map_err(ServerError::VaultClientError)?;\n\n    let cache_secrets: CacheSecrets = kv2::read(\u0026client, \u0026config.vault_kv_mount, \u0026config.vault_kv_path_redis).await?;\n\n    let database_deployment_credentials = creds(\n        \u0026client,\n        \u0026config.vault_database_mount,\n        \u0026config.vault_database_deployment_role,\n    )\n    .await?;\n    let database_deployment_secrets = DatabaseSecrets {\n        host: config.database_host.clone(),\n        port: config.database_port.clone(),\n        db: config.database_db.clone(),\n        user: database_deployment_credentials.username,\n        password: database_deployment_credentials.password,\n    };\n\n    let database_credentials = creds(\u0026client, \u0026config.vault_database_mount, \u0026config.vault_database_role).await?;\n    let database_secrets = DatabaseSecrets {\n        host: config.database_host.clone(),\n        port: config.database_port.clone(),\n        db: config.database_db.clone(),\n        user: database_credentials.username,\n        password: database_credentials.password,\n    };\n\n    let jwt_secrets: JwtSecrets = kv2::read(\u0026client, \u0026config.vault_kv_mount, \u0026config.vault_kv_path_jwt).await?;\n\n    Ok(Secrets {\n        cache: cache_secrets,\n        database: database_secrets,\n        database_deployment: database_deployment_secrets,\n        jwt: jwt_secrets,\n    })\n}\n","traces":[{"line":21,"address":[8802055,8802032],"length":1,"stats":{"Line":25},"fn_name":"read"},{"line":22,"address":[6051864,6051397,6051317,6050854],"length":1,"stats":{"Line":15},"fn_name":null},{"line":23,"address":[6051305],"length":1,"stats":{"Line":5},"fn_name":null},{"line":24,"address":[6039341],"length":1,"stats":{"Line":5},"fn_name":null},{"line":26,"address":[6051682,6051332,6051894],"length":1,"stats":{"Line":5},"fn_name":null},{"line":28,"address":[6052027,6052351],"length":1,"stats":{"Line":5},"fn_name":null},{"line":30,"address":[6052317,6052668,6053437,6050906,6051135],"length":1,"stats":{"Line":20},"fn_name":null},{"line":33,"address":[6053388],"length":1,"stats":{"Line":5},"fn_name":null},{"line":34,"address":[6041355],"length":1,"stats":{"Line":5},"fn_name":null},{"line":35,"address":[6053791],"length":1,"stats":{"Line":5},"fn_name":null},{"line":37,"address":[6054492,6054682],"length":1,"stats":{"Line":0},"fn_name":null},{"line":39,"address":[6054459],"length":1,"stats":{"Line":5},"fn_name":null},{"line":40,"address":[6054817],"length":1,"stats":{"Line":5},"fn_name":null},{"line":41,"address":[6054896],"length":1,"stats":{"Line":5},"fn_name":null},{"line":42,"address":[6042927],"length":1,"stats":{"Line":5},"fn_name":null},{"line":43,"address":[6042964],"length":1,"stats":{"Line":5},"fn_name":null},{"line":46,"address":[6043285,6038900,6043158,6038985,6043959],"length":1,"stats":{"Line":20},"fn_name":null},{"line":48,"address":[6043926],"length":1,"stats":{"Line":5},"fn_name":null},{"line":49,"address":[6044277],"length":1,"stats":{"Line":5},"fn_name":null},{"line":50,"address":[6044356],"length":1,"stats":{"Line":5},"fn_name":null},{"line":51,"address":[6044435],"length":1,"stats":{"Line":5},"fn_name":null},{"line":52,"address":[6044472],"length":1,"stats":{"Line":5},"fn_name":null},{"line":55,"address":[5486162],"length":1,"stats":{"Line":15},"fn_name":null},{"line":57,"address":[6045729],"length":1,"stats":{"Line":5},"fn_name":null},{"line":58,"address":[6045368],"length":1,"stats":{"Line":5},"fn_name":null},{"line":59,"address":[6045450],"length":1,"stats":{"Line":5},"fn_name":null},{"line":60,"address":[6045570],"length":1,"stats":{"Line":5},"fn_name":null},{"line":61,"address":[6045697],"length":1,"stats":{"Line":5},"fn_name":null}],"covered":27,"coverable":28},{"path":["/","home","runner","work","throwaway","throwaway","src","errors","core.rs"],"content":"use axum::{\n    http::StatusCode,\n    response::{IntoResponse, Response},\n    Json,\n};\nuse serde_json::json;\nuse thiserror::Error;\nuse tracing::error;\n\n#[derive(Error, Debug)]\npub enum ServerError {\n    // Can we include status code here? `#[error(\"[Validation]: {0}\", StatusCode::BAD_REQUEST)]`\n    #[error(\"[Validation]: {0}\")]\n    ValidationError(#[from] validator::ValidationErrors),\n\n    #[error(\"[Serde]: {0}\")]\n    SerdeJsonError(#[from] serde_json::Error),\n\n    #[error(\"[SQL]: {0}\")]\n    SqlxError(#[from] sqlx::Error),\n\n    #[error(\"[SQL Migration]: {0}\")]\n    SqlxMigrationError(#[from] sqlx::migrate::MigrateError),\n\n    #[error(\"[Cache]: {0}\")]\n    CacheError(#[from] deadpool_redis::CreatePoolError),\n\n    #[error(\"[Env Config]: {0}\")]\n    EnvConfigError(#[from] envconfig::Error),\n\n    #[error(\"[Log Env]: {0}\")]\n    LogEnvError(#[from] tracing_subscriber::filter::FromEnvError),\n\n    #[error(\"[Log Tracer]: {0}\")]\n    LogTracerError(#[from] tracing::log::SetLoggerError),\n\n    #[error(\"[Log Subscriber]: {0}\")]\n    LogSubscriberError(#[from] tracing::subscriber::SetGlobalDefaultError),\n\n    #[error(\"[Argon]: {0}\")]\n    ArgonPasswordError(#[from] argon2::password_hash::Error),\n\n    #[error(\"[JWT]: {0}\")]\n    JwtError(#[from] jsonwebtoken::errors::Error),\n\n    #[error(\"[Vault Client Config]: {0}\")]\n    VaultClientConfigError(#[from] vaultrs::client::VaultClientSettingsBuilderError),\n\n    #[error(\"[Vault Client]: {0}\")]\n    VaultClientError(#[from] vaultrs::error::ClientError),\n\n    #[error(\"[Hyper]: {0}\")]\n    HyperError(#[from] hyper::Error),\n\n    #[error(\"[Axum Header]: {0}\")]\n    AxumTypedHeaderError(#[from] axum::extract::rejection::TypedHeaderRejection),\n\n    #[error(\"[Axum Extension]: {0}\")]\n    AxumExtensionError(#[from] axum::extract::rejection::ExtensionRejection),\n\n    #[error(\"[Axum Form]: {0}\")]\n    AxumFormRejection(#[from] axum::extract::rejection::FormRejection),\n\n    #[error(\"[Axum Json]: {0}\")]\n    AxumJsonRejection(#[from] axum::extract::rejection::JsonRejection),\n\n    #[error(\"[Credentials]: {0}\")]\n    CredentialsError(#[from] crate::errors::credentials::CredentialsError),\n\n    #[error(\"[Profile]: {0}\")]\n    ProfileError(#[from] crate::errors::profile::ProfileError),\n\n    #[error(\"Token: {0}\")]\n    TokenError(#[from] crate::errors::token::TokenError),\n\n    /// FIXME: This should only be used short term, and replaced with proper error handling in time\n    #[error(\"WIP Error\")]\n    WIPError,\n}\n\nimpl IntoResponse for ServerError {\n    fn into_response(self) -\u003e Response {\n        let (status, message) = match self {\n            ServerError::ValidationError(err) =\u003e (StatusCode::BAD_REQUEST, err.to_string()),\n            ServerError::CredentialsError(error) =\u003e {\n                return error.into_response();\n            }\n            ServerError::ProfileError(error) =\u003e {\n                return error.into_response();\n            }\n            ServerError::TokenError(error) =\u003e {\n                return error.into_response();\n            }\n            _ =\u003e {\n                error!(\"Internal server error: {self:#?}\");\n                (StatusCode::INTERNAL_SERVER_ERROR, self.to_string())\n            }\n        };\n\n        let body = Json(json!({\n            \"status\": status.as_str(),\n            \"message\": message,\n        }));\n\n        (status, body).into_response()\n    }\n}\n","traces":[{"line":82,"address":[8829324,8824928,8828403],"length":1,"stats":{"Line":0},"fn_name":"into_response"},{"line":83,"address":[4904831,4907997],"length":1,"stats":{"Line":0},"fn_name":null},{"line":84,"address":[8836039,8832899],"length":1,"stats":{"Line":0},"fn_name":null},{"line":86,"address":[4905105,4908107],"length":1,"stats":{"Line":0},"fn_name":null},{"line":88,"address":[8833015],"length":1,"stats":{"Line":0},"fn_name":null},{"line":89,"address":[8825267,8828261,8825281],"length":1,"stats":{"Line":0},"fn_name":null},{"line":92,"address":[4908063,4905163],"length":1,"stats":{"Line":0},"fn_name":null},{"line":95,"address":[8826752,8825929,8827478,8826282,8827550,8826804,8826902,8825765,8825403,8826198],"length":1,"stats":{"Line":0},"fn_name":null},{"line":96,"address":[8835839,8834467],"length":1,"stats":{"Line":0},"fn_name":null},{"line":100,"address":[4908301,4908406,4908053,4908486],"length":1,"stats":{"Line":0},"fn_name":null},{"line":101,"address":[4908454,4908389],"length":1,"stats":{"Line":0},"fn_name":null},{"line":105,"address":[4908960],"length":1,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":12},{"path":["/","home","runner","work","throwaway","throwaway","src","errors","credentials.rs"],"content":"use axum::{\n    http::StatusCode,\n    response::{IntoResponse, Response},\n    Json,\n};\nuse serde_json::json;\nuse thiserror::Error;\n\n#[derive(Error, Debug)]\npub enum CredentialsError {\n    #[error(\"Credentials is invalid\")]\n    InvalidCredentials,\n}\n\nimpl IntoResponse for CredentialsError {\n    fn into_response(self) -\u003e Response {\n        let status = match self {\n            CredentialsError::InvalidCredentials =\u003e (StatusCode::NOT_FOUND),\n        };\n\n        let body = Json(json!({\n            \"status\": status.as_str(),\n            \"message\": format!(\"{self}\"),\n        }));\n\n        (status, body).into_response()\n    }\n}\n","traces":[{"line":16,"address":[7925472,7925851,7926635],"length":1,"stats":{"Line":0},"fn_name":"into_response"},{"line":17,"address":[7917745],"length":1,"stats":{"Line":0},"fn_name":null},{"line":18,"address":[5908033],"length":1,"stats":{"Line":0},"fn_name":null},{"line":21,"address":[7917886,7917768,7918118,7917950,7918351,7918183],"length":1,"stats":{"Line":0},"fn_name":null},{"line":22,"address":[5908141,5908206],"length":1,"stats":{"Line":0},"fn_name":null},{"line":23,"address":[3986369,3986298],"length":1,"stats":{"Line":0},"fn_name":null},{"line":26,"address":[3986867],"length":1,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":7},{"path":["/","home","runner","work","throwaway","throwaway","src","errors","mod.rs"],"content":"pub mod core;\npub mod credentials;\npub mod profile;\npub mod token;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","errors","profile.rs"],"content":"use axum::{\n    http::StatusCode,\n    response::{IntoResponse, Response},\n    Json,\n};\nuse serde_json::json;\nuse thiserror::Error;\n\n#[derive(Error, Debug)]\npub enum ProfileError {\n    #[error(\"Profile not found\")]\n    NotFound,\n\n    #[error(\"Profile already exists\")]\n    Exists,\n\n    #[error(\"Profile could not be updated\")]\n    UpdateFailure,\n\n    #[error(\"Profile name already set\")]\n    NameSet,\n\n    #[error(\"Profile email already set\")]\n    EmailSet,\n}\n\nimpl IntoResponse for ProfileError {\n    fn into_response(self) -\u003e Response {\n        let status = match self {\n            ProfileError::NotFound =\u003e (StatusCode::NOT_FOUND),\n            _ =\u003e (StatusCode::BAD_REQUEST),\n        };\n\n        let body = Json(json!({\n            \"status\": status.as_str(),\n            \"message\": format!(\"{self}\"),\n        }));\n\n        (status, body).into_response()\n    }\n}\n","traces":[{"line":28,"address":[6514422,6513638,6513232],"length":1,"stats":{"Line":0},"fn_name":"into_response"},{"line":29,"address":[4571816],"length":1,"stats":{"Line":0},"fn_name":null},{"line":30,"address":[4571843],"length":1,"stats":{"Line":0},"fn_name":null},{"line":31,"address":[8523020],"length":1,"stats":{"Line":0},"fn_name":null},{"line":34,"address":[4572446,4571859,4572201,4571977,4572262,4572057],"length":1,"stats":{"Line":0},"fn_name":null},{"line":35,"address":[8530937,8530872],"length":1,"stats":{"Line":0},"fn_name":null},{"line":36,"address":[4572316,4572245],"length":1,"stats":{"Line":0},"fn_name":null},{"line":39,"address":[4572814],"length":1,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":8},{"path":["/","home","runner","work","throwaway","throwaway","src","errors","token.rs"],"content":"use axum::{\n    http::StatusCode,\n    response::{IntoResponse, Response},\n    Json,\n};\nuse serde_json::json;\nuse thiserror::Error;\n\n#[derive(Error, Debug)]\npub enum TokenError {\n    #[error(\"Token is invalid\")]\n    InvalidToken,\n}\n\nimpl IntoResponse for TokenError {\n    fn into_response(self) -\u003e Response {\n        let status = match self {\n            TokenError::InvalidToken =\u003e (StatusCode::NOT_FOUND),\n        };\n\n        let body = Json(json!({\n            \"status\": status.as_str(),\n            \"message\": format!(\"{self}\"),\n        }));\n\n        (status, body).into_response()\n    }\n}\n","traces":[{"line":16,"address":[7926672,7927835,7927051],"length":1,"stats":{"Line":0},"fn_name":"into_response"},{"line":17,"address":[7918945],"length":1,"stats":{"Line":0},"fn_name":null},{"line":18,"address":[5909233],"length":1,"stats":{"Line":0},"fn_name":null},{"line":21,"address":[7919150,7919551,7919318,7919086,7918968,7919383],"length":1,"stats":{"Line":0},"fn_name":null},{"line":22,"address":[5909406,5909341],"length":1,"stats":{"Line":0},"fn_name":null},{"line":23,"address":[3987537,3987466],"length":1,"stats":{"Line":0},"fn_name":null},{"line":26,"address":[3988035],"length":1,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":7},{"path":["/","home","runner","work","throwaway","throwaway","src","extractors","mod.rs"],"content":"pub mod validated_json;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","extractors","validated_json.rs"],"content":"use axum::{\n    async_trait,\n    extract::{FromRequest, RequestParts},\n    BoxError,\n    Json,\n};\nuse http_body::Body;\nuse serde::de::DeserializeOwned;\nuse validator::Validate;\n\nuse crate::errors::core::ServerError;\n\n#[derive(Debug, Clone, Copy, Default)]\npub struct ValidatedJson\u003cT\u003e(pub T);\n\n#[async_trait]\nimpl\u003cT, B\u003e FromRequest\u003cB\u003e for ValidatedJson\u003cT\u003e\nwhere\n    T: DeserializeOwned + Validate,\n    B: Body + Send,\n    B::Data: Send,\n    B::Error: Into\u003cBoxError\u003e,\n{\n    type Rejection = ServerError;\n\n    async fn from_request(request_parts: \u0026mut RequestParts\u003cB\u003e) -\u003e Result\u003cSelf, Self::Rejection\u003e {\n        let Json(object) = Json::\u003cT\u003e::from_request(request_parts).await?;\n        object.validate()?;\n        Ok(Self(object))\n    }\n}\n","traces":[{"line":26,"address":[4429648,4430075,4430611,4431867,4433744,4429456,4431607,4433787,4434083,4430240,4434917,4432405,4430003,4429657,4430371,4432163,4429849,4434320,4429465,4429619,4432032,4433529,4429811,4433952,4430032,4431824,4429840],"length":1,"stats":{"Line":42},"fn_name":"from_request\u003cthrowaway::models::request::profile::ProfilePatchRequest, hyper::body::body::Body\u003e"},{"line":27,"address":[8689948,8690302,8687806],"length":1,"stats":{"Line":7},"fn_name":null},{"line":28,"address":[4433403,4434553,4431638,4431247,4431481,4433560,4434774,4433169,4434948],"length":1,"stats":{"Line":14},"fn_name":null},{"line":29,"address":[4433435,4431513,4434809],"length":1,"stats":{"Line":7},"fn_name":null}],"covered":4,"coverable":4},{"path":["/","home","runner","work","throwaway","throwaway","src","handlers","config.rs"],"content":"use axum::extract::Extension;\nuse axum::http::StatusCode;\nuse axum::response::IntoResponse;\nuse axum::routing::get;\nuse axum::{Json, Router};\n\nuse crate::errors::core::ServerError;\nuse crate::models::response::config::ConfigResponse;\nuse crate::Config;\n\n#[must_use]\npub fn routes() -\u003e Router {\n    Router::new().route(\"/config\", get(config_get))\n}\n\npub async fn config_get(Extension(config): Extension\u003cConfig\u003e) -\u003e Result\u003cimpl IntoResponse, ServerError\u003e {\n    let response = ConfigResponse {\n        config,\n    };\n\n    Ok((StatusCode::OK, Json(response)))\n}\n","traces":[{"line":12,"address":[8661334,8661136,8661303],"length":1,"stats":{"Line":5},"fn_name":"routes"},{"line":13,"address":[4861362,4861201],"length":1,"stats":{"Line":5},"fn_name":null},{"line":16,"address":[4861842,4861514,4861409,4861472,4861392],"length":1,"stats":{"Line":4},"fn_name":"config_get"},{"line":21,"address":[4861660],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":4,"coverable":4},{"path":["/","home","runner","work","throwaway","throwaway","src","handlers","mod.rs"],"content":"pub mod config;\npub mod profile;\npub mod register;\npub mod token;\npub mod version;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","handlers","profile.rs"],"content":"use axum::extract::Extension;\nuse axum::http::StatusCode;\nuse axum::response::IntoResponse;\nuse axum::routing::patch;\nuse axum::{Json, Router};\nuse tracing::instrument;\n\nuse crate::errors::core::ServerError;\nuse crate::extractors::validated_json::ValidatedJson;\nuse crate::middleware::token_authentication::TokenAuthenticationLayer;\nuse crate::models::database::profile::Profile;\nuse crate::models::request::profile::ProfilePatchRequest;\nuse crate::models::response::profile::ProfilePatchResponse;\nuse crate::services::profile::ProfileService;\n\n#[must_use]\npub fn routes() -\u003e Router {\n    Router::new()\n        .route(\"/profile\", patch(profile_patch))\n        .route_layer(TokenAuthenticationLayer::default())\n}\n\n// TODO: How does PATCH work with passwords and redacted fields?\n// TODO: How to prevent a PATCH being abused as a PUT? Just check request only 1 field?\n// FIXME: Can we remove the printing of errs but having 'err' in instrument instead?\n#[instrument(skip(profile_service), level = \"info\", err)]\npub async fn profile_patch(\n    ValidatedJson(profile_patch_request): ValidatedJson\u003cProfilePatchRequest\u003e,\n    Extension(profile_service): Extension\u003cProfileService\u003e,\n    Extension(profile): Extension\u003cProfile\u003e,\n) -\u003e Result\u003cimpl IntoResponse, ServerError\u003e {\n    // FIXME: Should this logic be pushed into a service?\n    return match profile_patch_request {\n        ProfilePatchRequest {\n            name: Some(name), ..\n        } =\u003e {\n            let updated_profile = profile_service\n                .update_name(profile.profile_id, name)\n                .await?;\n\n            let response = ProfilePatchResponse {\n                // FIXME: Where do we keep static strings like this? \"constants\"\n                message: \"Updated Profile name\".to_string(),\n                code: 200,\n                profile: Some(updated_profile.to_public()),\n            };\n\n            Ok((StatusCode::OK, Json(response)))\n        }\n        ProfilePatchRequest {\n            email: Some(email), ..\n        } =\u003e {\n            let updated_profile = profile_service\n                .update_email(profile.profile_id, email)\n                .await?;\n\n            let response = ProfilePatchResponse {\n                message: \"Updated Profile email\".to_string(),\n                code: 200,\n                profile: Some(updated_profile.to_public()),\n            };\n\n            Ok((StatusCode::OK, Json(response)))\n        }\n        // ProfilePatchRequest {\n        //     country: Some(country),\n        //     ..\n        // } =\u003e {\n        //     if country == profile.country {\n        //         let response = ProfilePatchResponse {\n        //             message: \"Country already set\".to_string(),\n        //             code: 409,\n        //             profile: None,\n        //         };\n        //\n        //         return Ok((StatusCode::CONFLICT, Json(response)));\n        //     }\n        //\n        //     profile.country = country.clone();\n        //     profile_service\n        //         .update(profile.clone())\n        //         .await?;\n        //\n        //     let response = ProfilePatchResponse {\n        //         message: \"Updated Country password\".to_string(),\n        //         code: 200,\n        //         profile: Some(profile.to_public()),\n        //     };\n        //\n        //     Ok((StatusCode::OK, Json(response)))\n        // }\n        // ProfilePatchRequest {\n        //     timezone: Some(timezone),\n        //     ..\n        // } =\u003e {\n        //     if timezone == profile.timezone {\n        //         let response = ProfilePatchResponse {\n        //             message: \"Timezone already set\".to_string(),\n        //             code: 409,\n        //             profile: None,\n        //         };\n        //\n        //         return Ok((StatusCode::CONFLICT, Json(response)));\n        //     }\n        //\n        //     profile.timezone = timezone.clone();\n        //     profile_service\n        //         .update(profile.clone())\n        //         .await?;\n        //\n        //     let response = ProfilePatchResponse {\n        //         message: \"Updated Timezone password\".to_string(),\n        //         code: 200,\n        //         profile: Some(profile.to_public()),\n        //     };\n        //\n        //     Ok((StatusCode::OK, Json(response)))\n        // }\n        _ =\u003e {\n            // This could be a scenario when a user tries to patch multiple fields (or no fields).\n            // TODO: Can we validate patches at the extractor level? Ensure validated json with only 1 field set e.g.\n            // TODO: Can we just return an Err here?\n            let response = ProfilePatchResponse {\n                message: \"Invalid request\".to_string(),\n                code: 422,\n                profile: None,\n            };\n\n            Ok((StatusCode::UNPROCESSABLE_ENTITY, Json(response)))\n        }\n    };\n}\n","traces":[{"line":17,"address":[4495867,4495664,4495837],"length":1,"stats":{"Line":5},"fn_name":"routes"},{"line":18,"address":[7945245,7945083,7944992],"length":1,"stats":{"Line":15},"fn_name":null},{"line":19,"address":[7945177,7945030,7945135],"length":1,"stats":{"Line":10},"fn_name":null},{"line":20,"address":[7945207,7945274,7945290,7945151],"length":1,"stats":{"Line":10},"fn_name":null},{"line":26,"address":[7966408,7965454,7961543,7958485,7958416,7962343,7965837,7960289,7959221,7965290,7960039,7959089,7966627,7965749,7961490,7967220,7964928,7961223,7966247,7959513,7961631,7967308,7967786,7958297,7959264,7959875],"length":1,"stats":{"Line":10},"fn_name":"{async_fn#0}"},{"line":27,"address":[7958256],"length":1,"stats":{"Line":1},"fn_name":"profile_patch"},{"line":33,"address":[4521910,4522320],"length":1,"stats":{"Line":1},"fn_name":null},{"line":35,"address":[7968274],"length":1,"stats":{"Line":1},"fn_name":null},{"line":37,"address":[4522224,4524462,4524679,4524571,4522302,4524965],"length":1,"stats":{"Line":5},"fn_name":null},{"line":38,"address":[4745480],"length":1,"stats":{"Line":6},"fn_name":null},{"line":39,"address":[7971147,7970953],"length":1,"stats":{"Line":0},"fn_name":null},{"line":41,"address":[7971387],"length":1,"stats":{"Line":1},"fn_name":null},{"line":43,"address":[7970923],"length":1,"stats":{"Line":1},"fn_name":null},{"line":45,"address":[7971291,7971223],"length":1,"stats":{"Line":2},"fn_name":null},{"line":48,"address":[7971527],"length":1,"stats":{"Line":1},"fn_name":null},{"line":51,"address":[7968438],"length":1,"stats":{"Line":0},"fn_name":null},{"line":53,"address":[7969046,7969602,7968523,7968469,7969185,7969290],"length":1,"stats":{"Line":0},"fn_name":null},{"line":54,"address":[4522846,4523125,4522985,4522388,4523027,4522016],"length":1,"stats":{"Line":0},"fn_name":null},{"line":55,"address":[4523520,4523330],"length":1,"stats":{"Line":0},"fn_name":null},{"line":57,"address":[4523752],"length":1,"stats":{"Line":0},"fn_name":null},{"line":58,"address":[4523300],"length":1,"stats":{"Line":0},"fn_name":null},{"line":60,"address":[4523656,4523608],"length":1,"stats":{"Line":0},"fn_name":null},{"line":63,"address":[4523892],"length":1,"stats":{"Line":0},"fn_name":null},{"line":123,"address":[4522568],"length":1,"stats":{"Line":0},"fn_name":null},{"line":124,"address":[4522469],"length":1,"stats":{"Line":0},"fn_name":null},{"line":126,"address":[4522556],"length":1,"stats":{"Line":0},"fn_name":null},{"line":129,"address":[4522658],"length":1,"stats":{"Line":0},"fn_name":null}],"covered":14,"coverable":27},{"path":["/","home","runner","work","throwaway","throwaway","src","handlers","register.rs"],"content":"use axum::extract::Extension;\nuse axum::http::StatusCode;\nuse axum::response::IntoResponse;\nuse axum::routing::post;\nuse axum::{Json, Router};\n\nuse crate::errors::core::ServerError;\nuse crate::extractors::validated_json::ValidatedJson;\nuse crate::models::request::register::RegisterRequest;\nuse crate::models::response::register::RegisterResponse;\nuse crate::services::profile::ProfileService;\n\n#[must_use]\npub fn routes() -\u003e Router {\n    Router::new().route(\"/register\", post(register_post))\n}\n\npub async fn register_post(\n    ValidatedJson(register_request): ValidatedJson\u003cRegisterRequest\u003e,\n    Extension(profile_service): Extension\u003cProfileService\u003e,\n) -\u003e Result\u003cimpl IntoResponse, ServerError\u003e {\n    let profile_id = profile_service\n        .create(register_request)\n        .await?;\n\n    let register_response = RegisterResponse {\n        profile_id,\n    };\n\n    Ok((StatusCode::CREATED, Json(register_response)))\n}\n","traces":[{"line":14,"address":[6784822,6784624,6784791],"length":1,"stats":{"Line":5},"fn_name":"routes"},{"line":15,"address":[4862098,4861937],"length":1,"stats":{"Line":5},"fn_name":null},{"line":18,"address":[4862128],"length":1,"stats":{"Line":3},"fn_name":"register_post"},{"line":22,"address":[8795878,8796122,8796523,8795789,8795464],"length":1,"stats":{"Line":12},"fn_name":null},{"line":23,"address":[8795814,8796070,8795518,8795336,8795682,8795868],"length":1,"stats":{"Line":15},"fn_name":null},{"line":24,"address":[4863883,4864073],"length":1,"stats":{"Line":0},"fn_name":null},{"line":30,"address":[4863766],"length":1,"stats":{"Line":3},"fn_name":null}],"covered":6,"coverable":7},{"path":["/","home","runner","work","throwaway","throwaway","src","handlers","token.rs"],"content":"use axum::extract::Extension;\nuse axum::http::StatusCode;\nuse axum::response::IntoResponse;\nuse axum::routing::{get, post};\nuse axum::{Json, Router};\nuse chrono::{Duration, TimeZone, Utc};\n\nuse crate::errors::core::ServerError;\nuse crate::extractors::validated_json::ValidatedJson;\nuse crate::middleware::basic_authentication::BasicAuthenticationLayer;\nuse crate::middleware::token_authentication::TokenAuthenticationLayer;\nuse crate::models::claims::Claims;\nuse crate::models::database::profile::Profile;\nuse crate::models::request::token::TokenRequest;\nuse crate::models::response::token::TokenResponse;\nuse crate::models::response::token_info::TokenInfoResponse;\nuse crate::TokenService;\n\n#[must_use]\npub fn routes() -\u003e Router {\n    let basic_auth_routes = Router::new()\n        .route(\"/token\", post(token_post))\n        .route_layer(BasicAuthenticationLayer::default());\n\n    let token_auth_routes = Router::new()\n        .route(\"/token/test\", post(token_test_get))\n        .route(\"/token/info\", get(token_info_get))\n        .route_layer(TokenAuthenticationLayer::default());\n\n    Router::new()\n        .merge(basic_auth_routes)\n        .merge(token_auth_routes)\n}\n\npub async fn token_post(\n    ValidatedJson(token_request): ValidatedJson\u003cTokenRequest\u003e,\n    Extension(token_service): Extension\u003cTokenService\u003e,\n    Extension(profile): Extension\u003cProfile\u003e,\n) -\u003e Result\u003cimpl IntoResponse, ServerError\u003e {\n    let lifespan_duration = Duration::seconds(token_request.lifespan as i64);\n    let token = token_service.generate(profile.profile_id, lifespan_duration, token_request.attributes)?;\n\n    let token_response = TokenResponse {\n        token,\n    };\n\n    Ok((StatusCode::CREATED, Json(token_response)))\n}\n\npub async fn token_test_get() -\u003e Result\u003cimpl IntoResponse, ServerError\u003e {\n    Ok(StatusCode::CREATED)\n}\n\npub async fn token_info_get(Extension(claims): Extension\u003cClaims\u003e) -\u003e Result\u003cimpl IntoResponse, ServerError\u003e {\n    let token_info_response = TokenInfoResponse {\n        issued_at: Utc\n            .timestamp(claims.iat, 0)\n            .to_rfc3339(),\n        expires_at: Utc\n            .timestamp(claims.exp, 0)\n            .to_rfc3339(),\n        attributes: claims.attributes,\n    };\n\n    Ok((StatusCode::CREATED, Json(token_info_response)))\n}\n","traces":[{"line":20,"address":[8432072,8431808,8432038],"length":1,"stats":{"Line":5},"fn_name":"routes"},{"line":21,"address":[8431956,8432117,8431825],"length":1,"stats":{"Line":15},"fn_name":null},{"line":22,"address":[8431903,8432011,8432053],"length":1,"stats":{"Line":10},"fn_name":null},{"line":23,"address":[8432184,8432149,8432027,8432083],"length":1,"stats":{"Line":10},"fn_name":null},{"line":25,"address":[8432598,8432308,8432165,8432457],"length":1,"stats":{"Line":20},"fn_name":null},{"line":26,"address":[8432398,8432363,8432247],"length":1,"stats":{"Line":10},"fn_name":null},{"line":27,"address":[8432539,8432512,8432379,8432420],"length":1,"stats":{"Line":10},"fn_name":null},{"line":28,"address":[4496680,4496787,4496655,4496748],"length":1,"stats":{"Line":10},"fn_name":null},{"line":30,"address":[4496967,4496772,4496899],"length":1,"stats":{"Line":15},"fn_name":null},{"line":31,"address":[4496838],"length":1,"stats":{"Line":5},"fn_name":null},{"line":32,"address":[4496906],"length":1,"stats":{"Line":5},"fn_name":null},{"line":35,"address":[4497040],"length":1,"stats":{"Line":3},"fn_name":"token_post"},{"line":40,"address":[8433336,8433485],"length":1,"stats":{"Line":6},"fn_name":null},{"line":41,"address":[4497561,4497968],"length":1,"stats":{"Line":3},"fn_name":null},{"line":47,"address":[4497800],"length":1,"stats":{"Line":3},"fn_name":null},{"line":50,"address":[4498384,4498556,4498388,4498432,4498475],"length":1,"stats":{"Line":0},"fn_name":"token_test_get"},{"line":51,"address":[4498506],"length":1,"stats":{"Line":0},"fn_name":null},{"line":54,"address":[4498592,4499477,4498873,4498605,4498656,4498699],"length":1,"stats":{"Line":5},"fn_name":"token_info_get"},{"line":56,"address":[4499000,4498845],"length":1,"stats":{"Line":2},"fn_name":null},{"line":59,"address":[4499015,4499100],"length":1,"stats":{"Line":2},"fn_name":null},{"line":62,"address":[4499107],"length":1,"stats":{"Line":1},"fn_name":null},{"line":65,"address":[4499199],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":20,"coverable":22},{"path":["/","home","runner","work","throwaway","throwaway","src","handlers","version.rs"],"content":"use axum::http::StatusCode;\nuse axum::response::IntoResponse;\nuse axum::routing::get;\nuse axum::{Json, Router};\n\nuse crate::errors::core::ServerError;\nuse crate::models::response::version::VersionResponse;\nuse crate::VERSION;\n\n#[must_use]\npub fn routes() -\u003e Router {\n    Router::new().route(\"/version\", get(version_get))\n}\n\npub async fn version_get() -\u003e Result\u003cimpl IntoResponse, ServerError\u003e {\n    let response = VersionResponse {\n        version: VERSION.to_string(),\n    };\n\n    Ok((StatusCode::OK, Json(response)))\n}\n","traces":[{"line":11,"address":[4864240,4864398,4864425],"length":1,"stats":{"Line":5},"fn_name":"routes"},{"line":12,"address":[4864418,4864257],"length":1,"stats":{"Line":5},"fn_name":null},{"line":15,"address":[8524420,8524416,8524464,8524506,8524570],"length":1,"stats":{"Line":4},"fn_name":"version_get"},{"line":17,"address":[4864578],"length":1,"stats":{"Line":1},"fn_name":null},{"line":20,"address":[4864756],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":5,"coverable":5},{"path":["/","home","runner","work","throwaway","throwaway","src","helpers","mod.rs"],"content":"pub mod serialization;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","helpers","serialization.rs"],"content":"pub const fn is_none_or_false(value: \u0026Option\u003cbool\u003e) -\u003e bool {\n    if let Some(value) = value {\n        return !(*value);\n    }\n\n    true\n}\n","traces":[{"line":1,"address":[8377408],"length":1,"stats":{"Line":3},"fn_name":"is_none_or_false"},{"line":2,"address":[4428877],"length":1,"stats":{"Line":3},"fn_name":null},{"line":3,"address":[4428911],"length":1,"stats":{"Line":3},"fn_name":null},{"line":6,"address":[4428923],"length":1,"stats":{"Line":3},"fn_name":null}],"covered":4,"coverable":4},{"path":["/","home","runner","work","throwaway","throwaway","src","lib.rs"],"content":"#![deny(clippy::all, clippy::pedantic, clippy::nursery, clippy::cargo)]\n#![allow(\n    clippy::module_name_repetitions,\n    clippy::missing_errors_doc,\n    clippy::multiple_crate_versions,\n    clippy::must_use_candidate,\n    clippy::unused_async,\n    clippy::struct_excessive_bools\n)]\n#![feature(const_mut_refs, once_cell, map_first_last, type_alias_impl_trait, core_intrinsics)]\n\nuse axum::extract::Extension;\nuse axum::http::header;\nuse axum::Router;\nuse axum_extra::middleware::from_fn;\nuse tower::ServiceBuilder;\nuse tower_http::ServiceBuilderExt;\nuse tracing::debug;\n\nuse crate::cache::Cache;\nuse crate::config::Config;\nuse crate::core::cache::CachePool;\nuse crate::core::config;\nuse crate::core::database;\nuse crate::core::database::DatabasePool;\nuse crate::core::logging;\nuse crate::core::migrations::migrate;\nuse crate::core::{cache, secrets};\nuse crate::errors::core::ServerError;\nuse crate::middleware::version_header;\nuse crate::repositories::profile::ProfileRepository;\nuse crate::secrets::Secrets;\nuse crate::services::password::PasswordService;\nuse crate::services::profile::ProfileService;\nuse crate::services::token::TokenService;\n\npub mod attributes;\npub mod core;\npub mod errors;\npub mod extractors;\npub mod handlers;\npub mod helpers;\npub mod middleware;\npub mod models;\npub mod repositories;\npub mod services;\npub mod validation;\n\npub const VERSION: \u0026str = env!(\"CARGO_PKG_VERSION\");\n\npub async fn build_app() -\u003e Result\u003cRouter, ServerError\u003e {\n    logging::init()?;\n\n    let config: Config = config::read()?;\n    debug!(\"Config: {config:#?}\");\n\n    let secrets: Secrets = secrets::read(\u0026config).await?;\n    debug!(\"Secrets: {secrets:#?}\");\n\n    // Connection Pools\n    let database: DatabasePool = database::connect(\u0026config, \u0026secrets.database).await?;\n    let database_deployment: DatabasePool = database::connect(\u0026config, \u0026secrets.database_deployment).await?;\n\n    let cache_pool: CachePool = cache::connect(\u0026config, \u0026secrets.cache)?;\n    let cache: Cache = cache::Cache::new(cache_pool);\n\n    // Database Provision\n    migrate(\u0026database_deployment).await?;\n\n    // Repositories\n    let profile_repository = ProfileRepository::new(database.clone(), cache.clone());\n\n    // Services\n    let token_service = TokenService::new(\u0026secrets.jwt);\n    let password_service = PasswordService::new();\n    let profile_service = ProfileService::new(password_service.clone(), profile_repository);\n\n    // Global Middleware\n    let version_header = from_fn(version_header::version_header_middleware);\n    let sensitive_headers = vec![header::AUTHORIZATION, header::COOKIE];\n\n    let middleware = ServiceBuilder::new()\n        .sensitive_headers(sensitive_headers)\n        .layer(version_header);\n\n    // App\n    let app = Router::new()\n        .layer(middleware)\n        .merge(handlers::config::routes())\n        .merge(handlers::register::routes())\n        .merge(handlers::token::routes())\n        .merge(handlers::profile::routes())\n        .merge(handlers::version::routes())\n        .layer(Extension(token_service))\n        .layer(Extension(password_service))\n        .layer(Extension(profile_service))\n        .layer(Extension(config))\n        .layer(Extension(secrets));\n\n    Ok(app)\n}\n","traces":[{"line":51,"address":[8435712,8435741],"length":1,"stats":{"Line":25},"fn_name":"build_app"},{"line":52,"address":[7282759,7282214,7282831],"length":1,"stats":{"Line":10},"fn_name":null},{"line":54,"address":[7313465,7314025,7313818],"length":1,"stats":{"Line":10},"fn_name":null},{"line":55,"address":[7316067,7315140,7316660,7315687,7314681,7314319,7315228,7315848,7314845,7316748],"length":1,"stats":{"Line":25},"fn_name":null},{"line":57,"address":[5522451],"length":1,"stats":{"Line":20},"fn_name":null},{"line":58,"address":[7318260,7319645,7319806,7318786,7318622,7320706,7320025,7319081,7320618,7319169],"length":1,"stats":{"Line":25},"fn_name":null},{"line":61,"address":[7313209,7313052,7321854,7319613,7321317],"length":1,"stats":{"Line":20},"fn_name":null},{"line":62,"address":[5482945],"length":1,"stats":{"Line":20},"fn_name":null},{"line":64,"address":[7292018,7292372,7292488],"length":1,"stats":{"Line":10},"fn_name":null},{"line":65,"address":[7292437,7292815],"length":1,"stats":{"Line":10},"fn_name":null},{"line":68,"address":[5482697],"length":1,"stats":{"Line":15},"fn_name":null},{"line":71,"address":[7293689,7293898,7293363,7293638],"length":1,"stats":{"Line":10},"fn_name":null},{"line":74,"address":[7293979,7293872],"length":1,"stats":{"Line":10},"fn_name":null},{"line":75,"address":[7293987],"length":1,"stats":{"Line":5},"fn_name":null},{"line":76,"address":[7294060,7294099],"length":1,"stats":{"Line":10},"fn_name":null},{"line":79,"address":[7294158],"length":1,"stats":{"Line":5},"fn_name":null},{"line":80,"address":[7294268,7294213],"length":1,"stats":{"Line":10},"fn_name":null},{"line":82,"address":[7294469,7294361],"length":1,"stats":{"Line":10},"fn_name":null},{"line":83,"address":[7294421],"length":1,"stats":{"Line":5},"fn_name":null},{"line":84,"address":[7294563],"length":1,"stats":{"Line":5},"fn_name":null},{"line":87,"address":[7296085,7294733,7295790,7294880,7295325,7295027,7295472,7296330,7294665,7296213,7295174,7294571],"length":1,"stats":{"Line":60},"fn_name":null},{"line":88,"address":[7294625,7294672],"length":1,"stats":{"Line":10},"fn_name":null},{"line":89,"address":[7294776,7294680,7294590,7294811],"length":1,"stats":{"Line":10},"fn_name":null},{"line":90,"address":[7294792,7294833,7294846,7294923,7294958],"length":1,"stats":{"Line":10},"fn_name":null},{"line":91,"address":[7295070,7294993,7294980,7294939,7295105],"length":1,"stats":{"Line":10},"fn_name":null},{"line":92,"address":[7295086,7295217,7295127,7295252,7295140],"length":1,"stats":{"Line":10},"fn_name":null},{"line":93,"address":[7295479,7295368,7295274,7295233,7295287],"length":1,"stats":{"Line":10},"fn_name":null},{"line":94,"address":[7295376],"length":1,"stats":{"Line":5},"fn_name":null},{"line":95,"address":[7295542],"length":1,"stats":{"Line":5},"fn_name":null},{"line":96,"address":[7295797],"length":1,"stats":{"Line":5},"fn_name":null},{"line":97,"address":[7296100],"length":1,"stats":{"Line":5},"fn_name":null},{"line":98,"address":[7296228],"length":1,"stats":{"Line":5},"fn_name":null},{"line":100,"address":[7296380],"length":1,"stats":{"Line":5},"fn_name":null}],"covered":33,"coverable":33},{"path":["/","home","runner","work","throwaway","throwaway","src","main.rs"],"content":"#![deny(clippy::all, clippy::pedantic, clippy::nursery, clippy::cargo)]\n#![allow(\n    clippy::module_name_repetitions,\n    clippy::missing_errors_doc,\n    clippy::multiple_crate_versions,\n    clippy::must_use_candidate,\n    clippy::unused_async,\n    clippy::struct_excessive_bools\n)]\n#![feature(const_mut_refs, once_cell, map_first_last, type_alias_impl_trait, core_intrinsics)]\n\nuse std::net::SocketAddr;\n\nuse anyhow::Error;\nuse hyper::Server;\nuse throwaway::build_app;\nuse throwaway::errors::core::ServerError;\nuse tracing::info;\n\n#[tokio::main]\npub async fn main() -\u003e Result\u003c(), Error\u003e {\n    let app = build_app().await?;\n\n    let address = SocketAddr::from(([0, 0, 0, 0], 8000));\n    info!(\"Listening on: {address}\");\n\n    Server::bind(\u0026address)\n        .serve(app.into_make_service())\n        .await\n        .map_err(ServerError::HyperError)?;\n\n    Ok(())\n}\n","traces":[{"line":21,"address":[5539703,5538770,5539252,5539157,5538661,5539480,5539104,5539408,5538640],"length":1,"stats":{"Line":0},"fn_name":"main"},{"line":22,"address":[5539714,5539365,5540114,5539282,5539218,5539536],"length":1,"stats":{"Line":0},"fn_name":null},{"line":24,"address":[5540020],"length":1,"stats":{"Line":0},"fn_name":null},{"line":25,"address":[5541865,5542026,5542245,5541343,5541052,5540526,5541427,5542918,5540888,5542834],"length":1,"stats":{"Line":0},"fn_name":null},{"line":27,"address":[5543806,5544002,5543524,5541839,5544307,5543631,5544248,5543913],"length":1,"stats":{"Line":0},"fn_name":null},{"line":28,"address":[4351880],"length":1,"stats":{"Line":0},"fn_name":null},{"line":30,"address":[5544088,5544275],"length":1,"stats":{"Line":0},"fn_name":null},{"line":32,"address":[5544067,5538841,5538690,5538746],"length":1,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":8},{"path":["/","home","runner","work","throwaway","throwaway","src","middleware","basic_authentication.rs"],"content":"use std::task::{Context, Poll};\n\nuse axum::extract::{FromRequest, RequestParts, TypedHeader};\nuse axum::response::IntoResponse;\nuse axum::{body::Body, http::Request, response::Response};\nuse futures::future::BoxFuture;\nuse headers::authorization::Basic;\nuse headers::Authorization;\nuse tower::{Layer, Service};\n\nuse crate::errors::token::TokenError;\nuse crate::ProfileService;\n\n#[derive(Debug, Clone)]\npub struct BasicAuthenticationLayer;\n\nimpl Default for BasicAuthenticationLayer {\n    fn default() -\u003e Self {\n        Self\n    }\n}\n\nimpl\u003cS\u003e Layer\u003cS\u003e for BasicAuthenticationLayer {\n    type Service = BasicAuthentication\u003cS\u003e;\n\n    fn layer(\u0026self, inner: S) -\u003e Self::Service {\n        BasicAuthentication {\n            inner,\n        }\n    }\n}\n\n#[derive(Debug, Clone)]\npub struct BasicAuthentication\u003cS\u003e {\n    inner: S,\n}\n\nimpl\u003cS\u003e Service\u003cRequest\u003cBody\u003e\u003e for BasicAuthentication\u003cS\u003e\nwhere\n    S: Service\u003cRequest\u003cBody\u003e, Response = Response\u003e + Clone + Send + 'static,\n    S::Future: Send + 'static,\n{\n    type Error = S::Error;\n    type Future = BoxFuture\u003c'static, Result\u003cSelf::Response, Self::Error\u003e\u003e;\n    type Response = S::Response;\n\n    fn poll_ready(\u0026mut self, cx: \u0026mut Context\u003c'_\u003e) -\u003e Poll\u003cResult\u003c(), Self::Error\u003e\u003e {\n        self.inner.poll_ready(cx)\n    }\n\n    fn call(\u0026mut self, request: Request\u003cBody\u003e) -\u003e Self::Future {\n        let clone = self.inner.clone();\n        let mut inner = std::mem::replace(\u0026mut self.inner, clone);\n\n        // FIXME: Solve error handling within middleware\n        Box::pin(async move {\n            let mut request_parts = RequestParts::new(request);\n\n            let profile_service = request_parts\n                .extensions()\n                .unwrap()\n                .get::\u003cProfileService\u003e()\n                .unwrap()\n                .clone();\n\n            // FIXME: Handle invalid token.\n            let TypedHeader(Authorization(basic)) =\n                TypedHeader::\u003cAuthorization\u003cBasic\u003e\u003e::from_request(\u0026mut request_parts)\n                    .await\n                    .unwrap();\n\n            let email = basic.username();\n            let password = basic.password();\n\n            let result = profile_service\n                .verify_credentials(email, password)\n                .await;\n\n            if let Err(err) = result {\n                return Ok(err.into_response());\n            }\n\n            let (is_valid, profile) = result.unwrap();\n            if !is_valid {\n                // FIXME: Not a token! Invalid basic credentials error\n                return Ok(TokenError::InvalidToken.into_response());\n            }\n\n            // Inject Profile for further actions\n            request_parts\n                .extensions_mut()\n                .unwrap()\n                .insert(profile);\n\n            let request = request_parts\n                .try_into_request()\n                .unwrap();\n\n            let response = inner.call(request).await?;\n\n            Ok(response)\n        })\n    }\n}\n","traces":[{"line":18,"address":[3988208],"length":1,"stats":{"Line":5},"fn_name":"default"},{"line":26,"address":[3988224],"length":1,"stats":{"Line":5},"fn_name":"layer\u003caxum::routing::route::Route\u003chyper::body::body::Body, core::convert::Infallible\u003e\u003e"},{"line":47,"address":[3988272],"length":1,"stats":{"Line":3},"fn_name":"poll_ready\u003caxum::routing::route::Route\u003chyper::body::body::Body, core::convert::Infallible\u003e\u003e"},{"line":48,"address":[3988286],"length":1,"stats":{"Line":3},"fn_name":null},{"line":51,"address":[3988817,3988848,3988320],"length":1,"stats":{"Line":3},"fn_name":"call\u003caxum::routing::route::Route\u003chyper::body::body::Body, core::convert::Infallible\u003e\u003e"},{"line":52,"address":[3988468,3988375],"length":1,"stats":{"Line":6},"fn_name":null},{"line":53,"address":[3988484],"length":1,"stats":{"Line":3},"fn_name":null},{"line":56,"address":[3988864,3988359,3988532,3989082,3988933,3989916,3993029,3989312],"length":1,"stats":{"Line":12},"fn_name":"{async_block#0}\u003caxum::routing::route::Route\u003chyper::body::body::Body, core::convert::Infallible\u003e\u003e"},{"line":57,"address":[3988998,3989434],"length":1,"stats":{"Line":6},"fn_name":null},{"line":59,"address":[3989516,3989441],"length":1,"stats":{"Line":6},"fn_name":null},{"line":60,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":61,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":62,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":63,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":64,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":67,"address":[3990129],"length":1,"stats":{"Line":3},"fn_name":null},{"line":68,"address":[4755085],"length":1,"stats":{"Line":9},"fn_name":null},{"line":69,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":70,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":72,"address":[3990169,3990271],"length":1,"stats":{"Line":6},"fn_name":null},{"line":73,"address":[3990309],"length":1,"stats":{"Line":3},"fn_name":null},{"line":75,"address":[3990576,3990700,3990399],"length":1,"stats":{"Line":9},"fn_name":null},{"line":76,"address":[4754965],"length":1,"stats":{"Line":15},"fn_name":null},{"line":77,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":79,"address":[3990817],"length":1,"stats":{"Line":3},"fn_name":null},{"line":80,"address":[3993127,3990912],"length":1,"stats":{"Line":0},"fn_name":null},{"line":83,"address":[3991157,3991026],"length":1,"stats":{"Line":6},"fn_name":null},{"line":84,"address":[3991225],"length":1,"stats":{"Line":3},"fn_name":null},{"line":86,"address":[3991324,3991269],"length":1,"stats":{"Line":0},"fn_name":null},{"line":90,"address":[3991384,3991483,3991239],"length":1,"stats":{"Line":9},"fn_name":null},{"line":91,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":92,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":93,"address":[3991498,3991414],"length":1,"stats":{"Line":6},"fn_name":null},{"line":95,"address":[3991513],"length":1,"stats":{"Line":3},"fn_name":null},{"line":96,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":97,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":99,"address":[3991618,3992801,3989151],"length":1,"stats":{"Line":3},"fn_name":null},{"line":101,"address":[3992510],"length":1,"stats":{"Line":3},"fn_name":null}],"covered":24,"coverable":38},{"path":["/","home","runner","work","throwaway","throwaway","src","middleware","mod.rs"],"content":"pub mod basic_authentication;\npub mod token_authentication;\npub mod version_header;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","middleware","token_authentication.rs"],"content":"use std::task::{Context, Poll};\n\nuse axum::extract::{FromRequest, RequestParts, TypedHeader};\nuse axum::{body::Body, http::Request, response::Response};\nuse futures::future::BoxFuture;\nuse headers::authorization::Bearer;\nuse headers::Authorization;\nuse tower::{Layer, Service};\nuse tracing::{debug, info};\n\nuse crate::{ProfileService, TokenService};\n\n#[derive(Debug, Clone)]\npub struct TokenAuthenticationLayer;\n\nimpl Default for TokenAuthenticationLayer {\n    fn default() -\u003e Self {\n        Self\n    }\n}\n\nimpl\u003cS\u003e Layer\u003cS\u003e for TokenAuthenticationLayer {\n    type Service = TokenAuthentication\u003cS\u003e;\n\n    fn layer(\u0026self, inner: S) -\u003e Self::Service {\n        TokenAuthentication {\n            inner,\n        }\n    }\n}\n\n#[derive(Debug, Clone)]\npub struct TokenAuthentication\u003cS\u003e {\n    inner: S,\n}\n\nimpl\u003cS\u003e Service\u003cRequest\u003cBody\u003e\u003e for TokenAuthentication\u003cS\u003e\nwhere\n    S: Service\u003cRequest\u003cBody\u003e, Response = Response\u003e + Clone + Send + 'static,\n    S::Future: Send + 'static,\n{\n    type Error = S::Error;\n    type Future = BoxFuture\u003c'static, Result\u003cSelf::Response, Self::Error\u003e\u003e;\n    type Response = S::Response;\n\n    fn poll_ready(\u0026mut self, cx: \u0026mut Context\u003c'_\u003e) -\u003e Poll\u003cResult\u003c(), Self::Error\u003e\u003e {\n        self.inner.poll_ready(cx)\n    }\n\n    fn call(\u0026mut self, request: Request\u003cBody\u003e) -\u003e Self::Future {\n        let clone = self.inner.clone();\n        let mut inner = std::mem::replace(\u0026mut self.inner, clone);\n\n        // FIXME: Solve error handling within middleware\n        Box::pin(async move {\n            let mut request_parts = RequestParts::new(request);\n\n            // FIXME: Maybe create a helper function to grab services from extensions, this is very verbose.\n            let token_service = request_parts\n                .extensions()\n                .unwrap()\n                .get::\u003cTokenService\u003e()\n                .unwrap()\n                .clone();\n\n            let profile_service = request_parts\n                .extensions()\n                .unwrap()\n                .get::\u003cProfileService\u003e()\n                .unwrap()\n                .clone();\n\n            // FIXME: Handle invalid token.\n            let TypedHeader(Authorization(bearer)) =\n                TypedHeader::\u003cAuthorization\u003cBearer\u003e\u003e::from_request(\u0026mut request_parts)\n                    .await\n                    .unwrap();\n\n            let token = bearer.token();\n            debug!(\"Bearer Token: {token:?}\");\n\n            let claims = token_service.decode(token).unwrap();\n            info!(\"Claims: {claims:?}\");\n\n            let profile_id = claims.sub;\n            let profile = profile_service\n                .read(profile_id)\n                .await\n                .unwrap();\n\n            // Inject Profile and Claims\n            request_parts\n                .extensions_mut()\n                .unwrap()\n                .insert(profile);\n\n            request_parts\n                .extensions_mut()\n                .unwrap()\n                .insert(claims);\n\n            let request = request_parts\n                .try_into_request()\n                .unwrap();\n\n            let response = inner.call(request).await?;\n\n            Ok(response)\n        })\n    }\n}\n","traces":[{"line":17,"address":[4499600],"length":1,"stats":{"Line":5},"fn_name":"default"},{"line":25,"address":[4499616],"length":1,"stats":{"Line":5},"fn_name":"layer\u003caxum::routing::route::Route\u003chyper::body::body::Body, core::convert::Infallible\u003e\u003e"},{"line":46,"address":[4499664],"length":1,"stats":{"Line":2},"fn_name":"poll_ready\u003caxum::routing::route::Route\u003chyper::body::body::Body, core::convert::Infallible\u003e\u003e"},{"line":47,"address":[4499678],"length":1,"stats":{"Line":2},"fn_name":null},{"line":50,"address":[4500240,4499712,4500209],"length":1,"stats":{"Line":2},"fn_name":"call\u003caxum::routing::route::Route\u003chyper::body::body::Body, core::convert::Infallible\u003e\u003e"},{"line":51,"address":[4499767,4499860],"length":1,"stats":{"Line":4},"fn_name":null},{"line":52,"address":[4499876],"length":1,"stats":{"Line":2},"fn_name":null},{"line":55,"address":[4500704,4499751,4500325,4500474,4500256,4499924,4510478,4501498],"length":1,"stats":{"Line":8},"fn_name":"{async_block#0}\u003caxum::routing::route::Route\u003chyper::body::body::Body, core::convert::Infallible\u003e\u003e"},{"line":56,"address":[4500390,4500826],"length":1,"stats":{"Line":4},"fn_name":null},{"line":59,"address":[4500908,4500833],"length":1,"stats":{"Line":4},"fn_name":null},{"line":60,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":61,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":62,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":63,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":64,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":66,"address":[4501021,4501098],"length":1,"stats":{"Line":4},"fn_name":null},{"line":67,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":68,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":69,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":70,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":71,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":74,"address":[4501711],"length":1,"stats":{"Line":2},"fn_name":null},{"line":75,"address":[4755859],"length":1,"stats":{"Line":6},"fn_name":null},{"line":76,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":77,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":79,"address":[4501766,4501882],"length":1,"stats":{"Line":4},"fn_name":null},{"line":80,"address":[4503525,4502907,4504417,4502532,4502368,4502006,4502823,4503364,4504333,4503744],"length":1,"stats":{"Line":10},"fn_name":null},{"line":82,"address":[4503322,4505033],"length":1,"stats":{"Line":4},"fn_name":null},{"line":83,"address":[4505770,4506145,4507673,4506061,4507000,4507589,4506781,4506620,4505244,4505606],"length":1,"stats":{"Line":10},"fn_name":null},{"line":85,"address":[4506556],"length":1,"stats":{"Line":2},"fn_name":null},{"line":86,"address":[4506571,4508592,4508499,4508390,4506610],"length":1,"stats":{"Line":10},"fn_name":null},{"line":87,"address":[4506578,4508293,4508534,4500610,4500525,4508423],"length":1,"stats":{"Line":12},"fn_name":null},{"line":88,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":89,"address":[4508630],"length":1,"stats":{"Line":2},"fn_name":null},{"line":92,"address":[4508637,4508709,4508796],"length":1,"stats":{"Line":6},"fn_name":null},{"line":93,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":94,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":95,"address":[4508811,4508736],"length":1,"stats":{"Line":4},"fn_name":null},{"line":97,"address":[4508965,4508826],"length":1,"stats":{"Line":4},"fn_name":null},{"line":98,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":99,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":100,"address":[4508980,4508882],"length":1,"stats":{"Line":4},"fn_name":null},{"line":102,"address":[4508995],"length":1,"stats":{"Line":2},"fn_name":null},{"line":103,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":104,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":106,"address":[4510265,4500543,4509094],"length":1,"stats":{"Line":3},"fn_name":null},{"line":108,"address":[4509974],"length":1,"stats":{"Line":2},"fn_name":null}],"covered":28,"coverable":47},{"path":["/","home","runner","work","throwaway","throwaway","src","middleware","version_header.rs"],"content":"use axum::body::Body;\nuse axum::http::{HeaderValue, Request};\nuse axum::response::IntoResponse;\nuse axum_extra::middleware::Next;\n\nuse crate::VERSION;\n\npub async fn version_header_middleware(request: Request\u003cBody\u003e, next: Next\u003cBody\u003e) -\u003e impl IntoResponse {\n    let mut response = next.run(request).await;\n\n    response\n        .headers_mut()\n        .insert(\"X-Version\", HeaderValue::from_static(VERSION));\n\n    response\n}\n","traces":[{"line":8,"address":[4107275,4107232],"length":1,"stats":{"Line":0},"fn_name":"version_header_middleware"},{"line":9,"address":[5437505],"length":1,"stats":{"Line":0},"fn_name":null},{"line":11,"address":[5702952,5702854],"length":1,"stats":{"Line":0},"fn_name":null},{"line":13,"address":[5702955,5702889],"length":1,"stats":{"Line":0},"fn_name":null},{"line":15,"address":[5702974],"length":1,"stats":{"Line":0},"fn_name":null}],"covered":0,"coverable":5},{"path":["/","home","runner","work","throwaway","throwaway","src","models","claims.rs"],"content":"use serde::{Deserialize, Serialize};\nuse uuid::Uuid;\n\nuse crate::attributes::core::Attributes;\n\npub const ISS: \u0026str = \"throwaway\";\n\n/// \u003chttps://www.iana.org/assignments/jwt/jwt.xhtml#claims\u003e\n#[derive(Clone, Debug, Serialize, Deserialize)]\npub struct Claims {\n    // Issuer\n    pub iss: String,\n\n    // Expiration Time\n    pub exp: i64,\n\n    // Issued At\n    pub iat: i64,\n\n    // Subject\n    pub sub: Uuid,\n\n    // Attributes\n    #[serde(skip_serializing_if = \"Option::is_none\")]\n    pub attributes: Option\u003cAttributes\u003e,\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","models","database","mod.rs"],"content":"pub mod profile;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","models","database","profile.rs"],"content":"use chrono::{DateTime, Utc};\nuse redis::{FromRedisValue, RedisResult, RedisWrite, ToRedisArgs, Value};\nuse serde::{Deserialize, Serialize};\nuse serde_json;\nuse sqlx::FromRow;\nuse uuid::Uuid;\n\nuse crate::models::public::profile::ProfilePublic;\n\n#[derive(Clone, Debug, Serialize, Deserialize, FromRow)]\npub struct Profile {\n    pub profile_id: Uuid,\n    pub name: String,\n    pub email: String,\n    pub password: String,\n    pub country: String,\n    pub timezone: String,\n    pub created_at: DateTime\u003cUtc\u003e,\n    pub updated_at: DateTime\u003cUtc\u003e,\n    pub is_deleted: bool,\n}\n\n// FIXME: Perhaps better ot support .into() style access? How do we do that, use From\u003cT\u003e ?\nimpl Profile {\n    pub fn to_public(\u0026self) -\u003e ProfilePublic {\n        ProfilePublic {\n            name: self.name.clone(),\n            email: self.email.clone(),\n            country: self.country.clone(),\n            timezone: self.timezone.clone(),\n        }\n    }\n}\n\nimpl ToRedisArgs for \u0026Profile {\n    fn write_redis_args\u003cW\u003e(\u0026self, output: \u0026mut W)\n    where\n        W: ?Sized + RedisWrite,\n    {\n        output.write_arg_fmt(serde_json::to_string(self).unwrap());\n    }\n}\n\nimpl FromRedisValue for Profile {\n    fn from_redis_value(value: \u0026Value) -\u003e RedisResult\u003cSelf\u003e {\n        match *value {\n            redis::Value::Data(ref value_slice) =\u003e {\n                match serde_json::from_slice(value_slice) {\n                    Err(_) =\u003e Err((redis::ErrorKind::TypeError, \"Can't serialize value\").into()),\n                    Ok(profile) =\u003e Ok(profile),\n                }\n            }\n            _ =\u003e Err((redis::ErrorKind::ResponseError, \"Response type not Profile compatible.\").into()),\n        }\n    }\n}\n","traces":[{"line":25,"address":[4959424,4959782],"length":1,"stats":{"Line":1},"fn_name":"to_public"},{"line":27,"address":[4959454],"length":1,"stats":{"Line":1},"fn_name":null},{"line":28,"address":[8812734],"length":1,"stats":{"Line":1},"fn_name":null},{"line":29,"address":[4959536],"length":1,"stats":{"Line":1},"fn_name":null},{"line":30,"address":[8829599],"length":1,"stats":{"Line":1},"fn_name":null},{"line":36,"address":[4959808,4959888],"length":1,"stats":{"Line":3},"fn_name":"write_redis_args\u003calloc::vec::Vec\u003calloc::vec::Vec\u003cu8, alloc::alloc::Global\u003e, alloc::alloc::Global\u003e\u003e"},{"line":40,"address":[8813177,8813097],"length":1,"stats":{"Line":3},"fn_name":null},{"line":45,"address":[4960409,4960436,4959968],"length":1,"stats":{"Line":2},"fn_name":"from_redis_value"},{"line":46,"address":[4959998],"length":1,"stats":{"Line":2},"fn_name":null},{"line":47,"address":[4960009],"length":1,"stats":{"Line":2},"fn_name":null},{"line":48,"address":[8837900,8837765],"length":1,"stats":{"Line":4},"fn_name":null},{"line":49,"address":[4960373,4960278],"length":1,"stats":{"Line":0},"fn_name":null},{"line":50,"address":[4960181],"length":1,"stats":{"Line":2},"fn_name":null},{"line":53,"address":[4960038],"length":1,"stats":{"Line":0},"fn_name":null}],"covered":12,"coverable":14},{"path":["/","home","runner","work","throwaway","throwaway","src","models","mod.rs"],"content":"pub mod claims;\npub mod database;\npub mod public;\npub mod request;\npub mod response;\npub mod secrets;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","models","public","mod.rs"],"content":"pub mod profile;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","models","public","profile.rs"],"content":"use serde::Serialize;\n\n#[derive(Serialize, Debug)]\npub struct ProfilePublic {\n    pub name: String,\n    pub email: String,\n    pub country: String,\n    pub timezone: String,\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","models","request","mod.rs"],"content":"pub mod profile;\npub mod register;\npub mod token;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","models","request","profile.rs"],"content":"use serde::Deserialize;\nuse validator::Validate;\n\nuse crate::validation::country::validate_country;\nuse crate::validation::email::validate_email;\nuse crate::validation::name::validate_name;\nuse crate::validation::timezone::validate_timezone;\n\n#[derive(Debug, Deserialize, Validate)]\npub struct ProfilePatchRequest {\n    #[validate(custom = \"validate_name\")]\n    pub name: Option\u003cString\u003e,\n\n    #[validate(custom = \"validate_email\")]\n    pub email: Option\u003cString\u003e,\n\n    #[validate(custom = \"validate_country\")]\n    pub country: Option\u003cString\u003e,\n\n    #[validate(custom = \"validate_timezone\")]\n    pub timezone: Option\u003cString\u003e,\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","models","request","register.rs"],"content":"use serde::Deserialize;\nuse validator::Validate;\n\nuse crate::validation::country::validate_country;\nuse crate::validation::email::validate_email;\nuse crate::validation::name::validate_name;\nuse crate::validation::password::validate_password;\nuse crate::validation::timezone::validate_timezone;\n\n#[derive(Debug, Deserialize, Validate)]\npub struct RegisterRequest {\n    #[validate(custom = \"validate_name\")]\n    pub name: String,\n\n    #[validate(custom = \"validate_email\")]\n    pub email: String,\n\n    #[validate(custom = \"validate_password\")]\n    pub password: String,\n\n    #[validate(custom = \"validate_country\")]\n    pub country: String,\n\n    #[validate(custom = \"validate_timezone\")]\n    pub timezone: String,\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","models","request","token.rs"],"content":"use serde::{Deserialize, Serialize};\nuse validator::Validate;\n\nuse crate::attributes::core::Attributes;\n\n#[derive(Debug, Deserialize, Serialize, Validate)]\npub struct TokenRequest {\n    /// FIXME: Limit options here? (10mins, 1hr, 6hrs, 12hrs, 24hrs etc. not the most user friendly...)\n    /// Maybe just 'X seconds' is good enough, but we'll need to limit max here (use validate)\n    pub lifespan: usize,\n\n    /// FIXME: How can we validate this? Will be tricky.\n    #[serde(skip_serializing_if = \"Option::is_none\")]\n    pub attributes: Option\u003cAttributes\u003e,\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","models","response","config.rs"],"content":"use serde::Serialize;\n\nuse crate::Config;\n\n#[derive(Serialize, Debug)]\npub struct ConfigResponse {\n    pub config: Config,\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","models","response","mod.rs"],"content":"pub mod config;\npub mod profile;\npub mod register;\npub mod token;\npub mod token_info;\npub mod version;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","models","response","profile.rs"],"content":"use serde::Serialize;\n\nuse crate::models::public::profile::ProfilePublic;\n\n#[derive(Serialize, Debug)]\npub struct ProfilePatchResponse {\n    pub message: String,\n    pub code: usize,\n    pub profile: Option\u003cProfilePublic\u003e,\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","models","response","register.rs"],"content":"use serde::Serialize;\nuse sqlx::types::Uuid;\n\n#[derive(Serialize, Debug)]\npub struct RegisterResponse {\n    pub profile_id: Uuid,\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","models","response","token.rs"],"content":"use serde::Serialize;\n\n#[derive(Serialize, Debug)]\npub struct TokenResponse {\n    pub token: String,\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","models","response","token_info.rs"],"content":"use serde::Serialize;\n\nuse crate::attributes::core::Attributes;\n\n#[derive(Serialize, Debug)]\npub struct TokenInfoResponse {\n    pub issued_at: String,\n    pub expires_at: String,\n    pub attributes: Option\u003cAttributes\u003e,\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","models","response","version.rs"],"content":"use serde::Serialize;\n\n#[derive(Serialize, Debug)]\npub struct VersionResponse {\n    pub version: String,\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","models","secrets","cache.rs"],"content":"use serde::{Deserialize, Serialize};\n\n#[derive(Clone, Debug, Deserialize, Serialize)]\npub struct CacheSecrets {\n    pub host: String,\n    pub port: String,\n    pub password: String,\n}\n\nimpl CacheSecrets {\n    pub fn dsn(\u0026self) -\u003e String {\n        format!(\"redis://:{}@{}:{}\", self.password, self.host, self.port)\n    }\n\n    pub fn local_dsn(\u0026self) -\u003e String {\n        format!(\"redis://:{}@{}:{}\", self.password, \"localhost\", self.port)\n    }\n}\n","traces":[{"line":11,"address":[8382864],"length":1,"stats":{"Line":0},"fn_name":"dsn"},{"line":12,"address":[4428982],"length":1,"stats":{"Line":0},"fn_name":null},{"line":15,"address":[4429200],"length":1,"stats":{"Line":5},"fn_name":"local_dsn"},{"line":16,"address":[4429238],"length":1,"stats":{"Line":5},"fn_name":null}],"covered":2,"coverable":4},{"path":["/","home","runner","work","throwaway","throwaway","src","models","secrets","database.rs"],"content":"use serde::{Deserialize, Serialize};\n\n#[derive(Clone, Debug, Deserialize, Serialize)]\npub struct DatabaseSecrets {\n    pub host: String,\n    pub port: String,\n    pub user: String,\n    pub password: String,\n    pub db: String,\n}\n\nimpl DatabaseSecrets {\n    pub fn dsn(\u0026self) -\u003e String {\n        format!(\n            \"postgresql://{}:{}@{}:{}/{}\",\n            self.user, self.password, self.host, self.port, self.db,\n        )\n    }\n\n    pub fn local_dsn(\u0026self) -\u003e String {\n        format!(\n            \"postgresql://{}:{}@{}:{}/{}\",\n            self.user, self.password, \"localhost\", self.port, self.db,\n        )\n    }\n}\n","traces":[{"line":13,"address":[8918768],"length":1,"stats":{"Line":0},"fn_name":"dsn"},{"line":14,"address":[4107399],"length":1,"stats":{"Line":0},"fn_name":null},{"line":20,"address":[4107712],"length":1,"stats":{"Line":5},"fn_name":"local_dsn"},{"line":21,"address":[4107751],"length":1,"stats":{"Line":5},"fn_name":null}],"covered":2,"coverable":4},{"path":["/","home","runner","work","throwaway","throwaway","src","models","secrets","jwt.rs"],"content":"use serde::{Deserialize, Serialize};\n\n#[derive(Clone, Debug, Deserialize, Serialize)]\npub struct JwtSecrets {\n    pub password: String,\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","models","secrets","mod.rs"],"content":"pub mod cache;\npub mod database;\npub mod jwt;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","repositories","mod.rs"],"content":"pub mod profile;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","repositories","profile.rs"],"content":"use sqlx::types::Uuid;\nuse tracing::error;\nuse tracing::instrument;\n\nuse crate::database::DatabasePool;\nuse crate::errors::core::ServerError;\nuse crate::errors::profile::ProfileError;\nuse crate::models::database::profile::Profile;\nuse crate::models::request::register::RegisterRequest;\nuse crate::Cache;\n\n#[derive(Clone)]\npub struct ProfileRepository {\n    pub database: DatabasePool,\n    pub cache: Cache,\n}\n\n// FIXME: I wonder if splitting this into SQL v Cache repos (?) would be nicer?\nimpl ProfileRepository {\n    #[must_use]\n    pub const fn new(database: DatabasePool, cache: Cache) -\u003e Self {\n        Self {\n            database,\n            cache,\n        }\n    }\n\n    // FIXME: Probably shouldn't pass in request object directly, pass in parts instead.\n    #[instrument(skip(self), level = \"info\")]\n    pub async fn insert(\u0026self, register_request: RegisterRequest) -\u003e Result\u003cUuid, ServerError\u003e {\n        // language=sql\n        let query = sqlx::query!(\n            r#\"\n            INSERT INTO throwaway.profile (name, email, password, country, timezone)\n            VALUES ($1, $2, $3, $4, $5)\n            RETURNING (profile_id)\n            \"#,\n            register_request.name,\n            register_request.email,\n            register_request.password,\n            register_request.country,\n            register_request.timezone,\n        );\n\n        return match query.fetch_one(\u0026self.database).await {\n            Ok(output) =\u003e Ok(output.profile_id),\n            Err(error) =\u003e {\n                // Tracing instead? Then we don't need to log out parameters every time\n                error!(\"Could not insert Profile: {error:#?}\");\n                Err(ProfileError::NotFound.into())\n            }\n        };\n    }\n\n    #[instrument(skip(self), level = \"info\")]\n    pub async fn exists(\u0026self, email: \u0026str) -\u003e Result\u003cbool, ServerError\u003e {\n        if self.cache_exists_by_email(email).await {\n            return Ok(true);\n        }\n\n        // language=sql\n        let query = sqlx::query!(\n            r#\"\n            SELECT EXISTS(\n                SELECT 1\n                FROM throwaway.profile\n                WHERE email = $1\n            )\n            \"#,\n            email,\n        );\n\n        return match query.fetch_one(\u0026self.database).await {\n            Ok(output) =\u003e {\n                let exists: bool = output.exists.unwrap();\n                Ok(exists)\n            }\n            Err(error) =\u003e {\n                error!(\"Could not find existing Profile by email: {error:#?}\");\n                Err(ProfileError::NotFound.into())\n            }\n        };\n    }\n\n    #[instrument(skip(self), level = \"info\")]\n    pub async fn get_by_email(\u0026self, email: \u0026str) -\u003e Result\u003cProfile, ServerError\u003e {\n        if let Some(profile) = self.cache_get_by_email(email).await {\n            return Ok(profile);\n        }\n\n        // language=sql\n        let query = sqlx::query_as!(\n            Profile,\n            r#\"\n            SELECT profile_id, name, email, password, country, timezone, created_at, updated_at, is_deleted\n            FROM throwaway.profile\n            WHERE email = $1\n            \"#,\n            email,\n        );\n\n        return match query.fetch_one(\u0026self.database).await {\n            Ok(profile) =\u003e {\n                self.cache_set(profile.clone()).await;\n                Ok(profile)\n            }\n            Err(error) =\u003e {\n                error!(\"Could not find Profile by email: {error:#?}\");\n                Err(ProfileError::NotFound.into())\n            }\n        };\n    }\n\n    #[instrument(skip(self), level = \"info\")]\n    pub async fn get_by_profile_id(\u0026self, profile_id: Uuid) -\u003e Result\u003cProfile, ServerError\u003e {\n        if let Some(profile) = self.cache_get_by_id(profile_id).await {\n            return Ok(profile);\n        }\n\n        // language=sql\n        let query = sqlx::query_as!(\n            Profile,\n            r#\"\n            SELECT profile_id, name, email, password, country, timezone, created_at, updated_at, is_deleted\n            FROM throwaway.profile\n            WHERE profile_id = $1\n            \"#,\n            profile_id,\n        );\n\n        return match query.fetch_one(\u0026self.database).await {\n            Ok(profile) =\u003e {\n                self.cache_set(profile.clone()).await;\n                Ok(profile)\n            }\n            Err(error) =\u003e {\n                error!(\"Could not find Profile by ID: {error:#?}\");\n                Err(ProfileError::NotFound.into())\n            }\n        };\n    }\n\n    #[instrument(skip(self), level = \"info\")]\n    pub async fn update(\u0026self, profile: Profile) -\u003e Result\u003c(), ServerError\u003e {\n        // language=sql\n        let query = sqlx::query!(\n            r#\"\n            UPDATE throwaway.profile\n            SET\n                name = $1,\n                email = $2,\n                password = $3,\n                country = $4,\n                timezone = $5\n            WHERE profile_id = $6\n            \"#,\n            profile.name,\n            profile.email,\n            profile.password,\n            profile.country,\n            profile.timezone,\n            profile.profile_id,\n        );\n\n        return match query.execute(\u0026self.database).await {\n            Ok(_) =\u003e Ok(()),\n            Err(error) =\u003e {\n                // FIXME: Do we log out here or at the \"error\" mapping level?\n                error!(\"Failed to update Profile: {error:#?}\");\n                Err(ProfileError::UpdateFailure.into())\n            }\n        };\n    }\n\n    #[instrument(skip(self), level = \"info\")]\n    pub async fn update_name(\u0026self, profile_id: Uuid, name: String) -\u003e Result\u003c(), ServerError\u003e {\n        // language=sql\n        let query = sqlx::query!(\n            r#\"\n            UPDATE throwaway.profile\n            SET name = $1\n            WHERE profile_id = $2\n            \"#,\n            name,\n            profile_id,\n        );\n\n        return match query.execute(\u0026self.database).await {\n            Ok(_) =\u003e Ok(()),\n            Err(error) =\u003e {\n                error!(\"Failed to update Profile name: {error:#?}\");\n                Err(ProfileError::UpdateFailure.into())\n            }\n        };\n    }\n\n    #[instrument(skip(self), level = \"info\")]\n    pub async fn update_email(\u0026self, profile_id: Uuid, email: String) -\u003e Result\u003c(), ServerError\u003e {\n        // language=sql\n        let query = sqlx::query!(\n            r#\"\n            UPDATE throwaway.profile\n            SET email = $1\n            WHERE profile_id = $2\n            \"#,\n            email,\n            profile_id,\n        );\n\n        return match query.execute(\u0026self.database).await {\n            Ok(_) =\u003e Ok(()),\n            Err(error) =\u003e {\n                error!(\"Failed to update Profile email: {error:#?}\");\n                Err(ProfileError::UpdateFailure.into())\n            }\n        };\n    }\n\n    // NOTE: Seems like we shouldn't invalidate caches at all, simply update? Might no scale quite as well...\n    pub async fn cache_set(\u0026self, profile: Profile) {\n        let cache_key_email = Self::cache_key_email(\u0026profile.email);\n        self.cache\n            .set(\u0026cache_key_email, \u0026profile, 600)\n            .await;\n\n        let cache_key_id = Self::cache_key_id(profile.profile_id);\n        self.cache\n            .set(\u0026cache_key_id, \u0026profile, 600)\n            .await;\n    }\n\n    pub async fn cache_get_by_id(\u0026self, profile_id: Uuid) -\u003e Option\u003cProfile\u003e {\n        let cache_key = Self::cache_key_id(profile_id);\n        self.cache.get(\u0026cache_key).await\n    }\n\n    // FIXME: Why do we need email again? For JWT lookups, why not just store Uuid in JWT and call it a day?\n    // FIXME: The \"best practices\" i followed seemed to stick with email as the claim in use for identification.\n    pub async fn cache_get_by_email(\u0026self, email: \u0026str) -\u003e Option\u003cProfile\u003e {\n        let cache_key = Self::cache_key_email(email);\n        self.cache.get(\u0026cache_key).await\n    }\n\n    pub async fn cache_exists_by_email(\u0026self, email: \u0026str) -\u003e bool {\n        let cache_key = Self::cache_key_email(email);\n        self.cache.exists(\u0026cache_key).await\n    }\n\n    pub fn cache_key_id(profile_id: Uuid) -\u003e String {\n        format!(\"profile_id_{profile_id}\")\n    }\n\n    pub fn cache_key_email(email: \u0026str) -\u003e String {\n        format!(\"profile_email_{email}\")\n    }\n}\n","traces":[{"line":21,"address":[4115296],"length":1,"stats":{"Line":5},"fn_name":"new"},{"line":29,"address":[4122054,4120484,4120544,4123043,4120993,4120861,4121282,4121808,4122928,4122679,4121036,4123502,4120605,4121644,4122971],"length":1,"stats":{"Line":30},"fn_name":"{async_fn#0}"},{"line":30,"address":[4125452,4120448,4131931,4125369,4120670,4125181,4122452,4125120,4125867],"length":1,"stats":{"Line":15},"fn_name":"insert"},{"line":32,"address":[4126831,4127149,4125246],"length":1,"stats":{"Line":9},"fn_name":null},{"line":38,"address":[4125602,4125543,4125354],"length":1,"stats":{"Line":3},"fn_name":null},{"line":39,"address":[4125909,4125512],"length":1,"stats":{"Line":3},"fn_name":null},{"line":40,"address":[4126224,4125878],"length":1,"stats":{"Line":3},"fn_name":null},{"line":41,"address":[4126193,4126539],"length":1,"stats":{"Line":3},"fn_name":null},{"line":42,"address":[4126508,4126857],"length":1,"stats":{"Line":3},"fn_name":null},{"line":45,"address":[4128085,4125393,4128005],"length":1,"stats":{"Line":9},"fn_name":null},{"line":46,"address":[4128458],"length":1,"stats":{"Line":3},"fn_name":null},{"line":47,"address":[4128567],"length":1,"stats":{"Line":0},"fn_name":null},{"line":49,"address":[4129577,4129286,4130504,4130124,4131063,4128760,4129122,4129661,4130285,4131135],"length":1,"stats":{"Line":0},"fn_name":null},{"line":50,"address":[4131675,4130090],"length":1,"stats":{"Line":0},"fn_name":null},{"line":55,"address":[4134094,4134269,4135923,4136440,4133855,4135674,4135966,4135033,4134226,4134875,4133920,4136038,4133989,4135255,4134513],"length":1,"stats":{"Line":30},"fn_name":"{async_fn#0}"},{"line":56,"address":[4134051,4137680,4135608,4137996,4138298,4133808,4137749,4137840],"length":1,"stats":{"Line":15},"fn_name":"exists"},{"line":57,"address":[4137953,4137870,4138309,4137811,4138121],"length":1,"stats":{"Line":12},"fn_name":null},{"line":58,"address":[4138436],"length":1,"stats":{"Line":0},"fn_name":null},{"line":62,"address":[4138408,4138828,4138511],"length":1,"stats":{"Line":9},"fn_name":null},{"line":70,"address":[4138529,4138428],"length":1,"stats":{"Line":3},"fn_name":null},{"line":73,"address":[4139295,4139216,4137888],"length":1,"stats":{"Line":9},"fn_name":null},{"line":74,"address":[4139667],"length":1,"stats":{"Line":3},"fn_name":null},{"line":75,"address":[4143037,4139677,4139659],"length":1,"stats":{"Line":9},"fn_name":null},{"line":76,"address":[4143049],"length":1,"stats":{"Line":3},"fn_name":null},{"line":78,"address":[4139705],"length":1,"stats":{"Line":0},"fn_name":null},{"line":79,"address":[4140260,4141262,4142231,4139898,4140424,4142315,4140799,4141423,4141642,4140715],"length":1,"stats":{"Line":0},"fn_name":null},{"line":80,"address":[4141228,4142891],"length":1,"stats":{"Line":0},"fn_name":null},{"line":85,"address":[4146678,4146362,4146629,4145153,4146762,4147170,4144501,4145515,4145925,4145679,4144560,4144909,4144734,4144629,4144866],"length":1,"stats":{"Line":30},"fn_name":"{async_fn#0}"},{"line":86,"address":[4148371,4148601,4148208,4144691,4144448,4146296,4148277,4148896],"length":1,"stats":{"Line":15},"fn_name":"get_by_email"},{"line":87,"address":[4148907,4148558,4148342,4148729,4148401],"length":1,"stats":{"Line":12},"fn_name":null},{"line":88,"address":[4149118],"length":1,"stats":{"Line":0},"fn_name":null},{"line":92,"address":[4149248,4149214,4149565],"length":1,"stats":{"Line":9},"fn_name":null},{"line":99,"address":[4149234,4149266],"length":1,"stats":{"Line":3},"fn_name":null},{"line":102,"address":[4150032,4149953,4148422,4148507],"length":1,"stats":{"Line":12},"fn_name":null},{"line":103,"address":[4150389],"length":1,"stats":{"Line":3},"fn_name":null},{"line":104,"address":[4153883,4150441,4148440],"length":1,"stats":{"Line":9},"fn_name":null},{"line":105,"address":[4154158],"length":1,"stats":{"Line":3},"fn_name":null},{"line":107,"address":[4150478],"length":1,"stats":{"Line":0},"fn_name":null},{"line":108,"address":[4152031,4152192,4151029,4153084,4153000,4152411,4150667,4151568,4151193,4151484],"length":1,"stats":{"Line":0},"fn_name":null},{"line":109,"address":[4151997,4153672],"length":1,"stats":{"Line":0},"fn_name":null},{"line":114,"address":[4160055,4161165,4159285,4161612,4159013,4158944,4158869,4159891,4159242,4161081,4159529,4159110,4160301,4161032,4160765],"length":1,"stats":{"Line":20},"fn_name":"{async_fn#0}"},{"line":115,"address":[4160711,4163048,4159075,4163343,4162640,4162709,4162818,4158832],"length":1,"stats":{"Line":10},"fn_name":"get_by_profile_id"},{"line":116,"address":[4163176,4163005,4162774,4163354,4162848],"length":1,"stats":{"Line":8},"fn_name":null},{"line":117,"address":[4163565],"length":1,"stats":{"Line":2},"fn_name":null},{"line":121,"address":[4163697,4163910,4163661],"length":1,"stats":{"Line":0},"fn_name":null},{"line":128,"address":[4163723,4163683],"length":1,"stats":{"Line":0},"fn_name":null},{"line":131,"address":[4162954,4162869,4164377,4164298],"length":1,"stats":{"Line":0},"fn_name":null},{"line":132,"address":[4164734],"length":1,"stats":{"Line":0},"fn_name":null},{"line":133,"address":[4164786,4162887,4168192],"length":1,"stats":{"Line":0},"fn_name":null},{"line":134,"address":[4168455],"length":1,"stats":{"Line":0},"fn_name":null},{"line":136,"address":[4164823],"length":1,"stats":{"Line":0},"fn_name":null},{"line":137,"address":[4167345,4165012,4166537,4166756,4165913,4165829,4166376,4167429,4165374,4165538],"length":1,"stats":{"Line":0},"fn_name":null},{"line":138,"address":[4167981,4166342],"length":1,"stats":{"Line":0},"fn_name":null},{"line":143,"address":[4173174],"length":1,"stats":{"Line":0},"fn_name":null},{"line":144,"address":[4173136],"length":1,"stats":{"Line":0},"fn_name":"update"},{"line":175,"address":[4173536,4174723,4173668,4175794,4175679,4173271,4175430,4173711,4174313,4173415,4173951,4176450,4175722,4174477,4173360],"length":1,"stats":{"Line":10},"fn_name":"{async_fn#0}"},{"line":176,"address":[4177751,4178368,4182811,4177953,4173477,4177872,4177696,4175348,4173248],"length":1,"stats":{"Line":5},"fn_name":"update_name"},{"line":178,"address":[4178601,4177816,4178387],"length":1,"stats":{"Line":3},"fn_name":null},{"line":184,"address":[4178044,4178103,4177857],"length":1,"stats":{"Line":1},"fn_name":null},{"line":185,"address":[4178013,4178413],"length":1,"stats":{"Line":1},"fn_name":null},{"line":188,"address":[4177896,4179083,4179163],"length":1,"stats":{"Line":3},"fn_name":null},{"line":189,"address":[4179537],"length":1,"stats":{"Line":1},"fn_name":null},{"line":190,"address":[4179550],"length":1,"stats":{"Line":0},"fn_name":null},{"line":191,"address":[4180105,4181107,4179743,4180644,4182118,4180560,4180269,4181487,4182046,4181268],"length":1,"stats":{"Line":0},"fn_name":null},{"line":192,"address":[4181073,4182658],"length":1,"stats":{"Line":0},"fn_name":null},{"line":197,"address":[4183872,4186191,4184048,4184825,4183927,4185235,4184180,4186306,4185942,4183783,4186962,4184223,4184463,4186234,4184989],"length":1,"stats":{"Line":0},"fn_name":"{async_fn#0}"},{"line":198,"address":[4185860,4193323,4188465,4188208,4188880,4188263,4183989,4188384,4183760],"length":1,"stats":{"Line":0},"fn_name":"update_email"},{"line":200,"address":[4188328,4189113,4188899],"length":1,"stats":{"Line":0},"fn_name":null},{"line":206,"address":[4188556,4188369,4188615],"length":1,"stats":{"Line":0},"fn_name":null},{"line":207,"address":[4188525,4188925],"length":1,"stats":{"Line":0},"fn_name":null},{"line":210,"address":[4189675,4189595,4188408],"length":1,"stats":{"Line":0},"fn_name":null},{"line":211,"address":[4190049],"length":1,"stats":{"Line":0},"fn_name":null},{"line":212,"address":[4190062],"length":1,"stats":{"Line":0},"fn_name":null},{"line":213,"address":[4190781,4190255,4191156,4192558,4191072,4191780,4191999,4190617,4192630,4191619],"length":1,"stats":{"Line":0},"fn_name":null},{"line":214,"address":[4191585,4193170],"length":1,"stats":{"Line":0},"fn_name":null},{"line":220,"address":[4116317,4115456,4115811,4115344,4115653,4116910,4115509,4115390],"length":1,"stats":{"Line":15},"fn_name":"cache_set"},{"line":221,"address":[4115620,4115942],"length":1,"stats":{"Line":6},"fn_name":null},{"line":222,"address":[4116240,4116117,4115964],"length":1,"stats":{"Line":9},"fn_name":null},{"line":223,"address":[4115768,4115983,4116271,4115683,4116328,4116140,4116096],"length":1,"stats":{"Line":18},"fn_name":null},{"line":226,"address":[4116400],"length":1,"stats":{"Line":3},"fn_name":null},{"line":227,"address":[4116721,4116445,4116598],"length":1,"stats":{"Line":9},"fn_name":null},{"line":228,"address":[4116577,4116621,4116464,4115701,4116746],"length":1,"stats":{"Line":15},"fn_name":null},{"line":232,"address":[4117120,4117024,4117724,4117055,4117410,4117333,4117189],"length":1,"stats":{"Line":8},"fn_name":"cache_get_by_id"},{"line":233,"address":[4117292],"length":1,"stats":{"Line":2},"fn_name":null},{"line":234,"address":[4117538,4117357,4117663,4117876,4117743],"length":1,"stats":{"Line":6},"fn_name":null},{"line":239,"address":[4118417,4118763,4118128,4118240,4118175,4118485,4118297],"length":1,"stats":{"Line":12},"fn_name":"cache_get_by_email"},{"line":240,"address":[4118400],"length":1,"stats":{"Line":3},"fn_name":null},{"line":241,"address":[4118779,4118604,4118900,4118705,4118438],"length":1,"stats":{"Line":9},"fn_name":null},{"line":244,"address":[4119120,4119279,4119467,4119167,4119745,4119232,4119399],"length":1,"stats":{"Line":12},"fn_name":"cache_exists_by_email"},{"line":245,"address":[4119382],"length":1,"stats":{"Line":3},"fn_name":null},{"line":246,"address":[4119761,4119687,4119586,4119889,4119420],"length":1,"stats":{"Line":9},"fn_name":null},{"line":249,"address":[4120032],"length":1,"stats":{"Line":3},"fn_name":"cache_key_id"},{"line":250,"address":[4120057],"length":1,"stats":{"Line":3},"fn_name":null},{"line":253,"address":[4120160],"length":1,"stats":{"Line":3},"fn_name":"cache_key_email"},{"line":254,"address":[4120184],"length":1,"stats":{"Line":3},"fn_name":null}],"covered":60,"coverable":95},{"path":["/","home","runner","work","throwaway","throwaway","src","services","mod.rs"],"content":"pub mod password;\npub mod profile;\npub mod token;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","services","password.rs"],"content":"use argon2::password_hash::SaltString;\nuse argon2::{Argon2, PasswordHash, PasswordHasher, PasswordVerifier};\nuse rand_core::OsRng;\n\nuse crate::errors::core::ServerError;\n\n#[derive(Clone)]\npub struct PasswordService {\n    argon2: Argon2\u003c'static\u003e,\n}\n\nimpl PasswordService {\n    #[must_use]\n    pub fn new() -\u003e Self {\n        Self {\n            argon2: Argon2::default(),\n        }\n    }\n\n    pub async fn hash(\u0026self, password: \u0026str) -\u003e Result\u003cString, ServerError\u003e {\n        let salt = SaltString::generate(OsRng);\n\n        let password_hash = self\n            .argon2\n            .hash_password(password.as_bytes(), \u0026salt);\n\n        match password_hash {\n            Ok(password) =\u003e Ok(password.to_string()),\n            Err(err) =\u003e Err(ServerError::ArgonPasswordError(err)),\n        }\n    }\n\n    pub async fn verify(\u0026self, password: \u0026str, password_hash: \u0026str) -\u003e Result\u003cbool, ServerError\u003e {\n        let parsed_hash = PasswordHash::new(password_hash)?;\n\n        let verified = self\n            .argon2\n            .verify_password(password.as_bytes(), \u0026parsed_hash)\n            .is_ok();\n\n        Ok(verified)\n    }\n}\n\nimpl Default for PasswordService {\n    fn default() -\u003e Self {\n        Self::new()\n    }\n}\n","traces":[{"line":14,"address":[4052240],"length":1,"stats":{"Line":5},"fn_name":"new"},{"line":16,"address":[4052257],"length":1,"stats":{"Line":5},"fn_name":null},{"line":20,"address":[7903456,7903579,7903692,7903483,7903536],"length":1,"stats":{"Line":12},"fn_name":"hash"},{"line":21,"address":[4052529],"length":1,"stats":{"Line":3},"fn_name":null},{"line":23,"address":[7920641],"length":1,"stats":{"Line":3},"fn_name":null},{"line":27,"address":[4052769],"length":1,"stats":{"Line":3},"fn_name":null},{"line":28,"address":[7903947,7904152],"length":1,"stats":{"Line":6},"fn_name":null},{"line":29,"address":[4052849],"length":1,"stats":{"Line":0},"fn_name":null},{"line":33,"address":[4053195,4053341,4053152,4053093,4053056],"length":1,"stats":{"Line":12},"fn_name":"verify"},{"line":34,"address":[4053659,4053461,4053322],"length":1,"stats":{"Line":6},"fn_name":null},{"line":36,"address":[7929435],"length":1,"stats":{"Line":3},"fn_name":null},{"line":41,"address":[4053867],"length":1,"stats":{"Line":3},"fn_name":null},{"line":46,"address":[4053904],"length":1,"stats":{"Line":0},"fn_name":"default"},{"line":47,"address":[4053912],"length":1,"stats":{"Line":0},"fn_name":null}],"covered":11,"coverable":14},{"path":["/","home","runner","work","throwaway","throwaway","src","services","profile.rs"],"content":"use sqlx::types::Uuid;\n\nuse crate::errors::core::ServerError;\nuse crate::errors::profile::ProfileError;\nuse crate::models::database::profile::Profile;\nuse crate::models::request::register::RegisterRequest;\nuse crate::repositories::profile::ProfileRepository;\nuse crate::services::password::PasswordService;\n\n#[derive(Clone)]\npub struct ProfileService {\n    password_service: PasswordService,\n    profile_repository: ProfileRepository,\n}\n\nimpl ProfileService {\n    #[must_use]\n    pub const fn new(password_service: PasswordService, profile_repository: ProfileRepository) -\u003e Self {\n        Self {\n            password_service,\n            profile_repository,\n        }\n    }\n\n    pub async fn create(\u0026self, mut register_request: RegisterRequest) -\u003e Result\u003cUuid, ServerError\u003e {\n        let profile_exists = self\n            .profile_repository\n            .exists(\u0026register_request.email)\n            .await?;\n\n        if profile_exists {\n            return Err(ProfileError::Exists.into());\n        }\n\n        let password_hash = self\n            .password_service\n            .hash(\u0026register_request.password.clone())\n            .await?;\n\n        register_request.password = password_hash;\n\n        let profile_id = self\n            .profile_repository\n            .insert(register_request)\n            .await?;\n\n        Ok(profile_id)\n    }\n\n    // FIXME: Read vs Get?\n    pub async fn read(\u0026self, profile_id: Uuid) -\u003e Result\u003cProfile, ServerError\u003e {\n        let profile = self\n            .profile_repository\n            .get_by_profile_id(profile_id)\n            .await?;\n\n        Ok(profile)\n    }\n\n    pub async fn update(\u0026self, profile: Profile) -\u003e Result\u003c(), ServerError\u003e {\n        self.profile_repository\n            .update(profile)\n            .await?;\n\n        Ok(())\n    }\n\n    pub async fn update_name(\u0026self, profile_id: Uuid, name: String) -\u003e Result\u003cProfile, ServerError\u003e {\n        let mut profile: Profile = self.read(profile_id).await?;\n        if name == profile.name {\n            return Err(ProfileError::NameSet.into());\n        }\n\n        profile.name = name.clone();\n        self.profile_repository\n            .update_name(profile_id, name)\n            .await?;\n\n        Ok(profile)\n    }\n\n    pub async fn update_email(\u0026self, profile_id: Uuid, email: String) -\u003e Result\u003cProfile, ServerError\u003e {\n        let mut profile: Profile = self.read(profile_id).await?;\n        if email == profile.email {\n            return Err(ProfileError::EmailSet.into());\n        }\n\n        profile.name = email.clone();\n        self.profile_repository\n            .update_email(profile_id, email)\n            .await?;\n\n        Ok(profile)\n    }\n\n    pub async fn verify_credentials(\u0026self, email: \u0026str, password: \u0026str) -\u003e Result\u003c(bool, Profile), ServerError\u003e {\n        let profile = self\n            .profile_repository\n            .get_by_email(email)\n            .await?;\n\n        let valid = self\n            .password_service\n            .verify(password, \u0026profile.password)\n            .await?;\n\n        Ok((valid, profile))\n    }\n}\n","traces":[{"line":18,"address":[4960480],"length":1,"stats":{"Line":5},"fn_name":"new"},{"line":25,"address":[4730767,4730683],"length":1,"stats":{"Line":15},"fn_name":null},{"line":26,"address":[4961403,4961608,4961526,4961869,4960987,4962098],"length":1,"stats":{"Line":15},"fn_name":null},{"line":28,"address":[4730722],"length":1,"stats":{"Line":18},"fn_name":null},{"line":29,"address":[4961938,4962128],"length":1,"stats":{"Line":0},"fn_name":null},{"line":31,"address":[4961925],"length":1,"stats":{"Line":3},"fn_name":null},{"line":32,"address":[4962231],"length":1,"stats":{"Line":0},"fn_name":null},{"line":35,"address":[4962450,4962191,4963160,4962881,4962627,4962561],"length":1,"stats":{"Line":15},"fn_name":null},{"line":37,"address":[4961090,4961175,4962591,4962473,4962866,4962203,4962355],"length":1,"stats":{"Line":15},"fn_name":null},{"line":38,"address":[4730634],"length":1,"stats":{"Line":3},"fn_name":null},{"line":40,"address":[4963471,4963319],"length":1,"stats":{"Line":6},"fn_name":null},{"line":42,"address":[4963866,4963508,4964485,4963792,4964127,4963669],"length":1,"stats":{"Line":15},"fn_name":null},{"line":44,"address":[4730561],"length":1,"stats":{"Line":15},"fn_name":null},{"line":45,"address":[4964515,4964325],"length":1,"stats":{"Line":0},"fn_name":null},{"line":47,"address":[4964227],"length":1,"stats":{"Line":3},"fn_name":null},{"line":51,"address":[4965536,4965593,4965716,4966558,4965424,4966336,4965461,4966047,4965784],"length":1,"stats":{"Line":10},"fn_name":"read"},{"line":52,"address":[4966192,4966501,4965706,4966103,4965986,4965673],"length":1,"stats":{"Line":10},"fn_name":null},{"line":54,"address":[4730044],"length":1,"stats":{"Line":10},"fn_name":null},{"line":55,"address":[4966531,4966341],"length":1,"stats":{"Line":0},"fn_name":null},{"line":57,"address":[4966271],"length":1,"stats":{"Line":2},"fn_name":null},{"line":60,"address":[4966644,4966608],"length":1,"stats":{"Line":0},"fn_name":"update"},{"line":68,"address":[4732730],"length":1,"stats":{"Line":5},"fn_name":null},{"line":69,"address":[4732688],"length":1,"stats":{"Line":4},"fn_name":null},{"line":70,"address":[4968057,4967749],"length":1,"stats":{"Line":2},"fn_name":null},{"line":71,"address":[4968094],"length":1,"stats":{"Line":0},"fn_name":null},{"line":74,"address":[4968071,4968197],"length":1,"stats":{"Line":2},"fn_name":null},{"line":75,"address":[4968315,4968581,4968387,4969090,4968510,4968811],"length":1,"stats":{"Line":5},"fn_name":null},{"line":76,"address":[4968540,4968410,4968323,4967093,4968741],"length":1,"stats":{"Line":5},"fn_name":null},{"line":77,"address":[4969120,4968930],"length":1,"stats":{"Line":0},"fn_name":null},{"line":79,"address":[4968849],"length":1,"stats":{"Line":1},"fn_name":null},{"line":82,"address":[4733274],"length":1,"stats":{"Line":0},"fn_name":null},{"line":83,"address":[4733232],"length":1,"stats":{"Line":0},"fn_name":null},{"line":84,"address":[4970363,4970678],"length":1,"stats":{"Line":0},"fn_name":null},{"line":85,"address":[4970715],"length":1,"stats":{"Line":0},"fn_name":null},{"line":88,"address":[4970692,4970818],"length":1,"stats":{"Line":0},"fn_name":null},{"line":89,"address":[4971711,4971008,4971131,4971432,4971202,4970936],"length":1,"stats":{"Line":0},"fn_name":null},{"line":90,"address":[4733100],"length":1,"stats":{"Line":0},"fn_name":null},{"line":91,"address":[4971551,4971741],"length":1,"stats":{"Line":0},"fn_name":null},{"line":93,"address":[4971470],"length":1,"stats":{"Line":0},"fn_name":null},{"line":96,"address":[4972300,4974054,4972021,4971952,4972096,4972458,4972165,4972750],"length":1,"stats":{"Line":15},"fn_name":"verify_credentials"},{"line":97,"address":[4972926,4973281,4972680,4972815,4972274],"length":1,"stats":{"Line":12},"fn_name":null},{"line":99,"address":[4735792],"length":1,"stats":{"Line":15},"fn_name":null},{"line":100,"address":[4973121,4973311],"length":1,"stats":{"Line":0},"fn_name":null},{"line":102,"address":[4974219,4973886,4973483,4973631,4973559,4973055],"length":1,"stats":{"Line":15},"fn_name":null},{"line":104,"address":[4973598,4973506,4973067,4972348,4973870],"length":1,"stats":{"Line":9},"fn_name":null},{"line":105,"address":[4974059,4974249],"length":1,"stats":{"Line":0},"fn_name":null},{"line":107,"address":[4973947],"length":1,"stats":{"Line":3},"fn_name":null}],"covered":29,"coverable":47},{"path":["/","home","runner","work","throwaway","throwaway","src","services","token.rs"],"content":"use chrono::{DateTime, Duration, Utc};\nuse jsonwebtoken::{decode, encode, Algorithm, DecodingKey, EncodingKey, Header, Validation};\nuse uuid::Uuid;\n\nuse crate::attributes::core::Attributes;\nuse crate::errors::core::ServerError;\nuse crate::models::claims::{Claims, ISS};\nuse crate::models::secrets::jwt::JwtSecrets;\n\n#[derive(Clone)]\npub struct TokenService {\n    jwt_password: String,\n}\n\nimpl TokenService {\n    #[must_use]\n    pub fn new(jwt_secrets: \u0026JwtSecrets) -\u003e Self {\n        Self {\n            jwt_password: jwt_secrets.password.clone(),\n        }\n    }\n\n    pub fn generate(\n        \u0026self,\n        profile_id: Uuid,\n        lifespan: Duration,\n        attributes: Option\u003cAttributes\u003e,\n    ) -\u003e Result\u003cString, ServerError\u003e {\n        let now = Utc::now();\n        let expiration: DateTime\u003cUtc\u003e = now + lifespan;\n\n        let claims = Claims {\n            iss: ISS.to_string(),\n            exp: expiration.timestamp(),\n            iat: now.timestamp(),\n            sub: profile_id,\n            attributes,\n        };\n\n        let encoding_key = EncodingKey::from_secret(self.jwt_password.as_bytes());\n        let token = encode(\u0026Header::new(Algorithm::HS512), \u0026claims, \u0026encoding_key);\n\n        token.map_err(ServerError::JwtError)\n    }\n\n    pub fn decode(\u0026self, token: \u0026str) -\u003e Result\u003cClaims, ServerError\u003e {\n        let mut validation = Validation::new(Algorithm::HS512);\n        validation.set_issuer(\u0026[ISS]);\n\n        let decoding_key = DecodingKey::from_secret(self.jwt_password.as_bytes());\n        let token_data = decode::\u003cClaims\u003e(token, \u0026decoding_key, \u0026validation);\n\n        match token_data {\n            Ok(token) =\u003e Ok(token.claims),\n            Err(error) =\u003e Err(ServerError::JwtError(error)),\n        }\n    }\n}\n","traces":[{"line":17,"address":[7981136],"length":1,"stats":{"Line":5},"fn_name":"new"},{"line":19,"address":[7956675],"length":1,"stats":{"Line":5},"fn_name":null},{"line":23,"address":[7957129,7956736],"length":1,"stats":{"Line":3},"fn_name":"generate"},{"line":29,"address":[4510842],"length":1,"stats":{"Line":3},"fn_name":null},{"line":30,"address":[7981318],"length":1,"stats":{"Line":3},"fn_name":null},{"line":33,"address":[7956881],"length":1,"stats":{"Line":3},"fn_name":null},{"line":34,"address":[7981386],"length":1,"stats":{"Line":3},"fn_name":null},{"line":35,"address":[4511003],"length":1,"stats":{"Line":3},"fn_name":null},{"line":40,"address":[7981686,7981592],"length":1,"stats":{"Line":6},"fn_name":null},{"line":41,"address":[7981781,7981705],"length":1,"stats":{"Line":6},"fn_name":null},{"line":43,"address":[4511469],"length":1,"stats":{"Line":3},"fn_name":null},{"line":46,"address":[4512217,4512193,4511600],"length":1,"stats":{"Line":2},"fn_name":"decode"},{"line":47,"address":[4511656],"length":1,"stats":{"Line":2},"fn_name":null},{"line":48,"address":[4511683],"length":1,"stats":{"Line":2},"fn_name":null},{"line":50,"address":[4511753],"length":1,"stats":{"Line":2},"fn_name":null},{"line":51,"address":[4511830],"length":1,"stats":{"Line":2},"fn_name":null},{"line":53,"address":[4511881],"length":1,"stats":{"Line":2},"fn_name":null},{"line":54,"address":[4511903],"length":1,"stats":{"Line":2},"fn_name":null},{"line":55,"address":[4512081],"length":1,"stats":{"Line":0},"fn_name":null}],"covered":18,"coverable":19},{"path":["/","home","runner","work","throwaway","throwaway","src","validation","country.rs"],"content":"use tracing::error;\nuse validator::ValidationError;\n\npub fn validate_country(country: \u0026str) -\u003e Result\u003c(), ValidationError\u003e {\n    if country == \"xXxShad0wxXx\" {\n        error!(\"Invalid country: {country:#?}\");\n        return Err(ValidationError::new(\"terrible_country\"));\n    }\n\n    Ok(())\n}\n","traces":[{"line":4,"address":[4335424],"length":1,"stats":{"Line":3},"fn_name":"validate_country"},{"line":5,"address":[4335463],"length":1,"stats":{"Line":3},"fn_name":null},{"line":6,"address":[8277407,8277925,8277989,8278573,8276942,8277877,8277333,8277090,8276633,8278511],"length":1,"stats":{"Line":0},"fn_name":null},{"line":7,"address":[4336831,4338089],"length":1,"stats":{"Line":0},"fn_name":null},{"line":10,"address":[4335512],"length":1,"stats":{"Line":3},"fn_name":null}],"covered":3,"coverable":5},{"path":["/","home","runner","work","throwaway","throwaway","src","validation","email.rs"],"content":"use validator::ValidationError;\n\n// FIXME: Don't do this. Should we have static/const errors instead? Or specific ValidationError enum of errors? and use\n// #[from]\nconst MISSING_EMAIL: \u0026str = \"missing_email\";\nconst INVALID_EMAIL: \u0026str = \"invalid_email\";\nconst INVALID_EMAIL_DOMAIN: \u0026str = \"invalid_email_domain\";\n\npub fn validate_email(email: \u0026str) -\u003e Result\u003c(), ValidationError\u003e {\n    if email.is_empty() {\n        return Err(ValidationError::new(MISSING_EMAIL));\n    }\n\n    if !email.contains('@') {\n        return Err(ValidationError::new(INVALID_EMAIL));\n    }\n\n    if email.contains(' ') {\n        return Err(ValidationError::new(INVALID_EMAIL));\n    }\n\n    let email_parts: Vec\u003c\u0026str\u003e = email.split('@').collect();\n    if email_parts.len() != 2 {\n        return Err(ValidationError::new(INVALID_EMAIL));\n    }\n\n    let domain = email_parts[1];\n    if !domain.contains('.') {\n        return Err(ValidationError::new(INVALID_EMAIL_DOMAIN));\n    }\n\n    if domain.contains('_') {\n        return Err(ValidationError::new(INVALID_EMAIL_DOMAIN));\n    }\n\n    Ok(())\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    #[test]\n    fn test_validate_email() {\n        let tests = vec![(\"email@here.com\", true), (\"\", false)];\n\n        for (email, expected_valid) in tests {\n            let valid = validate_email(email);\n\n            if expected_valid {\n                assert!(valid.is_ok());\n            } else {\n                assert!(valid.is_err());\n            }\n        }\n    }\n}\n","traces":[{"line":9,"address":[7905915,7905104],"length":1,"stats":{"Line":4},"fn_name":"validate_email"},{"line":10,"address":[7905163],"length":1,"stats":{"Line":4},"fn_name":null},{"line":11,"address":[7905209],"length":1,"stats":{"Line":1},"fn_name":null},{"line":14,"address":[4054024,4054101],"length":1,"stats":{"Line":8},"fn_name":null},{"line":15,"address":[7929782],"length":1,"stats":{"Line":0},"fn_name":null},{"line":18,"address":[7905357,7905285],"length":1,"stats":{"Line":8},"fn_name":null},{"line":19,"address":[7929874],"length":1,"stats":{"Line":0},"fn_name":null},{"line":22,"address":[7905373,7905448],"length":1,"stats":{"Line":8},"fn_name":null},{"line":23,"address":[4054375,4054302],"length":1,"stats":{"Line":8},"fn_name":null},{"line":24,"address":[7930065],"length":1,"stats":{"Line":0},"fn_name":null},{"line":27,"address":[4054495,4054381],"length":1,"stats":{"Line":8},"fn_name":null},{"line":28,"address":[4054528],"length":1,"stats":{"Line":4},"fn_name":null},{"line":29,"address":[4054588],"length":1,"stats":{"Line":0},"fn_name":null},{"line":32,"address":[4054568,4054651],"length":1,"stats":{"Line":8},"fn_name":null},{"line":33,"address":[4054688],"length":1,"stats":{"Line":0},"fn_name":null},{"line":36,"address":[4054662],"length":1,"stats":{"Line":4},"fn_name":null},{"line":44,"address":[4866309,4866959,4866336,4866304],"length":1,"stats":{"Line":3},"fn_name":"{closure#0}"},{"line":45,"address":[4866343],"length":1,"stats":{"Line":1},"fn_name":null},{"line":47,"address":[4866491],"length":1,"stats":{"Line":1},"fn_name":null},{"line":48,"address":[4866762],"length":1,"stats":{"Line":1},"fn_name":null},{"line":50,"address":[4866773],"length":1,"stats":{"Line":1},"fn_name":null},{"line":51,"address":[4866885,4866861,4866806],"length":1,"stats":{"Line":2},"fn_name":null},{"line":53,"address":[4866787,4866921],"length":1,"stats":{"Line":2},"fn_name":null}],"covered":18,"coverable":23},{"path":["/","home","runner","work","throwaway","throwaway","src","validation","mod.rs"],"content":"pub mod country;\npub mod email;\npub mod name;\npub mod password;\npub mod timezone;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","src","validation","name.rs"],"content":"use validator::ValidationError;\n\npub fn validate_name(name: \u0026str) -\u003e Result\u003c(), ValidationError\u003e {\n    if name == \"xXxShad0wxXx\" {\n        return Err(ValidationError::new(\"terrible_name\"));\n    }\n\n    Ok(())\n}\n","traces":[{"line":3,"address":[8661888],"length":1,"stats":{"Line":3},"fn_name":"validate_name"},{"line":4,"address":[4865018],"length":1,"stats":{"Line":3},"fn_name":null},{"line":5,"address":[4865063],"length":1,"stats":{"Line":0},"fn_name":null},{"line":8,"address":[4865054],"length":1,"stats":{"Line":3},"fn_name":null}],"covered":3,"coverable":4},{"path":["/","home","runner","work","throwaway","throwaway","src","validation","password.rs"],"content":"use validator::ValidationError;\n\npub fn validate_password(password: \u0026str) -\u003e Result\u003c(), ValidationError\u003e {\n    if password == \"xXxShad0wxXx\" {\n        return Err(ValidationError::new(\"terrible_password\"));\n    }\n\n    Ok(())\n}\n","traces":[{"line":3,"address":[8662016],"length":1,"stats":{"Line":3},"fn_name":"validate_password"},{"line":4,"address":[4865146],"length":1,"stats":{"Line":3},"fn_name":null},{"line":5,"address":[4865191],"length":1,"stats":{"Line":0},"fn_name":null},{"line":8,"address":[4865182],"length":1,"stats":{"Line":3},"fn_name":null}],"covered":3,"coverable":4},{"path":["/","home","runner","work","throwaway","throwaway","src","validation","timezone.rs"],"content":"use validator::ValidationError;\n\npub fn validate_timezone(timezone: \u0026str) -\u003e Result\u003c(), ValidationError\u003e {\n    if timezone == \"xXxShad0wxXx\" {\n        return Err(ValidationError::new(\"terrible_timezone\"));\n    }\n\n    Ok(())\n}\n","traces":[{"line":3,"address":[8456784],"length":1,"stats":{"Line":3},"fn_name":"validate_timezone"},{"line":4,"address":[4865274],"length":1,"stats":{"Line":3},"fn_name":null},{"line":5,"address":[4865319],"length":1,"stats":{"Line":0},"fn_name":null},{"line":8,"address":[4865310],"length":1,"stats":{"Line":3},"fn_name":null}],"covered":3,"coverable":4},{"path":["/","home","runner","work","throwaway","throwaway","tests","common","framework.rs"],"content":"use std::net::SocketAddr;\n\nuse anyhow::Error;\nuse axum::http::Request;\nuse base64::encode;\nuse hyper::client::HttpConnector;\nuse hyper::Client;\nuse hyper::{Body, Method};\nuse serde_json::{to_string, Value};\nuse tracing::log::debug;\n\nuse crate::common::models::response::APIResponse;\nuse crate::common::server::start_test_server;\nuse crate::{CreateProfile, PatchProfile};\n\npub struct Framework {\n    client: Client\u003cHttpConnector\u003e,\n    address: SocketAddr,\n}\n\nimpl Framework {\n    pub async fn new() -\u003e Self {\n        let address = start_test_server().await;\n\n        Self {\n            client: Client::new(),\n            address,\n        }\n    }\n\n    pub fn endpoint(\u0026self, endpoint: \u0026str) -\u003e String {\n        let address = self.address;\n        format!(\"http://{address}{endpoint}\")\n    }\n\n    pub async fn create_profile(\u0026self, profile: \u0026CreateProfile) -\u003e Result\u003cAPIResponse, Error\u003e {\n        let body: String = to_string(\u0026profile)?;\n        debug!(\"Create Profile Request Body: {body:#?}\");\n\n        let request = Request::builder()\n            .uri(self.endpoint(\"/register\"))\n            .method(Method::POST)\n            .header(\"Content-Type\", \"application/json\")\n            .body(Body::from(body))?;\n\n        let response = self.client.request(request).await?;\n        let result = APIResponse::new(response).await;\n        Ok(result)\n    }\n\n    pub async fn patch_profile(\u0026self, token: \u0026str, profile: \u0026PatchProfile) -\u003e Result\u003cAPIResponse, Error\u003e {\n        let body: String = to_string(\u0026profile)?;\n        debug!(\"Patch Profile Request Body: {body:#?}\");\n\n        let request = Request::builder()\n            .uri(self.endpoint(\"/profile\"))\n            .method(Method::PATCH)\n            .header(\"Content-Type\", \"application/json\")\n            .header(\"Authorization\", format!(\"Bearer {token}\"))\n            .body(Body::from(body))?;\n\n        let response = self.client.request(request).await?;\n        let result = APIResponse::new(response).await;\n        Ok(result)\n    }\n\n    pub async fn request_token(\n        \u0026self,\n        email: \u0026str,\n        password: \u0026str,\n        token_request_body: Value,\n    ) -\u003e Result\u003cAPIResponse, Error\u003e {\n        let encoded_authorization = encode(format!(\"{email}:{password}\"));\n        let basic_authorization = format!(\"Basic {encoded_authorization}\");\n        debug!(\"Token Request Headers: {basic_authorization:#?}\");\n\n        let body: String = token_request_body.to_string();\n        debug!(\"Token Request Body: {body:#?}\");\n\n        let request = Request::builder()\n            .uri(self.endpoint(\"/token\"))\n            .method(Method::POST)\n            .header(\"Content-Type\", \"application/json\")\n            .header(\"Authorization\", basic_authorization)\n            .body(Body::from(body))?;\n\n        let response = self.client.request(request).await?;\n        let result = APIResponse::new(response).await;\n        Ok(result)\n    }\n\n    pub async fn token_test(\u0026self, token: \u0026str) -\u003e Result\u003cAPIResponse, Error\u003e {\n        let request = Request::builder()\n            .uri(self.endpoint(\"/token/test\"))\n            .method(Method::GET)\n            .header(\"Content-Type\", \"application/json\")\n            .header(\"Authorization\", format!(\"Bearer {token}\"))\n            .body(Body::empty())?;\n\n        let response = self.client.request(request).await?;\n        let result = APIResponse::new(response).await;\n        Ok(result)\n    }\n\n    pub async fn token_info(\u0026self, token: \u0026str) -\u003e Result\u003cAPIResponse, Error\u003e {\n        let request = Request::builder()\n            .uri(self.endpoint(\"/token/info\"))\n            .method(Method::GET)\n            .header(\"Content-Type\", \"application/json\")\n            .header(\"Authorization\", format!(\"Bearer {token}\"))\n            .body(Body::empty())?;\n\n        let response = self.client.request(request).await?;\n        let result = APIResponse::new(response).await;\n        Ok(result)\n    }\n\n    pub async fn get_version(\u0026self) -\u003e Result\u003cAPIResponse, Error\u003e {\n        let request = Request::builder()\n            .uri(self.endpoint(\"/version\"))\n            .method(Method::GET)\n            .header(\"Content-Type\", \"application/json\")\n            .body(Body::empty())?;\n\n        let response = self.client.request(request).await?;\n        let result = APIResponse::new(response).await;\n        Ok(result)\n    }\n\n    pub async fn get_config(\u0026self) -\u003e Result\u003cAPIResponse, Error\u003e {\n        let request = Request::builder()\n            .uri(self.endpoint(\"/config\"))\n            .method(Method::GET)\n            .header(\"Content-Type\", \"application/json\")\n            .body(Body::empty())?;\n\n        let response = self.client.request(request).await?;\n        let result = APIResponse::new(response).await;\n        Ok(result)\n    }\n}\n","traces":[{"line":22,"address":[7531065,7531008,7530944,7531131,7530973,7531199,7531460],"length":1,"stats":{"Line":20},"fn_name":"new"},{"line":23,"address":[5756348,5756145,5756495,5756176],"length":1,"stats":{"Line":15},"fn_name":null},{"line":26,"address":[5756610],"length":1,"stats":{"Line":5},"fn_name":null},{"line":31,"address":[5756816],"length":1,"stats":{"Line":5},"fn_name":"endpoint"},{"line":32,"address":[5756851],"length":1,"stats":{"Line":5},"fn_name":null},{"line":33,"address":[5756899],"length":1,"stats":{"Line":5},"fn_name":null},{"line":36,"address":[5757056,5757197,5757839,5757339,5760327,5757565,5757493,5758538,5757086,5757136],"length":1,"stats":{"Line":15},"fn_name":"create_profile"},{"line":37,"address":[5757760,5757622,5757329],"length":1,"stats":{"Line":6},"fn_name":null},{"line":38,"address":[5757993,5757896,5757716],"length":1,"stats":{"Line":9},"fn_name":null},{"line":40,"address":[5758584,5759089,5758444,5758853,5759113,5758397,5758736,5759078,5758249,5758799],"length":1,"stats":{"Line":21},"fn_name":null},{"line":41,"address":[5758509,5758304,5758356,5758256,5758436,5758519],"length":1,"stats":{"Line":6},"fn_name":null},{"line":44,"address":[5758648,5758775,5759086,5758264,5759097,5758549,5759135,5758806],"length":1,"stats":{"Line":6},"fn_name":null},{"line":46,"address":[5467199],"length":1,"stats":{"Line":12},"fn_name":null},{"line":47,"address":[5467122],"length":1,"stats":{"Line":6},"fn_name":null},{"line":48,"address":[5760239],"length":1,"stats":{"Line":3},"fn_name":null},{"line":51,"address":[7532112,7532158],"length":1,"stats":{"Line":5},"fn_name":"patch_profile"},{"line":52,"address":[5761160,5760729,5761022],"length":1,"stats":{"Line":2},"fn_name":null},{"line":53,"address":[5761116,5761296,5761393],"length":1,"stats":{"Line":3},"fn_name":null},{"line":55,"address":[5761649,5762516,5761805,5761852,5762806,5762830,5761992,5762570,5762795,5762258,5762453],"length":1,"stats":{"Line":8},"fn_name":null},{"line":56,"address":[5761712,5761917,5761927,5761764,5761844,5761656],"length":1,"stats":{"Line":2},"fn_name":null},{"line":59,"address":[5762317,5761664,5761957,5762384,5762056],"length":1,"stats":{"Line":2},"fn_name":null},{"line":60,"address":[5762814,5762406,5762419,5762852,5762333,5762803,5762492,5761672,5762523],"length":1,"stats":{"Line":2},"fn_name":null},{"line":62,"address":[5762963,5760769,5763470,5760852,5762731],"length":1,"stats":{"Line":4},"fn_name":null},{"line":63,"address":[5763667,5760787,5763428],"length":1,"stats":{"Line":2},"fn_name":null},{"line":64,"address":[5763956],"length":1,"stats":{"Line":1},"fn_name":null},{"line":67,"address":[7532208],"length":1,"stats":{"Line":3},"fn_name":"request_token"},{"line":73,"address":[5764868,5764532],"length":1,"stats":{"Line":6},"fn_name":null},{"line":74,"address":[5765099,5765207],"length":1,"stats":{"Line":6},"fn_name":null},{"line":75,"address":[5765430,5765527,5765334],"length":1,"stats":{"Line":9},"fn_name":null},{"line":77,"address":[5765786,5765857],"length":1,"stats":{"Line":6},"fn_name":null},{"line":78,"address":[5765864,5765957,5766054],"length":1,"stats":{"Line":9},"fn_name":null},{"line":80,"address":[5766744,5766464,5766651,5766963,5767283,5767248,5766900,5766313,5766511,5767259,5767017],"length":1,"stats":{"Line":24},"fn_name":null},{"line":81,"address":[5766368,5766320,5766586,5766576,5766503,5766423],"length":1,"stats":{"Line":6},"fn_name":null},{"line":84,"address":[5766795,5766707],"length":1,"stats":{"Line":6},"fn_name":null},{"line":85,"address":[5766616,5767305,5766970,5767267,5767256,5766803,5766939,5766328],"length":1,"stats":{"Line":6},"fn_name":null},{"line":87,"address":[5466541],"length":1,"stats":{"Line":12},"fn_name":null},{"line":88,"address":[5466394],"length":1,"stats":{"Line":6},"fn_name":null},{"line":89,"address":[5768629],"length":1,"stats":{"Line":3},"fn_name":null},{"line":92,"address":[7532368,7532406],"length":1,"stats":{"Line":0},"fn_name":"token_test"},{"line":105,"address":[7532486,7532448],"length":1,"stats":{"Line":5},"fn_name":"token_info"},{"line":106,"address":[6055354,6055608,6055300,6054680,6054820,6054246,6055237,6055584,6055086,6055573,6054633],"length":1,"stats":{"Line":8},"fn_name":null},{"line":107,"address":[6054745,6054526,6054592,6054755,6054470,6054672],"length":1,"stats":{"Line":2},"fn_name":null},{"line":110,"address":[6055168,6055137,6054785,6054478,6054884],"length":1,"stats":{"Line":2},"fn_name":null},{"line":111,"address":[6055630,6055581,6055190,6055307,6055276,6054486,6055203,6055592,6055161],"length":1,"stats":{"Line":2},"fn_name":null},{"line":113,"address":[5461756],"length":1,"stats":{"Line":4},"fn_name":null},{"line":114,"address":[5461684],"length":1,"stats":{"Line":2},"fn_name":null},{"line":115,"address":[6056732],"length":1,"stats":{"Line":1},"fn_name":null},{"line":118,"address":[7532528,7532550],"length":1,"stats":{"Line":5},"fn_name":"get_version"},{"line":119,"address":[7533145,7533784,7533332,7532766,7533437,7533500,7533554,7533192,7533808,7533773],"length":1,"stats":{"Line":7},"fn_name":null},{"line":120,"address":[7533184,7533257,7532990,7533267,7533038,7533104],"length":1,"stats":{"Line":2},"fn_name":null},{"line":123,"address":[7533476,7533781,7533297,7533792,7532998,7533507,7533396,7533830],"length":1,"stats":{"Line":2},"fn_name":null},{"line":125,"address":[5426375],"length":1,"stats":{"Line":4},"fn_name":null},{"line":126,"address":[5426306],"length":1,"stats":{"Line":2},"fn_name":null},{"line":127,"address":[7534932],"length":1,"stats":{"Line":1},"fn_name":null},{"line":130,"address":[7535080,7533350,7532994,7532614,7532717,7532592,7532840,7533149,7532656,7533935],"length":1,"stats":{"Line":5},"fn_name":"get_config"},{"line":131,"address":[7533618,7533501,7533396,7533872,7533256,7533848,7533837,7533564,7532830,7533209],"length":1,"stats":{"Line":7},"fn_name":null},{"line":132,"address":[7533102,7533054,7533168,7533248,7533331,7533321],"length":1,"stats":{"Line":2},"fn_name":null},{"line":135,"address":[7533856,7533540,7533571,7533845,7533361,7533894,7533062,7533460],"length":1,"stats":{"Line":2},"fn_name":null},{"line":137,"address":[5426215],"length":1,"stats":{"Line":4},"fn_name":null},{"line":138,"address":[5426146],"length":1,"stats":{"Line":2},"fn_name":null},{"line":139,"address":[7534996],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":60,"coverable":61},{"path":["/","home","runner","work","throwaway","throwaway","tests","common","mod.rs"],"content":"#![deny(clippy::all, clippy::pedantic, clippy::nursery, clippy::cargo)]\n#![allow(\n    dead_code,\n    clippy::module_name_repetitions,\n    clippy::missing_errors_doc,\n    clippy::multiple_crate_versions,\n    clippy::must_use_candidate,\n    clippy::unused_async,\n    clippy::struct_excessive_bools\n)]\n\npub mod framework;\npub mod models;\npub mod server;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","tests","common","models","mod.rs"],"content":"pub mod profile;\npub mod response;\npub mod token;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","tests","common","models","profile","mod.rs"],"content":"pub mod profile_create;\npub mod profile_patch;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","tests","common","models","profile","profile_create.rs"],"content":"use rand_core::{OsRng, RngCore};\nuse serde::{Deserialize, Serialize};\n\n#[derive(Serialize, Deserialize)]\npub struct CreateProfile {\n    pub name: String,\n    pub email: String,\n    pub password: String,\n    pub country: String,\n    pub timezone: String,\n}\n\nimpl CreateProfile {\n    pub fn new() -\u003e Self {\n        let id = OsRng.next_u64();\n\n        Self {\n            name: format!(\"Test {id}\"),\n            email: format!(\"test-{id}@domain.test\"),\n            password: \"test-password\".to_string(),\n            country: \"UK\".to_string(),\n            timezone: \"GMT\".to_string(),\n        }\n    }\n}\n","traces":[{"line":14,"address":[6475376,6474640],"length":1,"stats":{"Line":3},"fn_name":"new"},{"line":15,"address":[6250225],"length":1,"stats":{"Line":3},"fn_name":null},{"line":18,"address":[7535169],"length":1,"stats":{"Line":3},"fn_name":null},{"line":19,"address":[7535286,7535361],"length":1,"stats":{"Line":6},"fn_name":null},{"line":20,"address":[7535477],"length":1,"stats":{"Line":3},"fn_name":null},{"line":21,"address":[7535548],"length":1,"stats":{"Line":3},"fn_name":null},{"line":22,"address":[7535616],"length":1,"stats":{"Line":3},"fn_name":null}],"covered":7,"coverable":7},{"path":["/","home","runner","work","throwaway","throwaway","tests","common","models","profile","profile_patch.rs"],"content":"use serde::{Deserialize, Serialize};\n\n#[derive(Serialize, Deserialize)]\npub struct PatchProfile {\n    pub name: Option\u003cString\u003e,\n    pub email: Option\u003cString\u003e,\n    pub country: Option\u003cString\u003e,\n    pub timezone: Option\u003cString\u003e,\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","tests","common","models","response.rs"],"content":"use axum::body::Body;\nuse axum::http::{HeaderMap, StatusCode};\nuse axum::response::Response;\nuse hyper::body::to_bytes;\nuse serde_json::{from_slice, Value};\nuse tracing::debug;\n\npub struct APIResponse {\n    pub status: StatusCode,\n    pub headers: HeaderMap,\n    pub body: Value,\n}\n\nimpl APIResponse {\n    pub async fn new(response: Response\u003cBody\u003e) -\u003e Self {\n        let status = response.status();\n        debug!(\"Response Status: {status:#?}\");\n\n        let headers = response.headers().clone();\n        debug!(\"Response Headers: {headers:#?}\");\n\n        let body_bytes = to_bytes(response.into_body())\n            .await\n            .unwrap();\n\n        let body: Value = from_slice(\u0026body_bytes).unwrap();\n        debug!(\"Response Body: {body:#?}\");\n\n        Self {\n            status,\n            headers,\n            body,\n        }\n    }\n}\n","traces":[{"line":15,"address":[7309497,7298791,7298480,7298496,7298621,7309404,7298874,7298560,7305681],"length":1,"stats":{"Line":25},"fn_name":"new"},{"line":16,"address":[7298755,7298998],"length":1,"stats":{"Line":10},"fn_name":null},{"line":17,"address":[7329213,7328160,7329129,7328540,7326782,7327683,7327144,7327308,7328321,7327599],"length":1,"stats":{"Line":25},"fn_name":null},{"line":19,"address":[7302190,7300451],"length":1,"stats":{"Line":10},"fn_name":null},{"line":20,"address":[7322766,7321552,7322985,7323574,7322605,7323658,7322007,7321190,7321716,7322091],"length":1,"stats":{"Line":25},"fn_name":null},{"line":22,"address":[5435162],"length":1,"stats":{"Line":10},"fn_name":null},{"line":26,"address":[7305897,7305988],"length":1,"stats":{"Line":10},"fn_name":null},{"line":27,"address":[7306718,7306192,7308766,7307824,7308838,7308204,7306554,7307985,7307093,7307009],"length":1,"stats":{"Line":25},"fn_name":null}],"covered":8,"coverable":8},{"path":["/","home","runner","work","throwaway","throwaway","tests","common","models","token","mod.rs"],"content":"pub mod request_token;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","tests","common","models","token","request_token.rs"],"content":"use serde::{Deserialize, Serialize};\n\n#[derive(Serialize, Deserialize)]\npub struct TokenRequest {\n    pub lifespan: usize,\n    pub attributes: String,\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","runner","work","throwaway","throwaway","tests","common","server.rs"],"content":"use std::net::{SocketAddr, TcpListener};\n\nuse throwaway::build_app;\n\npub async fn start_test_server() -\u003e SocketAddr {\n    let app = build_app().await.unwrap();\n\n    let socket_address = SocketAddr::from(([127, 0, 0, 1], 0));\n    let listener = TcpListener::bind(socket_address).unwrap();\n\n    let address = listener.local_addr().unwrap();\n    tokio::spawn(async move {\n        axum::Server::from_tcp(listener)\n            .unwrap()\n            .serve(app.into_make_service())\n            .await\n            .unwrap();\n    });\n\n    address\n}\n","traces":[{"line":5,"address":[7337762,7337280,7337245,7337216,7337564,7337423,7337337,7337491],"length":1,"stats":{"Line":20},"fn_name":"start_test_server"},{"line":6,"address":[7328564,7328505,7328744,7328893],"length":1,"stats":{"Line":15},"fn_name":null},{"line":8,"address":[7340917],"length":1,"stats":{"Line":5},"fn_name":null},{"line":9,"address":[7310484,7310397],"length":1,"stats":{"Line":10},"fn_name":null},{"line":11,"address":[7329378,7329313],"length":1,"stats":{"Line":10},"fn_name":null},{"line":12,"address":[7339517,7338640,7338288,7338776,7338673,7338850,7339164],"length":1,"stats":{"Line":15},"fn_name":"{async_block#0}"},{"line":13,"address":[7311415,7311726,7311800,7311637,7311062,7311281],"length":1,"stats":{"Line":20},"fn_name":null},{"line":14,"address":[7341972],"length":1,"stats":{"Line":5},"fn_name":null},{"line":15,"address":[7311561,7311659,7311246,7311454,7311747,7311133,7311324],"length":1,"stats":{"Line":25},"fn_name":null},{"line":20,"address":[7310786],"length":1,"stats":{"Line":5},"fn_name":null}],"covered":10,"coverable":10},{"path":["/","home","runner","work","throwaway","throwaway","tests","config_get_test.rs"],"content":"use anyhow::Error;\nmod common;\n\nuse common::models::profile::profile_create::CreateProfile;\nuse common::models::profile::profile_patch::PatchProfile;\n\nuse crate::common::framework::Framework;\n\n#[tokio::test]\nasync fn config_get_valid() -\u003e Result\u003c(), Error\u003e {\n    let framework = Framework::new().await;\n\n    // Lookup config\n    let config_response = framework.get_config().await?;\n\n    let use_local_string = config_response.body[\"config\"][\"use_local\"]\n        .as_bool()\n        .unwrap();\n    assert!(use_local_string);\n\n    Ok(())\n}\n","traces":[{"line":10,"address":[7536032,7536041,7536597,7536672,7536830,7536210,7536544,7537128,7536101,7536080],"length":1,"stats":{"Line":6},"fn_name":"{closure#0}"},{"line":11,"address":[7536662,7536702,7537139,7536958,7536787],"length":1,"stats":{"Line":4},"fn_name":null},{"line":14,"address":[5487436],"length":1,"stats":{"Line":3},"fn_name":null},{"line":16,"address":[7537817,7538064],"length":1,"stats":{"Line":2},"fn_name":null},{"line":19,"address":[7538160,7538193],"length":1,"stats":{"Line":1},"fn_name":null},{"line":21,"address":[7538166,7536281,7536186,7536130],"length":1,"stats":{"Line":4},"fn_name":null}],"covered":6,"coverable":6},{"path":["/","home","runner","work","throwaway","throwaway","tests","profile_patch_test.rs"],"content":"use anyhow::Error;\nuse serde_json::json;\n\nmod common;\n\nuse common::models::profile::profile_create::CreateProfile;\nuse common::models::profile::profile_patch::PatchProfile;\n\nuse crate::common::framework::Framework;\n\n#[tokio::test]\nasync fn profile_patch_name_valid() -\u003e Result\u003c(), Error\u003e {\n    let framework = Framework::new().await;\n\n    // Register\n    let profile = CreateProfile::new();\n    framework\n        .create_profile(\u0026profile)\n        .await?;\n\n    // Fetch Token\n    let token_request_body = json!({\n        \"lifespan\": 60,\n        \"attributes\": {\n            \"profile\": {\n                \"update\": true\n            }\n        }\n    });\n\n    let token_response = framework\n        .request_token(\u0026profile.email, \u0026profile.password, token_request_body)\n        .await?;\n\n    let token_authorization = token_response.body[\"token\"]\n        .as_str()\n        .unwrap();\n\n    // Patch Profile\n    let profile_patch = PatchProfile {\n        name: Some(\"Updated\".to_string()),\n        email: None,\n        country: None,\n        timezone: None,\n    };\n\n    let patch_response = framework\n        .patch_profile(token_authorization, \u0026profile_patch)\n        .await?;\n\n    let patch_response_country = patch_response.body[\"profile\"][\"name\"]\n        .as_str()\n        .unwrap();\n\n    assert_eq!(patch_response_country, \"Updated\");\n\n    Ok(())\n}\n","traces":[{"line":12,"address":[6248649,6248688,6248818,6249621,6249319,6248640,6248709,6249205,6249152,6249919],"length":1,"stats":{"Line":6},"fn_name":"{closure#0}"},{"line":13,"address":[6249930,6249270,6249578,6249749,6249349],"length":1,"stats":{"Line":4},"fn_name":null},{"line":16,"address":[6250098],"length":1,"stats":{"Line":1},"fn_name":null},{"line":17,"address":[6250325,6250178,6250781,6250571,6250449,6250724],"length":1,"stats":{"Line":4},"fn_name":null},{"line":18,"address":[5529684],"length":1,"stats":{"Line":6},"fn_name":null},{"line":19,"address":[5529738,5529698],"length":1,"stats":{"Line":1},"fn_name":null},{"line":22,"address":[6251407,6251280,6250956,6250893,6250822,6251170],"length":1,"stats":{"Line":5},"fn_name":null},{"line":31,"address":[6252472,6252718,6252081,6252910,6252967,6252327,6252596],"length":1,"stats":{"Line":5},"fn_name":null},{"line":32,"address":[5529601],"length":1,"stats":{"Line":7},"fn_name":null},{"line":33,"address":[6252932,6252894],"length":1,"stats":{"Line":0},"fn_name":null},{"line":35,"address":[6253050,6252850],"length":1,"stats":{"Line":2},"fn_name":null},{"line":41,"address":[6253181],"length":1,"stats":{"Line":1},"fn_name":null},{"line":47,"address":[6254067,6253608,6253438,6253732,6254008,6253854],"length":1,"stats":{"Line":4},"fn_name":null},{"line":48,"address":[5529401],"length":1,"stats":{"Line":4},"fn_name":null},{"line":49,"address":[6253992,6254027],"length":1,"stats":{"Line":0},"fn_name":null},{"line":51,"address":[6253950,6254238],"length":1,"stats":{"Line":2},"fn_name":null},{"line":55,"address":[6254367,6254494],"length":1,"stats":{"Line":1},"fn_name":null},{"line":57,"address":[6248794,6248738,6254457,6248889],"length":1,"stats":{"Line":4},"fn_name":null}],"covered":16,"coverable":18},{"path":["/","home","runner","work","throwaway","throwaway","tests","token_info_get_test.rs"],"content":"use anyhow::Error;\nuse serde_json::json;\n\nmod common;\n\nuse common::models::profile::profile_create::CreateProfile;\nuse common::models::profile::profile_patch::PatchProfile;\n\nuse crate::common::framework::Framework;\n\n#[tokio::test]\nasync fn token_info_get_valid() -\u003e Result\u003c(), Error\u003e {\n    let framework = Framework::new().await;\n\n    // Register\n    let profile = CreateProfile::new();\n    framework\n        .create_profile(\u0026profile)\n        .await?;\n\n    // Fetch Token\n    let token_request_body = json!({\n        \"lifespan\": 60,\n        \"attributes\": {\n            \"profile\": {\n                \"update\": true\n            }\n        }\n    });\n\n    let token_response = framework\n        .request_token(\u0026profile.email, \u0026profile.password, token_request_body)\n        .await?;\n\n    let token_authorization = token_response.body[\"token\"]\n        .as_str()\n        .unwrap();\n\n    // Lookup token info\n    let token_info_response = framework\n        .token_info(token_authorization)\n        .await?;\n\n    let token_info_issued_at = token_info_response.body[\"issued_at\"]\n        .as_str()\n        .unwrap();\n    assert!(!token_info_issued_at.is_empty());\n\n    let token_info_attributes_profile_update = token_info_response.body[\"attributes\"][\"profile\"][\"update\"]\n        .as_bool()\n        .unwrap();\n    assert!(token_info_attributes_profile_update);\n\n    Ok(())\n}\n","traces":[{"line":12,"address":[6469829,6469333,6469273,6469943,6469776,6469264,6470543,6469312,6469442,6470245],"length":1,"stats":{"Line":6},"fn_name":"{closure#0}"},{"line":13,"address":[6470554,6469894,6470202,6470373,6469973],"length":1,"stats":{"Line":4},"fn_name":null},{"line":16,"address":[6470722],"length":1,"stats":{"Line":1},"fn_name":null},{"line":17,"address":[6471195,6471348,6471405,6470949,6471073,6470802],"length":1,"stats":{"Line":4},"fn_name":null},{"line":18,"address":[5525432],"length":1,"stats":{"Line":6},"fn_name":null},{"line":19,"address":[5525446,5525486],"length":1,"stats":{"Line":1},"fn_name":null},{"line":22,"address":[6471446,6471904,6471517,6471794,6472031,6471580],"length":1,"stats":{"Line":5},"fn_name":null},{"line":31,"address":[6473096,6473342,6473534,6472705,6473591,6472951,6473220],"length":1,"stats":{"Line":5},"fn_name":null},{"line":32,"address":[5525349],"length":1,"stats":{"Line":7},"fn_name":null},{"line":33,"address":[6473556,6473518],"length":1,"stats":{"Line":0},"fn_name":null},{"line":35,"address":[6473674,6473474],"length":1,"stats":{"Line":2},"fn_name":null},{"line":40,"address":[6474046,6473922,6474390,6474331,6474168,6473799],"length":1,"stats":{"Line":4},"fn_name":null},{"line":41,"address":[5525209],"length":1,"stats":{"Line":4},"fn_name":null},{"line":42,"address":[6474315,6474350],"length":1,"stats":{"Line":0},"fn_name":null},{"line":44,"address":[6474542,6474270],"length":1,"stats":{"Line":2},"fn_name":null},{"line":47,"address":[6474627,6474689],"length":1,"stats":{"Line":1},"fn_name":null},{"line":49,"address":[6474650,6474726],"length":1,"stats":{"Line":2},"fn_name":null},{"line":52,"address":[6474858,6474891],"length":1,"stats":{"Line":1},"fn_name":null},{"line":54,"address":[6469418,6474864,6469513,6469362],"length":1,"stats":{"Line":4},"fn_name":null}],"covered":17,"coverable":19},{"path":["/","home","runner","work","throwaway","throwaway","tests","token_post_test.rs"],"content":"use anyhow::Error;\nuse serde_json::json;\n\nmod common;\n\nuse common::models::profile::profile_create::CreateProfile;\nuse common::models::profile::profile_patch::PatchProfile;\n\nuse crate::common::framework::Framework;\n\n#[tokio::test]\nasync fn token_post_valid() -\u003e Result\u003c(), Error\u003e {\n    let framework = Framework::new().await;\n\n    // Register\n    let profile = CreateProfile::new();\n    framework\n        .create_profile(\u0026profile)\n        .await?;\n\n    // Fetch Token\n    // FIXME: Maybe use a builder here to create a token request body instead, shouldn't necessarily be testing by\n    // passing in raw JSON bodies, try and make this more approachable?\n    let token_request_body = json!({\n        \"lifespan\": 60,\n        \"attributes\": {\n            \"profile\": {\n                \"update\": true\n            }\n        }\n    });\n\n    let token_response = framework\n        .request_token(\u0026profile.email, \u0026profile.password, token_request_body)\n        .await?;\n\n    let token_authorization = token_response.body[\"token\"]\n        .as_str()\n        .unwrap();\n    assert!(!token_authorization.is_empty());\n\n    Ok(())\n}\n","traces":[{"line":12,"address":[7334439,7333410,7333301,7333241,7333797,7333280,7334141,7333911,7333744,7333232],"length":1,"stats":{"Line":6},"fn_name":"{closure#0}"},{"line":13,"address":[7334098,7334269,7333862,7334450,7333941],"length":1,"stats":{"Line":4},"fn_name":null},{"line":16,"address":[7334618],"length":1,"stats":{"Line":1},"fn_name":null},{"line":17,"address":[7335091,7335301,7334969,7335244,7334845,7334698],"length":1,"stats":{"Line":4},"fn_name":null},{"line":18,"address":[5497020],"length":1,"stats":{"Line":6},"fn_name":null},{"line":19,"address":[5497034,5497074],"length":1,"stats":{"Line":1},"fn_name":null},{"line":24,"address":[7335413,7335800,7335927,7335476,7335690,7335342],"length":1,"stats":{"Line":5},"fn_name":null},{"line":33,"address":[7337392,7336847,7337116,7336601,7337238,7336992,7337451],"length":1,"stats":{"Line":5},"fn_name":null},{"line":34,"address":[5496913],"length":1,"stats":{"Line":6},"fn_name":null},{"line":35,"address":[7337411,7337376],"length":1,"stats":{"Line":0},"fn_name":null},{"line":37,"address":[7337595,7337334],"length":1,"stats":{"Line":2},"fn_name":null},{"line":40,"address":[7337730,7337680],"length":1,"stats":{"Line":1},"fn_name":null},{"line":42,"address":[7337703,7333330,7333481,7333386],"length":1,"stats":{"Line":4},"fn_name":null}],"covered":12,"coverable":13},{"path":["/","home","runner","work","throwaway","throwaway","tests","version_get_test.rs"],"content":"use anyhow::Error;\nmod common;\n\nuse common::models::profile::profile_create::CreateProfile;\nuse common::models::profile::profile_patch::PatchProfile;\n\nuse crate::common::framework::Framework;\n\n#[tokio::test]\nasync fn version_get_valid() -\u003e Result\u003c(), Error\u003e {\n    let framework = Framework::new().await;\n\n    // Lookup version\n    let version_response = framework.get_version().await?;\n\n    let version_string = version_response.body[\"version\"]\n        .as_str()\n        .unwrap();\n    assert!(!version_string.is_empty());\n\n    Ok(())\n}\n","traces":[{"line":10,"address":[7537128,7536597,7536041,7536101,7536544,7536830,7536080,7536210,7536032,7536672],"length":1,"stats":{"Line":6},"fn_name":"{closure#0}"},{"line":11,"address":[7536787,7537139,7536662,7536702,7536958],"length":1,"stats":{"Line":4},"fn_name":null},{"line":14,"address":[5488028],"length":1,"stats":{"Line":3},"fn_name":null},{"line":16,"address":[7537817,7538064],"length":1,"stats":{"Line":2},"fn_name":null},{"line":19,"address":[7538199,7538149],"length":1,"stats":{"Line":1},"fn_name":null},{"line":21,"address":[7536186,7536281,7536130,7538172],"length":1,"stats":{"Line":4},"fn_name":null}],"covered":6,"coverable":6}]};
    </script>
    <script crossorigin>/** @license React v16.13.1
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
'use strict';(function(d,r){"object"===typeof exports&&"undefined"!==typeof module?r(exports):"function"===typeof define&&define.amd?define(["exports"],r):(d=d||self,r(d.React={}))})(this,function(d){function r(a){for(var b="https://reactjs.org/docs/error-decoder.html?invariant="+a,c=1;c<arguments.length;c++)b+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+a+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}
function w(a,b,c){this.props=a;this.context=b;this.refs=ba;this.updater=c||ca}function da(){}function L(a,b,c){this.props=a;this.context=b;this.refs=ba;this.updater=c||ca}function ea(a,b,c){var g,e={},fa=null,d=null;if(null!=b)for(g in void 0!==b.ref&&(d=b.ref),void 0!==b.key&&(fa=""+b.key),b)ha.call(b,g)&&!ia.hasOwnProperty(g)&&(e[g]=b[g]);var h=arguments.length-2;if(1===h)e.children=c;else if(1<h){for(var k=Array(h),f=0;f<h;f++)k[f]=arguments[f+2];e.children=k}if(a&&a.defaultProps)for(g in h=a.defaultProps,
h)void 0===e[g]&&(e[g]=h[g]);return{$$typeof:x,type:a,key:fa,ref:d,props:e,_owner:M.current}}function va(a,b){return{$$typeof:x,type:a.type,key:b,ref:a.ref,props:a.props,_owner:a._owner}}function N(a){return"object"===typeof a&&null!==a&&a.$$typeof===x}function wa(a){var b={"=":"=0",":":"=2"};return"$"+(""+a).replace(/[=:]/g,function(a){return b[a]})}function ja(a,b,c,g){if(C.length){var e=C.pop();e.result=a;e.keyPrefix=b;e.func=c;e.context=g;e.count=0;return e}return{result:a,keyPrefix:b,func:c,
context:g,count:0}}function ka(a){a.result=null;a.keyPrefix=null;a.func=null;a.context=null;a.count=0;10>C.length&&C.push(a)}function O(a,b,c,g){var e=typeof a;if("undefined"===e||"boolean"===e)a=null;var d=!1;if(null===a)d=!0;else switch(e){case "string":case "number":d=!0;break;case "object":switch(a.$$typeof){case x:case xa:d=!0}}if(d)return c(g,a,""===b?"."+P(a,0):b),1;d=0;b=""===b?".":b+":";if(Array.isArray(a))for(var f=0;f<a.length;f++){e=a[f];var h=b+P(e,f);d+=O(e,h,c,g)}else if(null===a||
"object"!==typeof a?h=null:(h=la&&a[la]||a["@@iterator"],h="function"===typeof h?h:null),"function"===typeof h)for(a=h.call(a),f=0;!(e=a.next()).done;)e=e.value,h=b+P(e,f++),d+=O(e,h,c,g);else if("object"===e)throw c=""+a,Error(r(31,"[object Object]"===c?"object with keys {"+Object.keys(a).join(", ")+"}":c,""));return d}function Q(a,b,c){return null==a?0:O(a,"",b,c)}function P(a,b){return"object"===typeof a&&null!==a&&null!=a.key?wa(a.key):b.toString(36)}function ya(a,b,c){a.func.call(a.context,b,
a.count++)}function za(a,b,c){var g=a.result,e=a.keyPrefix;a=a.func.call(a.context,b,a.count++);Array.isArray(a)?R(a,g,c,function(a){return a}):null!=a&&(N(a)&&(a=va(a,e+(!a.key||b&&b.key===a.key?"":(""+a.key).replace(ma,"$&/")+"/")+c)),g.push(a))}function R(a,b,c,g,e){var d="";null!=c&&(d=(""+c).replace(ma,"$&/")+"/");b=ja(b,d,g,e);Q(a,za,b);ka(b)}function t(){var a=na.current;if(null===a)throw Error(r(321));return a}function S(a,b){var c=a.length;a.push(b);a:for(;;){var g=c-1>>>1,e=a[g];if(void 0!==
e&&0<D(e,b))a[g]=b,a[c]=e,c=g;else break a}}function n(a){a=a[0];return void 0===a?null:a}function E(a){var b=a[0];if(void 0!==b){var c=a.pop();if(c!==b){a[0]=c;a:for(var g=0,e=a.length;g<e;){var d=2*(g+1)-1,f=a[d],h=d+1,k=a[h];if(void 0!==f&&0>D(f,c))void 0!==k&&0>D(k,f)?(a[g]=k,a[h]=c,g=h):(a[g]=f,a[d]=c,g=d);else if(void 0!==k&&0>D(k,c))a[g]=k,a[h]=c,g=h;else break a}}return b}return null}function D(a,b){var c=a.sortIndex-b.sortIndex;return 0!==c?c:a.id-b.id}function F(a){for(var b=n(u);null!==
b;){if(null===b.callback)E(u);else if(b.startTime<=a)E(u),b.sortIndex=b.expirationTime,S(p,b);else break;b=n(u)}}function T(a){y=!1;F(a);if(!v)if(null!==n(p))v=!0,z(U);else{var b=n(u);null!==b&&G(T,b.startTime-a)}}function U(a,b){v=!1;y&&(y=!1,V());H=!0;var c=m;try{F(b);for(l=n(p);null!==l&&(!(l.expirationTime>b)||a&&!W());){var g=l.callback;if(null!==g){l.callback=null;m=l.priorityLevel;var e=g(l.expirationTime<=b);b=q();"function"===typeof e?l.callback=e:l===n(p)&&E(p);F(b)}else E(p);l=n(p)}if(null!==
l)var d=!0;else{var f=n(u);null!==f&&G(T,f.startTime-b);d=!1}return d}finally{l=null,m=c,H=!1}}function oa(a){switch(a){case 1:return-1;case 2:return 250;case 5:return 1073741823;case 4:return 1E4;default:return 5E3}}var f="function"===typeof Symbol&&Symbol.for,x=f?Symbol.for("react.element"):60103,xa=f?Symbol.for("react.portal"):60106,Aa=f?Symbol.for("react.fragment"):60107,Ba=f?Symbol.for("react.strict_mode"):60108,Ca=f?Symbol.for("react.profiler"):60114,Da=f?Symbol.for("react.provider"):60109,
Ea=f?Symbol.for("react.context"):60110,Fa=f?Symbol.for("react.forward_ref"):60112,Ga=f?Symbol.for("react.suspense"):60113,Ha=f?Symbol.for("react.memo"):60115,Ia=f?Symbol.for("react.lazy"):60116,la="function"===typeof Symbol&&Symbol.iterator,pa=Object.getOwnPropertySymbols,Ja=Object.prototype.hasOwnProperty,Ka=Object.prototype.propertyIsEnumerable,I=function(){try{if(!Object.assign)return!1;var a=new String("abc");a[5]="de";if("5"===Object.getOwnPropertyNames(a)[0])return!1;var b={};for(a=0;10>a;a++)b["_"+
String.fromCharCode(a)]=a;if("0123456789"!==Object.getOwnPropertyNames(b).map(function(a){return b[a]}).join(""))return!1;var c={};"abcdefghijklmnopqrst".split("").forEach(function(a){c[a]=a});return"abcdefghijklmnopqrst"!==Object.keys(Object.assign({},c)).join("")?!1:!0}catch(g){return!1}}()?Object.assign:function(a,b){if(null===a||void 0===a)throw new TypeError("Object.assign cannot be called with null or undefined");var c=Object(a);for(var g,e=1;e<arguments.length;e++){var d=Object(arguments[e]);
for(var f in d)Ja.call(d,f)&&(c[f]=d[f]);if(pa){g=pa(d);for(var h=0;h<g.length;h++)Ka.call(d,g[h])&&(c[g[h]]=d[g[h]])}}return c},ca={isMounted:function(a){return!1},enqueueForceUpdate:function(a,b,c){},enqueueReplaceState:function(a,b,c,d){},enqueueSetState:function(a,b,c,d){}},ba={};w.prototype.isReactComponent={};w.prototype.setState=function(a,b){if("object"!==typeof a&&"function"!==typeof a&&null!=a)throw Error(r(85));this.updater.enqueueSetState(this,a,b,"setState")};w.prototype.forceUpdate=
function(a){this.updater.enqueueForceUpdate(this,a,"forceUpdate")};da.prototype=w.prototype;f=L.prototype=new da;f.constructor=L;I(f,w.prototype);f.isPureReactComponent=!0;var M={current:null},ha=Object.prototype.hasOwnProperty,ia={key:!0,ref:!0,__self:!0,__source:!0},ma=/\/+/g,C=[],na={current:null},X;if("undefined"===typeof window||"function"!==typeof MessageChannel){var A=null,qa=null,ra=function(){if(null!==A)try{var a=q();A(!0,a);A=null}catch(b){throw setTimeout(ra,0),b;}},La=Date.now();var q=
function(){return Date.now()-La};var z=function(a){null!==A?setTimeout(z,0,a):(A=a,setTimeout(ra,0))};var G=function(a,b){qa=setTimeout(a,b)};var V=function(){clearTimeout(qa)};var W=function(){return!1};f=X=function(){}}else{var Y=window.performance,sa=window.Date,Ma=window.setTimeout,Na=window.clearTimeout;"undefined"!==typeof console&&(f=window.cancelAnimationFrame,"function"!==typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"),
"function"!==typeof f&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"));if("object"===typeof Y&&"function"===typeof Y.now)q=function(){return Y.now()};else{var Oa=sa.now();q=function(){return sa.now()-Oa}}var J=!1,K=null,Z=-1,ta=5,ua=0;W=function(){return q()>=ua};f=function(){};X=function(a){0>a||125<a?console.error("forceFrameRate takes a positive int between 0 and 125, forcing framerates higher than 125 fps is not unsupported"):
ta=0<a?Math.floor(1E3/a):5};var B=new MessageChannel,aa=B.port2;B.port1.onmessage=function(){if(null!==K){var a=q();ua=a+ta;try{K(!0,a)?aa.postMessage(null):(J=!1,K=null)}catch(b){throw aa.postMessage(null),b;}}else J=!1};z=function(a){K=a;J||(J=!0,aa.postMessage(null))};G=function(a,b){Z=Ma(function(){a(q())},b)};V=function(){Na(Z);Z=-1}}var p=[],u=[],Pa=1,l=null,m=3,H=!1,v=!1,y=!1,Qa=0;B={ReactCurrentDispatcher:na,ReactCurrentOwner:M,IsSomeRendererActing:{current:!1},assign:I};I(B,{Scheduler:{__proto__:null,
unstable_ImmediatePriority:1,unstable_UserBlockingPriority:2,unstable_NormalPriority:3,unstable_IdlePriority:5,unstable_LowPriority:4,unstable_runWithPriority:function(a,b){switch(a){case 1:case 2:case 3:case 4:case 5:break;default:a=3}var c=m;m=a;try{return b()}finally{m=c}},unstable_next:function(a){switch(m){case 1:case 2:case 3:var b=3;break;default:b=m}var c=m;m=b;try{return a()}finally{m=c}},unstable_scheduleCallback:function(a,b,c){var d=q();if("object"===typeof c&&null!==c){var e=c.delay;
e="number"===typeof e&&0<e?d+e:d;c="number"===typeof c.timeout?c.timeout:oa(a)}else c=oa(a),e=d;c=e+c;a={id:Pa++,callback:b,priorityLevel:a,startTime:e,expirationTime:c,sortIndex:-1};e>d?(a.sortIndex=e,S(u,a),null===n(p)&&a===n(u)&&(y?V():y=!0,G(T,e-d))):(a.sortIndex=c,S(p,a),v||H||(v=!0,z(U)));return a},unstable_cancelCallback:function(a){a.callback=null},unstable_wrapCallback:function(a){var b=m;return function(){var c=m;m=b;try{return a.apply(this,arguments)}finally{m=c}}},unstable_getCurrentPriorityLevel:function(){return m},
unstable_shouldYield:function(){var a=q();F(a);var b=n(p);return b!==l&&null!==l&&null!==b&&null!==b.callback&&b.startTime<=a&&b.expirationTime<l.expirationTime||W()},unstable_requestPaint:f,unstable_continueExecution:function(){v||H||(v=!0,z(U))},unstable_pauseExecution:function(){},unstable_getFirstCallbackNode:function(){return n(p)},get unstable_now(){return q},get unstable_forceFrameRate(){return X},unstable_Profiling:null},SchedulerTracing:{__proto__:null,__interactionsRef:null,__subscriberRef:null,
unstable_clear:function(a){return a()},unstable_getCurrent:function(){return null},unstable_getThreadID:function(){return++Qa},unstable_trace:function(a,b,c){return c()},unstable_wrap:function(a){return a},unstable_subscribe:function(a){},unstable_unsubscribe:function(a){}}});d.Children={map:function(a,b,c){if(null==a)return a;var d=[];R(a,d,null,b,c);return d},forEach:function(a,b,c){if(null==a)return a;b=ja(null,null,b,c);Q(a,ya,b);ka(b)},count:function(a){return Q(a,function(){return null},null)},
toArray:function(a){var b=[];R(a,b,null,function(a){return a});return b},only:function(a){if(!N(a))throw Error(r(143));return a}};d.Component=w;d.Fragment=Aa;d.Profiler=Ca;d.PureComponent=L;d.StrictMode=Ba;d.Suspense=Ga;d.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=B;d.cloneElement=function(a,b,c){if(null===a||void 0===a)throw Error(r(267,a));var d=I({},a.props),e=a.key,f=a.ref,m=a._owner;if(null!=b){void 0!==b.ref&&(f=b.ref,m=M.current);void 0!==b.key&&(e=""+b.key);if(a.type&&a.type.defaultProps)var h=
a.type.defaultProps;for(k in b)ha.call(b,k)&&!ia.hasOwnProperty(k)&&(d[k]=void 0===b[k]&&void 0!==h?h[k]:b[k])}var k=arguments.length-2;if(1===k)d.children=c;else if(1<k){h=Array(k);for(var l=0;l<k;l++)h[l]=arguments[l+2];d.children=h}return{$$typeof:x,type:a.type,key:e,ref:f,props:d,_owner:m}};d.createContext=function(a,b){void 0===b&&(b=null);a={$$typeof:Ea,_calculateChangedBits:b,_currentValue:a,_currentValue2:a,_threadCount:0,Provider:null,Consumer:null};a.Provider={$$typeof:Da,_context:a};return a.Consumer=
a};d.createElement=ea;d.createFactory=function(a){var b=ea.bind(null,a);b.type=a;return b};d.createRef=function(){return{current:null}};d.forwardRef=function(a){return{$$typeof:Fa,render:a}};d.isValidElement=N;d.lazy=function(a){return{$$typeof:Ia,_ctor:a,_status:-1,_result:null}};d.memo=function(a,b){return{$$typeof:Ha,type:a,compare:void 0===b?null:b}};d.useCallback=function(a,b){return t().useCallback(a,b)};d.useContext=function(a,b){return t().useContext(a,b)};d.useDebugValue=function(a,b){};
d.useEffect=function(a,b){return t().useEffect(a,b)};d.useImperativeHandle=function(a,b,c){return t().useImperativeHandle(a,b,c)};d.useLayoutEffect=function(a,b){return t().useLayoutEffect(a,b)};d.useMemo=function(a,b){return t().useMemo(a,b)};d.useReducer=function(a,b,c){return t().useReducer(a,b,c)};d.useRef=function(a){return t().useRef(a)};d.useState=function(a){return t().useState(a)};d.version="16.13.1"});
</script>
    <script crossorigin>/** @license React v16.13.1
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
/*
 Modernizr 3.0.0pre (Custom Build) | MIT
*/
'use strict';(function(I,ea){"object"===typeof exports&&"undefined"!==typeof module?ea(exports,require("react")):"function"===typeof define&&define.amd?define(["exports","react"],ea):(I=I||self,ea(I.ReactDOM={},I.React))})(this,function(I,ea){function k(a){for(var b="https://reactjs.org/docs/error-decoder.html?invariant="+a,c=1;c<arguments.length;c++)b+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+a+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}
function ji(a,b,c,d,e,f,g,h,m){yb=!1;gc=null;ki.apply(li,arguments)}function mi(a,b,c,d,e,f,g,h,m){ji.apply(this,arguments);if(yb){if(yb){var n=gc;yb=!1;gc=null}else throw Error(k(198));hc||(hc=!0,pd=n)}}function lf(a,b,c){var d=a.type||"unknown-event";a.currentTarget=mf(c);mi(d,b,void 0,a);a.currentTarget=null}function nf(){if(ic)for(var a in cb){var b=cb[a],c=ic.indexOf(a);if(!(-1<c))throw Error(k(96,a));if(!jc[c]){if(!b.extractEvents)throw Error(k(97,a));jc[c]=b;c=b.eventTypes;for(var d in c){var e=
void 0;var f=c[d],g=b,h=d;if(qd.hasOwnProperty(h))throw Error(k(99,h));qd[h]=f;var m=f.phasedRegistrationNames;if(m){for(e in m)m.hasOwnProperty(e)&&of(m[e],g,h);e=!0}else f.registrationName?(of(f.registrationName,g,h),e=!0):e=!1;if(!e)throw Error(k(98,d,a));}}}}function of(a,b,c){if(db[a])throw Error(k(100,a));db[a]=b;rd[a]=b.eventTypes[c].dependencies}function pf(a){var b=!1,c;for(c in a)if(a.hasOwnProperty(c)){var d=a[c];if(!cb.hasOwnProperty(c)||cb[c]!==d){if(cb[c])throw Error(k(102,c));cb[c]=
d;b=!0}}b&&nf()}function qf(a){if(a=rf(a)){if("function"!==typeof sd)throw Error(k(280));var b=a.stateNode;b&&(b=td(b),sd(a.stateNode,a.type,b))}}function sf(a){eb?fb?fb.push(a):fb=[a]:eb=a}function tf(){if(eb){var a=eb,b=fb;fb=eb=null;qf(a);if(b)for(a=0;a<b.length;a++)qf(b[a])}}function ud(){if(null!==eb||null!==fb)vd(),tf()}function uf(a,b,c){if(wd)return a(b,c);wd=!0;try{return vf(a,b,c)}finally{wd=!1,ud()}}function ni(a){if(wf.call(xf,a))return!0;if(wf.call(yf,a))return!1;if(oi.test(a))return xf[a]=
!0;yf[a]=!0;return!1}function pi(a,b,c,d){if(null!==c&&0===c.type)return!1;switch(typeof b){case "function":case "symbol":return!0;case "boolean":if(d)return!1;if(null!==c)return!c.acceptsBooleans;a=a.toLowerCase().slice(0,5);return"data-"!==a&&"aria-"!==a;default:return!1}}function qi(a,b,c,d){if(null===b||"undefined"===typeof b||pi(a,b,c,d))return!0;if(d)return!1;if(null!==c)switch(c.type){case 3:return!b;case 4:return!1===b;case 5:return isNaN(b);case 6:return isNaN(b)||1>b}return!1}function L(a,
b,c,d,e,f){this.acceptsBooleans=2===b||3===b||4===b;this.attributeName=d;this.attributeNamespace=e;this.mustUseProperty=c;this.propertyName=a;this.type=b;this.sanitizeURL=f}function xd(a,b,c,d){var e=E.hasOwnProperty(b)?E[b]:null;var f=null!==e?0===e.type:d?!1:!(2<b.length)||"o"!==b[0]&&"O"!==b[0]||"n"!==b[1]&&"N"!==b[1]?!1:!0;f||(qi(b,c,e,d)&&(c=null),d||null===e?ni(b)&&(null===c?a.removeAttribute(b):a.setAttribute(b,""+c)):e.mustUseProperty?a[e.propertyName]=null===c?3===e.type?!1:"":c:(b=e.attributeName,
d=e.attributeNamespace,null===c?a.removeAttribute(b):(e=e.type,c=3===e||4===e&&!0===c?"":""+c,d?a.setAttributeNS(d,b,c):a.setAttribute(b,c))))}function zb(a){if(null===a||"object"!==typeof a)return null;a=zf&&a[zf]||a["@@iterator"];return"function"===typeof a?a:null}function ri(a){if(-1===a._status){a._status=0;var b=a._ctor;b=b();a._result=b;b.then(function(b){0===a._status&&(b=b.default,a._status=1,a._result=b)},function(b){0===a._status&&(a._status=2,a._result=b)})}}function na(a){if(null==a)return null;
if("function"===typeof a)return a.displayName||a.name||null;if("string"===typeof a)return a;switch(a){case Ma:return"Fragment";case gb:return"Portal";case kc:return"Profiler";case Af:return"StrictMode";case lc:return"Suspense";case yd:return"SuspenseList"}if("object"===typeof a)switch(a.$$typeof){case Bf:return"Context.Consumer";case Cf:return"Context.Provider";case zd:var b=a.render;b=b.displayName||b.name||"";return a.displayName||(""!==b?"ForwardRef("+b+")":"ForwardRef");case Ad:return na(a.type);
case Df:return na(a.render);case Ef:if(a=1===a._status?a._result:null)return na(a)}return null}function Bd(a){var b="";do{a:switch(a.tag){case 3:case 4:case 6:case 7:case 10:case 9:var c="";break a;default:var d=a._debugOwner,e=a._debugSource,f=na(a.type);c=null;d&&(c=na(d.type));d=f;f="";e?f=" (at "+e.fileName.replace(si,"")+":"+e.lineNumber+")":c&&(f=" (created by "+c+")");c="\n    in "+(d||"Unknown")+f}b+=c;a=a.return}while(a);return b}function va(a){switch(typeof a){case "boolean":case "number":case "object":case "string":case "undefined":return a;
default:return""}}function Ff(a){var b=a.type;return(a=a.nodeName)&&"input"===a.toLowerCase()&&("checkbox"===b||"radio"===b)}function ti(a){var b=Ff(a)?"checked":"value",c=Object.getOwnPropertyDescriptor(a.constructor.prototype,b),d=""+a[b];if(!a.hasOwnProperty(b)&&"undefined"!==typeof c&&"function"===typeof c.get&&"function"===typeof c.set){var e=c.get,f=c.set;Object.defineProperty(a,b,{configurable:!0,get:function(){return e.call(this)},set:function(a){d=""+a;f.call(this,a)}});Object.defineProperty(a,
b,{enumerable:c.enumerable});return{getValue:function(){return d},setValue:function(a){d=""+a},stopTracking:function(){a._valueTracker=null;delete a[b]}}}}function mc(a){a._valueTracker||(a._valueTracker=ti(a))}function Gf(a){if(!a)return!1;var b=a._valueTracker;if(!b)return!0;var c=b.getValue();var d="";a&&(d=Ff(a)?a.checked?"true":"false":a.value);a=d;return a!==c?(b.setValue(a),!0):!1}function Cd(a,b){var c=b.checked;return M({},b,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=
c?c:a._wrapperState.initialChecked})}function Hf(a,b){var c=null==b.defaultValue?"":b.defaultValue,d=null!=b.checked?b.checked:b.defaultChecked;c=va(null!=b.value?b.value:c);a._wrapperState={initialChecked:d,initialValue:c,controlled:"checkbox"===b.type||"radio"===b.type?null!=b.checked:null!=b.value}}function If(a,b){b=b.checked;null!=b&&xd(a,"checked",b,!1)}function Dd(a,b){If(a,b);var c=va(b.value),d=b.type;if(null!=c)if("number"===d){if(0===c&&""===a.value||a.value!=c)a.value=""+c}else a.value!==
""+c&&(a.value=""+c);else if("submit"===d||"reset"===d){a.removeAttribute("value");return}b.hasOwnProperty("value")?Ed(a,b.type,c):b.hasOwnProperty("defaultValue")&&Ed(a,b.type,va(b.defaultValue));null==b.checked&&null!=b.defaultChecked&&(a.defaultChecked=!!b.defaultChecked)}function Jf(a,b,c){if(b.hasOwnProperty("value")||b.hasOwnProperty("defaultValue")){var d=b.type;if(!("submit"!==d&&"reset"!==d||void 0!==b.value&&null!==b.value))return;b=""+a._wrapperState.initialValue;c||b===a.value||(a.value=
b);a.defaultValue=b}c=a.name;""!==c&&(a.name="");a.defaultChecked=!!a._wrapperState.initialChecked;""!==c&&(a.name=c)}function Ed(a,b,c){if("number"!==b||a.ownerDocument.activeElement!==a)null==c?a.defaultValue=""+a._wrapperState.initialValue:a.defaultValue!==""+c&&(a.defaultValue=""+c)}function ui(a){var b="";ea.Children.forEach(a,function(a){null!=a&&(b+=a)});return b}function Fd(a,b){a=M({children:void 0},b);if(b=ui(b.children))a.children=b;return a}function hb(a,b,c,d){a=a.options;if(b){b={};
for(var e=0;e<c.length;e++)b["$"+c[e]]=!0;for(c=0;c<a.length;c++)e=b.hasOwnProperty("$"+a[c].value),a[c].selected!==e&&(a[c].selected=e),e&&d&&(a[c].defaultSelected=!0)}else{c=""+va(c);b=null;for(e=0;e<a.length;e++){if(a[e].value===c){a[e].selected=!0;d&&(a[e].defaultSelected=!0);return}null!==b||a[e].disabled||(b=a[e])}null!==b&&(b.selected=!0)}}function Gd(a,b){if(null!=b.dangerouslySetInnerHTML)throw Error(k(91));return M({},b,{value:void 0,defaultValue:void 0,children:""+a._wrapperState.initialValue})}
function Kf(a,b){var c=b.value;if(null==c){c=b.children;b=b.defaultValue;if(null!=c){if(null!=b)throw Error(k(92));if(Array.isArray(c)){if(!(1>=c.length))throw Error(k(93));c=c[0]}b=c}null==b&&(b="");c=b}a._wrapperState={initialValue:va(c)}}function Lf(a,b){var c=va(b.value),d=va(b.defaultValue);null!=c&&(c=""+c,c!==a.value&&(a.value=c),null==b.defaultValue&&a.defaultValue!==c&&(a.defaultValue=c));null!=d&&(a.defaultValue=""+d)}function Mf(a,b){b=a.textContent;b===a._wrapperState.initialValue&&""!==
b&&null!==b&&(a.value=b)}function Nf(a){switch(a){case "svg":return"http://www.w3.org/2000/svg";case "math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Hd(a,b){return null==a||"http://www.w3.org/1999/xhtml"===a?Nf(b):"http://www.w3.org/2000/svg"===a&&"foreignObject"===b?"http://www.w3.org/1999/xhtml":a}function nc(a,b){var c={};c[a.toLowerCase()]=b.toLowerCase();c["Webkit"+a]="webkit"+b;c["Moz"+a]="moz"+b;return c}function oc(a){if(Id[a])return Id[a];
if(!ib[a])return a;var b=ib[a],c;for(c in b)if(b.hasOwnProperty(c)&&c in Of)return Id[a]=b[c];return a}function Jd(a){var b=Pf.get(a);void 0===b&&(b=new Map,Pf.set(a,b));return b}function Na(a){var b=a,c=a;if(a.alternate)for(;b.return;)b=b.return;else{a=b;do b=a,0!==(b.effectTag&1026)&&(c=b.return),a=b.return;while(a)}return 3===b.tag?c:null}function Qf(a){if(13===a.tag){var b=a.memoizedState;null===b&&(a=a.alternate,null!==a&&(b=a.memoizedState));if(null!==b)return b.dehydrated}return null}function Rf(a){if(Na(a)!==
a)throw Error(k(188));}function vi(a){var b=a.alternate;if(!b){b=Na(a);if(null===b)throw Error(k(188));return b!==a?null:a}for(var c=a,d=b;;){var e=c.return;if(null===e)break;var f=e.alternate;if(null===f){d=e.return;if(null!==d){c=d;continue}break}if(e.child===f.child){for(f=e.child;f;){if(f===c)return Rf(e),a;if(f===d)return Rf(e),b;f=f.sibling}throw Error(k(188));}if(c.return!==d.return)c=e,d=f;else{for(var g=!1,h=e.child;h;){if(h===c){g=!0;c=e;d=f;break}if(h===d){g=!0;d=e;c=f;break}h=h.sibling}if(!g){for(h=
f.child;h;){if(h===c){g=!0;c=f;d=e;break}if(h===d){g=!0;d=f;c=e;break}h=h.sibling}if(!g)throw Error(k(189));}}if(c.alternate!==d)throw Error(k(190));}if(3!==c.tag)throw Error(k(188));return c.stateNode.current===c?a:b}function Sf(a){a=vi(a);if(!a)return null;for(var b=a;;){if(5===b.tag||6===b.tag)return b;if(b.child)b.child.return=b,b=b.child;else{if(b===a)break;for(;!b.sibling;){if(!b.return||b.return===a)return null;b=b.return}b.sibling.return=b.return;b=b.sibling}}return null}function jb(a,b){if(null==
b)throw Error(k(30));if(null==a)return b;if(Array.isArray(a)){if(Array.isArray(b))return a.push.apply(a,b),a;a.push(b);return a}return Array.isArray(b)?[a].concat(b):[a,b]}function Kd(a,b,c){Array.isArray(a)?a.forEach(b,c):a&&b.call(c,a)}function pc(a){null!==a&&(Ab=jb(Ab,a));a=Ab;Ab=null;if(a){Kd(a,wi);if(Ab)throw Error(k(95));if(hc)throw a=pd,hc=!1,pd=null,a;}}function Ld(a){a=a.target||a.srcElement||window;a.correspondingUseElement&&(a=a.correspondingUseElement);return 3===a.nodeType?a.parentNode:
a}function Tf(a){if(!wa)return!1;a="on"+a;var b=a in document;b||(b=document.createElement("div"),b.setAttribute(a,"return;"),b="function"===typeof b[a]);return b}function Uf(a){a.topLevelType=null;a.nativeEvent=null;a.targetInst=null;a.ancestors.length=0;10>qc.length&&qc.push(a)}function Vf(a,b,c,d){if(qc.length){var e=qc.pop();e.topLevelType=a;e.eventSystemFlags=d;e.nativeEvent=b;e.targetInst=c;return e}return{topLevelType:a,eventSystemFlags:d,nativeEvent:b,targetInst:c,ancestors:[]}}function Wf(a){var b=
a.targetInst,c=b;do{if(!c){a.ancestors.push(c);break}var d=c;if(3===d.tag)d=d.stateNode.containerInfo;else{for(;d.return;)d=d.return;d=3!==d.tag?null:d.stateNode.containerInfo}if(!d)break;b=c.tag;5!==b&&6!==b||a.ancestors.push(c);c=Bb(d)}while(c);for(c=0;c<a.ancestors.length;c++){b=a.ancestors[c];var e=Ld(a.nativeEvent);d=a.topLevelType;var f=a.nativeEvent,g=a.eventSystemFlags;0===c&&(g|=64);for(var h=null,m=0;m<jc.length;m++){var n=jc[m];n&&(n=n.extractEvents(d,b,f,e,g))&&(h=jb(h,n))}pc(h)}}function Md(a,
b,c){if(!c.has(a)){switch(a){case "scroll":Cb(b,"scroll",!0);break;case "focus":case "blur":Cb(b,"focus",!0);Cb(b,"blur",!0);c.set("blur",null);c.set("focus",null);break;case "cancel":case "close":Tf(a)&&Cb(b,a,!0);break;case "invalid":case "submit":case "reset":break;default:-1===Db.indexOf(a)&&w(a,b)}c.set(a,null)}}function xi(a,b){var c=Jd(b);Nd.forEach(function(a){Md(a,b,c)});yi.forEach(function(a){Md(a,b,c)})}function Od(a,b,c,d,e){return{blockedOn:a,topLevelType:b,eventSystemFlags:c|32,nativeEvent:e,
container:d}}function Xf(a,b){switch(a){case "focus":case "blur":xa=null;break;case "dragenter":case "dragleave":ya=null;break;case "mouseover":case "mouseout":za=null;break;case "pointerover":case "pointerout":Eb.delete(b.pointerId);break;case "gotpointercapture":case "lostpointercapture":Fb.delete(b.pointerId)}}function Gb(a,b,c,d,e,f){if(null===a||a.nativeEvent!==f)return a=Od(b,c,d,e,f),null!==b&&(b=Hb(b),null!==b&&Yf(b)),a;a.eventSystemFlags|=d;return a}function zi(a,b,c,d,e){switch(b){case "focus":return xa=
Gb(xa,a,b,c,d,e),!0;case "dragenter":return ya=Gb(ya,a,b,c,d,e),!0;case "mouseover":return za=Gb(za,a,b,c,d,e),!0;case "pointerover":var f=e.pointerId;Eb.set(f,Gb(Eb.get(f)||null,a,b,c,d,e));return!0;case "gotpointercapture":return f=e.pointerId,Fb.set(f,Gb(Fb.get(f)||null,a,b,c,d,e)),!0}return!1}function Ai(a){var b=Bb(a.target);if(null!==b){var c=Na(b);if(null!==c)if(b=c.tag,13===b){if(b=Qf(c),null!==b){a.blockedOn=b;Pd(a.priority,function(){Bi(c)});return}}else if(3===b&&c.stateNode.hydrate){a.blockedOn=
3===c.tag?c.stateNode.containerInfo:null;return}}a.blockedOn=null}function rc(a){if(null!==a.blockedOn)return!1;var b=Qd(a.topLevelType,a.eventSystemFlags,a.container,a.nativeEvent);if(null!==b){var c=Hb(b);null!==c&&Yf(c);a.blockedOn=b;return!1}return!0}function Zf(a,b,c){rc(a)&&c.delete(b)}function Ci(){for(Rd=!1;0<fa.length;){var a=fa[0];if(null!==a.blockedOn){a=Hb(a.blockedOn);null!==a&&Di(a);break}var b=Qd(a.topLevelType,a.eventSystemFlags,a.container,a.nativeEvent);null!==b?a.blockedOn=b:fa.shift()}null!==
xa&&rc(xa)&&(xa=null);null!==ya&&rc(ya)&&(ya=null);null!==za&&rc(za)&&(za=null);Eb.forEach(Zf);Fb.forEach(Zf)}function Ib(a,b){a.blockedOn===b&&(a.blockedOn=null,Rd||(Rd=!0,$f(ag,Ci)))}function bg(a){if(0<fa.length){Ib(fa[0],a);for(var b=1;b<fa.length;b++){var c=fa[b];c.blockedOn===a&&(c.blockedOn=null)}}null!==xa&&Ib(xa,a);null!==ya&&Ib(ya,a);null!==za&&Ib(za,a);b=function(b){return Ib(b,a)};Eb.forEach(b);Fb.forEach(b);for(b=0;b<Jb.length;b++)c=Jb[b],c.blockedOn===a&&(c.blockedOn=null);for(;0<Jb.length&&
(b=Jb[0],null===b.blockedOn);)Ai(b),null===b.blockedOn&&Jb.shift()}function Sd(a,b){for(var c=0;c<a.length;c+=2){var d=a[c],e=a[c+1],f="on"+(e[0].toUpperCase()+e.slice(1));f={phasedRegistrationNames:{bubbled:f,captured:f+"Capture"},dependencies:[d],eventPriority:b};Td.set(d,b);cg.set(d,f);dg[e]=f}}function w(a,b){Cb(b,a,!1)}function Cb(a,b,c){var d=Td.get(b);switch(void 0===d?2:d){case 0:d=Ei.bind(null,b,1,a);break;case 1:d=Fi.bind(null,b,1,a);break;default:d=sc.bind(null,b,1,a)}c?a.addEventListener(b,
d,!0):a.addEventListener(b,d,!1)}function Ei(a,b,c,d){Oa||vd();var e=sc,f=Oa;Oa=!0;try{eg(e,a,b,c,d)}finally{(Oa=f)||ud()}}function Fi(a,b,c,d){Gi(Hi,sc.bind(null,a,b,c,d))}function sc(a,b,c,d){if(tc)if(0<fa.length&&-1<Nd.indexOf(a))a=Od(null,a,b,c,d),fa.push(a);else{var e=Qd(a,b,c,d);if(null===e)Xf(a,d);else if(-1<Nd.indexOf(a))a=Od(e,a,b,c,d),fa.push(a);else if(!zi(e,a,b,c,d)){Xf(a,d);a=Vf(a,d,null,b);try{uf(Wf,a)}finally{Uf(a)}}}}function Qd(a,b,c,d){c=Ld(d);c=Bb(c);if(null!==c){var e=Na(c);if(null===
e)c=null;else{var f=e.tag;if(13===f){c=Qf(e);if(null!==c)return c;c=null}else if(3===f){if(e.stateNode.hydrate)return 3===e.tag?e.stateNode.containerInfo:null;c=null}else e!==c&&(c=null)}}a=Vf(a,d,c,b);try{uf(Wf,a)}finally{Uf(a)}return null}function fg(a,b,c){return null==b||"boolean"===typeof b||""===b?"":c||"number"!==typeof b||0===b||Kb.hasOwnProperty(a)&&Kb[a]?(""+b).trim():b+"px"}function gg(a,b){a=a.style;for(var c in b)if(b.hasOwnProperty(c)){var d=0===c.indexOf("--"),e=fg(c,b[c],d);"float"===
c&&(c="cssFloat");d?a.setProperty(c,e):a[c]=e}}function Ud(a,b){if(b){if(Ii[a]&&(null!=b.children||null!=b.dangerouslySetInnerHTML))throw Error(k(137,a,""));if(null!=b.dangerouslySetInnerHTML){if(null!=b.children)throw Error(k(60));if(!("object"===typeof b.dangerouslySetInnerHTML&&"__html"in b.dangerouslySetInnerHTML))throw Error(k(61));}if(null!=b.style&&"object"!==typeof b.style)throw Error(k(62,""));}}function Vd(a,b){if(-1===a.indexOf("-"))return"string"===typeof b.is;switch(a){case "annotation-xml":case "color-profile":case "font-face":case "font-face-src":case "font-face-uri":case "font-face-format":case "font-face-name":case "missing-glyph":return!1;
default:return!0}}function oa(a,b){a=9===a.nodeType||11===a.nodeType?a:a.ownerDocument;var c=Jd(a);b=rd[b];for(var d=0;d<b.length;d++)Md(b[d],a,c)}function uc(){}function Wd(a){a=a||("undefined"!==typeof document?document:void 0);if("undefined"===typeof a)return null;try{return a.activeElement||a.body}catch(b){return a.body}}function hg(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function ig(a,b){var c=hg(a);a=0;for(var d;c;){if(3===c.nodeType){d=a+c.textContent.length;if(a<=b&&d>=b)return{node:c,
offset:b-a};a=d}a:{for(;c;){if(c.nextSibling){c=c.nextSibling;break a}c=c.parentNode}c=void 0}c=hg(c)}}function jg(a,b){return a&&b?a===b?!0:a&&3===a.nodeType?!1:b&&3===b.nodeType?jg(a,b.parentNode):"contains"in a?a.contains(b):a.compareDocumentPosition?!!(a.compareDocumentPosition(b)&16):!1:!1}function kg(){for(var a=window,b=Wd();b instanceof a.HTMLIFrameElement;){try{var c="string"===typeof b.contentWindow.location.href}catch(d){c=!1}if(c)a=b.contentWindow;else break;b=Wd(a.document)}return b}
function Xd(a){var b=a&&a.nodeName&&a.nodeName.toLowerCase();return b&&("input"===b&&("text"===a.type||"search"===a.type||"tel"===a.type||"url"===a.type||"password"===a.type)||"textarea"===b||"true"===a.contentEditable)}function lg(a,b){switch(a){case "button":case "input":case "select":case "textarea":return!!b.autoFocus}return!1}function Yd(a,b){return"textarea"===a||"option"===a||"noscript"===a||"string"===typeof b.children||"number"===typeof b.children||"object"===typeof b.dangerouslySetInnerHTML&&
null!==b.dangerouslySetInnerHTML&&null!=b.dangerouslySetInnerHTML.__html}function kb(a){for(;null!=a;a=a.nextSibling){var b=a.nodeType;if(1===b||3===b)break}return a}function mg(a){a=a.previousSibling;for(var b=0;a;){if(8===a.nodeType){var c=a.data;if(c===ng||c===Zd||c===$d){if(0===b)return a;b--}else c===og&&b++}a=a.previousSibling}return null}function Bb(a){var b=a[Aa];if(b)return b;for(var c=a.parentNode;c;){if(b=c[Lb]||c[Aa]){c=b.alternate;if(null!==b.child||null!==c&&null!==c.child)for(a=mg(a);null!==
a;){if(c=a[Aa])return c;a=mg(a)}return b}a=c;c=a.parentNode}return null}function Hb(a){a=a[Aa]||a[Lb];return!a||5!==a.tag&&6!==a.tag&&13!==a.tag&&3!==a.tag?null:a}function Pa(a){if(5===a.tag||6===a.tag)return a.stateNode;throw Error(k(33));}function ae(a){return a[vc]||null}function pa(a){do a=a.return;while(a&&5!==a.tag);return a?a:null}function pg(a,b){var c=a.stateNode;if(!c)return null;var d=td(c);if(!d)return null;c=d[b];a:switch(b){case "onClick":case "onClickCapture":case "onDoubleClick":case "onDoubleClickCapture":case "onMouseDown":case "onMouseDownCapture":case "onMouseMove":case "onMouseMoveCapture":case "onMouseUp":case "onMouseUpCapture":case "onMouseEnter":(d=
!d.disabled)||(a=a.type,d=!("button"===a||"input"===a||"select"===a||"textarea"===a));a=!d;break a;default:a=!1}if(a)return null;if(c&&"function"!==typeof c)throw Error(k(231,b,typeof c));return c}function qg(a,b,c){if(b=pg(a,c.dispatchConfig.phasedRegistrationNames[b]))c._dispatchListeners=jb(c._dispatchListeners,b),c._dispatchInstances=jb(c._dispatchInstances,a)}function Ji(a){if(a&&a.dispatchConfig.phasedRegistrationNames){for(var b=a._targetInst,c=[];b;)c.push(b),b=pa(b);for(b=c.length;0<b--;)qg(c[b],
"captured",a);for(b=0;b<c.length;b++)qg(c[b],"bubbled",a)}}function be(a,b,c){a&&c&&c.dispatchConfig.registrationName&&(b=pg(a,c.dispatchConfig.registrationName))&&(c._dispatchListeners=jb(c._dispatchListeners,b),c._dispatchInstances=jb(c._dispatchInstances,a))}function Ki(a){a&&a.dispatchConfig.registrationName&&be(a._targetInst,null,a)}function lb(a){Kd(a,Ji)}function rg(){if(wc)return wc;var a,b=ce,c=b.length,d,e="value"in Ba?Ba.value:Ba.textContent,f=e.length;for(a=0;a<c&&b[a]===e[a];a++);var g=
c-a;for(d=1;d<=g&&b[c-d]===e[f-d];d++);return wc=e.slice(a,1<d?1-d:void 0)}function xc(){return!0}function yc(){return!1}function R(a,b,c,d){this.dispatchConfig=a;this._targetInst=b;this.nativeEvent=c;a=this.constructor.Interface;for(var e in a)a.hasOwnProperty(e)&&((b=a[e])?this[e]=b(c):"target"===e?this.target=d:this[e]=c[e]);this.isDefaultPrevented=(null!=c.defaultPrevented?c.defaultPrevented:!1===c.returnValue)?xc:yc;this.isPropagationStopped=yc;return this}function Li(a,b,c,d){if(this.eventPool.length){var e=
this.eventPool.pop();this.call(e,a,b,c,d);return e}return new this(a,b,c,d)}function Mi(a){if(!(a instanceof this))throw Error(k(279));a.destructor();10>this.eventPool.length&&this.eventPool.push(a)}function sg(a){a.eventPool=[];a.getPooled=Li;a.release=Mi}function tg(a,b){switch(a){case "keyup":return-1!==Ni.indexOf(b.keyCode);case "keydown":return 229!==b.keyCode;case "keypress":case "mousedown":case "blur":return!0;default:return!1}}function ug(a){a=a.detail;return"object"===typeof a&&"data"in
a?a.data:null}function Oi(a,b){switch(a){case "compositionend":return ug(b);case "keypress":if(32!==b.which)return null;vg=!0;return wg;case "textInput":return a=b.data,a===wg&&vg?null:a;default:return null}}function Pi(a,b){if(mb)return"compositionend"===a||!de&&tg(a,b)?(a=rg(),wc=ce=Ba=null,mb=!1,a):null;switch(a){case "paste":return null;case "keypress":if(!(b.ctrlKey||b.altKey||b.metaKey)||b.ctrlKey&&b.altKey){if(b.char&&1<b.char.length)return b.char;if(b.which)return String.fromCharCode(b.which)}return null;
case "compositionend":return xg&&"ko"!==b.locale?null:b.data;default:return null}}function yg(a){var b=a&&a.nodeName&&a.nodeName.toLowerCase();return"input"===b?!!Qi[a.type]:"textarea"===b?!0:!1}function zg(a,b,c){a=R.getPooled(Ag.change,a,b,c);a.type="change";sf(c);lb(a);return a}function Ri(a){pc(a)}function zc(a){var b=Pa(a);if(Gf(b))return a}function Si(a,b){if("change"===a)return b}function Bg(){Mb&&(Mb.detachEvent("onpropertychange",Cg),Nb=Mb=null)}function Cg(a){if("value"===a.propertyName&&
zc(Nb))if(a=zg(Nb,a,Ld(a)),Oa)pc(a);else{Oa=!0;try{ee(Ri,a)}finally{Oa=!1,ud()}}}function Ti(a,b,c){"focus"===a?(Bg(),Mb=b,Nb=c,Mb.attachEvent("onpropertychange",Cg)):"blur"===a&&Bg()}function Ui(a,b){if("selectionchange"===a||"keyup"===a||"keydown"===a)return zc(Nb)}function Vi(a,b){if("click"===a)return zc(b)}function Wi(a,b){if("input"===a||"change"===a)return zc(b)}function Xi(a){var b=this.nativeEvent;return b.getModifierState?b.getModifierState(a):(a=Yi[a])?!!b[a]:!1}function fe(a){return Xi}
function Zi(a,b){return a===b&&(0!==a||1/a===1/b)||a!==a&&b!==b}function Ob(a,b){if(Qa(a,b))return!0;if("object"!==typeof a||null===a||"object"!==typeof b||null===b)return!1;var c=Object.keys(a),d=Object.keys(b);if(c.length!==d.length)return!1;for(d=0;d<c.length;d++)if(!$i.call(b,c[d])||!Qa(a[c[d]],b[c[d]]))return!1;return!0}function Dg(a,b){var c=b.window===b?b.document:9===b.nodeType?b:b.ownerDocument;if(ge||null==nb||nb!==Wd(c))return null;c=nb;"selectionStart"in c&&Xd(c)?c={start:c.selectionStart,
end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset});return Pb&&Ob(Pb,c)?null:(Pb=c,a=R.getPooled(Eg.select,he,a,b),a.type="select",a.target=nb,lb(a),a)}function Ac(a){var b=a.keyCode;"charCode"in a?(a=a.charCode,0===a&&13===b&&(a=13)):a=b;10===a&&(a=13);return 32<=a||13===a?a:0}function q(a,b){0>ob||(a.current=ie[ob],ie[ob]=null,ob--)}function y(a,b,c){ob++;
ie[ob]=a.current;a.current=b}function pb(a,b){var c=a.type.contextTypes;if(!c)return Ca;var d=a.stateNode;if(d&&d.__reactInternalMemoizedUnmaskedChildContext===b)return d.__reactInternalMemoizedMaskedChildContext;var e={},f;for(f in c)e[f]=b[f];d&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=b,a.__reactInternalMemoizedMaskedChildContext=e);return e}function N(a){a=a.childContextTypes;return null!==a&&void 0!==a}function Fg(a,b,c){if(B.current!==Ca)throw Error(k(168));y(B,b);y(G,c)}
function Gg(a,b,c){var d=a.stateNode;a=b.childContextTypes;if("function"!==typeof d.getChildContext)return c;d=d.getChildContext();for(var e in d)if(!(e in a))throw Error(k(108,na(b)||"Unknown",e));return M({},c,{},d)}function Bc(a){a=(a=a.stateNode)&&a.__reactInternalMemoizedMergedChildContext||Ca;Ra=B.current;y(B,a);y(G,G.current);return!0}function Hg(a,b,c){var d=a.stateNode;if(!d)throw Error(k(169));c?(a=Gg(a,b,Ra),d.__reactInternalMemoizedMergedChildContext=a,q(G),q(B),y(B,a)):q(G);y(G,c)}function Cc(){switch(aj()){case Dc:return 99;
case Ig:return 98;case Jg:return 97;case Kg:return 96;case Lg:return 95;default:throw Error(k(332));}}function Mg(a){switch(a){case 99:return Dc;case 98:return Ig;case 97:return Jg;case 96:return Kg;case 95:return Lg;default:throw Error(k(332));}}function Da(a,b){a=Mg(a);return bj(a,b)}function Ng(a,b,c){a=Mg(a);return je(a,b,c)}function Og(a){null===qa?(qa=[a],Ec=je(Dc,Pg)):qa.push(a);return Qg}function ha(){if(null!==Ec){var a=Ec;Ec=null;Rg(a)}Pg()}function Pg(){if(!ke&&null!==qa){ke=!0;var a=0;
try{var b=qa;Da(99,function(){for(;a<b.length;a++){var c=b[a];do c=c(!0);while(null!==c)}});qa=null}catch(c){throw null!==qa&&(qa=qa.slice(a+1)),je(Dc,ha),c;}finally{ke=!1}}}function Fc(a,b,c){c/=10;return 1073741821-(((1073741821-a+b/10)/c|0)+1)*c}function aa(a,b){if(a&&a.defaultProps){b=M({},b);a=a.defaultProps;for(var c in a)void 0===b[c]&&(b[c]=a[c])}return b}function le(){Gc=qb=Hc=null}function me(a){var b=Ic.current;q(Ic);a.type._context._currentValue=b}function Sg(a,b){for(;null!==a;){var c=
a.alternate;if(a.childExpirationTime<b)a.childExpirationTime=b,null!==c&&c.childExpirationTime<b&&(c.childExpirationTime=b);else if(null!==c&&c.childExpirationTime<b)c.childExpirationTime=b;else break;a=a.return}}function rb(a,b){Hc=a;Gc=qb=null;a=a.dependencies;null!==a&&null!==a.firstContext&&(a.expirationTime>=b&&(ia=!0),a.firstContext=null)}function W(a,b){if(Gc!==a&&!1!==b&&0!==b){if("number"!==typeof b||1073741823===b)Gc=a,b=1073741823;b={context:a,observedBits:b,next:null};if(null===qb){if(null===
Hc)throw Error(k(308));qb=b;Hc.dependencies={expirationTime:0,firstContext:b,responders:null}}else qb=qb.next=b}return a._currentValue}function ne(a){a.updateQueue={baseState:a.memoizedState,baseQueue:null,shared:{pending:null},effects:null}}function oe(a,b){a=a.updateQueue;b.updateQueue===a&&(b.updateQueue={baseState:a.baseState,baseQueue:a.baseQueue,shared:a.shared,effects:a.effects})}function Ea(a,b){a={expirationTime:a,suspenseConfig:b,tag:Tg,payload:null,callback:null,next:null};return a.next=
a}function Fa(a,b){a=a.updateQueue;if(null!==a){a=a.shared;var c=a.pending;null===c?b.next=b:(b.next=c.next,c.next=b);a.pending=b}}function Ug(a,b){var c=a.alternate;null!==c&&oe(c,a);a=a.updateQueue;c=a.baseQueue;null===c?(a.baseQueue=b.next=b,b.next=b):(b.next=c.next,c.next=b)}function Qb(a,b,c,d){var e=a.updateQueue;Ga=!1;var f=e.baseQueue,g=e.shared.pending;if(null!==g){if(null!==f){var h=f.next;f.next=g.next;g.next=h}f=g;e.shared.pending=null;h=a.alternate;null!==h&&(h=h.updateQueue,null!==h&&
(h.baseQueue=g))}if(null!==f){h=f.next;var m=e.baseState,n=0,k=null,ba=null,l=null;if(null!==h){var p=h;do{g=p.expirationTime;if(g<d){var t={expirationTime:p.expirationTime,suspenseConfig:p.suspenseConfig,tag:p.tag,payload:p.payload,callback:p.callback,next:null};null===l?(ba=l=t,k=m):l=l.next=t;g>n&&(n=g)}else{null!==l&&(l=l.next={expirationTime:1073741823,suspenseConfig:p.suspenseConfig,tag:p.tag,payload:p.payload,callback:p.callback,next:null});Vg(g,p.suspenseConfig);a:{var q=a,r=p;g=b;t=c;switch(r.tag){case 1:q=
r.payload;if("function"===typeof q){m=q.call(t,m,g);break a}m=q;break a;case 3:q.effectTag=q.effectTag&-4097|64;case Tg:q=r.payload;g="function"===typeof q?q.call(t,m,g):q;if(null===g||void 0===g)break a;m=M({},m,g);break a;case Jc:Ga=!0}}null!==p.callback&&(a.effectTag|=32,g=e.effects,null===g?e.effects=[p]:g.push(p))}p=p.next;if(null===p||p===h)if(g=e.shared.pending,null===g)break;else p=f.next=g.next,g.next=h,e.baseQueue=f=g,e.shared.pending=null}while(1)}null===l?k=m:l.next=ba;e.baseState=k;e.baseQueue=
l;Kc(n);a.expirationTime=n;a.memoizedState=m}}function Wg(a,b,c){a=b.effects;b.effects=null;if(null!==a)for(b=0;b<a.length;b++){var d=a[b],e=d.callback;if(null!==e){d.callback=null;d=e;e=c;if("function"!==typeof d)throw Error(k(191,d));d.call(e)}}}function Lc(a,b,c,d){b=a.memoizedState;c=c(d,b);c=null===c||void 0===c?b:M({},b,c);a.memoizedState=c;0===a.expirationTime&&(a.updateQueue.baseState=c)}function Xg(a,b,c,d,e,f,g){a=a.stateNode;return"function"===typeof a.shouldComponentUpdate?a.shouldComponentUpdate(d,
f,g):b.prototype&&b.prototype.isPureReactComponent?!Ob(c,d)||!Ob(e,f):!0}function Yg(a,b,c){var d=!1,e=Ca;var f=b.contextType;"object"===typeof f&&null!==f?f=W(f):(e=N(b)?Ra:B.current,d=b.contextTypes,f=(d=null!==d&&void 0!==d)?pb(a,e):Ca);b=new b(c,f);a.memoizedState=null!==b.state&&void 0!==b.state?b.state:null;b.updater=Mc;a.stateNode=b;b._reactInternalFiber=a;d&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=e,a.__reactInternalMemoizedMaskedChildContext=f);return b}function Zg(a,
b,c,d){a=b.state;"function"===typeof b.componentWillReceiveProps&&b.componentWillReceiveProps(c,d);"function"===typeof b.UNSAFE_componentWillReceiveProps&&b.UNSAFE_componentWillReceiveProps(c,d);b.state!==a&&Mc.enqueueReplaceState(b,b.state,null)}function pe(a,b,c,d){var e=a.stateNode;e.props=c;e.state=a.memoizedState;e.refs=$g;ne(a);var f=b.contextType;"object"===typeof f&&null!==f?e.context=W(f):(f=N(b)?Ra:B.current,e.context=pb(a,f));Qb(a,c,e,d);e.state=a.memoizedState;f=b.getDerivedStateFromProps;
"function"===typeof f&&(Lc(a,b,f,c),e.state=a.memoizedState);"function"===typeof b.getDerivedStateFromProps||"function"===typeof e.getSnapshotBeforeUpdate||"function"!==typeof e.UNSAFE_componentWillMount&&"function"!==typeof e.componentWillMount||(b=e.state,"function"===typeof e.componentWillMount&&e.componentWillMount(),"function"===typeof e.UNSAFE_componentWillMount&&e.UNSAFE_componentWillMount(),b!==e.state&&Mc.enqueueReplaceState(e,e.state,null),Qb(a,c,e,d),e.state=a.memoizedState);"function"===
typeof e.componentDidMount&&(a.effectTag|=4)}function Rb(a,b,c){a=c.ref;if(null!==a&&"function"!==typeof a&&"object"!==typeof a){if(c._owner){c=c._owner;if(c){if(1!==c.tag)throw Error(k(309));var d=c.stateNode}if(!d)throw Error(k(147,a));var e=""+a;if(null!==b&&null!==b.ref&&"function"===typeof b.ref&&b.ref._stringRef===e)return b.ref;b=function(a){var b=d.refs;b===$g&&(b=d.refs={});null===a?delete b[e]:b[e]=a};b._stringRef=e;return b}if("string"!==typeof a)throw Error(k(284));if(!c._owner)throw Error(k(290,
a));}return a}function Nc(a,b){if("textarea"!==a.type)throw Error(k(31,"[object Object]"===Object.prototype.toString.call(b)?"object with keys {"+Object.keys(b).join(", ")+"}":b,""));}function ah(a){function b(b,c){if(a){var d=b.lastEffect;null!==d?(d.nextEffect=c,b.lastEffect=c):b.firstEffect=b.lastEffect=c;c.nextEffect=null;c.effectTag=8}}function c(c,d){if(!a)return null;for(;null!==d;)b(c,d),d=d.sibling;return null}function d(a,b){for(a=new Map;null!==b;)null!==b.key?a.set(b.key,b):a.set(b.index,
b),b=b.sibling;return a}function e(a,b){a=Sa(a,b);a.index=0;a.sibling=null;return a}function f(b,c,d){b.index=d;if(!a)return c;d=b.alternate;if(null!==d)return d=d.index,d<c?(b.effectTag=2,c):d;b.effectTag=2;return c}function g(b){a&&null===b.alternate&&(b.effectTag=2);return b}function h(a,b,c,d){if(null===b||6!==b.tag)return b=qe(c,a.mode,d),b.return=a,b;b=e(b,c);b.return=a;return b}function m(a,b,c,d){if(null!==b&&b.elementType===c.type)return d=e(b,c.props),d.ref=Rb(a,b,c),d.return=a,d;d=Oc(c.type,
c.key,c.props,null,a.mode,d);d.ref=Rb(a,b,c);d.return=a;return d}function n(a,b,c,d){if(null===b||4!==b.tag||b.stateNode.containerInfo!==c.containerInfo||b.stateNode.implementation!==c.implementation)return b=re(c,a.mode,d),b.return=a,b;b=e(b,c.children||[]);b.return=a;return b}function l(a,b,c,d,f){if(null===b||7!==b.tag)return b=Ha(c,a.mode,d,f),b.return=a,b;b=e(b,c);b.return=a;return b}function ba(a,b,c){if("string"===typeof b||"number"===typeof b)return b=qe(""+b,a.mode,c),b.return=a,b;if("object"===
typeof b&&null!==b){switch(b.$$typeof){case Pc:return c=Oc(b.type,b.key,b.props,null,a.mode,c),c.ref=Rb(a,null,b),c.return=a,c;case gb:return b=re(b,a.mode,c),b.return=a,b}if(Qc(b)||zb(b))return b=Ha(b,a.mode,c,null),b.return=a,b;Nc(a,b)}return null}function p(a,b,c,d){var e=null!==b?b.key:null;if("string"===typeof c||"number"===typeof c)return null!==e?null:h(a,b,""+c,d);if("object"===typeof c&&null!==c){switch(c.$$typeof){case Pc:return c.key===e?c.type===Ma?l(a,b,c.props.children,d,e):m(a,b,c,
d):null;case gb:return c.key===e?n(a,b,c,d):null}if(Qc(c)||zb(c))return null!==e?null:l(a,b,c,d,null);Nc(a,c)}return null}function t(a,b,c,d,e){if("string"===typeof d||"number"===typeof d)return a=a.get(c)||null,h(b,a,""+d,e);if("object"===typeof d&&null!==d){switch(d.$$typeof){case Pc:return a=a.get(null===d.key?c:d.key)||null,d.type===Ma?l(b,a,d.props.children,e,d.key):m(b,a,d,e);case gb:return a=a.get(null===d.key?c:d.key)||null,n(b,a,d,e)}if(Qc(d)||zb(d))return a=a.get(c)||null,l(b,a,d,e,null);
Nc(b,d)}return null}function q(e,g,h,m){for(var n=null,k=null,l=g,r=g=0,C=null;null!==l&&r<h.length;r++){l.index>r?(C=l,l=null):C=l.sibling;var O=p(e,l,h[r],m);if(null===O){null===l&&(l=C);break}a&&l&&null===O.alternate&&b(e,l);g=f(O,g,r);null===k?n=O:k.sibling=O;k=O;l=C}if(r===h.length)return c(e,l),n;if(null===l){for(;r<h.length;r++)l=ba(e,h[r],m),null!==l&&(g=f(l,g,r),null===k?n=l:k.sibling=l,k=l);return n}for(l=d(e,l);r<h.length;r++)C=t(l,e,r,h[r],m),null!==C&&(a&&null!==C.alternate&&l.delete(null===
C.key?r:C.key),g=f(C,g,r),null===k?n=C:k.sibling=C,k=C);a&&l.forEach(function(a){return b(e,a)});return n}function w(e,g,h,n){var m=zb(h);if("function"!==typeof m)throw Error(k(150));h=m.call(h);if(null==h)throw Error(k(151));for(var l=m=null,r=g,C=g=0,O=null,v=h.next();null!==r&&!v.done;C++,v=h.next()){r.index>C?(O=r,r=null):O=r.sibling;var q=p(e,r,v.value,n);if(null===q){null===r&&(r=O);break}a&&r&&null===q.alternate&&b(e,r);g=f(q,g,C);null===l?m=q:l.sibling=q;l=q;r=O}if(v.done)return c(e,r),m;
if(null===r){for(;!v.done;C++,v=h.next())v=ba(e,v.value,n),null!==v&&(g=f(v,g,C),null===l?m=v:l.sibling=v,l=v);return m}for(r=d(e,r);!v.done;C++,v=h.next())v=t(r,e,C,v.value,n),null!==v&&(a&&null!==v.alternate&&r.delete(null===v.key?C:v.key),g=f(v,g,C),null===l?m=v:l.sibling=v,l=v);a&&r.forEach(function(a){return b(e,a)});return m}return function(a,d,f,h){var m="object"===typeof f&&null!==f&&f.type===Ma&&null===f.key;m&&(f=f.props.children);var n="object"===typeof f&&null!==f;if(n)switch(f.$$typeof){case Pc:a:{n=
f.key;for(m=d;null!==m;){if(m.key===n){switch(m.tag){case 7:if(f.type===Ma){c(a,m.sibling);d=e(m,f.props.children);d.return=a;a=d;break a}break;default:if(m.elementType===f.type){c(a,m.sibling);d=e(m,f.props);d.ref=Rb(a,m,f);d.return=a;a=d;break a}}c(a,m);break}else b(a,m);m=m.sibling}f.type===Ma?(d=Ha(f.props.children,a.mode,h,f.key),d.return=a,a=d):(h=Oc(f.type,f.key,f.props,null,a.mode,h),h.ref=Rb(a,d,f),h.return=a,a=h)}return g(a);case gb:a:{for(m=f.key;null!==d;){if(d.key===m)if(4===d.tag&&d.stateNode.containerInfo===
f.containerInfo&&d.stateNode.implementation===f.implementation){c(a,d.sibling);d=e(d,f.children||[]);d.return=a;a=d;break a}else{c(a,d);break}else b(a,d);d=d.sibling}d=re(f,a.mode,h);d.return=a;a=d}return g(a)}if("string"===typeof f||"number"===typeof f)return f=""+f,null!==d&&6===d.tag?(c(a,d.sibling),d=e(d,f),d.return=a,a=d):(c(a,d),d=qe(f,a.mode,h),d.return=a,a=d),g(a);if(Qc(f))return q(a,d,f,h);if(zb(f))return w(a,d,f,h);n&&Nc(a,f);if("undefined"===typeof f&&!m)switch(a.tag){case 1:case 0:throw a=
a.type,Error(k(152,a.displayName||a.name||"Component"));}return c(a,d)}}function Ta(a){if(a===Sb)throw Error(k(174));return a}function se(a,b){y(Tb,b);y(Ub,a);y(ja,Sb);a=b.nodeType;switch(a){case 9:case 11:b=(b=b.documentElement)?b.namespaceURI:Hd(null,"");break;default:a=8===a?b.parentNode:b,b=a.namespaceURI||null,a=a.tagName,b=Hd(b,a)}q(ja);y(ja,b)}function tb(a){q(ja);q(Ub);q(Tb)}function bh(a){Ta(Tb.current);var b=Ta(ja.current);var c=Hd(b,a.type);b!==c&&(y(Ub,a),y(ja,c))}function te(a){Ub.current===
a&&(q(ja),q(Ub))}function Rc(a){for(var b=a;null!==b;){if(13===b.tag){var c=b.memoizedState;if(null!==c&&(c=c.dehydrated,null===c||c.data===$d||c.data===Zd))return b}else if(19===b.tag&&void 0!==b.memoizedProps.revealOrder){if(0!==(b.effectTag&64))return b}else if(null!==b.child){b.child.return=b;b=b.child;continue}if(b===a)break;for(;null===b.sibling;){if(null===b.return||b.return===a)return null;b=b.return}b.sibling.return=b.return;b=b.sibling}return null}function ue(a,b){return{responder:a,props:b}}
function S(){throw Error(k(321));}function ve(a,b){if(null===b)return!1;for(var c=0;c<b.length&&c<a.length;c++)if(!Qa(a[c],b[c]))return!1;return!0}function we(a,b,c,d,e,f){Ia=f;z=b;b.memoizedState=null;b.updateQueue=null;b.expirationTime=0;Sc.current=null===a||null===a.memoizedState?dj:ej;a=c(d,e);if(b.expirationTime===Ia){f=0;do{b.expirationTime=0;if(!(25>f))throw Error(k(301));f+=1;J=K=null;b.updateQueue=null;Sc.current=fj;a=c(d,e)}while(b.expirationTime===Ia)}Sc.current=Tc;b=null!==K&&null!==K.next;
Ia=0;J=K=z=null;Uc=!1;if(b)throw Error(k(300));return a}function ub(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};null===J?z.memoizedState=J=a:J=J.next=a;return J}function vb(){if(null===K){var a=z.alternate;a=null!==a?a.memoizedState:null}else a=K.next;var b=null===J?z.memoizedState:J.next;if(null!==b)J=b,K=a;else{if(null===a)throw Error(k(310));K=a;a={memoizedState:K.memoizedState,baseState:K.baseState,baseQueue:K.baseQueue,queue:K.queue,next:null};null===J?z.memoizedState=
J=a:J=J.next=a}return J}function Ua(a,b){return"function"===typeof b?b(a):b}function Vc(a,b,c){b=vb();c=b.queue;if(null===c)throw Error(k(311));c.lastRenderedReducer=a;var d=K,e=d.baseQueue,f=c.pending;if(null!==f){if(null!==e){var g=e.next;e.next=f.next;f.next=g}d.baseQueue=e=f;c.pending=null}if(null!==e){e=e.next;d=d.baseState;var h=g=f=null,m=e;do{var n=m.expirationTime;if(n<Ia){var l={expirationTime:m.expirationTime,suspenseConfig:m.suspenseConfig,action:m.action,eagerReducer:m.eagerReducer,eagerState:m.eagerState,
next:null};null===h?(g=h=l,f=d):h=h.next=l;n>z.expirationTime&&(z.expirationTime=n,Kc(n))}else null!==h&&(h=h.next={expirationTime:1073741823,suspenseConfig:m.suspenseConfig,action:m.action,eagerReducer:m.eagerReducer,eagerState:m.eagerState,next:null}),Vg(n,m.suspenseConfig),d=m.eagerReducer===a?m.eagerState:a(d,m.action);m=m.next}while(null!==m&&m!==e);null===h?f=d:h.next=g;Qa(d,b.memoizedState)||(ia=!0);b.memoizedState=d;b.baseState=f;b.baseQueue=h;c.lastRenderedState=d}return[b.memoizedState,
c.dispatch]}function Wc(a,b,c){b=vb();c=b.queue;if(null===c)throw Error(k(311));c.lastRenderedReducer=a;var d=c.dispatch,e=c.pending,f=b.memoizedState;if(null!==e){c.pending=null;var g=e=e.next;do f=a(f,g.action),g=g.next;while(g!==e);Qa(f,b.memoizedState)||(ia=!0);b.memoizedState=f;null===b.baseQueue&&(b.baseState=f);c.lastRenderedState=f}return[f,d]}function xe(a){var b=ub();"function"===typeof a&&(a=a());b.memoizedState=b.baseState=a;a=b.queue={pending:null,dispatch:null,lastRenderedReducer:Ua,
lastRenderedState:a};a=a.dispatch=ch.bind(null,z,a);return[b.memoizedState,a]}function ye(a,b,c,d){a={tag:a,create:b,destroy:c,deps:d,next:null};b=z.updateQueue;null===b?(b={lastEffect:null},z.updateQueue=b,b.lastEffect=a.next=a):(c=b.lastEffect,null===c?b.lastEffect=a.next=a:(d=c.next,c.next=a,a.next=d,b.lastEffect=a));return a}function dh(a){return vb().memoizedState}function ze(a,b,c,d){var e=ub();z.effectTag|=a;e.memoizedState=ye(1|b,c,void 0,void 0===d?null:d)}function Ae(a,b,c,d){var e=vb();
d=void 0===d?null:d;var f=void 0;if(null!==K){var g=K.memoizedState;f=g.destroy;if(null!==d&&ve(d,g.deps)){ye(b,c,f,d);return}}z.effectTag|=a;e.memoizedState=ye(1|b,c,f,d)}function eh(a,b){return ze(516,4,a,b)}function Xc(a,b){return Ae(516,4,a,b)}function fh(a,b){return Ae(4,2,a,b)}function gh(a,b){if("function"===typeof b)return a=a(),b(a),function(){b(null)};if(null!==b&&void 0!==b)return a=a(),b.current=a,function(){b.current=null}}function hh(a,b,c){c=null!==c&&void 0!==c?c.concat([a]):null;
return Ae(4,2,gh.bind(null,b,a),c)}function Be(a,b){}function ih(a,b){ub().memoizedState=[a,void 0===b?null:b];return a}function Yc(a,b){var c=vb();b=void 0===b?null:b;var d=c.memoizedState;if(null!==d&&null!==b&&ve(b,d[1]))return d[0];c.memoizedState=[a,b];return a}function jh(a,b){var c=vb();b=void 0===b?null:b;var d=c.memoizedState;if(null!==d&&null!==b&&ve(b,d[1]))return d[0];a=a();c.memoizedState=[a,b];return a}function Ce(a,b,c){var d=Cc();Da(98>d?98:d,function(){a(!0)});Da(97<d?97:d,function(){var d=
X.suspense;X.suspense=void 0===b?null:b;try{a(!1),c()}finally{X.suspense=d}})}function ch(a,b,c){var d=ka(),e=Vb.suspense;d=Va(d,a,e);e={expirationTime:d,suspenseConfig:e,action:c,eagerReducer:null,eagerState:null,next:null};var f=b.pending;null===f?e.next=e:(e.next=f.next,f.next=e);b.pending=e;f=a.alternate;if(a===z||null!==f&&f===z)Uc=!0,e.expirationTime=Ia,z.expirationTime=Ia;else{if(0===a.expirationTime&&(null===f||0===f.expirationTime)&&(f=b.lastRenderedReducer,null!==f))try{var g=b.lastRenderedState,
h=f(g,c);e.eagerReducer=f;e.eagerState=h;if(Qa(h,g))return}catch(m){}finally{}Ja(a,d)}}function kh(a,b){var c=la(5,null,null,0);c.elementType="DELETED";c.type="DELETED";c.stateNode=b;c.return=a;c.effectTag=8;null!==a.lastEffect?(a.lastEffect.nextEffect=c,a.lastEffect=c):a.firstEffect=a.lastEffect=c}function lh(a,b){switch(a.tag){case 5:var c=a.type;b=1!==b.nodeType||c.toLowerCase()!==b.nodeName.toLowerCase()?null:b;return null!==b?(a.stateNode=b,!0):!1;case 6:return b=""===a.pendingProps||3!==b.nodeType?
null:b,null!==b?(a.stateNode=b,!0):!1;case 13:return!1;default:return!1}}function De(a){if(Wa){var b=Ka;if(b){var c=b;if(!lh(a,b)){b=kb(c.nextSibling);if(!b||!lh(a,b)){a.effectTag=a.effectTag&-1025|2;Wa=!1;ra=a;return}kh(ra,c)}ra=a;Ka=kb(b.firstChild)}else a.effectTag=a.effectTag&-1025|2,Wa=!1,ra=a}}function mh(a){for(a=a.return;null!==a&&5!==a.tag&&3!==a.tag&&13!==a.tag;)a=a.return;ra=a}function Zc(a){if(a!==ra)return!1;if(!Wa)return mh(a),Wa=!0,!1;var b=a.type;if(5!==a.tag||"head"!==b&&"body"!==
b&&!Yd(b,a.memoizedProps))for(b=Ka;b;)kh(a,b),b=kb(b.nextSibling);mh(a);if(13===a.tag){a=a.memoizedState;a=null!==a?a.dehydrated:null;if(!a)throw Error(k(317));a:{a=a.nextSibling;for(b=0;a;){if(8===a.nodeType){var c=a.data;if(c===og){if(0===b){Ka=kb(a.nextSibling);break a}b--}else c!==ng&&c!==Zd&&c!==$d||b++}a=a.nextSibling}Ka=null}}else Ka=ra?kb(a.stateNode.nextSibling):null;return!0}function Ee(){Ka=ra=null;Wa=!1}function T(a,b,c,d){b.child=null===a?Fe(b,null,c,d):wb(b,a.child,c,d)}function nh(a,
b,c,d,e){c=c.render;var f=b.ref;rb(b,e);d=we(a,b,c,d,f,e);if(null!==a&&!ia)return b.updateQueue=a.updateQueue,b.effectTag&=-517,a.expirationTime<=e&&(a.expirationTime=0),sa(a,b,e);b.effectTag|=1;T(a,b,d,e);return b.child}function oh(a,b,c,d,e,f){if(null===a){var g=c.type;if("function"===typeof g&&!Ge(g)&&void 0===g.defaultProps&&null===c.compare&&void 0===c.defaultProps)return b.tag=15,b.type=g,ph(a,b,g,d,e,f);a=Oc(c.type,null,d,null,b.mode,f);a.ref=b.ref;a.return=b;return b.child=a}g=a.child;if(e<
f&&(e=g.memoizedProps,c=c.compare,c=null!==c?c:Ob,c(e,d)&&a.ref===b.ref))return sa(a,b,f);b.effectTag|=1;a=Sa(g,d);a.ref=b.ref;a.return=b;return b.child=a}function ph(a,b,c,d,e,f){return null!==a&&Ob(a.memoizedProps,d)&&a.ref===b.ref&&(ia=!1,e<f)?(b.expirationTime=a.expirationTime,sa(a,b,f)):He(a,b,c,d,f)}function qh(a,b){var c=b.ref;if(null===a&&null!==c||null!==a&&a.ref!==c)b.effectTag|=128}function He(a,b,c,d,e){var f=N(c)?Ra:B.current;f=pb(b,f);rb(b,e);c=we(a,b,c,d,f,e);if(null!==a&&!ia)return b.updateQueue=
a.updateQueue,b.effectTag&=-517,a.expirationTime<=e&&(a.expirationTime=0),sa(a,b,e);b.effectTag|=1;T(a,b,c,e);return b.child}function rh(a,b,c,d,e){if(N(c)){var f=!0;Bc(b)}else f=!1;rb(b,e);if(null===b.stateNode)null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2),Yg(b,c,d),pe(b,c,d,e),d=!0;else if(null===a){var g=b.stateNode,h=b.memoizedProps;g.props=h;var m=g.context,n=c.contextType;"object"===typeof n&&null!==n?n=W(n):(n=N(c)?Ra:B.current,n=pb(b,n));var l=c.getDerivedStateFromProps,k="function"===
typeof l||"function"===typeof g.getSnapshotBeforeUpdate;k||"function"!==typeof g.UNSAFE_componentWillReceiveProps&&"function"!==typeof g.componentWillReceiveProps||(h!==d||m!==n)&&Zg(b,g,d,n);Ga=!1;var p=b.memoizedState;g.state=p;Qb(b,d,g,e);m=b.memoizedState;h!==d||p!==m||G.current||Ga?("function"===typeof l&&(Lc(b,c,l,d),m=b.memoizedState),(h=Ga||Xg(b,c,h,d,p,m,n))?(k||"function"!==typeof g.UNSAFE_componentWillMount&&"function"!==typeof g.componentWillMount||("function"===typeof g.componentWillMount&&
g.componentWillMount(),"function"===typeof g.UNSAFE_componentWillMount&&g.UNSAFE_componentWillMount()),"function"===typeof g.componentDidMount&&(b.effectTag|=4)):("function"===typeof g.componentDidMount&&(b.effectTag|=4),b.memoizedProps=d,b.memoizedState=m),g.props=d,g.state=m,g.context=n,d=h):("function"===typeof g.componentDidMount&&(b.effectTag|=4),d=!1)}else g=b.stateNode,oe(a,b),h=b.memoizedProps,g.props=b.type===b.elementType?h:aa(b.type,h),m=g.context,n=c.contextType,"object"===typeof n&&null!==
n?n=W(n):(n=N(c)?Ra:B.current,n=pb(b,n)),l=c.getDerivedStateFromProps,(k="function"===typeof l||"function"===typeof g.getSnapshotBeforeUpdate)||"function"!==typeof g.UNSAFE_componentWillReceiveProps&&"function"!==typeof g.componentWillReceiveProps||(h!==d||m!==n)&&Zg(b,g,d,n),Ga=!1,m=b.memoizedState,g.state=m,Qb(b,d,g,e),p=b.memoizedState,h!==d||m!==p||G.current||Ga?("function"===typeof l&&(Lc(b,c,l,d),p=b.memoizedState),(l=Ga||Xg(b,c,h,d,m,p,n))?(k||"function"!==typeof g.UNSAFE_componentWillUpdate&&
"function"!==typeof g.componentWillUpdate||("function"===typeof g.componentWillUpdate&&g.componentWillUpdate(d,p,n),"function"===typeof g.UNSAFE_componentWillUpdate&&g.UNSAFE_componentWillUpdate(d,p,n)),"function"===typeof g.componentDidUpdate&&(b.effectTag|=4),"function"===typeof g.getSnapshotBeforeUpdate&&(b.effectTag|=256)):("function"!==typeof g.componentDidUpdate||h===a.memoizedProps&&m===a.memoizedState||(b.effectTag|=4),"function"!==typeof g.getSnapshotBeforeUpdate||h===a.memoizedProps&&m===
a.memoizedState||(b.effectTag|=256),b.memoizedProps=d,b.memoizedState=p),g.props=d,g.state=p,g.context=n,d=l):("function"!==typeof g.componentDidUpdate||h===a.memoizedProps&&m===a.memoizedState||(b.effectTag|=4),"function"!==typeof g.getSnapshotBeforeUpdate||h===a.memoizedProps&&m===a.memoizedState||(b.effectTag|=256),d=!1);return Ie(a,b,c,d,f,e)}function Ie(a,b,c,d,e,f){qh(a,b);var g=0!==(b.effectTag&64);if(!d&&!g)return e&&Hg(b,c,!1),sa(a,b,f);d=b.stateNode;gj.current=b;var h=g&&"function"!==typeof c.getDerivedStateFromError?
null:d.render();b.effectTag|=1;null!==a&&g?(b.child=wb(b,a.child,null,f),b.child=wb(b,null,h,f)):T(a,b,h,f);b.memoizedState=d.state;e&&Hg(b,c,!0);return b.child}function sh(a){var b=a.stateNode;b.pendingContext?Fg(a,b.pendingContext,b.pendingContext!==b.context):b.context&&Fg(a,b.context,!1);se(a,b.containerInfo)}function th(a,b,c){var d=b.mode,e=b.pendingProps,f=D.current,g=!1,h;(h=0!==(b.effectTag&64))||(h=0!==(f&2)&&(null===a||null!==a.memoizedState));h?(g=!0,b.effectTag&=-65):null!==a&&null===
a.memoizedState||void 0===e.fallback||!0===e.unstable_avoidThisFallback||(f|=1);y(D,f&1);if(null===a){void 0!==e.fallback&&De(b);if(g){g=e.fallback;e=Ha(null,d,0,null);e.return=b;if(0===(b.mode&2))for(a=null!==b.memoizedState?b.child.child:b.child,e.child=a;null!==a;)a.return=e,a=a.sibling;c=Ha(g,d,c,null);c.return=b;e.sibling=c;b.memoizedState=Je;b.child=e;return c}d=e.children;b.memoizedState=null;return b.child=Fe(b,null,d,c)}if(null!==a.memoizedState){a=a.child;d=a.sibling;if(g){e=e.fallback;
c=Sa(a,a.pendingProps);c.return=b;if(0===(b.mode&2)&&(g=null!==b.memoizedState?b.child.child:b.child,g!==a.child))for(c.child=g;null!==g;)g.return=c,g=g.sibling;d=Sa(d,e);d.return=b;c.sibling=d;c.childExpirationTime=0;b.memoizedState=Je;b.child=c;return d}c=wb(b,a.child,e.children,c);b.memoizedState=null;return b.child=c}a=a.child;if(g){g=e.fallback;e=Ha(null,d,0,null);e.return=b;e.child=a;null!==a&&(a.return=e);if(0===(b.mode&2))for(a=null!==b.memoizedState?b.child.child:b.child,e.child=a;null!==
a;)a.return=e,a=a.sibling;c=Ha(g,d,c,null);c.return=b;e.sibling=c;c.effectTag|=2;e.childExpirationTime=0;b.memoizedState=Je;b.child=e;return c}b.memoizedState=null;return b.child=wb(b,a,e.children,c)}function uh(a,b){a.expirationTime<b&&(a.expirationTime=b);var c=a.alternate;null!==c&&c.expirationTime<b&&(c.expirationTime=b);Sg(a.return,b)}function Ke(a,b,c,d,e,f){var g=a.memoizedState;null===g?a.memoizedState={isBackwards:b,rendering:null,renderingStartTime:0,last:d,tail:c,tailExpiration:0,tailMode:e,
lastEffect:f}:(g.isBackwards=b,g.rendering=null,g.renderingStartTime=0,g.last=d,g.tail=c,g.tailExpiration=0,g.tailMode=e,g.lastEffect=f)}function vh(a,b,c){var d=b.pendingProps,e=d.revealOrder,f=d.tail;T(a,b,d.children,c);d=D.current;if(0!==(d&2))d=d&1|2,b.effectTag|=64;else{if(null!==a&&0!==(a.effectTag&64))a:for(a=b.child;null!==a;){if(13===a.tag)null!==a.memoizedState&&uh(a,c);else if(19===a.tag)uh(a,c);else if(null!==a.child){a.child.return=a;a=a.child;continue}if(a===b)break a;for(;null===a.sibling;){if(null===
a.return||a.return===b)break a;a=a.return}a.sibling.return=a.return;a=a.sibling}d&=1}y(D,d);if(0===(b.mode&2))b.memoizedState=null;else switch(e){case "forwards":c=b.child;for(e=null;null!==c;)a=c.alternate,null!==a&&null===Rc(a)&&(e=c),c=c.sibling;c=e;null===c?(e=b.child,b.child=null):(e=c.sibling,c.sibling=null);Ke(b,!1,e,c,f,b.lastEffect);break;case "backwards":c=null;e=b.child;for(b.child=null;null!==e;){a=e.alternate;if(null!==a&&null===Rc(a)){b.child=e;break}a=e.sibling;e.sibling=c;c=e;e=a}Ke(b,
!0,c,null,f,b.lastEffect);break;case "together":Ke(b,!1,null,null,void 0,b.lastEffect);break;default:b.memoizedState=null}return b.child}function sa(a,b,c){null!==a&&(b.dependencies=a.dependencies);var d=b.expirationTime;0!==d&&Kc(d);if(b.childExpirationTime<c)return null;if(null!==a&&b.child!==a.child)throw Error(k(153));if(null!==b.child){a=b.child;c=Sa(a,a.pendingProps);b.child=c;for(c.return=b;null!==a.sibling;)a=a.sibling,c=c.sibling=Sa(a,a.pendingProps),c.return=b;c.sibling=null}return b.child}
function $c(a,b){switch(a.tailMode){case "hidden":b=a.tail;for(var c=null;null!==b;)null!==b.alternate&&(c=b),b=b.sibling;null===c?a.tail=null:c.sibling=null;break;case "collapsed":c=a.tail;for(var d=null;null!==c;)null!==c.alternate&&(d=c),c=c.sibling;null===d?b||null===a.tail?a.tail=null:a.tail.sibling=null:d.sibling=null}}function hj(a,b,c){var d=b.pendingProps;switch(b.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return N(b.type)&&(q(G),q(B)),
null;case 3:return tb(),q(G),q(B),c=b.stateNode,c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),null!==a&&null!==a.child||!Zc(b)||(b.effectTag|=4),wh(b),null;case 5:te(b);c=Ta(Tb.current);var e=b.type;if(null!==a&&null!=b.stateNode)ij(a,b,e,d,c),a.ref!==b.ref&&(b.effectTag|=128);else{if(!d){if(null===b.stateNode)throw Error(k(166));return null}a=Ta(ja.current);if(Zc(b)){d=b.stateNode;e=b.type;var f=b.memoizedProps;d[Aa]=b;d[vc]=f;switch(e){case "iframe":case "object":case "embed":w("load",
d);break;case "video":case "audio":for(a=0;a<Db.length;a++)w(Db[a],d);break;case "source":w("error",d);break;case "img":case "image":case "link":w("error",d);w("load",d);break;case "form":w("reset",d);w("submit",d);break;case "details":w("toggle",d);break;case "input":Hf(d,f);w("invalid",d);oa(c,"onChange");break;case "select":d._wrapperState={wasMultiple:!!f.multiple};w("invalid",d);oa(c,"onChange");break;case "textarea":Kf(d,f),w("invalid",d),oa(c,"onChange")}Ud(e,f);a=null;for(var g in f)if(f.hasOwnProperty(g)){var h=
f[g];"children"===g?"string"===typeof h?d.textContent!==h&&(a=["children",h]):"number"===typeof h&&d.textContent!==""+h&&(a=["children",""+h]):db.hasOwnProperty(g)&&null!=h&&oa(c,g)}switch(e){case "input":mc(d);Jf(d,f,!0);break;case "textarea":mc(d);Mf(d);break;case "select":case "option":break;default:"function"===typeof f.onClick&&(d.onclick=uc)}c=a;b.updateQueue=c;null!==c&&(b.effectTag|=4)}else{g=9===c.nodeType?c:c.ownerDocument;"http://www.w3.org/1999/xhtml"===a&&(a=Nf(e));"http://www.w3.org/1999/xhtml"===
a?"script"===e?(a=g.createElement("div"),a.innerHTML="<script>\x3c/script>",a=a.removeChild(a.firstChild)):"string"===typeof d.is?a=g.createElement(e,{is:d.is}):(a=g.createElement(e),"select"===e&&(g=a,d.multiple?g.multiple=!0:d.size&&(g.size=d.size))):a=g.createElementNS(a,e);a[Aa]=b;a[vc]=d;jj(a,b,!1,!1);b.stateNode=a;g=Vd(e,d);switch(e){case "iframe":case "object":case "embed":w("load",a);h=d;break;case "video":case "audio":for(h=0;h<Db.length;h++)w(Db[h],a);h=d;break;case "source":w("error",a);
h=d;break;case "img":case "image":case "link":w("error",a);w("load",a);h=d;break;case "form":w("reset",a);w("submit",a);h=d;break;case "details":w("toggle",a);h=d;break;case "input":Hf(a,d);h=Cd(a,d);w("invalid",a);oa(c,"onChange");break;case "option":h=Fd(a,d);break;case "select":a._wrapperState={wasMultiple:!!d.multiple};h=M({},d,{value:void 0});w("invalid",a);oa(c,"onChange");break;case "textarea":Kf(a,d);h=Gd(a,d);w("invalid",a);oa(c,"onChange");break;default:h=d}Ud(e,h);var m=h;for(f in m)if(m.hasOwnProperty(f)){var n=
m[f];"style"===f?gg(a,n):"dangerouslySetInnerHTML"===f?(n=n?n.__html:void 0,null!=n&&xh(a,n)):"children"===f?"string"===typeof n?("textarea"!==e||""!==n)&&Wb(a,n):"number"===typeof n&&Wb(a,""+n):"suppressContentEditableWarning"!==f&&"suppressHydrationWarning"!==f&&"autoFocus"!==f&&(db.hasOwnProperty(f)?null!=n&&oa(c,f):null!=n&&xd(a,f,n,g))}switch(e){case "input":mc(a);Jf(a,d,!1);break;case "textarea":mc(a);Mf(a);break;case "option":null!=d.value&&a.setAttribute("value",""+va(d.value));break;case "select":a.multiple=
!!d.multiple;c=d.value;null!=c?hb(a,!!d.multiple,c,!1):null!=d.defaultValue&&hb(a,!!d.multiple,d.defaultValue,!0);break;default:"function"===typeof h.onClick&&(a.onclick=uc)}lg(e,d)&&(b.effectTag|=4)}null!==b.ref&&(b.effectTag|=128)}return null;case 6:if(a&&null!=b.stateNode)kj(a,b,a.memoizedProps,d);else{if("string"!==typeof d&&null===b.stateNode)throw Error(k(166));c=Ta(Tb.current);Ta(ja.current);Zc(b)?(c=b.stateNode,d=b.memoizedProps,c[Aa]=b,c.nodeValue!==d&&(b.effectTag|=4)):(c=(9===c.nodeType?
c:c.ownerDocument).createTextNode(d),c[Aa]=b,b.stateNode=c)}return null;case 13:q(D);d=b.memoizedState;if(0!==(b.effectTag&64))return b.expirationTime=c,b;c=null!==d;d=!1;null===a?void 0!==b.memoizedProps.fallback&&Zc(b):(e=a.memoizedState,d=null!==e,c||null===e||(e=a.child.sibling,null!==e&&(f=b.firstEffect,null!==f?(b.firstEffect=e,e.nextEffect=f):(b.firstEffect=b.lastEffect=e,e.nextEffect=null),e.effectTag=8)));if(c&&!d&&0!==(b.mode&2))if(null===a&&!0!==b.memoizedProps.unstable_avoidThisFallback||
0!==(D.current&1))F===Xa&&(F=ad);else{if(F===Xa||F===ad)F=bd;0!==Xb&&null!==U&&(Ya(U,P),yh(U,Xb))}if(c||d)b.effectTag|=4;return null;case 4:return tb(),wh(b),null;case 10:return me(b),null;case 17:return N(b.type)&&(q(G),q(B)),null;case 19:q(D);d=b.memoizedState;if(null===d)return null;e=0!==(b.effectTag&64);f=d.rendering;if(null===f)if(e)$c(d,!1);else{if(F!==Xa||null!==a&&0!==(a.effectTag&64))for(f=b.child;null!==f;){a=Rc(f);if(null!==a){b.effectTag|=64;$c(d,!1);e=a.updateQueue;null!==e&&(b.updateQueue=
e,b.effectTag|=4);null===d.lastEffect&&(b.firstEffect=null);b.lastEffect=d.lastEffect;for(d=b.child;null!==d;)e=d,f=c,e.effectTag&=2,e.nextEffect=null,e.firstEffect=null,e.lastEffect=null,a=e.alternate,null===a?(e.childExpirationTime=0,e.expirationTime=f,e.child=null,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null):(e.childExpirationTime=a.childExpirationTime,e.expirationTime=a.expirationTime,e.child=a.child,e.memoizedProps=a.memoizedProps,e.memoizedState=a.memoizedState,
e.updateQueue=a.updateQueue,f=a.dependencies,e.dependencies=null===f?null:{expirationTime:f.expirationTime,firstContext:f.firstContext,responders:f.responders}),d=d.sibling;y(D,D.current&1|2);return b.child}f=f.sibling}}else{if(!e)if(a=Rc(f),null!==a){if(b.effectTag|=64,e=!0,c=a.updateQueue,null!==c&&(b.updateQueue=c,b.effectTag|=4),$c(d,!0),null===d.tail&&"hidden"===d.tailMode&&!f.alternate)return b=b.lastEffect=d.lastEffect,null!==b&&(b.nextEffect=null),null}else 2*Y()-d.renderingStartTime>d.tailExpiration&&
1<c&&(b.effectTag|=64,e=!0,$c(d,!1),b.expirationTime=b.childExpirationTime=c-1);d.isBackwards?(f.sibling=b.child,b.child=f):(c=d.last,null!==c?c.sibling=f:b.child=f,d.last=f)}return null!==d.tail?(0===d.tailExpiration&&(d.tailExpiration=Y()+500),c=d.tail,d.rendering=c,d.tail=c.sibling,d.lastEffect=b.lastEffect,d.renderingStartTime=Y(),c.sibling=null,b=D.current,y(D,e?b&1|2:b&1),c):null}throw Error(k(156,b.tag));}function lj(a,b){switch(a.tag){case 1:return N(a.type)&&(q(G),q(B)),b=a.effectTag,b&4096?
(a.effectTag=b&-4097|64,a):null;case 3:tb();q(G);q(B);b=a.effectTag;if(0!==(b&64))throw Error(k(285));a.effectTag=b&-4097|64;return a;case 5:return te(a),null;case 13:return q(D),b=a.effectTag,b&4096?(a.effectTag=b&-4097|64,a):null;case 19:return q(D),null;case 4:return tb(),null;case 10:return me(a),null;default:return null}}function Le(a,b){return{value:a,source:b,stack:Bd(b)}}function Me(a,b){var c=b.source,d=b.stack;null===d&&null!==c&&(d=Bd(c));null!==c&&na(c.type);b=b.value;null!==a&&1===a.tag&&
na(a.type);try{console.error(b)}catch(e){setTimeout(function(){throw e;})}}function mj(a,b){try{b.props=a.memoizedProps,b.state=a.memoizedState,b.componentWillUnmount()}catch(c){Za(a,c)}}function zh(a){var b=a.ref;if(null!==b)if("function"===typeof b)try{b(null)}catch(c){Za(a,c)}else b.current=null}function nj(a,b){switch(b.tag){case 0:case 11:case 15:case 22:return;case 1:if(b.effectTag&256&&null!==a){var c=a.memoizedProps,d=a.memoizedState;a=b.stateNode;b=a.getSnapshotBeforeUpdate(b.elementType===
b.type?c:aa(b.type,c),d);a.__reactInternalSnapshotBeforeUpdate=b}return;case 3:case 5:case 6:case 4:case 17:return}throw Error(k(163));}function Ah(a,b){b=b.updateQueue;b=null!==b?b.lastEffect:null;if(null!==b){var c=b=b.next;do{if((c.tag&a)===a){var d=c.destroy;c.destroy=void 0;void 0!==d&&d()}c=c.next}while(c!==b)}}function Bh(a,b){b=b.updateQueue;b=null!==b?b.lastEffect:null;if(null!==b){var c=b=b.next;do{if((c.tag&a)===a){var d=c.create;c.destroy=d()}c=c.next}while(c!==b)}}function oj(a,b,c,d){switch(c.tag){case 0:case 11:case 15:case 22:Bh(3,
c);return;case 1:a=c.stateNode;c.effectTag&4&&(null===b?a.componentDidMount():(d=c.elementType===c.type?b.memoizedProps:aa(c.type,b.memoizedProps),a.componentDidUpdate(d,b.memoizedState,a.__reactInternalSnapshotBeforeUpdate)));b=c.updateQueue;null!==b&&Wg(c,b,a);return;case 3:b=c.updateQueue;if(null!==b){a=null;if(null!==c.child)switch(c.child.tag){case 5:a=c.child.stateNode;break;case 1:a=c.child.stateNode}Wg(c,b,a)}return;case 5:a=c.stateNode;null===b&&c.effectTag&4&&lg(c.type,c.memoizedProps)&&
a.focus();return;case 6:return;case 4:return;case 12:return;case 13:null===c.memoizedState&&(c=c.alternate,null!==c&&(c=c.memoizedState,null!==c&&(c=c.dehydrated,null!==c&&bg(c))));return;case 19:case 17:case 20:case 21:return}throw Error(k(163));}function Ch(a,b,c){"function"===typeof Ne&&Ne(b);switch(b.tag){case 0:case 11:case 14:case 15:case 22:a=b.updateQueue;if(null!==a&&(a=a.lastEffect,null!==a)){var d=a.next;Da(97<c?97:c,function(){var a=d;do{var c=a.destroy;if(void 0!==c){var g=b;try{c()}catch(h){Za(g,
h)}}a=a.next}while(a!==d)})}break;case 1:zh(b);c=b.stateNode;"function"===typeof c.componentWillUnmount&&mj(b,c);break;case 5:zh(b);break;case 4:Dh(a,b,c)}}function Eh(a){var b=a.alternate;a.return=null;a.child=null;a.memoizedState=null;a.updateQueue=null;a.dependencies=null;a.alternate=null;a.firstEffect=null;a.lastEffect=null;a.pendingProps=null;a.memoizedProps=null;a.stateNode=null;null!==b&&Eh(b)}function Fh(a){return 5===a.tag||3===a.tag||4===a.tag}function Gh(a){a:{for(var b=a.return;null!==
b;){if(Fh(b)){var c=b;break a}b=b.return}throw Error(k(160));}b=c.stateNode;switch(c.tag){case 5:var d=!1;break;case 3:b=b.containerInfo;d=!0;break;case 4:b=b.containerInfo;d=!0;break;default:throw Error(k(161));}c.effectTag&16&&(Wb(b,""),c.effectTag&=-17);a:b:for(c=a;;){for(;null===c.sibling;){if(null===c.return||Fh(c.return)){c=null;break a}c=c.return}c.sibling.return=c.return;for(c=c.sibling;5!==c.tag&&6!==c.tag&&18!==c.tag;){if(c.effectTag&2)continue b;if(null===c.child||4===c.tag)continue b;
else c.child.return=c,c=c.child}if(!(c.effectTag&2)){c=c.stateNode;break a}}d?Oe(a,c,b):Pe(a,c,b)}function Oe(a,b,c){var d=a.tag,e=5===d||6===d;if(e)a=e?a.stateNode:a.stateNode.instance,b?8===c.nodeType?c.parentNode.insertBefore(a,b):c.insertBefore(a,b):(8===c.nodeType?(b=c.parentNode,b.insertBefore(a,c)):(b=c,b.appendChild(a)),c=c._reactRootContainer,null!==c&&void 0!==c||null!==b.onclick||(b.onclick=uc));else if(4!==d&&(a=a.child,null!==a))for(Oe(a,b,c),a=a.sibling;null!==a;)Oe(a,b,c),a=a.sibling}
function Pe(a,b,c){var d=a.tag,e=5===d||6===d;if(e)a=e?a.stateNode:a.stateNode.instance,b?c.insertBefore(a,b):c.appendChild(a);else if(4!==d&&(a=a.child,null!==a))for(Pe(a,b,c),a=a.sibling;null!==a;)Pe(a,b,c),a=a.sibling}function Dh(a,b,c){for(var d=b,e=!1,f,g;;){if(!e){e=d.return;a:for(;;){if(null===e)throw Error(k(160));f=e.stateNode;switch(e.tag){case 5:g=!1;break a;case 3:f=f.containerInfo;g=!0;break a;case 4:f=f.containerInfo;g=!0;break a}e=e.return}e=!0}if(5===d.tag||6===d.tag){a:for(var h=
a,m=d,n=c,l=m;;)if(Ch(h,l,n),null!==l.child&&4!==l.tag)l.child.return=l,l=l.child;else{if(l===m)break a;for(;null===l.sibling;){if(null===l.return||l.return===m)break a;l=l.return}l.sibling.return=l.return;l=l.sibling}g?(h=f,m=d.stateNode,8===h.nodeType?h.parentNode.removeChild(m):h.removeChild(m)):f.removeChild(d.stateNode)}else if(4===d.tag){if(null!==d.child){f=d.stateNode.containerInfo;g=!0;d.child.return=d;d=d.child;continue}}else if(Ch(a,d,c),null!==d.child){d.child.return=d;d=d.child;continue}if(d===
b)break;for(;null===d.sibling;){if(null===d.return||d.return===b)return;d=d.return;4===d.tag&&(e=!1)}d.sibling.return=d.return;d=d.sibling}}function Qe(a,b){switch(b.tag){case 0:case 11:case 14:case 15:case 22:Ah(3,b);return;case 1:return;case 5:var c=b.stateNode;if(null!=c){var d=b.memoizedProps,e=null!==a?a.memoizedProps:d;a=b.type;var f=b.updateQueue;b.updateQueue=null;if(null!==f){c[vc]=d;"input"===a&&"radio"===d.type&&null!=d.name&&If(c,d);Vd(a,e);b=Vd(a,d);for(e=0;e<f.length;e+=2){var g=f[e],
h=f[e+1];"style"===g?gg(c,h):"dangerouslySetInnerHTML"===g?xh(c,h):"children"===g?Wb(c,h):xd(c,g,h,b)}switch(a){case "input":Dd(c,d);break;case "textarea":Lf(c,d);break;case "select":b=c._wrapperState.wasMultiple,c._wrapperState.wasMultiple=!!d.multiple,a=d.value,null!=a?hb(c,!!d.multiple,a,!1):b!==!!d.multiple&&(null!=d.defaultValue?hb(c,!!d.multiple,d.defaultValue,!0):hb(c,!!d.multiple,d.multiple?[]:"",!1))}}}return;case 6:if(null===b.stateNode)throw Error(k(162));b.stateNode.nodeValue=b.memoizedProps;
return;case 3:b=b.stateNode;b.hydrate&&(b.hydrate=!1,bg(b.containerInfo));return;case 12:return;case 13:c=b;null===b.memoizedState?d=!1:(d=!0,c=b.child,Re=Y());if(null!==c)a:for(a=c;;){if(5===a.tag)f=a.stateNode,d?(f=f.style,"function"===typeof f.setProperty?f.setProperty("display","none","important"):f.display="none"):(f=a.stateNode,e=a.memoizedProps.style,e=void 0!==e&&null!==e&&e.hasOwnProperty("display")?e.display:null,f.style.display=fg("display",e));else if(6===a.tag)a.stateNode.nodeValue=d?
"":a.memoizedProps;else if(13===a.tag&&null!==a.memoizedState&&null===a.memoizedState.dehydrated){f=a.child.sibling;f.return=a;a=f;continue}else if(null!==a.child){a.child.return=a;a=a.child;continue}if(a===c)break;for(;null===a.sibling;){if(null===a.return||a.return===c)break a;a=a.return}a.sibling.return=a.return;a=a.sibling}Hh(b);return;case 19:Hh(b);return;case 17:return}throw Error(k(163));}function Hh(a){var b=a.updateQueue;if(null!==b){a.updateQueue=null;var c=a.stateNode;null===c&&(c=a.stateNode=
new pj);b.forEach(function(b){var d=qj.bind(null,a,b);c.has(b)||(c.add(b),b.then(d,d))})}}function Ih(a,b,c){c=Ea(c,null);c.tag=3;c.payload={element:null};var d=b.value;c.callback=function(){cd||(cd=!0,Se=d);Me(a,b)};return c}function Jh(a,b,c){c=Ea(c,null);c.tag=3;var d=a.type.getDerivedStateFromError;if("function"===typeof d){var e=b.value;c.payload=function(){Me(a,b);return d(e)}}var f=a.stateNode;null!==f&&"function"===typeof f.componentDidCatch&&(c.callback=function(){"function"!==typeof d&&
(null===La?La=new Set([this]):La.add(this),Me(a,b));var c=b.stack;this.componentDidCatch(b.value,{componentStack:null!==c?c:""})});return c}function ka(){return(p&(ca|ma))!==H?1073741821-(Y()/10|0):0!==dd?dd:dd=1073741821-(Y()/10|0)}function Va(a,b,c){b=b.mode;if(0===(b&2))return 1073741823;var d=Cc();if(0===(b&4))return 99===d?1073741823:1073741822;if((p&ca)!==H)return P;if(null!==c)a=Fc(a,c.timeoutMs|0||5E3,250);else switch(d){case 99:a=1073741823;break;case 98:a=Fc(a,150,100);break;case 97:case 96:a=
Fc(a,5E3,250);break;case 95:a=2;break;default:throw Error(k(326));}null!==U&&a===P&&--a;return a}function ed(a,b){a.expirationTime<b&&(a.expirationTime=b);var c=a.alternate;null!==c&&c.expirationTime<b&&(c.expirationTime=b);var d=a.return,e=null;if(null===d&&3===a.tag)e=a.stateNode;else for(;null!==d;){c=d.alternate;d.childExpirationTime<b&&(d.childExpirationTime=b);null!==c&&c.childExpirationTime<b&&(c.childExpirationTime=b);if(null===d.return&&3===d.tag){e=d.stateNode;break}d=d.return}null!==e&&
(U===e&&(Kc(b),F===bd&&Ya(e,P)),yh(e,b));return e}function fd(a){var b=a.lastExpiredTime;if(0!==b)return b;b=a.firstPendingTime;if(!Kh(a,b))return b;var c=a.lastPingedTime;a=a.nextKnownPendingLevel;a=c>a?c:a;return 2>=a&&b!==a?0:a}function V(a){if(0!==a.lastExpiredTime)a.callbackExpirationTime=1073741823,a.callbackPriority=99,a.callbackNode=Og(Te.bind(null,a));else{var b=fd(a),c=a.callbackNode;if(0===b)null!==c&&(a.callbackNode=null,a.callbackExpirationTime=0,a.callbackPriority=90);else{var d=ka();
1073741823===b?d=99:1===b||2===b?d=95:(d=10*(1073741821-b)-10*(1073741821-d),d=0>=d?99:250>=d?98:5250>=d?97:95);if(null!==c){var e=a.callbackPriority;if(a.callbackExpirationTime===b&&e>=d)return;c!==Qg&&Rg(c)}a.callbackExpirationTime=b;a.callbackPriority=d;b=1073741823===b?Og(Te.bind(null,a)):Ng(d,Lh.bind(null,a),{timeout:10*(1073741821-b)-Y()});a.callbackNode=b}}}function Lh(a,b){dd=0;if(b)return b=ka(),Ue(a,b),V(a),null;var c=fd(a);if(0!==c){b=a.callbackNode;if((p&(ca|ma))!==H)throw Error(k(327));
xb();a===U&&c===P||$a(a,c);if(null!==t){var d=p;p|=ca;var e=Mh();do try{rj();break}catch(h){Nh(a,h)}while(1);le();p=d;gd.current=e;if(F===hd)throw b=id,$a(a,c),Ya(a,c),V(a),b;if(null===t)switch(e=a.finishedWork=a.current.alternate,a.finishedExpirationTime=c,d=F,U=null,d){case Xa:case hd:throw Error(k(345));case Oh:Ue(a,2<c?2:c);break;case ad:Ya(a,c);d=a.lastSuspendedTime;c===d&&(a.nextKnownPendingLevel=Ve(e));if(1073741823===ta&&(e=Re+Ph-Y(),10<e)){if(jd){var f=a.lastPingedTime;if(0===f||f>=c){a.lastPingedTime=
c;$a(a,c);break}}f=fd(a);if(0!==f&&f!==c)break;if(0!==d&&d!==c){a.lastPingedTime=d;break}a.timeoutHandle=We(ab.bind(null,a),e);break}ab(a);break;case bd:Ya(a,c);d=a.lastSuspendedTime;c===d&&(a.nextKnownPendingLevel=Ve(e));if(jd&&(e=a.lastPingedTime,0===e||e>=c)){a.lastPingedTime=c;$a(a,c);break}e=fd(a);if(0!==e&&e!==c)break;if(0!==d&&d!==c){a.lastPingedTime=d;break}1073741823!==Yb?d=10*(1073741821-Yb)-Y():1073741823===ta?d=0:(d=10*(1073741821-ta)-5E3,e=Y(),c=10*(1073741821-c)-e,d=e-d,0>d&&(d=0),d=
(120>d?120:480>d?480:1080>d?1080:1920>d?1920:3E3>d?3E3:4320>d?4320:1960*sj(d/1960))-d,c<d&&(d=c));if(10<d){a.timeoutHandle=We(ab.bind(null,a),d);break}ab(a);break;case Xe:if(1073741823!==ta&&null!==kd){f=ta;var g=kd;d=g.busyMinDurationMs|0;0>=d?d=0:(e=g.busyDelayMs|0,f=Y()-(10*(1073741821-f)-(g.timeoutMs|0||5E3)),d=f<=e?0:e+d-f);if(10<d){Ya(a,c);a.timeoutHandle=We(ab.bind(null,a),d);break}}ab(a);break;default:throw Error(k(329));}V(a);if(a.callbackNode===b)return Lh.bind(null,a)}}return null}function Te(a){var b=
a.lastExpiredTime;b=0!==b?b:1073741823;if((p&(ca|ma))!==H)throw Error(k(327));xb();a===U&&b===P||$a(a,b);if(null!==t){var c=p;p|=ca;var d=Mh();do try{tj();break}catch(e){Nh(a,e)}while(1);le();p=c;gd.current=d;if(F===hd)throw c=id,$a(a,b),Ya(a,b),V(a),c;if(null!==t)throw Error(k(261));a.finishedWork=a.current.alternate;a.finishedExpirationTime=b;U=null;ab(a);V(a)}return null}function uj(){if(null!==bb){var a=bb;bb=null;a.forEach(function(a,c){Ue(c,a);V(c)});ha()}}function Qh(a,b){var c=p;p|=1;try{return a(b)}finally{p=
c,p===H&&ha()}}function Rh(a,b){var c=p;p&=-2;p|=Ye;try{return a(b)}finally{p=c,p===H&&ha()}}function $a(a,b){a.finishedWork=null;a.finishedExpirationTime=0;var c=a.timeoutHandle;-1!==c&&(a.timeoutHandle=-1,vj(c));if(null!==t)for(c=t.return;null!==c;){var d=c;switch(d.tag){case 1:d=d.type.childContextTypes;null!==d&&void 0!==d&&(q(G),q(B));break;case 3:tb();q(G);q(B);break;case 5:te(d);break;case 4:tb();break;case 13:q(D);break;case 19:q(D);break;case 10:me(d)}c=c.return}U=a;t=Sa(a.current,null);
P=b;F=Xa;id=null;Yb=ta=1073741823;kd=null;Xb=0;jd=!1}function Nh(a,b){do{try{le();Sc.current=Tc;if(Uc)for(var c=z.memoizedState;null!==c;){var d=c.queue;null!==d&&(d.pending=null);c=c.next}Ia=0;J=K=z=null;Uc=!1;if(null===t||null===t.return)return F=hd,id=b,t=null;a:{var e=a,f=t.return,g=t,h=b;b=P;g.effectTag|=2048;g.firstEffect=g.lastEffect=null;if(null!==h&&"object"===typeof h&&"function"===typeof h.then){var m=h;if(0===(g.mode&2)){var n=g.alternate;n?(g.updateQueue=n.updateQueue,g.memoizedState=
n.memoizedState,g.expirationTime=n.expirationTime):(g.updateQueue=null,g.memoizedState=null)}var l=0!==(D.current&1),k=f;do{var p;if(p=13===k.tag){var q=k.memoizedState;if(null!==q)p=null!==q.dehydrated?!0:!1;else{var w=k.memoizedProps;p=void 0===w.fallback?!1:!0!==w.unstable_avoidThisFallback?!0:l?!1:!0}}if(p){var y=k.updateQueue;if(null===y){var r=new Set;r.add(m);k.updateQueue=r}else y.add(m);if(0===(k.mode&2)){k.effectTag|=64;g.effectTag&=-2981;if(1===g.tag)if(null===g.alternate)g.tag=17;else{var O=
Ea(1073741823,null);O.tag=Jc;Fa(g,O)}g.expirationTime=1073741823;break a}h=void 0;g=b;var v=e.pingCache;null===v?(v=e.pingCache=new wj,h=new Set,v.set(m,h)):(h=v.get(m),void 0===h&&(h=new Set,v.set(m,h)));if(!h.has(g)){h.add(g);var x=xj.bind(null,e,m,g);m.then(x,x)}k.effectTag|=4096;k.expirationTime=b;break a}k=k.return}while(null!==k);h=Error((na(g.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display."+
Bd(g))}F!==Xe&&(F=Oh);h=Le(h,g);k=f;do{switch(k.tag){case 3:m=h;k.effectTag|=4096;k.expirationTime=b;var A=Ih(k,m,b);Ug(k,A);break a;case 1:m=h;var u=k.type,B=k.stateNode;if(0===(k.effectTag&64)&&("function"===typeof u.getDerivedStateFromError||null!==B&&"function"===typeof B.componentDidCatch&&(null===La||!La.has(B)))){k.effectTag|=4096;k.expirationTime=b;var H=Jh(k,m,b);Ug(k,H);break a}}k=k.return}while(null!==k)}t=Sh(t)}catch(cj){b=cj;continue}break}while(1)}function Mh(a){a=gd.current;gd.current=
Tc;return null===a?Tc:a}function Vg(a,b){a<ta&&2<a&&(ta=a);null!==b&&a<Yb&&2<a&&(Yb=a,kd=b)}function Kc(a){a>Xb&&(Xb=a)}function tj(){for(;null!==t;)t=Th(t)}function rj(){for(;null!==t&&!yj();)t=Th(t)}function Th(a){var b=zj(a.alternate,a,P);a.memoizedProps=a.pendingProps;null===b&&(b=Sh(a));Uh.current=null;return b}function Sh(a){t=a;do{var b=t.alternate;a=t.return;if(0===(t.effectTag&2048)){b=hj(b,t,P);if(1===P||1!==t.childExpirationTime){for(var c=0,d=t.child;null!==d;){var e=d.expirationTime,
f=d.childExpirationTime;e>c&&(c=e);f>c&&(c=f);d=d.sibling}t.childExpirationTime=c}if(null!==b)return b;null!==a&&0===(a.effectTag&2048)&&(null===a.firstEffect&&(a.firstEffect=t.firstEffect),null!==t.lastEffect&&(null!==a.lastEffect&&(a.lastEffect.nextEffect=t.firstEffect),a.lastEffect=t.lastEffect),1<t.effectTag&&(null!==a.lastEffect?a.lastEffect.nextEffect=t:a.firstEffect=t,a.lastEffect=t))}else{b=lj(t);if(null!==b)return b.effectTag&=2047,b;null!==a&&(a.firstEffect=a.lastEffect=null,a.effectTag|=
2048)}b=t.sibling;if(null!==b)return b;t=a}while(null!==t);F===Xa&&(F=Xe);return null}function Ve(a){var b=a.expirationTime;a=a.childExpirationTime;return b>a?b:a}function ab(a){var b=Cc();Da(99,Aj.bind(null,a,b));return null}function Aj(a,b){do xb();while(null!==Zb);if((p&(ca|ma))!==H)throw Error(k(327));var c=a.finishedWork,d=a.finishedExpirationTime;if(null===c)return null;a.finishedWork=null;a.finishedExpirationTime=0;if(c===a.current)throw Error(k(177));a.callbackNode=null;a.callbackExpirationTime=
0;a.callbackPriority=90;a.nextKnownPendingLevel=0;var e=Ve(c);a.firstPendingTime=e;d<=a.lastSuspendedTime?a.firstSuspendedTime=a.lastSuspendedTime=a.nextKnownPendingLevel=0:d<=a.firstSuspendedTime&&(a.firstSuspendedTime=d-1);d<=a.lastPingedTime&&(a.lastPingedTime=0);d<=a.lastExpiredTime&&(a.lastExpiredTime=0);a===U&&(t=U=null,P=0);1<c.effectTag?null!==c.lastEffect?(c.lastEffect.nextEffect=c,e=c.firstEffect):e=c:e=c.firstEffect;if(null!==e){var f=p;p|=ma;Uh.current=null;Ze=tc;var g=kg();if(Xd(g)){if("selectionStart"in
g)var h={start:g.selectionStart,end:g.selectionEnd};else a:{h=(h=g.ownerDocument)&&h.defaultView||window;var m=h.getSelection&&h.getSelection();if(m&&0!==m.rangeCount){h=m.anchorNode;var n=m.anchorOffset,q=m.focusNode;m=m.focusOffset;try{h.nodeType,q.nodeType}catch(sb){h=null;break a}var ba=0,w=-1,y=-1,B=0,D=0,r=g,z=null;b:for(;;){for(var v;;){r!==h||0!==n&&3!==r.nodeType||(w=ba+n);r!==q||0!==m&&3!==r.nodeType||(y=ba+m);3===r.nodeType&&(ba+=r.nodeValue.length);if(null===(v=r.firstChild))break;z=r;
r=v}for(;;){if(r===g)break b;z===h&&++B===n&&(w=ba);z===q&&++D===m&&(y=ba);if(null!==(v=r.nextSibling))break;r=z;z=r.parentNode}r=v}h=-1===w||-1===y?null:{start:w,end:y}}else h=null}h=h||{start:0,end:0}}else h=null;$e={activeElementDetached:null,focusedElem:g,selectionRange:h};tc=!1;l=e;do try{Bj()}catch(sb){if(null===l)throw Error(k(330));Za(l,sb);l=l.nextEffect}while(null!==l);l=e;do try{for(g=a,h=b;null!==l;){var x=l.effectTag;x&16&&Wb(l.stateNode,"");if(x&128){var A=l.alternate;if(null!==A){var u=
A.ref;null!==u&&("function"===typeof u?u(null):u.current=null)}}switch(x&1038){case 2:Gh(l);l.effectTag&=-3;break;case 6:Gh(l);l.effectTag&=-3;Qe(l.alternate,l);break;case 1024:l.effectTag&=-1025;break;case 1028:l.effectTag&=-1025;Qe(l.alternate,l);break;case 4:Qe(l.alternate,l);break;case 8:n=l,Dh(g,n,h),Eh(n)}l=l.nextEffect}}catch(sb){if(null===l)throw Error(k(330));Za(l,sb);l=l.nextEffect}while(null!==l);u=$e;A=kg();x=u.focusedElem;h=u.selectionRange;if(A!==x&&x&&x.ownerDocument&&jg(x.ownerDocument.documentElement,
x)){null!==h&&Xd(x)&&(A=h.start,u=h.end,void 0===u&&(u=A),"selectionStart"in x?(x.selectionStart=A,x.selectionEnd=Math.min(u,x.value.length)):(u=(A=x.ownerDocument||document)&&A.defaultView||window,u.getSelection&&(u=u.getSelection(),n=x.textContent.length,g=Math.min(h.start,n),h=void 0===h.end?g:Math.min(h.end,n),!u.extend&&g>h&&(n=h,h=g,g=n),n=ig(x,g),q=ig(x,h),n&&q&&(1!==u.rangeCount||u.anchorNode!==n.node||u.anchorOffset!==n.offset||u.focusNode!==q.node||u.focusOffset!==q.offset)&&(A=A.createRange(),
A.setStart(n.node,n.offset),u.removeAllRanges(),g>h?(u.addRange(A),u.extend(q.node,q.offset)):(A.setEnd(q.node,q.offset),u.addRange(A))))));A=[];for(u=x;u=u.parentNode;)1===u.nodeType&&A.push({element:u,left:u.scrollLeft,top:u.scrollTop});"function"===typeof x.focus&&x.focus();for(x=0;x<A.length;x++)u=A[x],u.element.scrollLeft=u.left,u.element.scrollTop=u.top}tc=!!Ze;$e=Ze=null;a.current=c;l=e;do try{for(x=a;null!==l;){var F=l.effectTag;F&36&&oj(x,l.alternate,l);if(F&128){A=void 0;var E=l.ref;if(null!==
E){var G=l.stateNode;switch(l.tag){case 5:A=G;break;default:A=G}"function"===typeof E?E(A):E.current=A}}l=l.nextEffect}}catch(sb){if(null===l)throw Error(k(330));Za(l,sb);l=l.nextEffect}while(null!==l);l=null;Cj();p=f}else a.current=c;if(ld)ld=!1,Zb=a,$b=b;else for(l=e;null!==l;)b=l.nextEffect,l.nextEffect=null,l=b;b=a.firstPendingTime;0===b&&(La=null);1073741823===b?a===af?ac++:(ac=0,af=a):ac=0;"function"===typeof bf&&bf(c.stateNode,d);V(a);if(cd)throw cd=!1,a=Se,Se=null,a;if((p&Ye)!==H)return null;
ha();return null}function Bj(){for(;null!==l;){var a=l.effectTag;0!==(a&256)&&nj(l.alternate,l);0===(a&512)||ld||(ld=!0,Ng(97,function(){xb();return null}));l=l.nextEffect}}function xb(){if(90!==$b){var a=97<$b?97:$b;$b=90;return Da(a,Dj)}}function Dj(){if(null===Zb)return!1;var a=Zb;Zb=null;if((p&(ca|ma))!==H)throw Error(k(331));var b=p;p|=ma;for(a=a.current.firstEffect;null!==a;){try{var c=a;if(0!==(c.effectTag&512))switch(c.tag){case 0:case 11:case 15:case 22:Ah(5,c),Bh(5,c)}}catch(d){if(null===
a)throw Error(k(330));Za(a,d)}c=a.nextEffect;a.nextEffect=null;a=c}p=b;ha();return!0}function Vh(a,b,c){b=Le(c,b);b=Ih(a,b,1073741823);Fa(a,b);a=ed(a,1073741823);null!==a&&V(a)}function Za(a,b){if(3===a.tag)Vh(a,a,b);else for(var c=a.return;null!==c;){if(3===c.tag){Vh(c,a,b);break}else if(1===c.tag){var d=c.stateNode;if("function"===typeof c.type.getDerivedStateFromError||"function"===typeof d.componentDidCatch&&(null===La||!La.has(d))){a=Le(b,a);a=Jh(c,a,1073741823);Fa(c,a);c=ed(c,1073741823);null!==
c&&V(c);break}}c=c.return}}function xj(a,b,c){var d=a.pingCache;null!==d&&d.delete(b);U===a&&P===c?F===bd||F===ad&&1073741823===ta&&Y()-Re<Ph?$a(a,P):jd=!0:Kh(a,c)&&(b=a.lastPingedTime,0!==b&&b<c||(a.lastPingedTime=c,V(a)))}function qj(a,b){var c=a.stateNode;null!==c&&c.delete(b);b=0;0===b&&(b=ka(),b=Va(b,a,null));a=ed(a,b);null!==a&&V(a)}function Ej(a){if("undefined"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)return!1;var b=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(b.isDisabled||!b.supportsFiber)return!0;try{var c=
b.inject(a);bf=function(a,e){try{b.onCommitFiberRoot(c,a,void 0,64===(a.current.effectTag&64))}catch(f){}};Ne=function(a){try{b.onCommitFiberUnmount(c,a)}catch(e){}}}catch(d){}return!0}function Fj(a,b,c,d){this.tag=a;this.key=c;this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null;this.index=0;this.ref=null;this.pendingProps=b;this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null;this.mode=d;this.effectTag=0;this.lastEffect=this.firstEffect=this.nextEffect=
null;this.childExpirationTime=this.expirationTime=0;this.alternate=null}function Ge(a){a=a.prototype;return!(!a||!a.isReactComponent)}function Gj(a){if("function"===typeof a)return Ge(a)?1:0;if(void 0!==a&&null!==a){a=a.$$typeof;if(a===zd)return 11;if(a===Ad)return 14}return 2}function Sa(a,b){var c=a.alternate;null===c?(c=la(a.tag,b,a.key,a.mode),c.elementType=a.elementType,c.type=a.type,c.stateNode=a.stateNode,c.alternate=a,a.alternate=c):(c.pendingProps=b,c.effectTag=0,c.nextEffect=null,c.firstEffect=
null,c.lastEffect=null);c.childExpirationTime=a.childExpirationTime;c.expirationTime=a.expirationTime;c.child=a.child;c.memoizedProps=a.memoizedProps;c.memoizedState=a.memoizedState;c.updateQueue=a.updateQueue;b=a.dependencies;c.dependencies=null===b?null:{expirationTime:b.expirationTime,firstContext:b.firstContext,responders:b.responders};c.sibling=a.sibling;c.index=a.index;c.ref=a.ref;return c}function Oc(a,b,c,d,e,f){var g=2;d=a;if("function"===typeof a)Ge(a)&&(g=1);else if("string"===typeof a)g=
5;else a:switch(a){case Ma:return Ha(c.children,e,f,b);case Hj:g=8;e|=7;break;case Af:g=8;e|=1;break;case kc:return a=la(12,c,b,e|8),a.elementType=kc,a.type=kc,a.expirationTime=f,a;case lc:return a=la(13,c,b,e),a.type=lc,a.elementType=lc,a.expirationTime=f,a;case yd:return a=la(19,c,b,e),a.elementType=yd,a.expirationTime=f,a;default:if("object"===typeof a&&null!==a)switch(a.$$typeof){case Cf:g=10;break a;case Bf:g=9;break a;case zd:g=11;break a;case Ad:g=14;break a;case Ef:g=16;d=null;break a;case Df:g=
22;break a}throw Error(k(130,null==a?a:typeof a,""));}b=la(g,c,b,e);b.elementType=a;b.type=d;b.expirationTime=f;return b}function Ha(a,b,c,d){a=la(7,a,d,b);a.expirationTime=c;return a}function qe(a,b,c){a=la(6,a,null,b);a.expirationTime=c;return a}function re(a,b,c){b=la(4,null!==a.children?a.children:[],a.key,b);b.expirationTime=c;b.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation};return b}function Ij(a,b,c){this.tag=b;this.current=null;this.containerInfo=
a;this.pingCache=this.pendingChildren=null;this.finishedExpirationTime=0;this.finishedWork=null;this.timeoutHandle=-1;this.pendingContext=this.context=null;this.hydrate=c;this.callbackNode=null;this.callbackPriority=90;this.lastExpiredTime=this.lastPingedTime=this.nextKnownPendingLevel=this.lastSuspendedTime=this.firstSuspendedTime=this.firstPendingTime=0}function Kh(a,b){var c=a.firstSuspendedTime;a=a.lastSuspendedTime;return 0!==c&&c>=b&&a<=b}function Ya(a,b){var c=a.firstSuspendedTime,d=a.lastSuspendedTime;
c<b&&(a.firstSuspendedTime=b);if(d>b||0===c)a.lastSuspendedTime=b;b<=a.lastPingedTime&&(a.lastPingedTime=0);b<=a.lastExpiredTime&&(a.lastExpiredTime=0)}function yh(a,b){b>a.firstPendingTime&&(a.firstPendingTime=b);var c=a.firstSuspendedTime;0!==c&&(b>=c?a.firstSuspendedTime=a.lastSuspendedTime=a.nextKnownPendingLevel=0:b>=a.lastSuspendedTime&&(a.lastSuspendedTime=b+1),b>a.nextKnownPendingLevel&&(a.nextKnownPendingLevel=b))}function Ue(a,b){var c=a.lastExpiredTime;if(0===c||c>b)a.lastExpiredTime=b}
function md(a,b,c,d){var e=b.current,f=ka(),g=Vb.suspense;f=Va(f,e,g);a:if(c){c=c._reactInternalFiber;b:{if(Na(c)!==c||1!==c.tag)throw Error(k(170));var h=c;do{switch(h.tag){case 3:h=h.stateNode.context;break b;case 1:if(N(h.type)){h=h.stateNode.__reactInternalMemoizedMergedChildContext;break b}}h=h.return}while(null!==h);throw Error(k(171));}if(1===c.tag){var m=c.type;if(N(m)){c=Gg(c,m,h);break a}}c=h}else c=Ca;null===b.context?b.context=c:b.pendingContext=c;b=Ea(f,g);b.payload={element:a};d=void 0===
d?null:d;null!==d&&(b.callback=d);Fa(e,b);Ja(e,f);return f}function cf(a){a=a.current;if(!a.child)return null;switch(a.child.tag){case 5:return a.child.stateNode;default:return a.child.stateNode}}function Wh(a,b){a=a.memoizedState;null!==a&&null!==a.dehydrated&&a.retryTime<b&&(a.retryTime=b)}function df(a,b){Wh(a,b);(a=a.alternate)&&Wh(a,b)}function ef(a,b,c){c=null!=c&&!0===c.hydrate;var d=new Ij(a,b,c),e=la(3,null,null,2===b?7:1===b?3:0);d.current=e;e.stateNode=d;ne(e);a[Lb]=d.current;c&&0!==b&&
xi(a,9===a.nodeType?a:a.ownerDocument);this._internalRoot=d}function bc(a){return!(!a||1!==a.nodeType&&9!==a.nodeType&&11!==a.nodeType&&(8!==a.nodeType||" react-mount-point-unstable "!==a.nodeValue))}function Jj(a,b){b||(b=a?9===a.nodeType?a.documentElement:a.firstChild:null,b=!(!b||1!==b.nodeType||!b.hasAttribute("data-reactroot")));if(!b)for(var c;c=a.lastChild;)a.removeChild(c);return new ef(a,0,b?{hydrate:!0}:void 0)}function nd(a,b,c,d,e){var f=c._reactRootContainer;if(f){var g=f._internalRoot;
if("function"===typeof e){var h=e;e=function(){var a=cf(g);h.call(a)}}md(b,g,a,e)}else{f=c._reactRootContainer=Jj(c,d);g=f._internalRoot;if("function"===typeof e){var m=e;e=function(){var a=cf(g);m.call(a)}}Rh(function(){md(b,g,a,e)})}return cf(g)}function Kj(a,b,c){var d=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:gb,key:null==d?null:""+d,children:a,containerInfo:b,implementation:c}}function Xh(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;
if(!bc(b))throw Error(k(200));return Kj(a,b,null,c)}if(!ea)throw Error(k(227));var ki=function(a,b,c,d,e,f,g,h,m){var n=Array.prototype.slice.call(arguments,3);try{b.apply(c,n)}catch(C){this.onError(C)}},yb=!1,gc=null,hc=!1,pd=null,li={onError:function(a){yb=!0;gc=a}},td=null,rf=null,mf=null,ic=null,cb={},jc=[],qd={},db={},rd={},wa=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),M=ea.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.assign,
sd=null,eb=null,fb=null,ee=function(a,b){return a(b)},eg=function(a,b,c,d,e){return a(b,c,d,e)},vd=function(){},vf=ee,Oa=!1,wd=!1,Z=ea.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.Scheduler,Lj=Z.unstable_cancelCallback,ff=Z.unstable_now,$f=Z.unstable_scheduleCallback,Mj=Z.unstable_shouldYield,Yh=Z.unstable_requestPaint,Pd=Z.unstable_runWithPriority,Nj=Z.unstable_getCurrentPriorityLevel,Oj=Z.unstable_ImmediatePriority,Zh=Z.unstable_UserBlockingPriority,ag=Z.unstable_NormalPriority,Pj=Z.unstable_LowPriority,
Qj=Z.unstable_IdlePriority,oi=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,wf=Object.prototype.hasOwnProperty,yf={},xf={},E={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(a){E[a]=
new L(a,0,!1,a,null,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(a){var b=a[0];E[b]=new L(b,1,!1,a[1],null,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(a){E[a]=new L(a,2,!1,a.toLowerCase(),null,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(a){E[a]=new L(a,2,!1,a,null,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(a){E[a]=
new L(a,3,!1,a.toLowerCase(),null,!1)});["checked","multiple","muted","selected"].forEach(function(a){E[a]=new L(a,3,!0,a,null,!1)});["capture","download"].forEach(function(a){E[a]=new L(a,4,!1,a,null,!1)});["cols","rows","size","span"].forEach(function(a){E[a]=new L(a,6,!1,a,null,!1)});["rowSpan","start"].forEach(function(a){E[a]=new L(a,5,!1,a.toLowerCase(),null,!1)});var gf=/[\-:]([a-z])/g,hf=function(a){return a[1].toUpperCase()};"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(a){var b=
a.replace(gf,hf);E[b]=new L(b,1,!1,a,null,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(a){var b=a.replace(gf,hf);E[b]=new L(b,1,!1,a,"http://www.w3.org/1999/xlink",!1)});["xml:base","xml:lang","xml:space"].forEach(function(a){var b=a.replace(gf,hf);E[b]=new L(b,1,!1,a,"http://www.w3.org/XML/1998/namespace",!1)});["tabIndex","crossOrigin"].forEach(function(a){E[a]=new L(a,1,!1,a.toLowerCase(),null,!1)});E.xlinkHref=new L("xlinkHref",1,
!1,"xlink:href","http://www.w3.org/1999/xlink",!0);["src","href","action","formAction"].forEach(function(a){E[a]=new L(a,1,!1,a.toLowerCase(),null,!0)});var da=ea.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;da.hasOwnProperty("ReactCurrentDispatcher")||(da.ReactCurrentDispatcher={current:null});da.hasOwnProperty("ReactCurrentBatchConfig")||(da.ReactCurrentBatchConfig={suspense:null});var si=/^(.*)[\\\/]/,Q="function"===typeof Symbol&&Symbol.for,Pc=Q?Symbol.for("react.element"):60103,gb=Q?Symbol.for("react.portal"):
60106,Ma=Q?Symbol.for("react.fragment"):60107,Af=Q?Symbol.for("react.strict_mode"):60108,kc=Q?Symbol.for("react.profiler"):60114,Cf=Q?Symbol.for("react.provider"):60109,Bf=Q?Symbol.for("react.context"):60110,Hj=Q?Symbol.for("react.concurrent_mode"):60111,zd=Q?Symbol.for("react.forward_ref"):60112,lc=Q?Symbol.for("react.suspense"):60113,yd=Q?Symbol.for("react.suspense_list"):60120,Ad=Q?Symbol.for("react.memo"):60115,Ef=Q?Symbol.for("react.lazy"):60116,Df=Q?Symbol.for("react.block"):60121,zf="function"===
typeof Symbol&&Symbol.iterator,od,xh=function(a){return"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(b,c,d,e){MSApp.execUnsafeLocalFunction(function(){return a(b,c,d,e)})}:a}(function(a,b){if("http://www.w3.org/2000/svg"!==a.namespaceURI||"innerHTML"in a)a.innerHTML=b;else{od=od||document.createElement("div");od.innerHTML="<svg>"+b.valueOf().toString()+"</svg>";for(b=od.firstChild;a.firstChild;)a.removeChild(a.firstChild);for(;b.firstChild;)a.appendChild(b.firstChild)}}),Wb=function(a,
b){if(b){var c=a.firstChild;if(c&&c===a.lastChild&&3===c.nodeType){c.nodeValue=b;return}}a.textContent=b},ib={animationend:nc("Animation","AnimationEnd"),animationiteration:nc("Animation","AnimationIteration"),animationstart:nc("Animation","AnimationStart"),transitionend:nc("Transition","TransitionEnd")},Id={},Of={};wa&&(Of=document.createElement("div").style,"AnimationEvent"in window||(delete ib.animationend.animation,delete ib.animationiteration.animation,delete ib.animationstart.animation),"TransitionEvent"in
window||delete ib.transitionend.transition);var $h=oc("animationend"),ai=oc("animationiteration"),bi=oc("animationstart"),ci=oc("transitionend"),Db="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Pf=new ("function"===typeof WeakMap?WeakMap:Map),Ab=null,wi=function(a){if(a){var b=a._dispatchListeners,c=a._dispatchInstances;
if(Array.isArray(b))for(var d=0;d<b.length&&!a.isPropagationStopped();d++)lf(a,b[d],c[d]);else b&&lf(a,b,c);a._dispatchListeners=null;a._dispatchInstances=null;a.isPersistent()||a.constructor.release(a)}},qc=[],Rd=!1,fa=[],xa=null,ya=null,za=null,Eb=new Map,Fb=new Map,Jb=[],Nd="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput close cancel copy cut paste click change contextmenu reset submit".split(" "),
yi="focus blur dragenter dragleave mouseover mouseout pointerover pointerout gotpointercapture lostpointercapture".split(" "),dg={},cg=new Map,Td=new Map,Rj=["abort","abort",$h,"animationEnd",ai,"animationIteration",bi,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata",
"loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",ci,"transitionEnd","waiting","waiting"];Sd("blur blur cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focus focus input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),
0);Sd("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1);Sd(Rj,2);(function(a,b){for(var c=0;c<a.length;c++)Td.set(a[c],b)})("change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),0);var Hi=Zh,Gi=Pd,tc=!0,Kb={animationIterationCount:!0,
borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,
strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Sj=["Webkit","ms","Moz","O"];Object.keys(Kb).forEach(function(a){Sj.forEach(function(b){b=b+a.charAt(0).toUpperCase()+a.substring(1);Kb[b]=Kb[a]})});var Ii=M({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0}),ng="$",og="/$",$d="$?",Zd="$!",Ze=null,$e=null,We="function"===typeof setTimeout?setTimeout:void 0,vj="function"===
typeof clearTimeout?clearTimeout:void 0,jf=Math.random().toString(36).slice(2),Aa="__reactInternalInstance$"+jf,vc="__reactEventHandlers$"+jf,Lb="__reactContainere$"+jf,Ba=null,ce=null,wc=null;M(R.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():"unknown"!==typeof a.returnValue&&(a.returnValue=!1),this.isDefaultPrevented=xc)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():"unknown"!==
typeof a.cancelBubble&&(a.cancelBubble=!0),this.isPropagationStopped=xc)},persist:function(){this.isPersistent=xc},isPersistent:yc,destructor:function(){var a=this.constructor.Interface,b;for(b in a)this[b]=null;this.nativeEvent=this._targetInst=this.dispatchConfig=null;this.isPropagationStopped=this.isDefaultPrevented=yc;this._dispatchInstances=this._dispatchListeners=null}});R.Interface={type:null,target:null,currentTarget:function(){return null},eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(a){return a.timeStamp||
Date.now()},defaultPrevented:null,isTrusted:null};R.extend=function(a){function b(){return c.apply(this,arguments)}var c=this,d=function(){};d.prototype=c.prototype;d=new d;M(d,b.prototype);b.prototype=d;b.prototype.constructor=b;b.Interface=M({},c.Interface,a);b.extend=c.extend;sg(b);return b};sg(R);var Tj=R.extend({data:null}),Uj=R.extend({data:null}),Ni=[9,13,27,32],de=wa&&"CompositionEvent"in window,cc=null;wa&&"documentMode"in document&&(cc=document.documentMode);var Vj=wa&&"TextEvent"in window&&
!cc,xg=wa&&(!de||cc&&8<cc&&11>=cc),wg=String.fromCharCode(32),ua={beforeInput:{phasedRegistrationNames:{bubbled:"onBeforeInput",captured:"onBeforeInputCapture"},dependencies:["compositionend","keypress","textInput","paste"]},compositionEnd:{phasedRegistrationNames:{bubbled:"onCompositionEnd",captured:"onCompositionEndCapture"},dependencies:"blur compositionend keydown keypress keyup mousedown".split(" ")},compositionStart:{phasedRegistrationNames:{bubbled:"onCompositionStart",captured:"onCompositionStartCapture"},
dependencies:"blur compositionstart keydown keypress keyup mousedown".split(" ")},compositionUpdate:{phasedRegistrationNames:{bubbled:"onCompositionUpdate",captured:"onCompositionUpdateCapture"},dependencies:"blur compositionupdate keydown keypress keyup mousedown".split(" ")}},vg=!1,mb=!1,Wj={eventTypes:ua,extractEvents:function(a,b,c,d,e){var f;if(de)b:{switch(a){case "compositionstart":var g=ua.compositionStart;break b;case "compositionend":g=ua.compositionEnd;break b;case "compositionupdate":g=
ua.compositionUpdate;break b}g=void 0}else mb?tg(a,c)&&(g=ua.compositionEnd):"keydown"===a&&229===c.keyCode&&(g=ua.compositionStart);g?(xg&&"ko"!==c.locale&&(mb||g!==ua.compositionStart?g===ua.compositionEnd&&mb&&(f=rg()):(Ba=d,ce="value"in Ba?Ba.value:Ba.textContent,mb=!0)),e=Tj.getPooled(g,b,c,d),f?e.data=f:(f=ug(c),null!==f&&(e.data=f)),lb(e),f=e):f=null;(a=Vj?Oi(a,c):Pi(a,c))?(b=Uj.getPooled(ua.beforeInput,b,c,d),b.data=a,lb(b)):b=null;return null===f?b:null===b?f:[f,b]}},Qi={color:!0,date:!0,
datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0},Ag={change:{phasedRegistrationNames:{bubbled:"onChange",captured:"onChangeCapture"},dependencies:"blur change click focus input keydown keyup selectionchange".split(" ")}},Mb=null,Nb=null,kf=!1;wa&&(kf=Tf("input")&&(!document.documentMode||9<document.documentMode));var Xj={eventTypes:Ag,_isInputEventSupported:kf,extractEvents:function(a,b,c,d,e){e=b?Pa(b):window;var f=
e.nodeName&&e.nodeName.toLowerCase();if("select"===f||"input"===f&&"file"===e.type)var g=Si;else if(yg(e))if(kf)g=Wi;else{g=Ui;var h=Ti}else(f=e.nodeName)&&"input"===f.toLowerCase()&&("checkbox"===e.type||"radio"===e.type)&&(g=Vi);if(g&&(g=g(a,b)))return zg(g,c,d);h&&h(a,e,b);"blur"===a&&(a=e._wrapperState)&&a.controlled&&"number"===e.type&&Ed(e,"number",e.value)}},dc=R.extend({view:null,detail:null}),Yi={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"},di=0,ei=0,fi=!1,gi=!1,ec=dc.extend({screenX:null,
screenY:null,clientX:null,clientY:null,pageX:null,pageY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:fe,button:null,buttons:null,relatedTarget:function(a){return a.relatedTarget||(a.fromElement===a.srcElement?a.toElement:a.fromElement)},movementX:function(a){if("movementX"in a)return a.movementX;var b=di;di=a.screenX;return fi?"mousemove"===a.type?a.screenX-b:0:(fi=!0,0)},movementY:function(a){if("movementY"in a)return a.movementY;var b=ei;ei=a.screenY;return gi?"mousemove"===
a.type?a.screenY-b:0:(gi=!0,0)}}),hi=ec.extend({pointerId:null,width:null,height:null,pressure:null,tangentialPressure:null,tiltX:null,tiltY:null,twist:null,pointerType:null,isPrimary:null}),fc={mouseEnter:{registrationName:"onMouseEnter",dependencies:["mouseout","mouseover"]},mouseLeave:{registrationName:"onMouseLeave",dependencies:["mouseout","mouseover"]},pointerEnter:{registrationName:"onPointerEnter",dependencies:["pointerout","pointerover"]},pointerLeave:{registrationName:"onPointerLeave",dependencies:["pointerout",
"pointerover"]}},Yj={eventTypes:fc,extractEvents:function(a,b,c,d,e){var f="mouseover"===a||"pointerover"===a,g="mouseout"===a||"pointerout"===a;if(f&&0===(e&32)&&(c.relatedTarget||c.fromElement)||!g&&!f)return null;f=d.window===d?d:(f=d.ownerDocument)?f.defaultView||f.parentWindow:window;if(g){if(g=b,b=(b=c.relatedTarget||c.toElement)?Bb(b):null,null!==b){var h=Na(b);if(b!==h||5!==b.tag&&6!==b.tag)b=null}}else g=null;if(g===b)return null;if("mouseout"===a||"mouseover"===a){var m=ec;var n=fc.mouseLeave;
var l=fc.mouseEnter;var k="mouse"}else if("pointerout"===a||"pointerover"===a)m=hi,n=fc.pointerLeave,l=fc.pointerEnter,k="pointer";a=null==g?f:Pa(g);f=null==b?f:Pa(b);n=m.getPooled(n,g,c,d);n.type=k+"leave";n.target=a;n.relatedTarget=f;c=m.getPooled(l,b,c,d);c.type=k+"enter";c.target=f;c.relatedTarget=a;d=g;k=b;if(d&&k)a:{m=d;l=k;g=0;for(a=m;a;a=pa(a))g++;a=0;for(b=l;b;b=pa(b))a++;for(;0<g-a;)m=pa(m),g--;for(;0<a-g;)l=pa(l),a--;for(;g--;){if(m===l||m===l.alternate)break a;m=pa(m);l=pa(l)}m=null}else m=
null;l=m;for(m=[];d&&d!==l;){g=d.alternate;if(null!==g&&g===l)break;m.push(d);d=pa(d)}for(d=[];k&&k!==l;){g=k.alternate;if(null!==g&&g===l)break;d.push(k);k=pa(k)}for(k=0;k<m.length;k++)be(m[k],"bubbled",n);for(k=d.length;0<k--;)be(d[k],"captured",c);return 0===(e&64)?[n]:[n,c]}},Qa="function"===typeof Object.is?Object.is:Zi,$i=Object.prototype.hasOwnProperty,Zj=wa&&"documentMode"in document&&11>=document.documentMode,Eg={select:{phasedRegistrationNames:{bubbled:"onSelect",captured:"onSelectCapture"},
dependencies:"blur contextmenu dragend focus keydown keyup mousedown mouseup selectionchange".split(" ")}},nb=null,he=null,Pb=null,ge=!1,ak={eventTypes:Eg,extractEvents:function(a,b,c,d,e,f){e=f||(d.window===d?d.document:9===d.nodeType?d:d.ownerDocument);if(!(f=!e)){a:{e=Jd(e);f=rd.onSelect;for(var g=0;g<f.length;g++)if(!e.has(f[g])){e=!1;break a}e=!0}f=!e}if(f)return null;e=b?Pa(b):window;switch(a){case "focus":if(yg(e)||"true"===e.contentEditable)nb=e,he=b,Pb=null;break;case "blur":Pb=he=nb=null;
break;case "mousedown":ge=!0;break;case "contextmenu":case "mouseup":case "dragend":return ge=!1,Dg(c,d);case "selectionchange":if(Zj)break;case "keydown":case "keyup":return Dg(c,d)}return null}},bk=R.extend({animationName:null,elapsedTime:null,pseudoElement:null}),ck=R.extend({clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),dk=dc.extend({relatedTarget:null}),ek={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",
Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},fk={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",
224:"Meta"},gk=dc.extend({key:function(a){if(a.key){var b=ek[a.key]||a.key;if("Unidentified"!==b)return b}return"keypress"===a.type?(a=Ac(a),13===a?"Enter":String.fromCharCode(a)):"keydown"===a.type||"keyup"===a.type?fk[a.keyCode]||"Unidentified":""},location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:fe,charCode:function(a){return"keypress"===a.type?Ac(a):0},keyCode:function(a){return"keydown"===a.type||"keyup"===a.type?a.keyCode:0},which:function(a){return"keypress"===
a.type?Ac(a):"keydown"===a.type||"keyup"===a.type?a.keyCode:0}}),hk=ec.extend({dataTransfer:null}),ik=dc.extend({touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:fe}),jk=R.extend({propertyName:null,elapsedTime:null,pseudoElement:null}),kk=ec.extend({deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?
-a.wheelDelta:0},deltaZ:null,deltaMode:null}),lk={eventTypes:dg,extractEvents:function(a,b,c,d,e){e=cg.get(a);if(!e)return null;switch(a){case "keypress":if(0===Ac(c))return null;case "keydown":case "keyup":a=gk;break;case "blur":case "focus":a=dk;break;case "click":if(2===c.button)return null;case "auxclick":case "dblclick":case "mousedown":case "mousemove":case "mouseup":case "mouseout":case "mouseover":case "contextmenu":a=ec;break;case "drag":case "dragend":case "dragenter":case "dragexit":case "dragleave":case "dragover":case "dragstart":case "drop":a=
hk;break;case "touchcancel":case "touchend":case "touchmove":case "touchstart":a=ik;break;case $h:case ai:case bi:a=bk;break;case ci:a=jk;break;case "scroll":a=dc;break;case "wheel":a=kk;break;case "copy":case "cut":case "paste":a=ck;break;case "gotpointercapture":case "lostpointercapture":case "pointercancel":case "pointerdown":case "pointermove":case "pointerout":case "pointerover":case "pointerup":a=hi;break;default:a=R}b=a.getPooled(e,b,c,d);lb(b);return b}};(function(a){if(ic)throw Error(k(101));
ic=Array.prototype.slice.call(a);nf()})("ResponderEventPlugin SimpleEventPlugin EnterLeaveEventPlugin ChangeEventPlugin SelectEventPlugin BeforeInputEventPlugin".split(" "));(function(a,b,c){td=a;rf=b;mf=c})(ae,Hb,Pa);pf({SimpleEventPlugin:lk,EnterLeaveEventPlugin:Yj,ChangeEventPlugin:Xj,SelectEventPlugin:ak,BeforeInputEventPlugin:Wj});var ie=[],ob=-1,Ca={},B={current:Ca},G={current:!1},Ra=Ca,bj=Pd,je=$f,Rg=Lj,aj=Nj,Dc=Oj,Ig=Zh,Jg=ag,Kg=Pj,Lg=Qj,Qg={},yj=Mj,Cj=void 0!==Yh?Yh:function(){},qa=null,
Ec=null,ke=!1,ii=ff(),Y=1E4>ii?ff:function(){return ff()-ii},Ic={current:null},Hc=null,qb=null,Gc=null,Tg=0,Jc=2,Ga=!1,Vb=da.ReactCurrentBatchConfig,$g=(new ea.Component).refs,Mc={isMounted:function(a){return(a=a._reactInternalFiber)?Na(a)===a:!1},enqueueSetState:function(a,b,c){a=a._reactInternalFiber;var d=ka(),e=Vb.suspense;d=Va(d,a,e);e=Ea(d,e);e.payload=b;void 0!==c&&null!==c&&(e.callback=c);Fa(a,e);Ja(a,d)},enqueueReplaceState:function(a,b,c){a=a._reactInternalFiber;var d=ka(),e=Vb.suspense;
d=Va(d,a,e);e=Ea(d,e);e.tag=1;e.payload=b;void 0!==c&&null!==c&&(e.callback=c);Fa(a,e);Ja(a,d)},enqueueForceUpdate:function(a,b){a=a._reactInternalFiber;var c=ka(),d=Vb.suspense;c=Va(c,a,d);d=Ea(c,d);d.tag=Jc;void 0!==b&&null!==b&&(d.callback=b);Fa(a,d);Ja(a,c)}},Qc=Array.isArray,wb=ah(!0),Fe=ah(!1),Sb={},ja={current:Sb},Ub={current:Sb},Tb={current:Sb},D={current:0},Sc=da.ReactCurrentDispatcher,X=da.ReactCurrentBatchConfig,Ia=0,z=null,K=null,J=null,Uc=!1,Tc={readContext:W,useCallback:S,useContext:S,
useEffect:S,useImperativeHandle:S,useLayoutEffect:S,useMemo:S,useReducer:S,useRef:S,useState:S,useDebugValue:S,useResponder:S,useDeferredValue:S,useTransition:S},dj={readContext:W,useCallback:ih,useContext:W,useEffect:eh,useImperativeHandle:function(a,b,c){c=null!==c&&void 0!==c?c.concat([a]):null;return ze(4,2,gh.bind(null,b,a),c)},useLayoutEffect:function(a,b){return ze(4,2,a,b)},useMemo:function(a,b){var c=ub();b=void 0===b?null:b;a=a();c.memoizedState=[a,b];return a},useReducer:function(a,b,c){var d=
ub();b=void 0!==c?c(b):b;d.memoizedState=d.baseState=b;a=d.queue={pending:null,dispatch:null,lastRenderedReducer:a,lastRenderedState:b};a=a.dispatch=ch.bind(null,z,a);return[d.memoizedState,a]},useRef:function(a){var b=ub();a={current:a};return b.memoizedState=a},useState:xe,useDebugValue:Be,useResponder:ue,useDeferredValue:function(a,b){var c=xe(a),d=c[0],e=c[1];eh(function(){var c=X.suspense;X.suspense=void 0===b?null:b;try{e(a)}finally{X.suspense=c}},[a,b]);return d},useTransition:function(a){var b=
xe(!1),c=b[0];b=b[1];return[ih(Ce.bind(null,b,a),[b,a]),c]}},ej={readContext:W,useCallback:Yc,useContext:W,useEffect:Xc,useImperativeHandle:hh,useLayoutEffect:fh,useMemo:jh,useReducer:Vc,useRef:dh,useState:function(a){return Vc(Ua)},useDebugValue:Be,useResponder:ue,useDeferredValue:function(a,b){var c=Vc(Ua),d=c[0],e=c[1];Xc(function(){var c=X.suspense;X.suspense=void 0===b?null:b;try{e(a)}finally{X.suspense=c}},[a,b]);return d},useTransition:function(a){var b=Vc(Ua),c=b[0];b=b[1];return[Yc(Ce.bind(null,
b,a),[b,a]),c]}},fj={readContext:W,useCallback:Yc,useContext:W,useEffect:Xc,useImperativeHandle:hh,useLayoutEffect:fh,useMemo:jh,useReducer:Wc,useRef:dh,useState:function(a){return Wc(Ua)},useDebugValue:Be,useResponder:ue,useDeferredValue:function(a,b){var c=Wc(Ua),d=c[0],e=c[1];Xc(function(){var c=X.suspense;X.suspense=void 0===b?null:b;try{e(a)}finally{X.suspense=c}},[a,b]);return d},useTransition:function(a){var b=Wc(Ua),c=b[0];b=b[1];return[Yc(Ce.bind(null,b,a),[b,a]),c]}},ra=null,Ka=null,Wa=
!1,gj=da.ReactCurrentOwner,ia=!1,Je={dehydrated:null,retryTime:0};var jj=function(a,b,c,d){for(c=b.child;null!==c;){if(5===c.tag||6===c.tag)a.appendChild(c.stateNode);else if(4!==c.tag&&null!==c.child){c.child.return=c;c=c.child;continue}if(c===b)break;for(;null===c.sibling;){if(null===c.return||c.return===b)return;c=c.return}c.sibling.return=c.return;c=c.sibling}};var wh=function(a){};var ij=function(a,b,c,d,e){var f=a.memoizedProps;if(f!==d){var g=b.stateNode;Ta(ja.current);a=null;switch(c){case "input":f=
Cd(g,f);d=Cd(g,d);a=[];break;case "option":f=Fd(g,f);d=Fd(g,d);a=[];break;case "select":f=M({},f,{value:void 0});d=M({},d,{value:void 0});a=[];break;case "textarea":f=Gd(g,f);d=Gd(g,d);a=[];break;default:"function"!==typeof f.onClick&&"function"===typeof d.onClick&&(g.onclick=uc)}Ud(c,d);var h,m;c=null;for(h in f)if(!d.hasOwnProperty(h)&&f.hasOwnProperty(h)&&null!=f[h])if("style"===h)for(m in g=f[h],g)g.hasOwnProperty(m)&&(c||(c={}),c[m]="");else"dangerouslySetInnerHTML"!==h&&"children"!==h&&"suppressContentEditableWarning"!==
h&&"suppressHydrationWarning"!==h&&"autoFocus"!==h&&(db.hasOwnProperty(h)?a||(a=[]):(a=a||[]).push(h,null));for(h in d){var k=d[h];g=null!=f?f[h]:void 0;if(d.hasOwnProperty(h)&&k!==g&&(null!=k||null!=g))if("style"===h)if(g){for(m in g)!g.hasOwnProperty(m)||k&&k.hasOwnProperty(m)||(c||(c={}),c[m]="");for(m in k)k.hasOwnProperty(m)&&g[m]!==k[m]&&(c||(c={}),c[m]=k[m])}else c||(a||(a=[]),a.push(h,c)),c=k;else"dangerouslySetInnerHTML"===h?(k=k?k.__html:void 0,g=g?g.__html:void 0,null!=k&&g!==k&&(a=a||
[]).push(h,k)):"children"===h?g===k||"string"!==typeof k&&"number"!==typeof k||(a=a||[]).push(h,""+k):"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&(db.hasOwnProperty(h)?(null!=k&&oa(e,h),a||g===k||(a=[])):(a=a||[]).push(h,k))}c&&(a=a||[]).push("style",c);e=a;if(b.updateQueue=e)b.effectTag|=4}};var kj=function(a,b,c,d){c!==d&&(b.effectTag|=4)};var pj="function"===typeof WeakSet?WeakSet:Set,wj="function"===typeof WeakMap?WeakMap:Map,sj=Math.ceil,gd=da.ReactCurrentDispatcher,
Uh=da.ReactCurrentOwner,H=0,Ye=8,ca=16,ma=32,Xa=0,hd=1,Oh=2,ad=3,bd=4,Xe=5,p=H,U=null,t=null,P=0,F=Xa,id=null,ta=1073741823,Yb=1073741823,kd=null,Xb=0,jd=!1,Re=0,Ph=500,l=null,cd=!1,Se=null,La=null,ld=!1,Zb=null,$b=90,bb=null,ac=0,af=null,dd=0,Ja=function(a,b){if(50<ac)throw ac=0,af=null,Error(k(185));a=ed(a,b);if(null!==a){var c=Cc();1073741823===b?(p&Ye)!==H&&(p&(ca|ma))===H?Te(a):(V(a),p===H&&ha()):V(a);(p&4)===H||98!==c&&99!==c||(null===bb?bb=new Map([[a,b]]):(c=bb.get(a),(void 0===c||c>b)&&bb.set(a,
b)))}};var zj=function(a,b,c){var d=b.expirationTime;if(null!==a){var e=b.pendingProps;if(a.memoizedProps!==e||G.current)ia=!0;else{if(d<c){ia=!1;switch(b.tag){case 3:sh(b);Ee();break;case 5:bh(b);if(b.mode&4&&1!==c&&e.hidden)return b.expirationTime=b.childExpirationTime=1,null;break;case 1:N(b.type)&&Bc(b);break;case 4:se(b,b.stateNode.containerInfo);break;case 10:d=b.memoizedProps.value;e=b.type._context;y(Ic,e._currentValue);e._currentValue=d;break;case 13:if(null!==b.memoizedState){d=b.child.childExpirationTime;
if(0!==d&&d>=c)return th(a,b,c);y(D,D.current&1);b=sa(a,b,c);return null!==b?b.sibling:null}y(D,D.current&1);break;case 19:d=b.childExpirationTime>=c;if(0!==(a.effectTag&64)){if(d)return vh(a,b,c);b.effectTag|=64}e=b.memoizedState;null!==e&&(e.rendering=null,e.tail=null);y(D,D.current);if(!d)return null}return sa(a,b,c)}ia=!1}}else ia=!1;b.expirationTime=0;switch(b.tag){case 2:d=b.type;null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2);a=b.pendingProps;e=pb(b,B.current);rb(b,c);e=we(null,
b,d,a,e,c);b.effectTag|=1;if("object"===typeof e&&null!==e&&"function"===typeof e.render&&void 0===e.$$typeof){b.tag=1;b.memoizedState=null;b.updateQueue=null;if(N(d)){var f=!0;Bc(b)}else f=!1;b.memoizedState=null!==e.state&&void 0!==e.state?e.state:null;ne(b);var g=d.getDerivedStateFromProps;"function"===typeof g&&Lc(b,d,g,a);e.updater=Mc;b.stateNode=e;e._reactInternalFiber=b;pe(b,d,a,c);b=Ie(null,b,d,!0,f,c)}else b.tag=0,T(null,b,e,c),b=b.child;return b;case 16:a:{e=b.elementType;null!==a&&(a.alternate=
null,b.alternate=null,b.effectTag|=2);a=b.pendingProps;ri(e);if(1!==e._status)throw e._result;e=e._result;b.type=e;f=b.tag=Gj(e);a=aa(e,a);switch(f){case 0:b=He(null,b,e,a,c);break a;case 1:b=rh(null,b,e,a,c);break a;case 11:b=nh(null,b,e,a,c);break a;case 14:b=oh(null,b,e,aa(e.type,a),d,c);break a}throw Error(k(306,e,""));}return b;case 0:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),He(a,b,d,e,c);case 1:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),rh(a,b,d,e,c);
case 3:sh(b);d=b.updateQueue;if(null===a||null===d)throw Error(k(282));d=b.pendingProps;e=b.memoizedState;e=null!==e?e.element:null;oe(a,b);Qb(b,d,null,c);d=b.memoizedState.element;if(d===e)Ee(),b=sa(a,b,c);else{if(e=b.stateNode.hydrate)Ka=kb(b.stateNode.containerInfo.firstChild),ra=b,e=Wa=!0;if(e)for(c=Fe(b,null,d,c),b.child=c;c;)c.effectTag=c.effectTag&-3|1024,c=c.sibling;else T(a,b,d,c),Ee();b=b.child}return b;case 5:return bh(b),null===a&&De(b),d=b.type,e=b.pendingProps,f=null!==a?a.memoizedProps:
null,g=e.children,Yd(d,e)?g=null:null!==f&&Yd(d,f)&&(b.effectTag|=16),qh(a,b),b.mode&4&&1!==c&&e.hidden?(b.expirationTime=b.childExpirationTime=1,b=null):(T(a,b,g,c),b=b.child),b;case 6:return null===a&&De(b),null;case 13:return th(a,b,c);case 4:return se(b,b.stateNode.containerInfo),d=b.pendingProps,null===a?b.child=wb(b,null,d,c):T(a,b,d,c),b.child;case 11:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),nh(a,b,d,e,c);case 7:return T(a,b,b.pendingProps,c),b.child;case 8:return T(a,
b,b.pendingProps.children,c),b.child;case 12:return T(a,b,b.pendingProps.children,c),b.child;case 10:a:{d=b.type._context;e=b.pendingProps;g=b.memoizedProps;f=e.value;var h=b.type._context;y(Ic,h._currentValue);h._currentValue=f;if(null!==g)if(h=g.value,f=Qa(h,f)?0:("function"===typeof d._calculateChangedBits?d._calculateChangedBits(h,f):1073741823)|0,0===f){if(g.children===e.children&&!G.current){b=sa(a,b,c);break a}}else for(h=b.child,null!==h&&(h.return=b);null!==h;){var m=h.dependencies;if(null!==
m){g=h.child;for(var l=m.firstContext;null!==l;){if(l.context===d&&0!==(l.observedBits&f)){1===h.tag&&(l=Ea(c,null),l.tag=Jc,Fa(h,l));h.expirationTime<c&&(h.expirationTime=c);l=h.alternate;null!==l&&l.expirationTime<c&&(l.expirationTime=c);Sg(h.return,c);m.expirationTime<c&&(m.expirationTime=c);break}l=l.next}}else g=10===h.tag?h.type===b.type?null:h.child:h.child;if(null!==g)g.return=h;else for(g=h;null!==g;){if(g===b){g=null;break}h=g.sibling;if(null!==h){h.return=g.return;g=h;break}g=g.return}h=
g}T(a,b,e.children,c);b=b.child}return b;case 9:return e=b.type,f=b.pendingProps,d=f.children,rb(b,c),e=W(e,f.unstable_observedBits),d=d(e),b.effectTag|=1,T(a,b,d,c),b.child;case 14:return e=b.type,f=aa(e,b.pendingProps),f=aa(e.type,f),oh(a,b,e,f,d,c);case 15:return ph(a,b,b.type,b.pendingProps,d,c);case 17:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2),b.tag=1,N(d)?(a=!0,Bc(b)):a=!1,rb(b,c),Yg(b,d,e),pe(b,d,e,c),Ie(null,
b,d,!0,a,c);case 19:return vh(a,b,c)}throw Error(k(156,b.tag));};var bf=null,Ne=null,la=function(a,b,c,d){return new Fj(a,b,c,d)};ef.prototype.render=function(a){md(a,this._internalRoot,null,null)};ef.prototype.unmount=function(){var a=this._internalRoot,b=a.containerInfo;md(null,a,null,function(){b[Lb]=null})};var Di=function(a){if(13===a.tag){var b=Fc(ka(),150,100);Ja(a,b);df(a,b)}};var Yf=function(a){13===a.tag&&(Ja(a,3),df(a,3))};var Bi=function(a){if(13===a.tag){var b=ka();b=Va(b,a,null);Ja(a,
b);df(a,b)}};sd=function(a,b,c){switch(b){case "input":Dd(a,c);b=c.name;if("radio"===c.type&&null!=b){for(c=a;c.parentNode;)c=c.parentNode;c=c.querySelectorAll("input[name="+JSON.stringify(""+b)+'][type="radio"]');for(b=0;b<c.length;b++){var d=c[b];if(d!==a&&d.form===a.form){var e=ae(d);if(!e)throw Error(k(90));Gf(d);Dd(d,e)}}}break;case "textarea":Lf(a,c);break;case "select":b=c.value,null!=b&&hb(a,!!c.multiple,b,!1)}};(function(a,b,c,d){ee=a;eg=b;vd=c;vf=d})(Qh,function(a,b,c,d,e){var f=p;p|=4;
try{return Da(98,a.bind(null,b,c,d,e))}finally{p=f,p===H&&ha()}},function(){(p&(1|ca|ma))===H&&(uj(),xb())},function(a,b){var c=p;p|=2;try{return a(b)}finally{p=c,p===H&&ha()}});var mk={Events:[Hb,Pa,ae,pf,qd,lb,function(a){Kd(a,Ki)},sf,tf,sc,pc,xb,{current:!1}]};(function(a){var b=a.findFiberByHostInstance;return Ej(M({},a,{overrideHookState:null,overrideProps:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:da.ReactCurrentDispatcher,findHostInstanceByFiber:function(a){a=Sf(a);
return null===a?null:a.stateNode},findFiberByHostInstance:function(a){return b?b(a):null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null}))})({findFiberByHostInstance:Bb,bundleType:0,version:"16.13.1",rendererPackageName:"react-dom"});I.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=mk;I.createPortal=Xh;I.findDOMNode=function(a){if(null==a)return null;if(1===a.nodeType)return a;var b=a._reactInternalFiber;if(void 0===
b){if("function"===typeof a.render)throw Error(k(188));throw Error(k(268,Object.keys(a)));}a=Sf(b);a=null===a?null:a.stateNode;return a};I.flushSync=function(a,b){if((p&(ca|ma))!==H)throw Error(k(187));var c=p;p|=1;try{return Da(99,a.bind(null,b))}finally{p=c,ha()}};I.hydrate=function(a,b,c){if(!bc(b))throw Error(k(200));return nd(null,a,b,!0,c)};I.render=function(a,b,c){if(!bc(b))throw Error(k(200));return nd(null,a,b,!1,c)};I.unmountComponentAtNode=function(a){if(!bc(a))throw Error(k(40));return a._reactRootContainer?
(Rh(function(){nd(null,null,a,!1,function(){a._reactRootContainer=null;a[Lb]=null})}),!0):!1};I.unstable_batchedUpdates=Qh;I.unstable_createPortal=function(a,b){return Xh(a,b,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)};I.unstable_renderSubtreeIntoContainer=function(a,b,c,d){if(!bc(c))throw Error(k(200));if(null==a||void 0===a._reactInternalFiber)throw Error(k(38));return nd(a,b,c,!1,d)};I.version="16.13.1"});
</script>
    <script>const e = React.createElement;

function pathToString(path) {
  if (path[0] === '/') {
    return '/' + path.slice(1).join('/');
  } else {
    return path.join('/');
  }
}

function findCommonPath(files) {
  if (!files || !files.length) {
    return [];
  }

  function isPrefix(arr, prefix) {
    if (arr.length < prefix.length) {
      return false;
    }
    for (let i = prefix.length - 1; i >= 0; --i) {
      if (arr[i] !== prefix[i]) {
        return false;
      }
    }
    return true;
  }

  let commonPath = files[0].path.slice(0, -1);
  while (commonPath.length) {
    if (files.every(file => isPrefix(file.path, commonPath))) {
      break;
    }
    commonPath.pop();
  }
  return commonPath;
}

function findFolders(files) {
  if (!files || !files.length) {
    return [];
  }

  let folders = files.filter(file => file.path.length > 1).map(file => file.path[0]);
  folders = [...new Set(folders)]; // unique
  folders.sort();

  folders = folders.map(folder => {
    let filesInFolder = files
      .filter(file => file.path[0] === folder)
      .map(file => ({
        ...file,
        path: file.path.slice(1),
        parent: [...file.parent, file.path[0]],
      }));

    const children = findFolders(filesInFolder); // recursion

    return {
      is_folder: true,
      path: [folder],
      parent: files[0].parent,
      children,
      covered: children.reduce((sum, file) => sum + file.covered, 0),
      coverable: children.reduce((sum, file) => sum + file.coverable, 0),
      prevRun: {
        covered: children.reduce((sum, file) => sum + file.prevRun.covered, 0),
        coverable: children.reduce((sum, file) => sum + file.prevRun.coverable, 0),
      }
    };
  });

  return [
    ...folders,
    ...files.filter(file => file.path.length === 1),
  ];
}

class App extends React.Component {
  constructor(...args) {
    super(...args);

    this.state = {
      current: [],
    };
  }

  componentDidMount() {
    this.updateStateFromLocation();
    window.addEventListener("hashchange", () => this.updateStateFromLocation(), false);
  }

  updateStateFromLocation() {
    if (window.location.hash.length > 1) {
      const current = window.location.hash.substr(1).split('/');
      this.setState({current});
    } else {
      this.setState({current: []});
    }
  }

  getCurrentPath() {
    let file = this.props.root;
    let path = [file];
    for (let p of this.state.current) {
      file = file.children.find(file => file.path[0] === p);
      if (!file) {
        return path;
      }
      path.push(file);
    }
    return path;
  }

  render() {
    const path = this.getCurrentPath();
    const file = path[path.length - 1];

    let w = null;
    if (file.is_folder) {
      w = e(FilesList, {
        folder: file,
        onSelectFile: this.selectFile.bind(this),
        onBack: path.length > 1 ? this.back.bind(this) : null,
      });
    } else {
      w = e(DisplayFile, {
        file,
        onBack: this.back.bind(this),
      });
    }

    return e('div', {className: 'app'}, w);
  }

  selectFile(file) {
    this.setState(({current}) => {
      return {current: [...current, file.path[0]]};
    }, () => this.updateHash());
  }

  back(file) {
    this.setState(({current}) => {
      return {current: current.slice(0, current.length - 1)};
    }, () => this.updateHash());
  }

  updateHash() {
    if (!this.state.current || !this.state.current.length) {
      window.location = '#';
    } else {
      window.location = '#' + this.state.current.join('/');
    }
  }
}

function FilesList({folder, onSelectFile, onBack}) {
  let files = folder.children;
  return e('div', {className: 'display-folder'},
    e(FileHeader, {file: folder, onBack}),
    e('table', {className: 'files-list'},
      e('thead', {className: 'files-list__head'},
        e('tr', null,
          e('th', null, "Path"),
          e('th', null, "Coverage")
        )
      ),
      e('tbody', {className: 'files-list__body'},
        files.map(file => e(File, {file, onClick: onSelectFile}))
      )
    )
  );
}

function File({file, onClick}) {
  const coverage = file.coverable ? file.covered / file.coverable * 100 : -1;
  const coverageDelta = file.prevRun &&
    (file.covered / file.coverable * 100 - file.prevRun.covered / file.prevRun.coverable * 100);

  return e('tr', {
      className: 'files-list__file'
        + (coverage >= 0 && coverage < 50 ? ' files-list__file_low': '')
        + (coverage >= 50 && coverage < 80 ? ' files-list__file_medium': '')
        + (coverage >= 80 ? ' files-list__file_high': '')
        + (file.is_folder ? ' files-list__file_folder': ''),
      onClick: () => onClick(file),
    },
    e('td', null, pathToString(file.path)),
    e('td', null,
      file.covered + ' / ' + file.coverable +
      (coverage >= 0 ? ' (' + coverage.toFixed(2) + '%)' : ''),
      e('span', {title: 'Change from the previous run'},
        (coverageDelta ? ` (${coverageDelta > 0 ? '+' : ''}${coverageDelta.toFixed(2)}%)` : ''))
    )
  );
}

function DisplayFile({file, onBack}) {
  return e('div', {className: 'display-file'},
    e(FileHeader, {file, onBack}),
    e(FileContent, {file})
  );
}

function FileHeader({file, onBack}) {
  const coverage = file.covered / file.coverable * 100;
  const coverageDelta = file.prevRun && (coverage - file.prevRun.covered / file.prevRun.coverable * 100);

  return e('div', {className: 'file-header'},
    onBack ? e('a', {className: 'file-header__back', onClick: onBack}, 'Back') : null,
    e('div', {className: 'file-header__name'}, pathToString([...file.parent, ...file.path])),
    e('div', {className: 'file-header__stat'},
      'Covered: ' + file.covered + ' of ' + file.coverable +
      (file.coverable ? ' (' + coverage.toFixed(2) + '%)' : ''),
      e('span', {title: 'Change from the previous run'},
        (coverageDelta ? ` (${coverageDelta > 0 ? '+' : ''}${coverageDelta.toFixed(2)}%)` : ''))
    )
  );
}

function FileContent({file}) {
  return e('div', {className: 'file-content'},
    file.content.split(/\r?\n/).map((line, index) => {
      const trace = file.traces.find(trace => trace.line === index + 1);
      const covered = trace && trace.stats.Line;
      const uncovered = trace && !trace.stats.Line;
      return e('pre', {
          className: 'code-line'
            + (covered ? ' code-line_covered' : '')
            + (uncovered ? ' code-line_uncovered' : ''),
          title: trace ? JSON.stringify(trace.stats, null, 2) : null,
        }, line);
    })
  );
}

(function(){
  const commonPath = findCommonPath(data.files);
  const prevFilesMap = new Map();

  previousData && previousData.files.forEach((file) => {
    const path = file.path.slice(commonPath.length).join('/');
    prevFilesMap.set(path, file);
  });

  const files = data.files.map((file) => {
    const path = file.path.slice(commonPath.length);
    const { covered = 0, coverable = 0 } = prevFilesMap.get(path.join('/')) || {};
    return {
      ...file,
      path,
      parent: commonPath,
      prevRun: { covered, coverable },
    };
  });

  const children = findFolders(files);

  const root = {
    is_folder: true,
    children,
    path: commonPath,
    parent: [],
    covered: children.reduce((sum, file) => sum + file.covered, 0),
    coverable: children.reduce((sum, file) => sum + file.coverable, 0),
    prevRun: {
      covered: children.reduce((sum, file) => sum + file.prevRun.covered, 0),
      coverable: children.reduce((sum, file) => sum + file.prevRun.coverable, 0),
    }
  };

  ReactDOM.render(e(App, {root, prevFilesMap}), document.getElementById('root'));
}());
</script>
</body>
</html>